function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var a=0,t=new Array(e.length);a<e.length;a++)t[a]=e[a];return t}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}!function(){for(var e,a=function(){},t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=t.length,o=window.console=window.console||{};n--;)o[e=t[n]]||(o[e]=a)}();var app={core:{},plugin:{},charts:{},setup:{},menu:{},factory:{},mods:{},canvas:{},popup:{},managers:{},modHelper:{},share:{},home:{},dash:{},editor:{},common:{},console:{},lib:{}};dayjs.extend(dayjs_plugin_relativeTime),dayjs.extend(dayjs_plugin_localizedFormat),dayjs.extend(dayjs_plugin_advancedFormat),dayjs.extend(dayjs_plugin_utc),dayjs.extend(dayjs_plugin_customParseFormat),app.common.main=function(e,a,t,n,o,i,s,r,l,d){var c=this;c.notification(e,a,t,n,i,s,o,r,d),c.menu(e,a,t,o,i,r,l,s,d,n),c.session(t,o),c.undrop(t),c.urlHash(o,d)},app.common.menu=function(i,a,e,s,t,n,o,r,l,d){var c=$('<div id="logo-bar" class="header-edit container-fluid"></div>'),u=$('<div id="top-bar"></div>'),m=i.isHome?"#tmp-dash-topbar":"#tmp-primary-bar",p=$(m),f=p.find(i.isHome?".menu-tile .inside":".menu-tile"),h=$("#tmp-user-menu"),g=$("#tmp-user-menu .upgrade-btn, "+m+" .user-menu-popup .upgrade-btn");$setbut=h.find(".gear-button"),lockedTip=app.plugin.lockedTip(i,e),$userBar=p.find(".user-info"),$templateSubnav=$($("#tmp-template-nav").html());var v=!0,b=!0,T="",y="",C='<div class="new">New</div> ',w=(l.isOwner(),"Business feature"),k=app.core.padlocks(l,lockedTip,i),x=$('<div class="tipped-icon teamtemplatestab-icon"><i class="fa fa-info-circle"></i></div>'),P=$('<div class="tipped-icon mytemplatestab-icon"><i class="fa fa-info-circle"></i></div>'),S=!1,D=$('<div id="app-load-animation" style="top: 0; left: 0; position: fixed;height: 100%;width: 100%;"><div class="loading-animation"></div></div>').hide();function F(){0==S&&0<$("#top-bar .template-subnav .tipped-icon").length&&(S=!0,app.plugin.tipped(i,a,d,!1,!0))}D.find(".loading-animation").html(s.spinner),$("body").append(D),u.append(c),$userBar.css("position","relative").append($("#tmp-user-menu-popup").html()),u.append($templateSubnav),setTimeout(function(){$("#tmp-my-labels-container .item:eq(0)").hide(),$("#all-temps-button").hide(),$("#team-temps-button").hide(),$("#my-temps-button").hide();var e=u.find(".template-subnav"),t=e.find(".nav-menu a");function a(e){var a=[];a["xtensio-temp"]="#all-temps-button",a["my-temp"]="#my-temps-button",a["team-temp"]="#team-temps-button",t.removeClass("active"),$("#tmp-temp-sidebar .sidebar > .item").removeClass("active"),$(a[e.attr("class")]).addClass("active"),e.addClass("active")}0===i.Team.Id&&(v=!1,l.isFree()&&(b=!1)),T=v?C+"Team Templates":C+w+"Team Templates",y=b?"My Templates":w+"My Templates",e.find(".team-temp").html(T).append(x),e.find(".my-temp").html(y).append(P),F(),app.plugin.tooltip(),e.find(".my-temp, .team-temp").click(function(e){e.preventDefault(),$(this).find("i.fa-lock").length?s.message({heading:"You Cannot Perform this Action",message:"Templates are only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",cancelText:"Nevermind",enterAsOK:!0,notMini:!0,bodyCentered:!0,handleOK:function(){s.payment("showPlans")}}):($(this).hasClass("team-temp")&&$("#team-temps-button").click(),$(this).hasClass("my-temp")&&$("#my-temps-button").click(),a($(this)))}),e.find(".xtensio-temp").click(function(e){e.preventDefault(),$("#all-temps-button").click(),a($(this))})},500);function I(e){e.preventDefault(),l.getData(1,function(e,a,t,n){l.isFreeWithTeam()?s.payment("showPlans"):!0===l.isOldFreeUserNeverOnTrialOrPlan()?window.location.href="/teams/create":1==e.ST||2==e.ST||9==e.ST||10==e.ST||11==e.ST||a||0<i.Team.Id?s.payment("showPlans"):s.payment(),i.isTrial&&s.payment()},!0)}function M(){l.getData(1,function(e,a,t,n){l.isBusiness()||l.ownsATeam()||!l.isOwner()?(g.hide(),p.addClass("hide-upgrade-btn")):(g.show(),p.find(".plus-menu").addClass("move-left")),(e.Count||e.Referrals.length)&&$("#top-bar .nav-setmenu li.item.billing").text("Billing"),(l.isFree()||l.isPlus()||l.isPro()||!l.isOwner())&&($("#top-bar .nav-setmenu li.item.upgrade").hide(),$("#top-bar .nav-setmenu li.item.billing").hide()),l.isFreeWithTeam()&&l.isOwner()&&$("#top-bar .nav-setmenu li.item.billing").show(),i.isTrial&&$("#top-bar .nav-setmenu li.item.upgrade").show()},!0)}setTimeout(function(){!function(){if(i.fullName)try{var e=i.fullName.toUpperCase().match(/\b\w/g);e=1<e.length?e.shift()+e.pop():e.shift(),$("#top-bar .nav-setmenu").find(".initials span").text(e),$("#top-bar .nav-setmenu").find(".fullname").text(i.fullName)}catch(e){console.log("error on userDetails",e),$usrmenu.find(".initials span").text("")}}();var e=d.isOnMultipleTeams(i,l);d.updateTeamsInMenu(i,l),0==$("#top-bar .nav-setmenu .item.team-item").length&&$("#top-bar .nav-setmenu .li-sep.team-item").remove(),i.Team&&0==i.Team.Id&&$("#top-bar .nav-setmenu .li-sep.team-menu").remove();var a=$('<li class="item style-guide">Style Guide</li>');if(i.Team&&0!==i.Team.Id&&$(a).insertBefore("#top-bar .nav-setmenu .item.team-menu.team-edit"),i.Team&&0<i.Team.Id){if(l.isTeamActive(i.Team)){if($("#top-bar .nav-setmenu").find(".user-role").text(function(e){for(var a=0;a<i.TeamRoles.length;a++)if(i.TeamRoles[a].Id==e)return i.TeamRoles[a].Name}(i.Team.Role)),!e){var t=$('<li class="item team-name single-team" style="color:#000">'+i.Team.Name+"</li>");$(t).insertAfter("#top-bar .nav-setmenu .item.upgrade")}(l.isPremiumGuest()||l.isSingleFolioGuest()||l.isTeamMember())&&k.menu.teamLockedItems()}}else if(l.isPlus()||l.isPro()?$("#top-bar .nav-setmenu").find(".user-role").text("Paid Account"):$("#top-bar .nav-setmenu").find(".user-role").text("Free Account"),l.isPremiumGuest()||l.isSingleFolioGuest()||l.isTeamMember()?k.menu.teamLockedItems():k.menu.freeOldLockedItems(),0<i.UserTeams.length){$("#top-bar .nav-setmenu").find(".user-role").text("Free Account");for(var n=0;n<i.UserTeams.length;n++){var o=i.UserTeams[n];l.isTeamActive(o)&&(l.isOwner()||l.isAdmin())?e||$("#top-bar .user-menu-popup .li-sep.team-item.workspace").hide():!l.isTeamActive(o)||l.isOwner()&&l.isAdmin()||$("#top-bar .nav-setmenu .li-sep.free-menu").remove()}}$("#top-bar .nav-setmenu .team-settings").click(function(){s.teamSettingPopup()}),$("#top-bar .nav-setmenu .invite-people").click(function(){if(3===i.Team.Role){s.teamUserActionBlocked("invite-member","Team Members")}else s.teamManagePopup(!0)}),$("#top-bar .nav-setmenu .team-edit").click(function(){s.teamManagePopup()}),$("#top-bar .nav-setmenu .style-guide").click(function(){s.styleGuidePopup()}),$("#top-bar .nav-setmenu .import-folios").click(function(){s.importFolioPopup()}),$("#tmp-dash-topbar .nav-setmenu li.item.explore a").click(function(e){e.preventDefault(),$("#tmp-dash-topbar a.explore").trigger("click")})},1e3),$(m).on("click",".upgrade-btn",I),M();var E=function(){if(i.fullName)try{var e=i.fullName.toUpperCase().match(/\b\w/g);e=1<e.length?e.shift()+e.pop():e.shift(),$setbut.find(".initials").text(e)}catch(e){$setbut.find(".initials").text("")}};if(e.addListener("plusUnlocked",function(){M()}),e.addListener("plusCancelled",function(){M()}),i.plusInfo&&i.plusInfo.End>Date.now()&&e.raiseEvent("plusUnlocked"),e.addListener("nameChanged",E),E(),i.editMode){l.getData(1,function(e,a,t,n){i.UserTeams&&0<i.UserTeams.length&&l.isTeamActive(i.Team)&&i.Team&&0!=i.Team.Id&&(l.hasTeam()||l.isTeamMember()||l.isSingleFolioGuest()||l.isPremiumGuest()||l.isOwner()||l.ownsATeam())&&!l.isFreeWithTeam()&&$(m+" .upgrade-btn").remove()},!0);var U=$('<div id="folio-bar" class="header-edit container-fluid"></div>'),N=p.find(".folio-name").val(n.FolioName);u.append(U);1<n.Role&&N.on("blur",function(){var e=$.trim(N.val());2<e.length?($(".folio-name-error").fadeOut(500),a.renameFolio({name:e})):$(".folio-name-error").fadeIn(500)}),e.addListener("folioRename",function(e){n.Token==e.Token&&(n.FolioName=e.NewFolioName,N.val(e.NewFolioName))})}else p.find(".fa-angle-right").remove(),p.find(".folio-name").remove();if(c.append(p),"preview"==$.trim(window.location.hash.substr(1))&&u.hide(),$("body").prepend(u),F(),p.find(".folio-name").scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",ellips:0,wrapperWidth:"274px",animBack:!0,minScrollWidth:272,wrap:!0,callback:function(){$("#tmp-collaborators").css({"margin-left":"300px"})}}),i.ShowGdprConsent&&app.dash.globalAlert(i,a),f.append(h),o.popupMenu("#tmp-user-menu .gear-button","#top-bar .user-menu-popup"),s.getUserMenu(i,s,e,l),i.Team&&0!=i.Team.Id&&($("#tmp-dash-topbar .menu-tile .nav-main-menu a:eq(0)").contents().first().replaceWith("Folios"),i.Team.LogoUrl?($("#logo-bar .app-title a").addClass("team-logo-wrap").append('<img style="max-width: 80px; max-height: 40px; margin-top: -4px; max-height:calc(100% - 4px);" src="'+i.Team.LogoUrl+'">').css({textAlign:"center"}),$("#logo-bar .app-title a .icon-Logo").remove()):i.Team.Name&&"5"!=i.Team.Role&&(45<i.Team.Name.length&&!0!==i.editMode?$("#logo-bar .app-title a").addClass("team-name-wrap").attr("title",i.Team.Name).append('<h4 class="multiLine-title" style="color: #4c7ba0; font-weight: bold;">'+function(e){for(var a=e.split(" "),t=a.length,n="<span>",o=!0,i=0,s=0;s<t;s++)25<=(i+=a[s].length)&&o?(n=(n+="</span><span>")+a[s]+" ",o=!1):n=n+a[s]+(s==t-1?"":" ");return n+="</span>"}(i.Team.Name)+"</h4>"):$("#logo-bar .app-title a").addClass("team-name-wrap").append('<h4 style="color: #4c7ba0; font-weight: bold; ">'+i.Team.Name+"</h4>"),$("#logo-bar .app-title a .icon-Logo").remove())),setTimeout(function(){$("#top-bar .nav-setmenu li.item.upgrade").click(I),$("#logo-bar .app-title").removeClass("hidden"),k.setMenuLocks()},200),0<i.Team.Id&&1==i.Team.Role&&"nadeem@fakecrow.com"==i.userEmail){$('<li class="item team-item add-mem" style="text-decoration: underline;">Add Member</li>').insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item.add-mem").click(function(){s.addTeamMember()})}},app.common.notification=function(b,r,T,y,e,a,C,s,w){var t,k,x,n,l=[],d=[],P=[],c=[],S=$("#notify-btn"),D=$("#n-panel"),F=$("#folio-items-container"),I=D.find(".contents"),M=D.find(".load-more"),o=D.find(".loading-notifs"),E=b.msgType,U=b.nType,N=($("#trans-folio-tile").html(),$("#plus-news").html()),A=$("#data-news").html(),L=$("#transfer-news").html(),O=$("#accept-news").html(),R=$("#reject-news").html(),B=$("#receive-news").html(),Y=$("#decline-news").html(),_=$("#plus-added-news").html(),G=$("#plus-started-news").html(),H=$("#billing-saved-news").html(),z=$("#card-updated-news").html(),q=$("#plus-cancel-news").html(),K=$("#delinquent-downgraded-news").html(),j=$("#plus-expire-news").html(),V=$("#added-to-team").html(),J=$("#team-owner-changed").html(),W=$("#removed-from-team").html(),X=$("#added-to-team-for-owner").html(),Q=$("#removed-from-team-for-owner").html(),Z=$("#team-access-changed").html(),ee=($("#section-copy-moved").html(),$("#team-role-changed").html()),ae=$("#team-created").html(),te=[],ne=null,oe=99,ie=!1,se=!1,u=$("#collaboration-news").html(),m=$("#collaboration-accept-news").html(),p=$("#collaboration-reject-news").html(),f=$("#collaboration-left-news").html(),h=$("#collaboration-receive-news").html(),g=$("#collaboration-decline-news").html(),v=$("#collaboration-removed-news").html(),re=$("#collaboration-archived-news").html(),le=$("#collaboration-reverted-news").html(),de=$("#user-joined-channel").html(),ce=$("#user-joined-channel-self").html(),ue=$("#joined-channel-for-owner").html(),me=$("#joined-channel-for-TO").html(),pe=$("#user-left-channel").html(),fe=$("#user-left-channel-self").html(),he=$("#left-channel-for-owner").html(),ge=$("#left-channel-for-TO").html(),ve=$("#folio-added-to-channel").html(),be=$("#folio-added-for-owner").html(),Te=$("#folio-added-for-TO").html(),ye=$("#folio-removed-from-channel").html(),Ce=$("#folio-removed-for-owner").html(),we=$("#folio-removed-for-TO").html(),ke=$("#channel-created-for-owner").html(),xe=$("#channel-created-for-TO").html(),$e=$("#channel-created-for-member").html(),Pe=$("#channel-privacy-changed-teamvisible").html(),Se=$("#channel-privacy-changed-private").html(),De=$("#channel-privacy-changed-private-owners").html(),Fe=$("#channel-deleted").html(),Ie=$("#channel-deleted-for-owner").html(),Me=$("#channel-deleted-for-TO").html();function Ee(e){if(Array.isArray(e)){var a=e.filter(function(e){return e.New&&e.Kind!=U.teamFirstTimeSignin}).length,t=$("#n-panel").find(".new").length,n=$("#n-panel").find(".item").length,o=t<a&&t==n?a:t;S.attr("data-original-title",0==o?"No new notifications":1==o?"1 new notification":o+" new notifications")}}function Ue(e){for(var a=y.standardizeEmail(e),t=0;t<s.Collaborators.length;t++)if(y.standardizeEmail(s.Collaborators[t].Email)===a&&0<s.Collaborators[t].Privilege&&1==s.Collaborators[t].Accepted)return!0;return!1}function i(){n&&clearTimeout(n),n=setTimeout(function(){y.updateTeamsInMenu(b,w)},1e3)}function Ne(e){for(var a=!1,t=0;t<b.UserTeams.length;t++)e.Data.TeamID==b.UserTeams[t].Id&&(a=!0);if(!a){var n={Id:e.Data.TeamID,Name:e.Data.TeamName,LogoUrl:null,TeamUrl:e.Data.TeamURL,Status:0,Role:e.Data.Role};b.UserTeams.push(n)}i()}function Ae(e,a){for(var t=0;t<b.UserTeams.length;t++)if(b.UserTeams[t].Id==e){b.UserTeams.splice(t,1);break}$("#top-bar .nav-setmenu .team-item a[href*='"+a+"']").parent().remove(),i()}function Le(){M.addClass("hidden"),o.removeClass("hidden")}function Oe(){M.removeClass("hidden"),o.addClass("hidden")}function Re(e,a){Le(),a?r.loadNotifications({data:{userEmail:e,nextCount:a},success:function(){},error:function(e){Oe()}}):Oe()}function Be(e){return function(){C.signupPerformance(e.Data.ModId)}}function Ye(e){a.send(E.bRead,{Arr:e})}function _e(e,a,t,n,o,i){var s;console.log("in processTransfer func"),s={verb:e,secret:a,teamId:t},r.processTransfer({data:s,success:function(){n.parent().find(".yes, .no").remove(),"accept"===e?r.getFolioCollaborators({token:o,success:function(a){console.log("response collaborators",a),r.getWorkspaceChannels({teamId:t,success:function(e){console.log("response channels",e),b.saveFolioTransferWithTeam={FolioName:i,Token:o,collaborators:JSON.parse(a.Data),labels:JSON.parse(e.Data)},console.log("saveFolioTransferWithTeam",b.saveFolioTransferWithTeam),C.saveFolio()},error:function(e){console.log("error in getWorkspaceChannels",e)}})},error:function(e){console.log("error in getFolioCollaborators",e)}}):b.isHome&&(window.location="/")},error:function(e){5==e.StatusCode?C.plusPrompt("create",null,!0):10==e.StatusCode?C.plusPrompt("create",null,!1,!0):C.error(e.Message)}})}function Ge(e,a,t){a.verb=e,1==a.Data.AllowOutside?b.UserTeams&&0<b.UserTeams.length&&a.Data.UserDefinedTeam<0?C.transferFolioToSpace(a):b.UserTeams&&0<b.UserTeams.length&&-1<a.Data.UserDefinedTeam?b.Team&&b.Team.Id==a.Data.UserDefinedTeam&&C.transferFolioToSpace(a):a.Process&&b.isHome&&_e(e,a.Key,0,t,a.Data.Token,a.Data.Folio):_e(e,a.Key,a.Data.TeamID,t,a.Data.Token,a.Data.Folio)}function He(e,a){console.log("getProcessTransferFunc request",e);var t=a.hasClass("yes")?"accept":"reject";console.log("$this",a),"accept"===t?w.checkFoliosLimitReached(r,C,function(){Ge(t,e,a)}):Ge(t,e,a)}function ze(a){r.processSFG({data:{id:a.Id},success:function(e){window.location="https://"+a.teamURL},error:function(e){1002!=e.StatusCode&&2!=e.StatusCode&&C.error(e.Message,"Error Accepting Folio")}})}function qe(o){return function(){var a=$(this),n=a.hasClass("yes")?"accept":"reject";if("accept"!=n)return r.processCollaborator({data:{verb:n,id:o.Data.Id},success:function(){a.parent().find(".yes, .no").remove(),console.log("request",o);var e,t="https://"+o.Data.TeamURL;console.log("url",t),"accept"===n?r.getFolioCollaborators({token:o.Data.Token,success:function(a){console.log("response",a),r.getWorkspaceChannels({teamId:b.Team.Id,success:function(e){console.log("response channels",e),b.saveFolioCollabItem={FolioName:o.Data.Folio,Token:o.Data.Token,TeamID:o.Data.TeamID,TeamUrl:t,collaborators:JSON.parse(a.Data),labels:JSON.parse(e.Data)},console.log("saveFolioCollabItem",b.saveFolioCollabItem),C.saveFolio()},error:function(e){console.log("in error, getWorkspaceChannels",e)}})},error:function(e){console.log("in error, processCollaborator",e)}}):(e=o,b.isHome&&(e.Data.TeamID!=b.Team.Id?0<e.Data.TeamID?window.location="https://"+e.Data.TeamURL+"/edit/"+e.Data.Token:window.location=y.getAppUrl()+"/edit/"+e.Data.Token:window.location="/"))},error:function(e){5==e.StatusCode?C.plusPrompt("create",null,!0):10==e.StatusCode?C.plusPrompt("create",null,!1,!0):C.error(e.Message)}}),!1;window.location.href=window.location.protocol+"//"+o.Data.TeamURL+"#acceptcollab"}}function Ke(a,t){return function(){var e=t?"edit":"folio";0<a.Data.TeamID?window.open("https://"+a.Data.TeamURL+"/"+e+"/"+a.Data.Token):window.open(y.getAppUrl()+"/"+e+"/"+a.Data.Token)}}function je(a){return function(){var e=a.indexOf("http")<0?"https://":"";window.location=e+a}}function Ve(){window.location="/"}function Je(){C.billing(1)}function We(e,a,t,n){C.message({heading:e||"Folio Deleted",message:a||"This folio has been deleted by its owner. You can no longer view or edit it.",btnText:t||"Go To Dashboard",noClose:!0,enterAsOK:!0,handleOK:n||Ve})}function Xe(){C.billing()}function Qe(a){return Faltu(c).filter(function(e){return e.Data.Token&&e.Data.Token==a.Data.Token&&e.Kind==a.Kind&&e.Time>=a.Time&&e.Id!=a.Id}).get()}function Ze(e){return s&&s.Token==e||!b.isHome?s:Faltu(b.folios).find({Token:e}).get()[0]}function ea(e){var t,n,o;t=Ze(e.Data.Token),n=e,t&&(clearTimeout(l[n.Kind]),l[n.Kind]=setTimeout(function(){0<Qe(n).length||$.each(t.Collaborators,function(e,a){(n.User||n.Data.Email)==a.Email&&(t.Collaborators[e].Accepted=!o,t.Collaborators[e].Privilege=n.Data.Privilege||n.Data.Role||0,T.raiseEvent("collabChange",t))})},1e3))}function aa(e){return 1<window.location.href.indexOf(e.Data.Token)}function ta(a){c.push(a);var e,t,n,o=b.nType;if(a.Data.Folio=a.Data.Folio||"Untitled",a.Kind==o.collaboratorRequest)return(e=$(u)).find(".name").text(a.Data.Name),e.find(".role").text(1===parseInt(a.Privilege)?"view":"edit"),e.find(".folio").text(a.Data.Folio),a.Process&&d.indexOf(a.Data.Id)<0?(d.push(a.Data.Id),e.on("click",".yes, .no",qe(a))):e.find(".yes, .no").remove(),e;if(a.Kind!=o.collaboratorReceive&&a.Kind!=o.collaboratorChange)return a.Kind==o.collaboratorAccept?((e=$(m)).find(".name").text(a.Data.Name),e.find(".folio").text(a.Data.Folio),a.New&&ea(a),e.addClass("notification-clickable").click(Ke(a,!0)),e):a.Kind==o.collaboratorDecline?((e=$(g)).find(".name").text(a.Data.Name),e.find(".folio").text(a.Data.Folio),e):a.Kind==o.collaboratorReject?((e=$(p)).find(".name").text(a.Data.Name),e.find(".folio").text(a.Data.Folio),e.addClass("notification-clickable").click(Ke(a,!0)),e):a.Kind==o.collaboratorRemoveHimself?(e=$(f),a.Data.Email==b.userName?e.html('You have left "<span class="bold folio">'+a.Data.Folio+'</span>".'):(e.find(".name").text(a.Data.Name),e.find(".folio").text(a.Data.Folio),e.addClass("notification-clickable").click(Ke(a,!0))),e):a.Kind==o.collaboratorRemove?((e=$(v)).find(".folio").text(a.Data.Folio),a.New&&k&&aa(a)&&We("Access Changed","You no longer have access to this folio.",null,function(){Ye([a.Id]),Ve()}),e):a.Kind==o.collaboratorRemoveToAllCollaborators?((e=$(f)).find(".name").text(a.Data.Name),e.find(".folio").text(a.Data.Folio),s=Ze(a.Data.Token),e.addClass("notification-clickable").click(Ke(a,!0)),e):a.Kind==o.collaboratorAddedToAllCollaborators?((e=$(m)).find(".name").text(a.Data.Name),e.find(".folio").text(a.Data.Folio),e.addClass("notification-clickable").click(Ke(a,!0)),e):a.Kind==o.sendCollaboratorFolioArchived?((e=$(re)).find(".folio").text(a.Data.Folio),e):a.Kind==o.folioReverted?(e=$(le),a.Data.Email==b.userName?e.html('You have reverted to a different version of "<span class="bold folio">'+a.Data.Folio+'</span>".'):(e.find(".name").text(a.Data.Name),e.find(".folio").text(a.Data.Folio),clearTimeout(l[a.Kind]),l[a.Kind]=setTimeout(function(){var e=Qe(a);aa(a)&&a.New&&e.length<1&&a.Data.CurrentVersion&&s.CurrentVersion!==a.Data.CurrentVersion&&We("Folio Reverted",a.Data.Name+' has reverted to a different version of "'+a.Data.Folio+'".',"Refresh Page",function(){Ye([a.Id]),location.reload()})},1e3)),e.addClass("notification-clickable").click(Ke(a,!0)),e):void 0;e=$(h);var i=1===parseInt(a.Data.Role||a.Data.Privilege);a.New&&(t=a,n=1e3,Date.now()-t.Time<=(n||1e4))&&aa(a)&&We("Access Changed","Owner of this folio has "+(i?"changed your access to be view-only.":"granted you edit access."),"Reload Folio",function(){Ye([a.Id]),location.reload()});return e.find(".role").text(i?"view-only access to":"access to edit"),e.find(".folio").text(a.Data.Folio),e.addClass("notification-clickable").click(Ke(a,!0)),e}D.find(".loading-notifs > .loading-animation").html(C.spinner),Le(),$(function(){$('[data-toggle="tooltip"]').tooltip()});var na=[11,12,14,15,16,24,25,27,28,29,30,31,32,36,37],oa=function(e){for(var a=0;a<te.length;a++)te[a].Data.Token==e&&1==te[a].New&&na.indexOf(te[a].type)&&(y.removeFromList(P,te[a].Id),te[a].New=!1)};function ia(t){if(b.Team.Id==t.Data.TeamID&&t.New)if(b.userEmail==t.Data.Email)app.popup.message({heading:"Access Revoked",message:"You have been removed from this team<br>If you think this was a mistake please contact the team owner.",btnText:"Close",noClose:!0,handleOK:function(){0===b.UserTeams.length?window.location=y.getAppUrl()+"teams/create":window.location=y.getAppUrl()}});else if(b.editMode)for(var e=0;e<s.Collaborators.length;e++)s.Collaborators[e].Email==t.Data.Email&&(s.Collaborators[e].Accepted=!1,s.Collaborators[e].Privilege=0,T.raiseEvent("collabChange",s));else b.folios&&$.each(b.folios,function(e,a){for(e=0;e<a.Collaborators.length;e++)a.Collaborators[e].Email==t.Data.Email&&(a.Collaborators[e].Accepted=!1,a.Collaborators[e].Privilege=0,T.raiseEvent("collabChange",a))})}function sa(e){for(var a=0;a<b.TeamRoles.length;a++)if(b.TeamRoles[a].Id==e)return b.TeamRoles[a].Name}function ra(e){var a=$("#all-labels-container .item").length;if(e.Data.Folios&&0<e.Data.Folios.length&&b.Team&&b.Team.Id==e.Data.TeamID&&b.isHome){for(var t=[],n=0,o=[],i={Name:e.Data.LabelName,Token:e.Data.LabelToken,FolioTokens:t,Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:b.colors[a%b.colors.length]},s=0;s<e.Data.Folios.length;s++){for(var r=!1,l=0;l<b.folios.length;l++)b.folios[l].Token==e.Data.Folios[s].Token&&(r=!0);r||(n++,t.push(e.Data.Folios.Token),e.Data.Folios[s].Role=3,e.Data.Folios[s].Labels.push(i.Token),o.push(s))}if(0<n){b.labels.push(i),T.raiseEvent("addlabel",a);for(s=0;s<o.length;s++)T.raiseEvent("foliosRecieved",e.Data.Folios[o[s]],!0)}}}function la(e){$("#all-labels-container [data-name='"+e+"']").click()}T.addListener("hubMsg",function(e,a){var t,n,o,i,s,r,l,d,c=[],u=dayjs(),m=a.Notifications&&a.Notifications.filter(function(e){return!e.Data.hasOwnProperty("Id")||null!=e.Data.Id})||a;if(Oe(),x=a.TotalNotificationCount||null,ne=null==ne?a.Notifications.length:ne+(a.Notifications?10:1),0==m.length&&oe<10&&0<ne?(oe+=1,Re(b.userEmail,ne)):c=m,x&&x<=ne&&(M.remove(),Oe(),D.find(".no-more-notifs").removeClass("hidden")),"",se=ie=!1,e==E.bRead)for(p=0;p<c.Arr.length;p++)y.removeFromList(P,c.Arr[p]);else if(e==E.bell||e==E.loadMore){if(0<c.length)for(6<c.length&&D.find(".load-more").removeClass("hidden"),I.find(".empty").remove(),e==E.bell&&S.addClass("active"),Ee(c),p=0;p<c.length;p++)if(n=c[p],console.log("notification item",n),l=null,-1<na.indexOf(n.Kind)&&oa(c[p].Data.Token),te.push(c[p]),n.Kind!=U.transferFolioRequest||n.Process){switch(n.Data&&n.Data.Data&&(n.Data.Data=JSON.parse(n.Data.Data)),n.New&&n.Kind!=U.teamFirstTimeSignin&&P.push(n.Id),n.End>b.plusExpireTime&&(b.plusExpireTime=n.End),s=dayjs(n.Time),o=u.isSame(s,"day"),r=I.find('[data-time="'+s.format("YYYY-MM-DD")+'"]'),i=o?"Today":s.format("MMMM DD"),t=o?s.fromNow():s.format("hh:mm A"),o&&I.find(".block").each(function(){var e=$(this),a=e.data("tobj");a&&e.find(".date").text(a.format("MMMM DD"))}),r.length<1&&((r=$('<div class="block" data-time="'+s.format("YYYY-MM-DD")+'"><div class="date">'+i+"</div></div>")).data("tobj",s),null==x?I.prepend(r):I.append(r)),n.Kind){case U.referralSignup:(l=$(N)).find(".name").text(n.Data.Name),l.addClass("notification-clickable").click(C.plusInfo);break;case U.transferFolioRequest:case U.transferFolioAccept:case U.transferFolioReject:case U.folioReceive:case U.folioDecline:n.Kind==U.transferFolioRequest?((l=$(L)).addClass("notificationItemToken-"+n.Data.Token),l.find(".yes, .no").click(function(){var e=$(this);He(n,e)}),1==n.Data.AllowOutside?n.Process&&b.isHome&&T.raiseEvent("transferRequestArrived",n.Data):n.Data.TeamID==b.Team.Id&&T.raiseEvent("transferRequestArrived",n.Data)):n.Kind==U.transferFolioAccept?(l=$(O),k&&n.Owner!=b.userName&&!Ue(b.userName)&&(d=n.Data.Token,b.isHome&&F.find(".folio-item-shell[data-token='"+d+"']").remove(),0<window.location.href.indexOf(n.Data.Token)&&C.message({heading:"Folio Transferred",message:"This folio has been transferred. You no longer have access to edit.",btnText:"Return to Dashboard",noClose:1,handleOK:Ve})),n.New&&(Ye([n.Id]),-1==window.location.hash.search(/accepttransfer/)&&setTimeout(function(){Ve()},200))):l=n.Kind==U.transferFolioReject?$(R):n.Kind==U.folioReceive?$(B):$(Y),l.find(".name").text(n.Data.Name),l.find(".folio").text(n.Data.Folio||"Untitled"),n.Data.Token||l.addClass("simple");break;case U.plusExpiring1Week:case U.plusExpiringToday:break;case U.subscribed:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="Pro"),"Month"==n.Data.Plan&&(n.Data.Plan="Pro"),"Year"==n.Data.Plan&&(n.Data.Plan="Pro"),"PlusMonth"==n.Data.Plan&&(n.Data.Plan="Plus"),"PlusYear"==n.Data.Plan&&(n.Data.Plan="Plus"),"BusinessYearly"==n.Data.Plan&&(n.Data.Plan="Business"),"ExportCredits"==n.Data.Plan?(n.Data.Plan="Export Credits",(l=$("<div class='item'>You have purchased 5 credits. <div class='links'><a href='#' class='textlink'>See billing for details</a></div></div>")).addClass("notification-clickable").click(Xe)):(l=$("<div class='item'>You've successfully upgraded to Xtensio "+n.Data.Plan+". <div class='links'><a target='_blank' href='#' class='textlink'>See Xtensio "+n.Data.Plan+" features</a></div></div>")).find("a").attr("href","https://xtensio.com/"+n.Data.Plan+"/");break;case U.plusStarted:(l=$(G)).addClass("notification-clickable").click(Xe);break;case U.billingSaved:(l=$(H)).addClass("notification-clickable").click(Je);break;case U.cardUpdate:(l=$(z)).addClass("notification-clickable").click(Je);break;case U.planChange:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="DiscountYear"),"Month"==n.Data.Plan&&(n.Data.Plan="ProMonth"),"Year"==n.Data.Plan&&(n.Data.Plan="ProYear"),(l=$('<div class="item">You switched to '+n.Data.Plan+" plan.</div>")).addClass("notification-clickable").click(Xe);break;case U.planCancel:(l=$(q)).addClass("notification-clickable").click(Xe);break;case U.delinquentUserDowngraded:(l=$(K)).addClass("notification-clickable").click(Xe);break;case U.plusExpire:l=$(j),10==n.Data.PlanName||11==n.Data.PlanName?l.find("pname").text("Plus"):l.find("pname").text("Pro"),l.addClass("notification-clickable").click(Xe);break;case U.plusTimeAdded:(l=$(_)).find(".via").text(n.Data.Via),l.addClass("notification-clickable").click(C.plusInfo);break;case U.dataCollectionSignup:l=$(A),n.Folio=(n.Folio||"Untitled")+".",40<n.Folio.length&&(n.Folio=n.Folio.substr(n.Folio,37)+" ..."),n.Data.Count&&1<n.Data.Count&&l.find(".count").text(n.Data.Count+" form responses"),l.find(".folio").text(n.Folio),l.addClass("notification-clickable").click(Be(n)),k&&T.raiseEvent("newSignUp",n);break;case U.collaboratorAccept:case U.collaboratorDecline:case U.collaboratorReceive:n.Kind==U.collaboratorReceive&&0!=n.Data.TeamID&&D.find(".item.sfg-accept").each(function(){$this=$(this);$this.data("team");c.teamId==n.Data.TeamID&&$this.find(".yes, .no, br").remove()});case U.collaboratorReject:l=ta(n);break;case U.collaboratorRequest:(l=ta(n)).attr("data-token",n.Data.Token);break;case U.collaboratorChange:case U.collaboratorRemove:l=ta(n);break;case U.folioReverted:case U.collaboratorRemoveHimself:case U.sendCollaboratorFolioArchived:case U.collaboratorRemoveToAllCollaborators:case U.collaboratorAddedToAllCollaborators:case U.folioUpgraded:l=ta(n);break;case U.teamMemberAdded:l=1==n.Data.Role?$(J):$(V),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):b.userEmail==n.Data.Email?(l.find(".user").text("You have").removeClass("bold"),l.addClass("notification-clickable").click(je(n.Data.TeamURL))):b.userEmail!=n.Data.Email&&(l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),l.addClass("notification-clickable").click(je(n.Data.TeamURL))),l.find(".role").text(sa(n.Data.Role)),l.find(".team").text(n.Data.TeamName),l.find("a").attr("href","https://"+n.Data.TeamURL),b.Team&&b.Team.Id==n.Data.TeamID&&l.find(".links").remove(),l.attr("data-teamaddid",n.Data.TeamID),5==n.Data.Role&&(l.addClass("sfg-accept"),l.find("a").text("Accept"),l.find("a").data("team",{teamURL:n.Data.TeamURL,Id:n.Data.Id,teamId:n.Data.TeamID,notifId:n.Id}),n.New?l.find("a").on("click",function(e){e.preventDefault();var a=$(this).data("team");return Ye([a.notifId]),ze(a),$(this).parent().find(".yes, .no, br").remove(),!1}):(l.find(".yes, .no, br").remove(),l.addClass("notification-clickable").click(je(n.Data.TeamURL))),b.Team&&b.Team.Id==n.Data.TeamID&&n.New&&(Ye([n.Id]),ze({teamURL:n.Data.TeamURL,Id:n.Data.Id,teamId:n.Data.TeamID}),l.find(".yes, .no, br").remove(),l.addClass("notification-clickable").click(je(n.Data.TeamURL)))),b.Team.Id!=n.Data.TeamID&&k&&Ne(n),ie=!0;break;case U.teamMemberAddedToTO:l=$(V),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):b.userEmail==n.Data.Email?l.find(".user").text("You have").removeClass("bold"):b.userEmail!=n.Data.Email&&l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),l.find(".role").text(sa(n.Data.Role)),l.find(".team").text(n.Data.TeamName),l.find("a").attr("href","https://"+n.Data.TeamURL),b.Team&&b.Team.Id==n.Data.TeamID&&l.find(".links").remove(),l.attr("data-teamaddid",n.Data.TeamID),ie=!0;break;case U.teamMemberRemoved:(l=$(W)).find(".team").text(n.Data.TeamName),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):b.userEmail==n.Data.Email?l.find(".user").text("You have").removeClass("bold"):b.userEmail!=n.Data.Email&&l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),b.userEmail==n.Data.Email&&k&&(r.find('.item[data-teamaddid="'+n.Data.TeamID+'"]').find(".links").remove(),Ae(n.Data.TeamID,n.Data.TeamURL)),k&&ia(n),ie=!0;break;case U.teamMemberRemovedToTO:b.userEmail==n.Data.Email&&n.New&&(r.find('.item[data-teamaddid="'+n.Data.TeamID+'"]').find(".links").remove(),Ae(n.Data.TeamID,n.Data.TeamURL)),(l=$(W)).find(".team").text(n.Data.TeamName),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):b.userEmail==n.Data.Email?l.find(".user").text("You have").removeClass("bold"):b.userEmail!=n.Data.Email&&l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),n.New&&(Ye([n.Id]),ia(n)),ie=!0;break;case U.folioRecievedToTO:ra(n);break;case U.teamMemberAddedToTO:(l=$(X)).find(".team").text(n.Data.TeamName),l.find(".user").text(n.Data.Name);break;case U.teamMemberRemovedToTO:(l=$(Q)).find(".team").text(n.Data.TeamName),l.find(".user").text(n.Data.Name),ie=!0;break;case U.teamMemberAccessChanged:w.updateConfig(n),T.raiseEvent("userTeamRoleChanged",n),(l=$(Z)).find(".team").text(n.Data.TeamName),l.find(".role").text(sa(n.Data.Role));break;case U.copyMoveSectionToFolio:b.editMode&&b.token==n.Data.Token&&app.popup.message({heading:"Section Added",message:"A section from another folio has been copied or moved to this folio. Please reload to get the latest changes.",btnText:"Reload",noClose:!0,handleOK:function(){permDisc=!0,window.location.reload()}}),n.New&&Ye([n.Id]);break;case U.teamMemberAccessChanged:case U.teamMemberAccessChangedToTO:l=$(ee),b.userEmail==n.Data.Email?l.find(".user").text("Your").removeClass("bold"):l.find(".user").text((n.Data.Name||n.Data.Email)+"'s"),l.find(".role").text(sa(n.Data.Role)),l.find(".team").text(n.Data.TeamName),l.find("a").attr("href","https://"+n.Data.TeamURL),b.Team&&b.Team.Id==n.Data.TeamID&&l.find(".links").remove(),b.userEmail==n.Data.Email&&b.Team.Id==n.Data.TeamID&&n.New&&(Ye([n.Id]),app.popup.message({heading:"Team Access Changed",message:"Your Access to team has been updated. Please reload.",btnText:"Reload",noClose:!0,handleOK:function(){window.location.reload()}})),ie=!0;break;case U.transferredFolios:if(0==b.Team.Id)for(var p=0;p<n.Data.Folios.length;p++){var f=$('#folio-items-container .folio-item-shell[data-token="'+n.Data.Folios[p].Token+'"]');f.animate({width:0,opacity:0,padding:0},500,"linear",function(){f.remove()})}else if(b.Team.Id==n.Data.TeamID)for(p=0;p<n.Data.Folios.length;p++)T.raiseEvent("foliosRecieved",n.Data.Folios[p],!0);n.New&&Ye([n.Id]);break;case U.addedFromEditTemplate:n.New&&(C.addFolioToSpace(n.Data.FToken,""),Ye([n.Id]));break;case U.teamPurchased:(l=$(ae)).find(".team").text(n.Data.TeamName),l.addClass("notification-clickable").click(je(n.Data.TeamURL)),b.Team&&b.Team.Id==n.Data.TeamID&&l.find(".links").remove(),n.New&&Ye([n.Id]);break;case U.channelCreated:(l=$($e)).find(".owner").text(n.Data.ChannelOwner.FullName),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.channelCreatedOwner:(l=$(ke)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.channelCreatedTO:(l=$(xe)).find(".owner").text(n.Data.ChannelOwner.FullName),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.channelDeletedTO:(l=$(Me)).find(".channel").text(n.Data.LabelName);break;case U.channelDeletedOwner:(l=$(Ie)).find(".channel").text(n.Data.LabelName);break;case U.channelDeleted:(l=$(Fe)).find(".channel").text(n.Data.LabelName);break;case U.userJoinedChannel:l=$(de);var h=b.userEmail===n.Data.Email?"You have been":n.Data.FullName;l.find(".user").text(h),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.userJoinedChannelSelf:(l=$(ce)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.userJoinedChannelOwner:l=$(ue);h=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(h),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.userJoinedChannelTO:l=$(me);h=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(h),l.find(".channel").text(n.Data.LabelName);break;case U.userLeftChannel:l=$(pe);h=b.userEmail===n.Data.Email?"You have been":n.Data.FullName;l.find(".user").text(h),l.find(".channel").text(n.Data.LabelName);break;case U.userLeftChannelSelf:(l=$(fe)).find(".channel").text(n.Data.LabelName);break;case U.userLeftChannelOwner:l=$(he);h=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(h),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.userLeftChannelTO:l=$(ge);h=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(h),l.find(".channel").text(n.Data.LabelName);break;case U.folioAddedToChannel:(l=$(ve)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(Ke(n,!0));break;case U.folioAddedToChannelOwner:(l=$(be)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(Ke(n,!0));break;case U.folioAddedToChannelTO:(l=$(Te)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case U.folioRemovedFromChannel:(l=$(ye)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case U.folioRemovedFromChannelOwner:(l=$(Ce)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case U.folioRemovedFromChannelTO:(l=$(we)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case U.channelPrivacyChangedTeamVisible:(l=$(Pe)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.channelPrivacyChangedPrivate:(l=$(Se)).find(".channel").text(n.Data.LabelName);break;case U.channelPrivacyChangedPrivateOwners:(l=$(De)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){la(n.Data.LabelToken)});break;case U.subscriptionUpgrade:break;case U.upgradeToPaidPlan:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="DiscountYear"),"Month"==n.Data.Plan&&(n.Data.Plan="ProMonth"),"Year"==n.Data.Plan&&(n.Data.Plan="ProYear"),(l=$("<div class='item'>You've successfully started your "+n.Data.Plan+" subscription. <div class='links'><a href='#' class='textlink'>View plan details and invoices</a></div></div>")).addClass("notification-clickable").click(Xe);break;case U.teamTemplateCreated:case U.teamTemplateRemoved:var g=89===n.Kind?n.Data.Name+" has created a new team template: <b>"+n.Data.FolioName+"</b>":n.Data.Name+" has deleted the team template: <b>"+n.Data.FolioName+"</b>",v="<a href='"+("https://"+n.Data.TeamURL+"#teamtemplates")+"' class='link yes'>Go to "+n.Data.TeamName+" Templates</a>";l=$("<div class='item'>"+g+"<div class='links' style='margin-top: 10px'>"+v+"</div></div>"),n.New&&(T.raiseEvent("teamTemplateUpdate",{item:n,refreshType:"teamTemplateUpdate"}),Ye([n.Id]),se=!0);break;case U.manualPlanUpgrade:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="DiscountYear"),"Month"==n.Data.Plan&&(n.Data.Plan="ProMonth"),"Year"==n.Data.Plan&&(n.Data.Plan="ProYear"),(l=$("<div class='item'>Your plan has been updated to "+n.Data.Plan+".</div>")).addClass("notification-clickable").click(Xe)}l&&(-1<l.html().search(/undefined/g)&&(l.removeClass("notification-clickable").find("a").remove(),l.html(l.html().replace(/undefined|\:/g,""))),l.toggleClass("new",n.New),l.find(".time").text(t),l.wrapInner("<span data-id='"+n.Id+"' class='notification_wrap'></span>"),null==x?l.insertAfter(r.find(".date")):r.append(l))}k=1,function(){for(var e=I.find(".block"),a=[],t=0;t<e.length;t++)0==$(e[t]).find(".item").length&&a.push($(e[t]));a.forEach(function(e){e.remove()})}()}void 0===c.Arr&&S.toggleClass("active",0<P.length),Ee(c),ie&&se&&setTimeout(function(){S.addClass("active"),Ee(c)},300)}),S.add(D.find(".close-btn")).click(function(){return t?(D.find(".new").removeClass("new"),S.tooltip("hide").attr("data-original-title","No new notifications")):(S.removeClass("active"),0<P.length&&(Ye(P),S.tooltip("hide").attr("data-original-title","No new notifications"))),t=!t,D.toggle(),!1}),M.click(function(){return oe=0,Re(b.userEmail,ne),!1}),T.addListener("docClick",function(e){t&&D.find(".close-btn").click()}),C.failedPaymentAddUser()},app.common.session=function(e,a){e.addListener("loggedOut",function(e){a.message({heading:"Signin Required",message:"Session expired. Please sign in again.",btnText:"Sign In",noClose:!0,handleOK:function(){a.signIn(!0,function(){a.close(),e()})}})})},app.common.undrop=function(e){e.addListener("docClick",function(a){$(".top-comp").removeClass("top-comp"),$(".drop-down-container").each(function(){var e=$(this);0===e.closest(".keep-open").length&&0===e.has(a.target).length&&(e.find(".drop-down").slideUp(150),e.find(".drop-down-open").removeClass("drop-down-open"),e.removeClass("showing"))}),$(".two-state-container.editing").each(function(){var e=$(this);0===e.has(a.target).length&&e.removeClass("editing")}),$(".edit-content.active").each(function(){var e=$(this);0===e.has(a.target).length&&e.removeClass("active")}),$(".gear-drop-down").each(function(){var e=$(this);0!==e.has(a.target).length||e.is(a.target)||e.find(".drop-down").slideUp(150)})})},app.common.urlHash=function(a,t){function n(){var e=$.trim(window.location.hash.substr(1));"styleguide"==e?a.styleGuidePopup():"invitepeople"==e?a.teamManagePopup():"managepeople"==e?a.teamManagePopup():"teamsettings"==e?a.teamSettingPopup():"managecolors"==e?(a.styleGuidePopup(),setTimeout(function(){$("#tmp-style-guide .popup-header .tabs span:eq(1)").trigger("click")},1e3)):"billing"==e?t.isOwner()&&a.billing():"signup-plans"===e?a.signupPlansPopup():"compareplans"===e||"seeplans"===e?t.isAdmin()||t.isTeamMember()||t.isPremiumGuest()||t.isSingleFolioGuest()?window.location="/":a.payment("showPlans"):"plus"==e?a.plusInfo():"manage-notifications"==e?a.emailSettings():0<=e.indexOf("res-")?(e=e.replace("res-",""),a.signupPerformance(e)):"active"==e?app.dash.changeView(0):"shared"==e?app.dash.changeView(1):"archived"==e?app.dash.changeView(2):"mytemplates"===e?setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click"),setTimeout(function(){$("#top-bar").find(".my-temp").trigger("click")},100)},2e3):"teamtemplates"===e?setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click"),setTimeout(function(){$("#top-bar").find(".team-temp").trigger("click")},100)},2e3):"xtensiotemplates"===e?setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click"),setTimeout(function(){$("#top-bar").find(".xtensio-temp").trigger("click")},100)},2e3):"examples"===e&&setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .examples-link").trigger("click")},2e3)}window.onpopstate=function(){var e=document.location.href;-1<(e=e.toLowerCase()).indexOf("account/teamsignup")?a.signUp():-1<e.indexOf("account/signup")?a.signUp():-1<e.indexOf("account/signin")?a.signIn():-1<e.indexOf("teams/create")?a.signUpTeam():-1<e.indexOf("#")&&n()},n()},app.menu.bgPanel=function(e,t){e.apiHelper,e.eventManager;var n,o,i,a=$("#tmp-change-bg-panel").html(),s=$("<div>"),r=$(a),l=r.find(".gallery-container"),d=r.find(".img-btn"),c=r.find(".gallery-btn"),u=r.find(".color-btn"),m=r.find(".color-buttons"),p=r.find(".reset-btn"),f=r.find(".adjust-btn"),h=r.find(".adjust-btn + .sep");return d.uploader({type:"bg",success:function(e){t.add(e)},imageLoaded:function(e){}}),u.on("click",function(){t.$node.hide(),n.$node.toggle()}),c.on("click",function(){n.$node.hide(),t.$node.toggle()}),p.on("click",function(){o()}),f.on("click",function(){i()}),{$node:r,detach:function(){r.hide(),$("body").append(r)},setCallback:t.setCallback,mount:function(e,a){"none"!==e.parent().css("backgroundImage")?(f.show(),h.show()):(f.hide(),h.hide()),a.bgUrl,o=a.reset,n=a.colorPanel,i=a.adjustBgFn,s.append(m.find("> div")),m.append(n.$node),t.mount(l,a),e.append(r),n.$node.hide(),t.$node.hide(),r.hide()}}},app.menu.getColorPanelFunc=function(h,g){var t=$("#tmp-color-buttons").html(),v=["#66d7c4","#ffd271","#fd9f4d","#f67157","#e95f5e","#ffffff","#dcbb9f","#76d5e5","#6486a5","#2e5668","#d45d77","#9d557c","#7e8589","#000000","#052b3e"];function e(e){var t=[];return e.forEach(function(e,a){t.push(e.HexCode.toString().toLowerCase())}),t}return console.log("config",h),0!==h.Team.Id&&void 0!==h.StyleGuides?v=e(h.StyleGuides[0].TeamColors):void 0!==h.DefaultColors&&(v=e(h.DefaultColors)),function(d,c){var u=$(t),m=u.find(".text-box"),p=u.find(".sample"),e=u.find(".btn"),f=u.find(".color-list");$.each(v,function(e,a){var t=$('<div class="color-btn col-sm-3"><i class="icon-CheckMark"></i></div>').css("background-color",a).data("color",a).addClass(a==d?"selected":"");f.append(t)});var a=function(e){var a=m.val(),t=null,n=u.parent().hasClass("module-buttons")?"scheme":"bg",o=u.closest(".module-container").attr("id");if(void 0===o){var i=u.closest(".section-settings").index();o="edit-sections .section-settings:nth-child(".concat(i+1,")")}-1===(a=a.toString().trim().toLowerCase()).indexOf("#")&&(a="#"+a),m.val(a);var s=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a);if(m.toggleClass("error",!s),s&&d!=a){if(p.css("background-color",a),-1!==v.indexOf(a)){var r=g.utility.hex2Rgb?g.utility.hex2Rgb(a):null;r=r.r?"rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")"):null;var l=f.find(".color-btn").filter(function(){var e=$(this).css("background-color");return e===a||e===r});l&&(l.addClass("selected"),t=l.index()),f.find('[data-color="'.concat(a,'"]')).addClass("selected")}else f.find(".color-btn").removeClass("selected");g.eventManager.raiseEvent("sendUpdateColorPalette",{token:h.token,hex:a,data:{elm:o,pickerType:n,listMatch:t}}),e&&(c(a),u.hide(),d=a)}};return f.on("click",".color-btn",function(){var e=$(this);$(".color-btn.selected").removeClass("selected"),e.addClass("selected"),m.val(e.data("color")),c(e.data("color")),a()}),u.find(".sample").colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var a=this.$UI;return e.hasClass("btn-picker")?a.appendTo("#picker-container"):a.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,a){var t=e.parent().find("input[type=text]");!0!==a&&t.val("#"+this.color.colors.HEX)}}),m.on("change",function(){a()}),e.on("click",function(){a(!0)}),m.val(d),p.css("background-color",d),{$node:u}}},app.menu.getColumnPicker=function(){var e=["One","Two","Three","Four","Five","Six"];return function(o,a){var i=$('<div class="column-picker child drop-down">');return $.each(e,function(e,a){var t=e+1,n=$('<div class="btn num-btn settings-btn" data-num="'+t+'"><span>'+a+"</span></div>").addClass(t==o?"selected":"");i.append(n)}),i.on("click",".num-btn",function(){var e=$(this);i.find(".selected").removeClass("selected"),e.addClass("selected"),a(e.data("num"))}),{$node:i}}},app.menu.getFolioButtonsFunc=function(e,a,t){var n=a.appHub,o=$("#tmp-secondary-bar").find(".nav-settings");var i=t(e.Modules[0].Data.Theme,function(a){e.Modules.forEach(function(e){e.applyStyle&&(e.applyStyle(a),e.editObj&&e.editObj.applyStyle&&e.editObj.applyStyle(a,!0)),e.Data.Theme=a,n.sync(e,"Theme",a)})}),s=$("#tmp-secondary-bar").find(".folio-color-scheme");o.append(i.$node),s.on("click",function(e){i.$node.toggle()}),o.find(".theme-picker .color-picker .sample").colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var a=this.$UI;return e.hasClass("btn-picker")?a.appendTo("#picker-container"):a.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,a){var t=e.parent().find("input[type=text]");!0!==a&&t.val("#"+this.color.colors.HEX)}})},app.menu.gallery=function(e,a,t){var o,s,r=e.imageLibrary,n=t.apiHelper,l=t.utility,i=t.appHub,d=$('<div class="cover-image-preview"></div>'),c=l.obtain(a.Modules,"Type","DataModule"),u=a.UserBgImages||[],m=[];function p(e){return-1<m.indexOf(e.Id)||e.isLibraryItem}function f(e,a){var t=a&&a.length?a:d.find("[data-id='"+e+"']");d.find(".cover-image-thumb").each(function(){var e=$(this),a=l.obtain(r,"Id",e.data("id"));e.removeClass("selected used"),p(a)&&e.addClass("used")}),t.addClass("used selected")}0<r.length&&r.unshift(r.pop()),$.each(r,function(e,a){a.isLibraryItem=!0}),r=u.concat(r);var h=function(a,e){var t=$('<div class="cover-image-thumb" data-id="'+a.Id+'"><span class="fi-x close-btn"></span><img src="'+a.ThumbUrl+'"/></div>');p(a)&&t.addClass("used"),e?d.prepend(t):d.append(t),t.on("click",function(e){t.hasClass("selected")||$(e.target).hasClass("close-btn")||(o&&o(a.ImageUrl),f(null,t))}),e&&t.click()};function g(t){var n=d.find("[data-id="+t+"]");$.each(r,function(e,a){if(a.Id==t)return p(a)||(n.remove(),r.splice(e,1)),!1})}d.on("click",".close-btn",function(){var e=$(this).closest(".cover-image-thumb").data("id");n.deleteImage(e,function(){g(e)},function(){}),i.sync(c,"ImageRemove",e)});var v=function(e){d.find('[data-id="'+e.Id+'"]').toggleClass("used",p(e))},b=!0;function T(e){r.unshift(e),h(e,!0),v(e)}return i.reg(c,"ImageAdd",function(e,a){T(a)}),i.reg(c,"ImageRemove",function(e,a){g(a)}),{$node:d,add:function(e){var a={Id:e.Data,ThumbUrl:e.Message,ImageUrl:e.Message};T(a),i.sync(c,"ImageAdd",a)},mount:function(e,a){if(b){for(var t=0;t<r.length;t++)d.find("[data-id='"+r[t].Id+"']").length<1&&h(r[t]);b=!1}var n=l.obtain(r,"ImageUrl",a.url);o=a.bgUrl,d.find(".selected").removeClass("selected"),n&&f(n.Id),e.append(d)},setCallback:function(e){o=e},changeImage:function(e,a){e=e!=a?e:s;var t,n,o,i=l.obtain(r,"ImageUrl",e);i&&(t=i.Id,-1<(n=m.indexOf(t))&&m.splice(n,1),v(i)),(i=l.obtain(r,"ImageUrl",a))&&(o=i.Id,m.push(o),f(i.Id),v(i)),s=a}}},app.menu.main=function(e,a,t,n){console.log(e);var o=app.menu,i=o.getColorPanelFunc(e,t),s=o.getColumnPicker(),r=o.getVertGraphType(),l=o.gallery(e,a,t),d=o.bgPanel(t,l),c=o.getModButtonsFunc(a,t,n,i,d,s,r),u=o.getSectionButtonsFunc(t,i,d,n,app,e,t.apiHelper,t.utility);return o.getFolioButtonsFunc(a,t,i),{changeImage:l.changeImage,setCallback:l.setCallback,colorPicker:i,bgPanel:d,modButtons:c,sectionButtons:u,detach:function(){d.detach()}}},app.menu.getModButtonsFunc=function(W,e,X,Q,Z,ee,ae){var te=e.appHub,ne=e.eventManager,oe=$("#tmp-mod-settings").html();return function(t,n,e){function o(e,a){r.Theme=e,n.applyStyle(e),n.editObj&&n.editObj.applyStyle&&n.editObj.applyStyle(e,!0),a||te.sync(n,"Theme",e)}var a,i,s,r=n.Data,l=$(oe),d=e.changeColumns,c=e.addModule,u=e.align,m=e.addItem,p=Q(r.Theme,o),f=l.find(".drop-down .btn"),h=l.find(".button-panel"),g=l.find(".add-mod-btn"),v=h.find(".col-btn"),b=h.find(".theme-btn"),T=h.find(".bg-panel-btn"),y=h.find(".share-btn"),C=h.find(".exp-btn"),w=h.find(".dup-btn"),k=h.find(".del-btn"),x=h.find(".adv-btn"),P=h.find(".cls-btn"),S=l.find(".mod-setting-btn"),D=l.find(".mod-top-buttons"),F=D.find(".plus"),I=D.find(".align"),M=l.find(".adv-panel"),E=l.find(".border-btn").text((1==r.Border?"Hide":"Show")+" Border"),U=l.find(".header-btn").text((1==r.Head?"Hide":"Show")+" Header"),N=l.find(".txt-btn").text((1==r.Txt?"Hide":"Show")+" Text"),A=M.add(Z.$node).add(p.$node),L=D.find(".add"),O=D.find(".column"),R=D.find(".color"),B=D.find(".background"),Y=D.find(".more"),_=D.find(".vertBarLine"),G=e.changeGraphType;function H(e,a,t){var n=$(window).width()-(a.offset().left+a.outerWidth());e.css({left:n<210?"unset":"164px",right:n<210?t+"px":"unset"})}function z(e){A.not(e.toggle()).hide()}if(a=Q(r.BgColor,function(e){t.bgColor(n,e)}),l.append(p.$node),l.append(Z.$node),l.find(".border-btn").on("click",function(){$(this).toggleClass("is-present")}),f.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),b.on("click",function(){H(p.$node,$(this),5),z(p.$node)}),T.on("click",function(){H(Z.$node,$(this),5),z(Z.$node)}),x.on("click",function(){H(M,$(this),164),z(M)}),c?g.click(c):g.remove(),u&&"Text"!=n.Type?(I.attr("class","align icon-Align"+r.Align),I.find(".align-btn").on("click",function(){var e=$(this).data("align");I.attr("class","align icon-Align"+e),r.Align=e,u(),te.sync(n,"Align",e)})):I.remove(),m){var q=-1<n.Type.search(/image/gi)?"Image":-1<n.Type.search(/chart|scale/gi)?"Segment":n.Type;F.data("tip","Add "+q),F.click(function(){m(),te.sync(n,"Items",r.Items)})}else F.remove();function K(){console.log("module.clone",n.clone),n.clone?n.clone():t.modManager.duplicateModule(n)}function j(e){e.css("position","absolute"),e.css("left","-9999px"),e.css("opacity","0")}function V(e){void 0!==e?e?h.slideDown(150):h.slideUp(150):h.slideToggle(150),S.toggleClass("drop-down-open"),S.closest(".drop-down-container").toggleClass("showing"),S.closest(".edit-content").addClass("active"),z($("<p>")),J(),setTimeout(function(){l.closest(".module-container, .edit-div").addClass("top-comp")},0)}function J(){Z.mount(l,{url:r.BgUrl,colorPanel:a,bgUrl:function(a){X.bgImageAdjust(n.$editNode,a,function(e){t.bgUrl(n,a),t.bgPositionY(n,e),t.bgPositionX(n,e),t.bgSize(n,e)})},adjustBgFn:function(){X.bgImageAdjust(n.$editNode,r.BgUrl,function(e){t.bgUrl(n,r.BgUrl),t.bgPositionY(n,e),t.bgPositionX(n,e),t.bgSize(n,e)})},reset:function(){t.resetBg(n)}})}return d?(i=ee(r.Arr.length,d),l.append(i.$node),A=A.add(i.$node),v.on("click",function(){z(i.$node)})):v.remove(),E.on("click",function(){r.Theme;r.Border=1==r.Border?2:1,E.text((1==r.Border?"Hide":"Show")+" Border"),te.sync(n,"Border",r.Border),n.$editNode.css({borderWidth:1==r.Border?"1px":"0"})}),U.on("click",function(){r.Theme;r.Head=1==r.Head?2:1,n.editObj.$node.find("> .header-container").css({display:1==r.Head?"":"none"}),U.text((1==r.Head?"Hide":"Show")+" Header"),te.sync(n,"Head",r.Head)}),N.remove(),k.on("click",function(){h.slideToggle(150),t.removeModule(n,!1,function(){te.sync(n,"RemoveModule"),setTimeout(function(){ne.raiseEvent("moduleRemoved",n)},100)})}),w.on("click",function(){h.slideToggle(150),t.modManager.currentAction("dup"),K(),te.sync(n,"DuplicateModule")}),n.menuCb=function(e,a){"Head"==e?(U.text((1==r.Head?"Hide":"Show")+" Header"),n.editObj.$node.find("> .header-container").css({display:1==r.Head?"":"none"})):"Txt"==e?N.text((1==r.Txt?"Hide":"Show")+" Text"):"Col"==e||("Theme"==e?o(r.Theme,!0):"BgColor"==e?t.bgColor(n,r.BgColor,!0):"BgUrl"==e?(Z.showAdjustBg(),Z.setCallback(null),t.bgUrl(n,r.BgUrl,!0)):"BgPositionY"==e?t.bgPositionY(n,r.BgPositionY,!0):"BgPositionX"==e?t.bgPositionX(n,r.BgPositionX,!0):"BgSize"==e?t.bgSize(n,r.BgSize,!0):"ResetBg"==e?t.resetBg(n,!0):"Border"==e?(E.text((1==r.Border?"Hide":"Show")+" Border"),n.$editNode.css({borderWidth:1==r.Border?"1px":"0"})):"DuplicateModule"==e?K():"RemoveModule"==e&&t.removeModule(n,!0))},C.on("click",function(){h.slideToggle(150),t.handleExport(n)}),y.on("click",function(){h.slideToggle(150),t.shareModule(W,n)}),P.on("click",function(){X.message({heading:"Format Class",message:"One or more css class names for the module. You can use these class names to provide custom styles under Folio Settings.",btnText:"Save",showInput:1,enterAsOK:1,input:r.CssClass||r.FormatClass,handleOK:function(e){n.$editNode.add(n.$previewNode).removeClass(r.CssClass).addClass(e),r.CssClass=e,te.sync(n,"CssClass",e)}})}),S.on("click",function(){V()}),l.find(".theme-picker .color-picker .sample").colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var a=this.$UI;return e.hasClass("btn-picker")?a.appendTo("#picker-container"):a.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,a){var t=e.parent().find("input[type=text]");!0!==a&&t.val("#"+this.color.colors.HEX)}}),w.css("padding-top","10px"),R.click(function(){z(p.$node),h.hide()}),B.click(function(){0===l.find(".bg-panel").length&&J();var e=$(this).position();l.find(".bg-panel").css({top:0,left:"".concat(e.left,"px")}),z(Z.$node),h.hide()}),l.find(".theme-picker").css({top:0,left:"38px"}),j(T),j(b),"RowBreak"==n.Type&&(B.remove(),b.remove(),T.remove(),y.remove(),C.remove(),x.remove()),"Canvas"===n.Type?(j(g),j(v),h.find(".sep").first().hide(),l.find(".column-picker").css({top:0,left:"54px"}),l.find(".theme-picker").css({top:0,left:"83px"}),L.click(function(){var e;e=g,V(!1),setTimeout(function(){e.trigger("click")},200)}),O.click(function(){z(i.$node),$(this)}),D.find(".move").click(function(){}),!0):(L.remove(),O.remove(),Y.remove()),"Vertical Bar"===n.Type?G&&(s=ae(r.graphType,G),l.append(s.$node),A=A.add(s.$node),_.on("click",function(){z(s.$node)})):_.remove(),{$node:l}}},window.jQuery?function(i){i.fn.passwordify=function(e){var o=i.extend({maxLength:8,numbersOnly:!1,alphaOnly:!1,alNumOnly:!1,enterKeyCallback:null,charToShow:4},e),a="\\s\\S";o.numbersOnly&&(a="0-9"),o.alphaOnly&&(a="A-z"),o.alNumOnly&&(a="0-9A-z");for(var t="",n=0;n<o.maxLength;n++)t+="Z";return this.on("input",function(e){var a=-1===i(this).val().indexOf("*"),t=a?i(this).val():i(this).data("val"),n=i(this).val().length-i(this).data("val").length;a?i(this).data("val",i(this).val()):0<n?i(this).data("val",t+i(this).val().substring(t.length,t.length+n)):n<0&&i(this).data("val",t.substring(0,t.length+n)),t=i(this).data("val"),i(this).val(t.substring(0,t.length>o.charToShow?t.length-o.charToShow:0).replace(/./g,"*")+t.slice(-o.charToShow))}).mask(t,{translation:{Z:{pattern:"["+a+"*]"}}})}}(jQuery):console.log("Passwordify.js: $(this) class requires jQuery > v3!"),function(u){u.fn.scrollText=function(e){var t,n,o,a,s=u.extend({speed:4e3,minScrollWidth:0,startEvent:"mouseenter",stopEvent:"mouseleave",wrap:!1,ellips:0,wrapperWidth:0,animBack:!1,callback:!1},e);function i(e){if(s.minScrollWidth||(s.minScrollWidth=e.outerWidth()+s.ellips),n=function(e,a,t){t||(t="");var n=e.get(0).tagName;"input"==n.toLowerCase()&&(n="div");var o=u("<"+n+">");o.css({visibility:"hidden",position:"absolute","white-space":"pre","text-overflow":"unset","font-family":e.css("font-family"),"font-weight":e.css("font-weight"),"font-size":e.css("font-size")}).addClass(t+" tmp-calc").html(e.is("input")?e.val():e.html()),a.append(o);var i=a.find(".tmp-calc").outerWidth();return o.remove(),s.ellips&&(i+=s.ellips),i}(e,u("body")),e.attr("text-width",n),e.hasClass("animate")?l(e):(s.wrap&&e.wrap('<span class="animation-wrapper" style="position:fixed; width: '+s.wrapperWidth+'">'),e.addClass("animate"),t=e.outerWidth(),e.attr("elem-width",t),e.css({"text-overflow":"unset"}),e.parent().css({overflow:"hidden"}),s.callback&&s.callback()),t=parseInt(e.attr("elem-width")),(n=parseInt(e.attr("text-width")))>s.minScrollWidth){e.css("width",n+"px"),e.css("max-width",n+"px");var a=(n-s.minScrollWidth)/100*s.speed;a<2e3&&(a=2e3),o=a,d(e,n-s.minScrollWidth,o)}else l(e)}function r(e){e.stop()}function l(e){r(e),e.animate({"margin-left":"-="+e.css("margin-left")},{duration:o,step:function(e,a){},progress:function(e,a,t){}})}function d(t,n,o){if(!t.length)return!1;r(t);var e=parseInt(t.css("margin-left"));if(e<0){e=n-Math.abs(e);var a=o;return t.animate({"margin-left":"-="+e+"px"},{duration:a,step:function(e,a){},progress:function(e,a,t){},done:function(e,a){c(t,n,o)}}),!1}t.animate({"margin-left":"-="+n+"px"},{duration:o,step:function(e,a){},progress:function(e,a,t){},done:function(e,a){c(t,n,o)}})}function c(t,n,o){t.animate({"margin-left":"+="+n+"px"},{duration:o,step:function(e,a){},progress:function(e,a,t){},done:function(e,a){d(t,n,o)}})}this.each(function(){var t=u(this);s.startEvent&&"all"!=s.startEvent?t.on(s.startEvent,function(){i(t),s.stopEvent&&t.on(s.stopEvent,function(){r(t)})}):i(t),s.stopEvent&&t.on(s.stopEvent,function(){if(s.animBack){clearTimeout(a);var e=(n-s.minScrollWidth)/100*s.speed*.5;a=setTimeout(function(){t.animate({"margin-left":"0"},{duration:e,step:function(e,a){},progress:function(e,a,t){},done:function(e,a){l(t)}})},300)}else r(t)})})}}(jQuery),app.menu.getSectionButtonsFunc=function(e,C,w,k,x,P,S,D){var F=$("#tmp-section-settings").html();return function(e,a){var t=$(F),n=t.find(".drop-down .btn"),o=t.find(".button-panel"),i=t.find(".move-menu"),s=t.find(".more-menu"),r=t.find(".add-mod-btn"),l=o.find(".bg-panel-btn"),d=s.find(".exp-btn"),c=s.find(".del-sec-btn"),u=s.find(".dup-btn"),m=o.find(".move-sec-btn"),p=o.find(".more-sec-btn"),f=s.find(".copy-to-folio-btn"),h=s.find(".move-to-folio-btn"),g=t.find(".sec-btn"),v=t.find(".adjust-btn"),b=t.find(".adjust-btn + .sep");v.hide(),b.hide();var T=C(e.BgColor,a.bgColor),y=function(){o.slideToggle(150),g.toggleClass("drop-down-open"),g.closest(".drop-down-container").toggleClass("showing"),g.closest(".edit-content").addClass("active"),i.hide(),s.hide()};return n.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),i.on("click","button",function(){y(),a.move($(this).data("action"))}),s.on("click","button",function(){y(),a.move($(this).data("action"))}),l.on("click",function(){i.hide(),s.hide(),w.$node.toggle(),Tipped.hideAll()}),c.on("click",function(){y(),a.del()}),u.on("click",function(){y(),a.dup()}),d.on("click",function(){y(),a.handleExport()}),m.on("click",function(){w.$node.hide(),s.hide(),i.toggle(),Tipped.hideAll()}),p.on("click",function(){w.$node.hide(),i.hide(),s.toggle(),Tipped.hideAll()}),f.on("click",function(){y(),k.copySectionPopup($(this).closest(".edit-div").index(),"Copy Section")}),h.on("click",function(){y(),k.copySectionPopup($(this).closest(".edit-div").index(),"Move Section",function(){a.del(!0)})}),r.on("click",function(){a.addModule()}),g.on("click",function(){o.fadeToggle(200),g.toggleClass("drop-down-open"),g.closest(".drop-down-container").toggleClass("showing"),g.closest(".edit-content").addClass("active"),i.hide(),s.hide(),w.$node.hide(),x.plugin.tipped(P,S,D,!0),w.mount(t,{url:e.BgUrl,colorPanel:T,bgUrl:a.bgUrl,adjustBgFn:a.adjustBgFn,reset:a.resetBg})}),{$node:t}}},app.menu.getVertGraphType=function(){var e=["Bar","Line"];return function(n,a){var o=$('<div class="vert-graph-type-picker child drop-down">');return $.each(e,function(e,a){var t=$('<div class="btn vert-graph-type-btn settings-btn" data-vertgraphtype="'+a+'"><span>'+a+"</span></div>").addClass(a==n?"selected":"");o.append(t)}),o.on("click",".vert-graph-type-btn",function(){var e=$(this);o.find(".selected").removeClass("selected"),e.addClass("selected"),a(e.data("vertgraphtype")),console.log("getVertGraphType clicked on click vert-graph-type-btn ")}),{$node:o}}},app.menu.xSelect=function(){var e=$(".x-select");function o(e,a){a.siblings().removeClass("active"),a.addClass("active");var t=a.data("name")||a.text(),n=a.data("value")||t;e.data("value",n).find(".text").text(t)}$.each(e,function(e,a){var n=$(a),t=n.find(".popup-menu");n.on("click",".item",function(e){var a=$(this);n.hasClass("no-select")||a.hasClass("active")||(o(n,a),n.trigger("change"))}),n.on("val",function(e,a,t){o(n,n.find(".item[data-"+a+'="'+t+'"]'))}),t.length&&app.plugin.popupMenu(n,t)})},function(g){g.fn.xautocomplete=function(e){var m,p=this,a=e.container.find(".search-font-clear"),f=g.extend({minLength:2},e);function t(e){if(!e)return!1;!function(e){for(var a=0;a<e.length;a++)e[a].classList.remove("autocomplete-active")}(e),m>=e.length&&(m=0),m<0&&(m=e.length-1),e[m].classList.add("autocomplete-active")}function h(e){if(e==p.get(0))return!1;var a=g(".autocomplete-items");return!!a.length&&(f.close?(!g(e).parents("#autocomplete-list").length&&g(e).hasClass("autocomplete-items"),f.close(e,a),!1):void a.each(function(){e!=g(this).get(0)&&g(this).remove()}))}return f.source(function(u){p.get(0).addEventListener("input",function(e){var a,o,t,n=this.value;if(h(),!n||n.length<f.minLength)return!1;m=-1,(a=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),a.setAttribute("class","autocomplete-items"),a.style.width=p.css("width"),a.style.position="absolute",a.style.backgroundColor="#ffffff",this.parentNode.appendChild(a);var i=!1;for(t=0;t<u.length;t++){var s=u[t].label,r=u[t].value,l=u[t].data;if(s.substr(0,n.length).toUpperCase()==n.toUpperCase()){i=!0,o=document.createElement("DIV");var d="<strong>"+s.substr(0,n.length)+"</strong>";if(d+=s.substr(n.length),f.addElement){var c=f.addElement(e,o,d,s,r,l);c.append("<input type='hidden' title='"+s+"' value='"+r+"'>"),c.on("click",function(e){var a=g(this).get(0),t=a.getElementsByTagName("input")[0].value,n=a.getElementsByTagName("input")[0].getAttribute("title");f.select?(p.val(n),f.select(e,o,t,l)):(p.val(t),h())}),g(a).append(c)}else d+="<input type='hidden' title='"+s+"' value='"+r+"'>",o.innerHTML=d,o.addEventListener("click",function(e){var a=this.getElementsByTagName("input")[0].value,t=this.getElementsByTagName("input")[0].getAttribute("title");f.select?(p.val(t),f.select(e,o,a,l)):(p.val(a),h())}),a.appendChild(o)}}return!i&&f.errorMsg?((o=document.createElement("DIV")).innerHTML=f.errorMsg,a.appendChild(o),!1):void 0})}),p.get(0).addEventListener("keydown",function(e){var a=document.getElementById(this.id+"autocomplete-list");a&&(a=a.getElementsByTagName("div")),40==e.keyCode?(m++,t(a)):38==e.keyCode?(m--,t(a)):13==e.keyCode&&(e.preventDefault(),-1<m&&a&&a[m].click())}),g(document).on("click",function(e){h(e.target)}),a.on("click",function(e){h(e.target),p.val("")}),p.closest(".app-popup .paper").on("click",function(e){h(e.target)}),this}}(jQuery),function(o){o.fn.extend({addTimedClass:function(a,e,t){var n=this;return setTimeout(function(e){n.removeClass(a),t&&t(e,n)},e),this.each(function(){o(this).addClass(a)})}})}(jQuery),function(t){t.fn.xpassword=function(e){var a=t.extend({preview:!1,previewFontClass:"eye"},e);function r(e){for(var a="",t=0;t<e;t++)a+="*";return a}return this.each(function(){var o=t(this),i="",s=t('<input type="hidden" />');if(o.before(s),a.preview){var e=t('<i class="'+a.previewFontClass+'"></i>');o.after(e),e.css({cursor:"pointer"}),e.on("click",function(){o.val(s.val()),setTimeout(function(){o.val(r(o.val().length))},2e3)})}s.attr("name",o.attr("name")),s.attr("id",o.attr("id")),s.addClass(o.attr("class")),s.addClass("hiddenpass"),o.attr("type","text").removeAttr("name").removeAttr("id"),o.on("keypress",function(e){var a,t=e.which;if(32<=t&&t<=127){var n=String.fromCharCode(t);(a="",void 0!==window.getSelection?a=window.getSelection().toString():void 0!==document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a).length?s.val(n):s.val(s.val()+n)}}),o.on("keyup",function(e){var a=e.which;if(8==a){var t=o.val().length;s.val(s.val().substring(0,t))}else if(37==a);else{var n=o.val().length;o.val(r(n-1)+o.val().substring(n-1))}i&&clearTimeout(i),i=setTimeout(function(){o.val(r(o.val().length))},2e3)})}),this}}(jQuery),app.core.apiHelper=function(u,n,m,e,a){var t,p=!1;function o(s){var a,r=0,l=s.maxAttempts||100,d=100,c=0;return function o(i){var e;s.noPause||!p?(i=i||2,r++<l?a=$.ajax({type:"POST",url:s.url,data:(e=s.data,"__RequestVerificationToken="+u.verificationToken+(e?"&"+e:"")),success:function(e,a,t){var n;$("#saving-popup").removeClass("error").hide(),r=l,1==e.StatusCode?s.success&&s.success(e):401==e.StatusCode?(p=!0,r--,m.raiseEvent("loggedOut",function(){p=!1})):1001==e.StatusCode?(r--,$("#saving-popup").show().addClass("error").find(".popup-text").text("Not logged in."),console.log("Status 1001 Detected"),console.log("tokenRefresh",c),console.log("maxTokenRefresh",d),c<d?(c++,n=function(){o(1)},$.ajax({url:"/Account/RefreshToken",type:"POST",success:function(e,a,t){var n=$("<div />").html(e).find('input[type="hidden"]').val();n&&(u.verificationToken=n,m.raiseEvent("tokenRenewed"))},complete:n})):(console.error("ABORTING: Maximum token refresh of "+d+" has been reached."),$("#saving-popup").show().addClass("error").find(".popup-text").text("Something went wrong. Please try again later."))):s.appError&&s.appError(e)},error:function(e,a,t){if("abort"!=a)if(r===l)s.error&&s.error(e,a,t);else{var n=Math.min(6e4,1e3*(i+i));setTimeout(o,n)}},complete:function(e,a){r===l&&s.complete&&s.complete(e,a)}}):(a=null,console.log("ABORTING: Maximum attempts of "+l+" has been exhausted"))):setTimeout(function(){o(i)},3e3)}(),{abort:function(){r=l,a&&4!=a.readystate&&a.abort()}}}function l(e,a,t,n){a.addClass("error"),t.html(n),setTimeout(function(){a.fadeOut("slow")},8e3),e.error()}function s(n){o({maxAttempts:n.maxAttempts||1,url:n.url,data:$.param(n.data),success:n.success,appError:n.error,noPause:n.noPause,error:function(e,a,t){n.error&&n.error({Message:"Failed to connect. Please try again."})},complete:n.complete})}function i(e){return e.replace(/[<>]/gi,"")}function r(e,a){s({url:e,data:a.data,success:a.success,error:a.error,complete:a.complete})}function d(e){s({url:"/labels/AddRemoveChannelCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function d(e){s({url:"/labels/AddRemoveChannelCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}return $("#saving-popup").append($("#spinner-container > .loading-animation").clone().addClass("size-30")),_defineProperty(t={signIn:function(e,a,t,n,o,i){console.log(i),s({url:"/Account/LoginAJAX",noPause:!0,data:{Email:e,Password:a,RememberMe:t,returnUrl:u.returnUrl+"#"+window.location.hash.substr(1),FolioToken:i},success:n,error:o})},signUp:function(e,a,t){s({url:"/Account/RegisterAJAX",data:$.extend({refToken:u.refToken},e),success:function(e){try{window.intercomSettings=e.IntercomConfig,sendIntercom(),ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(e){}a()},error:t})},TeamSignUp:function(e,a,t){s({url:"/Account/RegisterTeamAJAX",data:$.extend({refToken:u.refToken},e),success:function(e){try{window.intercomSettings=e.IntercomConfig,sendIntercom(),ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(e){}a()},error:t})},deleteModule:function(e){e&&e.ID&&0<e.ID&&o({url:"/Apiv1/DeleteModule",maxAttempts:999,data:$.param({token:u.token,moduleId:e.ID})})},deleteModules:function(e){e&&o({url:"/Apiv1/DeleteModules",maxAttempts:999,data:$.param({token:u.token,moduleIds:e})})},sendShareEmail:function(e){s({url:"/Apiv1/ShareFolioByEmail",data:{token:e.token||u.token,modId:e.modId,message:e.message,emails:e.addresses&&$.trim(e.addresses)},success:e.success,error:e.error,complete:e.complete})},sendLabelEmail:function(e){s({url:"/Labels/ShareByEmail",data:{token:e.token,message:e.message,emails:e.addresses&&$.trim(e.addresses)},success:e.success,error:e.error,complete:e.complete})},uploadImage:function(e,a,n,t){var o=new FormData(e),i=$("#uploading-popup"),s=i.find(".popup-text"),r=$('<span class="upload-progress"></span>');i.removeClass("error").show();try{if(a.type.indexOf("image")<0)return void l(n,i,s,"Please use an image for background.");if(t&&a.size>u.FreeUserLimitPerImage)return l(n,i,s,"File size exceeds the 1MB limit,  but if you upgrade to a premium plan you can upload images up to 5MB."),void m.raiseEvent("free-exceedsize");if(a.size>u.PaidUserLimitPerImage)return void l(n,i,s,"The image is too big. <br/>Maximum size for uploads is 5MB.")}catch(e){}i.find(".upload-progress").length||s.text("Uploading image").after(r),r.show(),o.append("token",u.token),o.append("type",n.type||"image"),o.append("custom",n.custom),o.append("__RequestVerificationToken",u.verificationToken),$.ajax({url:"/Apiv1/UploadImage",type:"POST",data:o,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return i.show(),e.upload.onprogress=function(e){r.text((e.loaded&&1/e.total*100).toFixed(0)+"%")},e.upload.onload=function(){s.text("Processing image .."),r.hide()},e},success:function(e,a,t){i.show(),1==e.StatusCode?(s.text("Image uploaded"),r.hide(),setTimeout(function(){s.text("Downloading image")},300),n.success&&n.success(e),$("<img>").attr("src",e.Message).on("load",function(){i.fadeOut(),n.imageLoaded&&n.imageLoaded(e.Message),$(this).remove()})):l(n,i,s,e.Message)},error:function(e,a,t){n.error(),s.text("Image Failed to process."),r.hide(),setTimeout(function(){i.hide(),r.show(),s.text("Uploading image")},2e3)}})},deleteImage:function(e,a,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),o({maxAttempts:1,url:"/Apiv1/DeleteBgImage",data:$.param({token:u.token,imageId:e}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),a()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(n){function e(e,a,t){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(e,a,t){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")}),complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})},saveModuleRecord:function(e){o({url:"/Apiv1/SaveModuleRecord",maxAttempts:1,data:$.param({token:u.token,moduleId:e.moduleId,data:JSON.stringify(e.dataObj)}),success:e.success,appError:e.error,error:e.error})},resendEmail:function(e){s({url:"/Account/ResendConfirmationEmailAJAX",data:{Email:e.email},success:e.success,error:e.error})},forgotPassword:function(e){s({url:"/Account/ForgotPassword",data:{Email:e.email},success:e.success,error:e.error,appError:e.error})},changePassword:function(e){s({url:"/Account/ChangePassword",data:{OldPassword:e.oldPassword,NewPassword:e.newPassword,ConfirmPassword:e.confirmPassword},success:e.success,error:e.error})},changeEmail:function(e){s({url:"/Account/ChangeEmail",data:{email:e.email},success:e.success,error:e.error})},changeFullName:function(e){s({url:"/Account/ChangeName",data:{name:e.fullName},success:e.success,error:e.error})},sanitizeText:i,cleanAmp:function(e){return e.replace(new RegExp("&amp;","g"),"&")},renameFolio:function(a){if(!a.isAuto||!u.renameAutoSaveDisabled){var t=$("#tmp-secondary-bar").find(".nav-save-section");t.addClass("saving"),s({url:"/Apiv1/RenameFolio",data:{token:a.token||u.token,name:i(a.name),isAuto:a.isAuto||!1},success:function(e){t.removeClass("saving").addClass("saved"),setTimeout(function(){t.removeClass("saved")},1500),u.renameAutoSaveDisabled=!0,n&&(n.FolioName=a.name),a.success&&a.success(e)},error:a.error})}},setSlug:function(e){s({url:"/Apiv1/SetSlug",data:{token:e.token||u.token,slug:e.slug},success:e.success,error:e.error})},duplicateFolio:function(e){var a=e.teamId||0;0!==e.teamId&&u.Team&&0<u.Team.Id&&(a=e.teamId||u.Team.Id),s({url:"/Apiv1/Duplicate",data:{token:e.token,name:e.name,CopiedFromTemplate:e.fToken,teamId:a},success:e.success,error:e.error,complete:e.complete})},exportFolio:function(a){s({url:"/Apiv1/Export",data:{token:u.token,html:a.html,format:a.format,settings:a.settings&&JSON.stringify(a.settings)},success:a.success,error:function(e){6==e.StatusCode&&(u.plusExpireTime=Date.now()),a.error(e)},complete:a.complete})},setObjPass:function(a){s({url:a.isLabel?"/labels/SetPass":"/Apiv1/SetFolioPass",data:{token:a.token,pass:a.pass},success:a.success,error:function(e){6==e.StatusCode&&(u.plusExpireTime=Date.now()),a.error(e)},complete:a.complete})},removeObjPass:function(a){s({url:a.isLabel?"/labels/RemovePass":"/Apiv1/RemoveFolioPass",data:{token:a.token},success:a.success,error:function(e){6==e.StatusCode&&(u.plusExpireTime=Date.now()),a.error(e)},complete:a.complete})},getFreePlusInfo:function(n){o({maxAttempts:1,url:"/Apiv1/GetFreePlusInfo",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})},getFolioByToken:function(e){s({url:"/Apiv1/GetFolioByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getFolioFullByToken:function(e){s({url:"/Apiv1/GetFolioFullByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getTooltips:function(e){s({url:"/Apiv1/GetTooltips",data:{},success:e.success,error:e.error,complete:e.complete})},deleteFolio:function(e){s({url:"/Apiv1/DeleteFolio",data:e.data,success:e.success,error:e.error,complete:e.complete})},submitFolio:function(e){s({url:"/Apiv1/SubmitFolio",data:{token:e.token||u.token},success:e.success,appError:e.appError,error:e.error})},updatePrivacy:function(e,a){s({url:e.isLabel?"/labels/ChangePrivacy":"/Apiv1/ChangeFolioPrivacy",data:{token:e.Token,isPrivate:e.Private,isIndexed:e.Indexed},success:a.success,error:a.error,complete:a.complete})},getMaxTag:function(e){s({url:"/Apiv1/GetMaxTag",data:{count:e.count,token:e.token},success:e.success,error:e.error,complete:e.complete})},templateMods:function(e){s({url:"/Apiv1/GetTemplateMods2",data:{name:e.name,id:e.token},success:e.success,error:e.error,complete:e.complete})},addCollaborator:function(e){s({url:"/Apiv1/AddCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})},changeCollaborator:function(e){s({url:"/Apiv1/ChangeCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})},transfer:function(e){e.teamId=0,u.Team&&0<u.Team.Id&&(e.teamId=u.Team.Id),s({url:"/Apiv1/TransferFolio",data:e.data,success:e.success,error:e.error,complete:e.complete})},upgradeFolio:function(e){s({url:"/Apiv1/UpgradeFolio",data:{token:u.token||e.token},success:e.success,error:e.error,complete:e.complete})},getRecords:function(e){s({url:"/Apiv1/GetModRecords",data:{id:e.id},success:e.success,error:e.error,complete:e.complete})},emailSettings:function(e){s({url:"/Apiv1/EmailSettings",data:e.data||{},success:e.success,error:e.error,complete:e.complete})},findUser:function(e){s({url:"/Apiv1/FindUser",data:{email:e.email},success:e.success,error:e.error,complete:e.complete})},getUserFolioCountFromTeam:function(e){s({url:"/Apiv1/GetUserFolioCountFromTeam",data:{username:e.username,teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})},processTransfer:function(e){e.teamId=e.teamId||0,u.Team&&0<u.Team.Id&&(e.teamId=e.teamId||u.Team.Id),s({url:"/Apiv1/ProcessTransfer",data:e.data,success:e.success,error:e.error,complete:e.complete})},processCollaborator:function(e){s({url:"/Apiv1/ProcessCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})},modStore:function(e){r("/Apiv1/ModStore",e)},folioStore:function(e){r("/Apiv1/FolioStore",e)},card:function(e){s({url:"/billing/changecard/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})},buy:function(e){s({url:"/billing/purchase/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})},changePlan:function(e){s({url:"/billing/CancelPlanAtPeriodEnd/",data:e.data,success:e.success,error:e.error,complete:e.complete})},cancelPlan:function(e){s({url:"/billing/cancelplan/",data:e.data,success:e.success,error:e.error,complete:e.complete})},createFolio:function(e){var a=0;u.Team&&0<u.Team.Id&&(a=u.Team.Id),s({url:"/create/"+e.id,data:{teamId:a},success:e.success,error:e.error,complete:e.complete})},createLabel:function(e){s({url:"/labels/create",data:{name:e.name,title:e.title||"",desc:e.desc||""},success:e.success,error:e.error,complete:e.complete})},changeLabels:function(e){s({url:"/labels/change",data:{token:e.token,list:e.list},success:e.success,error:e.error,complete:e.complete})},changeCollabChan:function(e){s({url:"/labels/ChangeCollabChan",data:{token:e.token,labelToken:e.labelToken},success:e.success,error:e.error,complete:e.complete})},removeFromCollabChan:function(e){s({url:"/labels/RemoveLableFromFolioCollabChan",data:{token:e.token,labelId:e.id},success:e.success,error:e.error,complete:e.complete})},changeLabelProps:function(e,a){s({url:"/labels/ChangeLabelProps",data:{labelId:e.Token,title:e.Title,desc:e.Description},success:a.success,error:a.error,complete:a.complete})},renameLabel:function(e){s({url:"/labels/ChangeLabelName",data:{labelId:e.token,name:e.name},success:e.success,error:e.error,complete:e.complete})},removeLabel:function(e){s({url:"/labels/remove",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})},removeCollabChan:function(e){s({url:"/labels/RemoveCollabChan",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})},setLastChannel:function(e){s({url:"/apiv1/SetLastChannel",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getChannelsOfAFolio:function(e){s({url:"/Apiv1/GetChannelsOfAFolio",data:e.data,success:e.success,error:e.error,complete:e.complete})},makeLabelDefault:function(e){s({url:"/labels/MakeDefault",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})},getChannelOwner:function(e){s({url:"/labels/getLabelOwner",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getChannelCollaborators:function(e){s({url:"/labels/GetChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})},addMultipleChannelCollaborators:function(e){s({url:"/labels/AddMultipleChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})},addRemoveChannelCollaborator:d,getLabelOwner:function(e){s({url:"/labels/GetLabelOwner",data:e.data,success:e.success,error:e.error,complete:e.complete})},getWorkspaceChannels:function(e){u.Team&&0<u.Team.Id&&u.Team.Id,s({url:"/labels/GetWorkspaceChannels",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})},createCollabChan:function(e){s({url:"/labels/CreateCollabChan",data:e.data,success:e.success,error:e.error,complete:e.complete})},saveChannelCollaborators:function(e){s({url:"/labels/SaveChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})},changeChannelAccess:function(e){s({url:"/labels/ChangeChannelAccess",data:e.data,success:e.success,error:e.error,complete:e.complete})}},"addRemoveChannelCollaborator",d),_defineProperty(t,"getDashboardData",function(e){s({url:"/apiv1/GetDashboardData",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getExampleData",function(e){s({url:"/apiv1/GetExampleData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getFolioCollaborators",function(e){s({url:"/Apiv1/GetFolioCollaborators",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"folioVersion",function(e){s({url:"/apiv1/version",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getTagStore",function(e){s({url:"/apiv1/GetTagStore",data:{token:n.Token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"changePresentMode",function(e){s({url:"/Apiv1/ChangePresentationMode",data:{token:e.token||u.token,isPresentable:e.present},success:e.success,appError:e.appError,error:e.error})}),_defineProperty(t,"saveFolioSnapShot",function(e){s({url:"/apiv1/SaveFolio",data:{data:e.data,token:n.Token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"makeFolioFromSnapshot",function(e){s({url:"/apiv1/MakeFolioFromSnapshot",data:{folioToken:e.token,data:JSON.stringify(e.data),verb:e.verb,name:e.name,channels:e.channels},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getRemovedFolioData",function(e){s({url:"/apiv1/GetRemovedFolioData",data:{folioToken:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"removeFromLabels",function(e){s({url:"/labels/RemoveLableFromFolio",data:{token:e.token,labelId:e.id},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"loadNotifications",function(e){s({url:"/Apiv1/UserInAppNotifications",data:{email:e.data.userEmail,nextCount:e.data.nextCount},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getRecentMessages",function(e){s({url:"/Apiv1/Pull",data:{timestamp:e.data.timestamp,token:e.data.token,connectionId:e.data.connecId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"checkTeamURL",function(e){s({url:"/TeamApi/CheckTeamURL",data:{data:e.data.teamUrl},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"uploadTeamImage",function(e,a,n){var t=new FormData(e),o=$("#uploading-popup"),i=o.find(".popup-text"),s=$('<span class="upload-progress"></span>');n.isProgress&&o.removeClass("error").show();try{if(a.type.indexOf("image")<0)return void(n.isProgress?l(n,o,i,"Please use an image for background."):n.error("Please use an image for background."));if(a.size>u.PaidUserLimitPerImage)return void(n.isProgress?l(n,o,i,"The image is too big. Maximum size for uploads is 5MB."):n.error("The image is too big. Maximum size for uploads is 5MB."))}catch(e){}n.isProgress&&(o.find(".upload-progress").length||i.text("Uploading image").after(s),s.show()),t.append("token",u.teamId),t.append("type",n.type||"image"),t.append("custom",n.custom),t.append("__RequestVerificationToken",u.verificationToken),t.append("file",a),$.ajax({url:"/TeamApi/UploadTeamImage",type:"POST",data:t,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,a,t){n.isProgress?(o.show(),1==e.StatusCode?(i.text("Image uploaded"),s.hide(),setTimeout(function(){i.text("Downloading image")},300),n.success&&n.success(e),$("<img>").attr("src",e.Message).on("load",function(){o.fadeOut(),n.imageLoaded&&n.imageLoaded(e.Message),$(this).remove()})):l(n,o,i,"Error. Please try again.")):1==e.StatusCode?n.success(e):n.error("Error. Please try again.")},error:function(e,a,t){n.isProgress?n.error():n.error(t)}})}),_defineProperty(t,"deleteTeamImage",function(e,a,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),o({maxAttempts:1,url:"/TeampApi/DeleteTeamImage",data:$.param({teamId:u.teamId,imageId:e}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),a()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(n){function e(e,a,t){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(e,a,t){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")}),complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})}),_defineProperty(t,"saveTeam",function(e){s({url:"/TeamApi/SaveTeam",data:{email:e.data.email,teamMem:JSON.stringify(e.data.members),teamId:e.data.teamId,imageID:e.data.imageID,data:JSON.stringify(e.data.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"deleteTeam",function(e){s({url:"/TeamApi/DeleteTeam",data:{email:e.data.email,teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"listTeamMembers",function(e){s({url:"/TeamApi/GetTeamMembers",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"listALLMembers",function(e){s({url:"/TeamApi/GetAllMembers",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getTeamSetCount",function(e){s({url:"/TeamApi/GetTeamSetCount",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getMember",function(e){s({url:"/TeamApi/GetTeamUser",data:{teamId:e.data.teamId,email:e.data.email},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getExportCreditsLeft",function(e){s({url:"/Apiv1/GetExportCreditsLeft",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getCreditsLeft",function(e){s({url:"/Apiv1/GetCreditsLeft",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getUserActiveFoliosCount",function(e){s({url:"/Apiv1/GetUserActiveFolios",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getStripInvoiceData",function(e){s({url:"/Apiv1/GetInvoiceTabData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getFolioDataPoints",function(e){s({url:"/Apiv1/GetFolioDataPoints",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getUserFolios",function(e){s({url:"/Apiv1/GetUserFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getUserOwnFolios",function(e){s({url:"/Apiv1/GetUserOwnFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getCopySections",function(e){s({url:"/Apiv1/CopySections",data:{sourceToken:e.sourceToken,destinationToken:e.destinationToken,sectionTag:e.sectionTag,order:e.order,action:e.action},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"moveUserFolios",function(e){s({url:"/TeamApi/MoveFolios",data:{userEmail:e.userEmail,source:e.source,destination:e.destination,folios:e.folios},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"addSingleFolioGuest",function(e){s({url:"/TeamApi/AddSingleFolioGuest",data:{members:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"removeSingleFolioGuest",function(e){s({url:"/TeamApi/RemoveSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"setUserDefinedTeam",function(e){s({url:"/Apiv1/UpdateNotification",data:{id:e.notificationId,teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"resendSFGEmailNotification",function(e){s({url:"/TeamApi/ReSendEmailNotificationSFG",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"processSFG",function(e){s({url:"/TeamApi/ProcessSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"saveAsTemplate",function(e){s({url:"/Apiv1/SaveAsTemplate",data:{token:e.token,name:e.name,teamId:e.teamId,CopiedFromTemplate:e.CopiedFromTemplate,isTeamTemplate:e.isTeamTemplate},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"switchTemplateTypes",function(e){s({url:"/Apiv1/SwitchTemplateTypes",data:{token:e.token,op:e.op},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"deleteUserTemplate",function(e){s({url:"/Apiv1/DeleteTemplate",data:{token:e.token,op:e.op},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getUserTemplateCount",function(e){s({url:"/Apiv1/GetUserTemplateCount",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"resendTeamUser",function(e){s({url:"/TeamApi/AddResendUser",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"changeMemberAccess",function(e){s({url:"/billing/ChangeAccess",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"purchaseTeam",function(e){s({url:"/Billing/PurchaseTeam",data:{teamInfo:JSON.stringify(e.data.teamInfo),billingInfo:JSON.stringify(e.data.billingInfo)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"addMembers",function(e){s({url:"/Billing/AddTeamMembers/",data:{teamMembers:JSON.stringify(e.data.teamMembers)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"removeMember",function(e){s({url:"/Billing/RemoveTeamMember/",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"removeTeamMemberReactivation",function(e){s({url:"/Billing/RemoveTeamMemberReactivation/",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getTemplateData",function(e){s({url:"/apiv1/GetTemplateData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"emptyTrash",function(e){s({url:"/Apiv1/EmptyTrash",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"searchFonts",function(n){o({maxAttempts:1,type:"GET",url:"/Apiv1/SearchFont",data:$.param(n.data),success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"getAllFonts",function(n){o({maxAttempts:1,type:"GET",url:"/Apiv1/GetAllFonts",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"makeDefault",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/MakeDefault",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"addFont",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/AddFont",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"removeFont",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RemoveFont",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"savePalette",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/SavePalette",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"updateColor",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/UpdateColor",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"addColor",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/AddColor",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"removeColor",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RemoveColor",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"makeColorDefault",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/MakeColorDefault",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"restoreDefaultFonts",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RestoreDefaultFonts ",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"restoreDefaultColors",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RestoreDefaultColors",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"uploadSwatch",function(e,a,n,t){var o=new FormData(e);o.append("token",u.teamId),o.append("__RequestVerificationToken",u.verificationToken),o.append("file",a),o.append("swatchSource",n.source||1),$.ajax({url:"/Apiv1/UploadSwatch",type:"POST",data:o,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,a,t){n.success(e)},error:function(e,a,t){n.error(t)}})}),_defineProperty(t,"getDefaultStyleTeamCreation",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/GetDefaultStyleGuideForTeamCreation",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"getStyleGuides",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/GetStyleGuides",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"saveLog",function(e){s({url:"/Apiv1/SaveFrontEndLog",data:{data:JSON.stringify(e.data.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"setGdprConsent",function(n){o({maxAttempts:1,type:"POST",url:"/Apiv1/SetGdprConsent",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"updateFolioCurl",function(e){s({url:"/Apiv1/UpdateFoliosCurl",data:{curl:e.curl,token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"checkCurlAvailability",function(e){s({url:"/Apiv1/CheckCurlIsAvailable",data:{curl:e.curl,token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getFolioCurl",function(e){s({url:"/Apiv1/GetFoliosCurl",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getFolioData",function(e){s({url:"/apiv1/GetFolioData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getLabelData",function(e){s({url:"/apiv1/GetLabelData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"removeFoliosCurl",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RemoveFoliosCurl",success:n.success,appError:n.error,error:function(e,a,t){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(t,"saveFolio",function(e){s({url:"/Apiv1/CreateFolio",data:{teamId:e.teamId,token:e.folioToken,data:JSON.stringify(e),id:e.templateId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getFolioLastSaveTimestamp",function(e){s({url:"/apiv1/GetFolioLastSaveTimestamp",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"uploadCustomFont",function(e,a,n){var t=new FormData(e);t.append("__RequestVerificationToken",u.verificationToken),t.append("fontFile",a),$.ajax({url:"/Apiv1/UploadCustomFont",type:"POST",data:t,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,a,t){n.success(e)},error:function(e,a,t){n.error(t)}})}),_defineProperty(t,"setOnboardingStatus",function(e){s({url:"/Apiv1/SetOnboardingStatus",data:{step:e.step,onboardingType:e.onboardingType},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"upgrade",function(e){s({url:"/billing/Upgrade",data:{plan:e.plan,data:JSON.stringify(e.data),teamMembers:JSON.stringify(e.teamMembers)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"changeTeamPlan",function(e){s({url:"/billing/ChangeTeamPlan",data:{plan:e.plan},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"buyCredits",function(e){s({url:"/billing/PurchaseCredits",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"getUserTeamsAndFolios",function(e){s({url:"/TeamApi/GetUserTeamsAndFolios",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"buyCreditsWithoutCard",function(e){s({url:"/billing/PurchaseCreditsWithoutCard",data:{data:JSON.stringify(e)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"removeUnpaidMembers",function(e){s({url:"/billing/RemoveUnpaidMembers",data:{userEmails:e.data},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(t,"setTooltipUserClick",function(e){s({url:"/Apiv1/SetUserClick",data:{objectId:e.tooltipId,clickType:e.type},success:e.success,error:e.error,complete:e.complete})}),t},app.core.appHub=function(s,r,e,o,l,i,a){var d,n,c,t,u=s.timeStamp,m=Date.now(),p={},f=[],h={},g=[],v=[],b=[],T=[],y=app.editor.saveSpinner,C=$.connection.appHub,w=(s.msgType,$("#notify-popup")),k=!1,x=null,P=!1,S=!1,D=!1,F=[],I=[],M=null,E=null,U=!1,N="",A=0,L=!1,O=!1,R=!1,B=!1,Y=1e4,_=100,G=0,H=[],z=80;function q(e){console.log(e)}function K(){var t=[];return $.each(l.Modules,function(e,a){"EmptyModule"!==a.Type&&t.push({Tag:a.Tag||0,ModType:a.Type||null,ModId:a.ID||0,Data:JSON.stringify(a.Data)})}),t}function j(){return l.Modules.length}function V(e){B=!0;var a=K();ye(),i.saveFolioSnapShot({data:JSON.stringify(a),success:function(e){console.log("saveFolioSnapShot response",e),R="Success"!==e.Status},error:function(e){R=!0,console.log("saveFolioSnapshot error",e)},complete:function(){B=!1,e&&"function"==typeof e&&e()}})}setInterval(function(){if(0==A)A=Date.now();else{var e=Date.now();13e4<e-A?(q("unable to connect, notify popup unable"),s.editMode&&J("unable")):A=Date.now()}},1e4);w.find(".btn-manual-save").click(function(e){e.preventDefault(),app.popup.folioVersion(s,s.token)});var J=function e(a,t){if(!L&&(s.editMode||s.userName)&&!w.hasClass("logged-in")&&!(w.hasClass("unable")||w.hasClass(a)||w.hasClass("off")&&("synclost"==a||"stilltrying"==a)||w.hasClass("stilltrying")&&"synclost"==a||"stilltrying"==a&&w.hasClass("savingdelayed")||w.hasClass("savingdelayed")&&"on"==a&&t||w.hasClass("savingdelayed")&&"synclost"==a||(clearTimeout(M),"on"==a&&7!=d))){w.removeClass("off on unable synclost stilltrying savingdelayed gettingchanges logged-in "),w.addClass(a).show(),"synclost"==a&&(M=setTimeout(function(){s.editMode&&e("stilltrying")},15e3));$(".add-module-button, .module-button.dup-btn, .module-button.del-btn, .module-button.del-sec-btn, .preview-bottom .white-blue-btn,.empty-module .add-btn, .settings-btn.add-mod-btn, .tag-module .tag-close, .slider-outer .item-close-btn, .images-module .close-btn, .donut-module .breakup-row .item-close-btn"),$(".settings-btn.gallery-btn, .settings-btn.img-btn");"off"!=a&&"stilltrying"!=a&&"savingdelayed"!=a||($("body").addClass("no-internet"),s.editMode&&(U=!0,E=setTimeout(function(){U&&s.editMode&&e("unable")},12e4))),"on"==a&&(U=!1,clearTimeout(E),$("body").removeClass("no-internet"),$("body").removeClass("block-reload"),M=setTimeout(function(){w.fadeOut(500)},2500),s.editMode&&le()),"unable"==a&&(console.trace(),$.connection.hub.stop(),k=!0,$("body").addClass("block-reload"))}},W=function(e){s.editMode&&(1===e?(P=!1,x=setTimeout(function(){P||(q(" Sync was delayed",console.trace()),s.editMode&&J("savingdelayed"),x=setTimeout(function(){P||(q("unable to connect, show unable popup notify"),s.editMode&&J("unable"))},12e4))},15e3)):2===e&&(clearTimeout(x),P=!0,s.editMode&&J("on")))};function X(e){switch(e.EventType){case 24:e.Data.TeamID===s.Team.Id&&r.raiseEvent("collabRequestArrived",e);break;case 27:case 32:case 36:Q(Z(e.Data.Token),e,!0);break;case 31:case 37:Q(Z(e.Data.Token),e,!1);break;case 30:case 34:r.raiseEvent("folioArchived",e.Data);break;case 58:r.raiseEvent("folioRename",e.Data);break;case 61:r.raiseEvent("userJoinedChannel",e.Data);break;case 62:r.raiseEvent("userJoinedChannelOwner",e.Data);break;case 64:r.raiseEvent("userLeftChannel",e.Data);break;case 65:r.raiseEvent("userLeftChannelOwner",e.Data);break;case 67:case 68:r.raiseEvent("folioAddedToChannel",e.Data);break;case 70:case 71:r.raiseEvent("folioRemovedFromChannel",e.Data);break;case 73:r.raiseEvent("channelDelete",e.Data);break;case 76:r.raiseEvent("channelAdd",e.Data);break;case 80:r.raiseEvent("channelChangedTeamVisible",e.Data);break;case 81:case 82:r.raiseEvent("channelChangedPrivate",e.Data)}console.log("appHub markEventDelivered: ",e.Id),C.server.markEventDelivered(e.Id)}function Q(t,n,o){t&&(clearTimeout(H[n.EventType]),H[n.EventType]=setTimeout(function(){$.each(t.Collaborators,function(e,a){(n.User||n.Data.Email)==a.Email&&(t.Collaborators[e].Accepted=!o,t.Collaborators[e].Privilege=n.Data.Privilege||n.Data.Role||0,r.raiseEvent("collabChange",t))})},1e3))}function Z(e){return Faltu(s.folios).find({Token:e}).get()[0]}$.connection.hub.logging=!0,s.pendingUpdateNotifications||(s.pendingUpdateNotifications=[]),$.connection.hub.error(function(e){console.log("SignalR error: "+e)}),r.addListener("processPendingNotifications",function(){if(s.pendingUpdateNotifications&&0<s.pendingUpdateNotifications.length){console.log("processing pending notifs: ",s.pendingUpdateNotifications);for(var e=s.pendingUpdateNotifications.length;e--;){var a=s.pendingUpdateNotifications[e],t=a.event,n=a.messageType,o=a.parsedData;"update"===t&&r.raiseEvent("hubMsg",n,o),"feed"===t&&X(o),s.pendingUpdateNotifications.splice(e,1)}}}),r.addListener("folioDataLoading",function(){setTimeout(function(){w.find(".logged-in .text").html("Loading your folios..."),w.removeClass("on").addClass("logged-in").show(),setTimeout(function(){w.hide("slow").removeClass("logged-in")},2e3)},1e3)}),C.client.update=function(e,a){try{var t=JSON.parse(a);s.isDashboard?s.isFollioDataInit?r.raiseEvent("hubMsg",e,t):s.pendingUpdateNotifications.push({event:"update",messageType:e,parsedData:t}):r.raiseEvent("hubMsg",e,t)}catch(e){console.log("appHub update error: ",e)}},C.client.feed=function(e,a){try{var t=JSON.parse(a);console.log("appHub feed: "+e,t),Array.isArray(t)&&t.forEach(function(e){console.log(e),s.isFollioDataInit?X(e):s.pendingUpdateNotifications.push({event:"feed",parsedData:e,messageType:"eventHub"})})}catch(e){console.log("appHub feed error: ",e)}},r.addListener("sendUpdateColorPalette",function(e){var a=e.token,t=e.hex,n=e.data;console.log("updateColorPalette server invoke",{token:a,hex:t,data:n}),C.server.updateColorPalette(a,t,JSON.stringify(n))}),C.client.updatecolorpalette=function(e,a){try{var t=JSON.parse(e),n=t.elm,o=t.listMatch,i=t.pickerType,s=$("#".concat(n)),r="scheme"===i?".module-buttons .theme-picker:first":".bg-panel";console.log("updateColorPalette client event",{elm:n,listMatch:o,hex:a}),s.find("".concat(r," .sample")).css("background-color",a),s.find("".concat(r," input.text-box")).val(a),s.find("".concat(r," .color-list .color-btn")).removeClass("selected"),null!==o&&s.find("".concat(r," .color-list .color-btn")).eq(o).addClass("selected")}catch(e){console.log("updateColorPalette client event error",e)}},C.client.editorOnDash=function(e,a,t,n,o){r.raiseEvent("editorStatusOnDash",{email:a,status:2==e?2:1,folioToken:o})},C.client.editorSendBackStatus=function(e,a,t,n,o){s.editMode&&(s.userEmail,s.fullName,C.server.sendEditorStatusUpdateToUser(s.userEmail,s.fullName,o,n))},C.client.sendEditorStatusToUser=function(e,a,t){r.raiseEvent("editorStatusOnDash",{email:e,status:1,folioToken:t})},C.client.editor=function(e,a,t,n,o){if(p[n]={email:a,name:t,time:Date.now(),folioToken:o},r.raiseEvent("editorStatus",{email:a,status:2==e?2:1,folioToken:o}),r.raiseEvent("editorStatusOnDash",{email:a,status:2==e?2:1,folioToken:o}),1==e){s.userEmail,s.fullName,l.Token,C.server.editorPing(s.userEmail,s.fullName,l.Token);var i=s.currentlyEditing[s.userEmail];i&&Date.now()-i.time<=6e4&&be(i,"Editor",s.userEmail)}else 2==e&&delete p[n]};var ee=null,ae=null,te=null;C.client.syncMod=function(e,a,t,n,o){var i=!1,s=!1;o&&(i=0!=o,s=2==o);var r=g[e+a];if(D&&!i){var l={tag:e,prop:a,val:t,ts:n};F.indexOf(l)<0&&F.push(l)}else if(r){if(n<u&&!s)return;if(u==n&&e==ee&&a==ae&&t==te)return;ee=e,te=t,"Editor"==(ae=a)||s||(u=n),m=Date.now(),r(e,t)}};var ne=function(e){setTimeout(function(){"syncSend"==I[e].type?(I[e].mod,I[e].prop,I[e].val,be(I[e].mod,I[e].prop,I[e].val)):(I[e].mod,I[e].success,he(I[e].mod,I[e].success))},50*e)},oe=function(){var e=0,a=I.length;for(e=0;e<I.length;e++)ne(e);setTimeout(function(){I=[]},50*a)};function ie(e,a){var t=new Array;if(!e[0]||!a[0])return!1;if(e.length!=a.length)return!1;if(0==e.length&&0==a.length)return!0;for(var n=0;n<e.length;n++)key=_typeof(e[n])+"~"+e[n],t[key]?t[key]++:t[key]=1;for(n=0;n<a.length;n++){if(key=_typeof(a[n])+"~"+a[n],!t[key])return!1;if(0==t[key])return!1;t[key]--}return!0}var se=function(e,a){for(var t=0;t<e.length;t++)a!=e[t].ConnectionId&&C.client.syncMod(e[t].Tag,e[t].Prop,e[t].Value,e[t].TimeStamp,1);F.length;for(t=0;t<F.length;t++){for(var n=!1,o=0;o<e.length;o++)if(e[o].TimeStamp==F[t].ts&&(e[o].Tag,F[t].tag,e[o].Prop==F[t].prop&&(e[o].Value,F[t].val,jQuery.type(e[o].Value)==jQuery.type(F[t].val)))){var i=jQuery.type(e[o].Value);"boolean"==i||"number"==i||"string"==i?e[o].Value==F[t].val&&(n=!0):"array"==i?ie(e[o].Value,F[t].val)&&(n=!0):n=!0}n||C.client.syncMod(F[t].tag,F[t].prop,F[t].val,F[t].ts,2)}F=[]},re=0,le=function t(){var c;c=N==$.connection.hub.id?$.connection.hub.id:N,setTimeout(function(){N=$.connection.hub.id},5e3),i.getRecentMessages({data:{token:s.token,timestamp:u,connecId:c},success:function(e){var a=JSON.parse(e.Data),t=a.Messages;if(re=0,2!=e.StatusCode){for(var n=a.MaxCount,o=t.length,i=!1,s=!1,r=!1,l=!1,d=0;d<t.length;d++)t[d].TimeStamp>u&&c!=t[d].ConnectionId&&(i=!0),c==t[d].ConnectionId&&(s=!0),t[d].TimeStamp>u&&(r=!1);(t[0].TimeStamp<=u&&t[t.length-1].TimeStamp>=u||o<n||s)&&(r=!0),t[0].TimeStamp,t[t.length-1].TimeStamp,t[0].TimeStamp,t[t.length-1].TimeStamp,t[t.length-1].ConnectionId==c&&(l=!0),t[t.length-1].ConnectionId,i=r&&!l,r?D&&0<I.length&&i?app.popup.message({heading:"This folio has been updated",message:"This folio was updated when you were disconnected, would you like to merge (may overwrite their changes) or reload to discard your changes",btnText:"Merge the changes",cancelText:"Reload",noClose:!0,handleOK:function(){se(t,c),D=!1,oe()},handleNo:function(){k=!0,window.location.reload()}}):D&&I.length<1&&i?(se(t,c),D=!1):(D=!1,oe()):app.popup.message({heading:"This folio has been updated",message:"We were unable to merge changes kindly reload to continue editing.",btnText:"Reload",handleOK:function(){k=!0,window.location.reload()}})}else D=!1},error:function(e){e.StatusCode?re=0:re++;var a=36e4<Date.now()-m;3!=e.StatusCode||a?(2==e.StatusCode?(D=!1,oe()):e.StatusCode?app.popup.message({heading:"Oops!",message:"Unable to merge kindly reload to continue.",btnText:"Reload",handleOK:function(){window.location.reload()}}):e.StatusCode||setTimeout(function(){re<3?t():app.popup.message({heading:"Oops!",message:"Unable to connect to Xtensio servers. Kindly reload to continue.",btnText:"Reload",handleOK:function(){window.location.reload()}})},3e3),console.error(e)):app.popup.message({heading:"This folio has been updated",message:"We were unable to merge changes kindly reload to continue editing.",btnText:"Reload",handleOK:function(){k=!0,window.location.reload()}})}})};function de(){for(var e=[],a=0;a<s.folios.length;a++)e.push(s.folios[a].Token);return e=e.join(",")}var ce=!(C.client.onEvent=function(e,a){var t=b[e];t&&t(a)});function ue(n){$.connection.hub.start({transport:["webSockets","longPolling","foreverFrame","serverSentEvents"]}).done(function(){if(console.log("Connected, transport = "+$.connection.hub.transport.name),console.log("$.connection.hub.id",$.connection.hub.id),s.editMode&&l){var e=j();console.log("folio module count: ",e),$(".fr-embedly").each(function(){$(this).data().originalEmbed&&$(this).html($(this).data().originalEmbed)}),0===s.Team.ST&&z<e&&plusHelpershowFreeModuleBlocker(popup,z)}var a;if(ce&&(s.editMode&&(lscache.setBucket(s.userEmail),a=s.token,i.getFolioLastSaveTimestamp({token:a,success:function(e){var a,t;console.log("getFolioLastSaveTimestamp response",e),(t=Ce())&&dayjs(t.timestamp).isAfter(dayjs(a))?app.popup.message({heading:"You have a newer version",message:"Locally saved data is newer than the currently loaded folio data. Do you want to load the local version?",btnText:"Load",cancelText:"Nevermind",noClose:!0,bodyCentered:!0,notMini:!0,handleOK:function(){we("overwrite",function(e){window.location.reload()})}}):Te()},error:function(e){console.log("getFolioLastSaveTimestamp error",e),Te()},complete:function(){}})),ce=!1),s.isDashboard&&s.folios&&0<s.folios.length){var t=de();console.log("appHub.server.editorOnDashPing joined ",s.userEmail,s.fullName,t),"function"==typeof C.server.editorOnDashPing&&C.server.editorOnDashPing(s.userEmail,s.fullName,t)}p[$.connection.hub.id]={},d=7,n&&n(),s.editMode&&J("on",!0),N=$.connection.hub.id}).fail(function(){q("connection failed SignalR"),d=0,s&&""!==s.userEmail&&(G<_?setTimeout(ue,2e3):app.popup.message({heading:"Signalr Connection Failed",message:"Could not establish connection, kindly reload.",btnText:"Reload",handleOK:function(){window.location.reload()}})),q("sync lost"),s.editMode&&J("synclost"),D=!0})}function me(a,t){if(!(n=!0),y(1),W(1),!k)try{C.server.saveMods(l.Token,JSON.stringify(a)).always(function(){n=!1}).fail(function(e){q("server sending fail"),ge()}).done(function(e){JSON.stringify(a),1==e.Status?t&&t(e.TagMap):(q("server returned error status : ",e.Status),console.error(e))})}catch(e){q("exception: "+e),ge()}}function pe(e){l.LastSavedUtc=Date.now(),y(2,l.LastSavedUtc),W(2),$.each(e,function(e,a){var t=o.obtain(f,"Tag",a.Tag);if(t){t.ID=a.Id,h[t.Key]=0,t.lastSavedData=t.dataToSave,o.removeFromList(T,null,"Tag",t.Tag),o.removeFromList(f,t);var n=v[t.Tag];n&&n()}})}function fe(e,a){var t,n;h[e.Key]=1,v[e.Tag]=a,t=e,n=pe,clearTimeout(c),o.pushUnique(T,{Tag:t.Tag||0,ModType:t.Type,ModId:t.ID||0,Data:t.dataToSave}),c=setTimeout(function(){me(T,n)},3e3)}function he(e,a){if(D){q("browser is dc");var t={type:"processSave",mod:e,success:a};I.push(t)}else e.Tag&&(R=!0,h[e.Key]||e.suspend?setTimeout(function(){he(e,a)},1e3):(e.dataToSave=JSON.stringify(e.Data),e.Syncd||e.dataToSave==e.lastSavedData||l.Role<2?(e.Syncd&&(e.Syncd=null),l.LastSavedUtc=Date.now(),y(2,l.LastSavedUtc),W(2),o.removeFromList(f,e),a&&a()):(o.pushUnique(f,e),fe(e,a))))}$.connection.hub.reconnecting(function(){s.editMode&&J("off"),q("trying to reconnect signalR, set browserwasDC"),D=!0,d=1}),$.connection.hub.reconnected(function(){ce&&(ce=!1),d=7,setTimeout(function(){s.editMode&&J("on",!0)},1e3)}),$.connection.hub.connectionSlow(function(){d=6,q("slow connection from signalR, synclost"),s.editMode&&J("synclost")}),$.connection.hub.disconnected(function(){ce||(ce=!0,q("disconnected from signalR, set browserwasDC, synclost"),d=0,setTimeout(ue,3e3),s.editMode&&J("synclost"),D=!0)}),r.addListener("markNotificationAsRefreshed",function(e){console.log("markNotificationAsRefreshed notif id",e),C.server.markNotificationAsRefreshed(e)}),r.addListener("saveCurrentRevision",function(){console.log("saving snapshot..."),V(function(){setTimeout(function(){r.raiseEvent("doneSavingRevision")},1e3)})}),s.editMode&&l&&(y(2,l.LastSavedUtc),W(2),$.connection.hub.qs={fid:l.Token},r.addListener("moduleRemoved",function(e){console.log("folio module count: ",j())}),$(window).on("beforeunload",function(e){L=!0,V(function(){console.log('saveSnapShot called from window.on("beforeunload")')})}),r.addListener("saveBeforeExport",function(e){return V(e)}),r.addListener("docClick",function(t){var e=$("#edit-page .section-settings .more-menu"),a=$("#edit-page .section-settings .move-menu"),n=$("#edit-page .section-settings .bg-panel");e.each(function(){var e=$(this),a=e.parent().find(".section-side-panel .more-sec-btn");0===e.has(t.target).length&&0===a.has(t.target).length&&e.hide()}),a.each(function(){var e=$(this),a=e.parent().find(".section-side-panel .move-sec-btn");0===e.has(t.target).length&&0===a.has(t.target).length&&e.hide()}),n.each(function(){var e=$(this),a=e.parent().find(".section-side-panel .bg-panel-btn");0===e.has(t.target).length&&0===a.has(t.target).length&&e.hide()})}));var ge=function a(){var e,t;k?q("Permanent DC, don't go furhter"):(e=function(e){S&&(S=!1),e?(O&&(O=!1),s.editMode&&J("on"),ue(function(){n||me(T,pe)})):setTimeout(a,2e3)},(t=new Image).src="https://app.xtensio.com/img/v-"+Date.now()+"-xtensio-icon.jpg",t.onload=function(){e(!0)},t.onerror=function(){e(!1),O=!0})};if(s.editMode||s.isHome){if(s.isHome&&s.isDashboard&&s.folios&&0<s.folios.length){var ve=de();$.connection.hub.qs={dashFids:ve}}ue(),function(){if(s.editMode){var e=6e4;void 0!==s.saveInterval&&o.isNumber(s.saveInterval)?(e=parseInt(s.saveInterval,10),console.log("config.saveInterval",s.saveInterval)):console.log("config.saveInterval is undefined or not set properly. Defaulting interval to 60 secs"),console.log("saveTimer",e),t=setInterval(function(){console.log(R,D,B,k),!R||D||B||k?k&&(console.log("Quit trying to save."),clearInterval(t)):V(function(){console.log("saveSnapShot called at timerSaveInterval")})},e)}}(),$(window).on("offline",function(){q("window offline event received"),k?q("Permanent Disconnection was found"):(s.editMode&&J("off"),D=!0,ge())}),$(window).on("online",function(){app.console("window online, event received "),ge()})}var be=function(e,a,t){if(D){if("Editor"!=a){var n={type:"syncSend",mod:e,prop:a,val:t};I.push(n)}}else"Editor"!=a&&(R=!0),5<d&&0<e.Tag&&C.server.syncMod(l.Token,e.Tag,a,t),e.save&&e.save()};function Te(){setInterval(function(){ye()},Y)}function ye(){var e=K();lscache.set(s.token,{timestamp:Date.now(),data:e})}function Ce(){var e=lscache.get(s.token)||!1;return console.log("localStorage data",e),e}function we(e,a){var t=Ce(),n=s.token;console.log("token",n),console.log("data",t.data),console.log("verb",e),t&&("overwrite"===e?i.makeFolioFromSnapshot({data:t.data,token:n,verb:e,name:"",channels:[],success:function(e){console.log("makeFolioFromSnapshot res",e),window.location.reload()},error:function(e){console.log("makeFolioFromSnapshot error",e),app.popup.error(e.Message)}}):(s.saveFolioFromSnapshot={token:n,data:t.data,channels:a,verb:e,fromLocalStorage:!0},app.popup.saveFolio()))}return{send:function e(a,t,n){5<d?C.server.send(a,JSON.stringify(t)).done(function(e){n&&n(e)}):setTimeout(function(){e(a,t,n)},3e3)},saveMod:he,reg:function e(a,t,n){var o=a.Tag||0;0<o?(a["onReg"+t]&&a["onReg"+t](),g[o+t]=n):"EmptyModule"!=a.Type&&setTimeout(function(){e(a,t,n)},500)},sync:be,raiseEvent:function(e,a){C.server.raise(l.Token,e,a)},addListener:function(e,a){b[e]=a},getBrowserDC:function(){return D},loadFolioDataFromLocal:Ce,saveFolioDatatoLocal:ye,loadLocalToFolio:we,getModuleCount:j}},app.core.configStore=function(n){var o,i,s;return n.localStorage||(n.localStorage={}),{folioStorage:function(e){return function(e,a){switch(s=a,e){case"folio":n.localStorage.folios||(n.localStorage.folios=[]),i=n.localStorage.folios}var t=function(){for(var e=0;e<i.length;e++)if(i[e]&&i[e][s])return i[e];return!1}();t||((t={})[s]={},i.push(t)),o=t}("folio",e),this},store:function(e,a){o[e]=a,i[s]=o},fetch:function(e){return o[e]}}},app.core.eventManager=function(){var s={},t={reset:function(){$(s).each(function(e,a){a.listeners=[]})},addEvent:function(e){s[e]={listeners:[]}},addListener:function(e,a,t,n){if("string"==typeof e)s[e].listeners.push({method:a,once:t,data:n});else for(var o=0;o<e.length;o++)s[e[o]].listeners.push({method:a,once:t,data:n})},removeListener:function(e,a){for(var t=s[e].listeners.length-1;0<=t;t--)s[e].listeners[t].method===a&&s[e].listeners.splice(t,1)},raiseEvent:function(e,a,t,n){for(var o=s[e].listeners.length-1;0<=o;o--){var i=s[e].listeners[o];i.data?i.method(i.data,a,t,n):i.method(a,t,n),i.once&&s[e].listeners.splice(o,1)}}};return $.each(["resize","loggedOut","tokenRenewed","docClick","donutError","nameChanged","plusUnlocked","hubMsg","newSignUp","labelChange","transferRequestArrived","duplicateFolio","collabChange","editorStatus","collabRequestArrived","getFolio","removeCollabs","beforeunload","collabreqaccpt","plusCancelled","foliosRecieved","addlabel","fontAdded","froalaClick","froalaCmdAfter","froalaCmdBefore","userTeamRoleChanged","folioRename","folioArchived","collabChanUdate","collabChanFolioUpdate","collabChanFolioMixItUp","free-exceedsize","teamTemplateUpdate","editorStatusOnDash","moduleRemoved","reInitMixerTemplates","reInitChannelMixers","updateStatsSaveAsTempLocks","saveCurrentRevision","doneSavingRevision","markNotificationAsRefreshed","processPendingNotifications","folioDataLoading","processPendingTransfers","sendUpdateColorPalette","channelAdd","channelDelete","updateFolioData","refreshLabelData","channelChangedTeamVisible","channelChangedPrivate","userJoinedChannel","userJoinedChannelOwner","userLeftChannel","userLeftChannelOwner","folioAddedToChannel","folioRemovedFromChannel","refreshMemberData","saveBeforeExport","clearTemplateSubmenu","initToolTips","showExamplesTab"],function(e,a){t.addEvent(a)}),$(document).on("click",function(e){t.raiseEvent("docClick",e)}),$(window).on("resize",function(){var e=$(this);t.raiseEvent("resize",e.width(),e.height())}),t},app.core.folioStore=function(t,n){var o=JSON.parse(n.Store||"{}");return{get:function(e){return o[e]},set:function(e,a){o[e]=a,t.folioStore({data:{id:n.Token,data:JSON.stringify(o)}})}}},app.core.main=function(e,a){console.log("app core",app.core);var t,n=this,o=n.eventManager(),i=n.store(),s=n.utility(),r=n.apiHelper(e,a,o,i,s),l=n.plusHelper(e,r,o),d=n.appHub(e,o,i,s,a,r,l),c=n.pageManager(e,a,d),u=n.modStore(r),m=n.configStore(e);return a&&(t=n.folioStore(r,a)),{eventManager:o,pageManager:c,store:i,utility:s,apiHelper:r,appHub:d,modStore:u,folioStore:t,configStore:m,plusHelper:l}},app.core.modStore=function(o){var i={},n={reg:function(e,a){e&&!i[e]&&(i[e]=a||{})},get:function(a,t,n,e){i[a]?n(i[a][t]):o.modStore({data:{id:a},maxAttempts:99,success:function(e){i[a]=JSON.parse(e.Message||"{}"),n(i[a][t])},error:e})},set:function(e,a,t){n.get(e,a,function(){i[e][a]=t,o.modStore({data:{id:e,data:JSON.stringify(i[e])}})})}};return n},app.core.padlocks=function(l,i,t){var d="Premium Feature";function c(e,a,t,n){e?i.remove(a):i.add(a,t,n||0)}var n=function a(t,n,o){[$(".user-menu-popup .team-settings"),$(".user-menu-popup .team-edit"),$(".user-menu-popup .style-guide")].forEach(function(e){if(!e.length&&!o)return console.log("menu item not created yet, wait for 1000"),setTimeout(function(){a(t,n,1)},1e3),!1;!function(e,a,t){var n=!1;if(a.hasTeam()){var o="Needs admin access";n=a.isOwner()||a.isAdmin()}c(n,e,o)}(e,l)})},s=function(e,a,t){var n=t.find(".show-stats"),o=d,i=!0;l.hasTeam()?l.isBusinessTeamMember()&&!l.isPremiumGuest()?i=!0:(l.isSingleFolioGuest()||l.isPremiumGuest()||l.isProBusiness()||l.isProTeamMember()||l.isFreeWithTeam())&&(o=l.isOwner()?"Business feature":"Needs more access",i=!1):(l.isFree()||l.isPlus()||l.isProBusiness())&&(i=!1),c(i,n,o)};function o(e){e=$(".froala-styleguide-link");var a=$(".theme-picker").find(".manage-color-link"),t=$(".froala-manage-color-link"),n=!1;if(l.hasTeam()){var o="Needs admin access";(l.isOwner()||l.isAdmin())&&(n=!0)}r(a,n),r(t,n),n?(i.remove(e),i.remove(a),i.remove(t)):(i.add(e,o,0),i.add(a,o,0),i.add(t,o,0)),$("#edit-page").on("click",".bg-panel-btn",function(){var e=$("#edit-page .manage-color-link");r(e,n),n?i.remove(e):i.add(e,o,0)})}function r(e,a){var t="Manage/Add Colors";e.html(t),a&&e.html(t+' <i class="icon-Color-Scheme"></i>')}return{menu:{freeOldLockedItems:function(){if(l.isFree()||l.isPlus()||l.isPro()){$('<li class="item free-menu team-settings">Team Settings</li>').insertBefore("#top-bar .nav-setmenu .li-sep.free-menu");$('<li class="item free-menu team-edit">Manage Team Members</li>').insertBefore("#top-bar .nav-setmenu .li-sep.free-menu");var e=$('<li class="item free-menu style-guide">Style Guide</li>');$(e).insertBefore("#top-bar .nav-setmenu .item.free-menu.team-edit")}$("#top-bar .nav-setmenu .free-menu").removeClass("hidden"),$("#top-bar .nav-setmenu .free-menu").show()},teamLockedItems:function(){if(l.isPremiumGuest()||l.isSingleFolioGuest()||l.isTeamMember()){$("#top-bar .nav-setmenu .li-sep.team-menu").remove(),$("#top-bar .nav-setmenu li.item.upgrade").hide(),$("#top-bar .nav-setmenu li.item.billing").hide();$('<li class="item free-menu team-edit">Manage Team Members</li>').insertBefore("#top-bar .nav-setmenu .li-sep.free-menu");var e=$('<li class="item free-menu style-guide">Style Guide</li>');$(e).insertBefore("#top-bar .nav-setmenu .item.free-menu.team-edit"),$("#top-bar .nav-setmenu .free-menu").removeClass("hidden"),$("#top-bar .nav-setmenu .free-menu").show()}else $("#top-bar .nav-setmenu .li-sep.free-menu").remove()}},setMenuLocks:function(){l.setLock(function(e,a){n(e,a)})},setTemplateStatsLock:function(e){l.setLock(function(e,a){s(0,0,$("#templates-items-container"))},e)},setFolioStatsLock:function(e){l.setLock(function(e,a){var t,n,o;s(0,0,$("#folio-items-container")),t=$("#folio-items-container").find(".save-template-btn"),n=d,o=!0,l.hasTeam()?(l.isSingleFolioGuest()||l.isPremiumGuest())&&(o=!(n="Needs more access")):(l.isFree()||l.isPlus())&&(o=!1),console.log("allowed updateLockSaveAsTemplate",o),c(o,t,n)},e)},setLockStyleGuide:function(){l.setLock(function(e,a){o()})},setLockStatsSaveAsTemplate:function(){l.setLock(function(e,a){var t,n,o,i,s,r;t=l.isOwner()?"Business feature":"Needs more access",n=$("#tmp-secondary-bar").find(".navs-stats"),o=!0,l.hasTeam()?(l.isSingleFolioGuest()||l.isPremiumGuest()||l.isProBusiness()||l.isProTeamMember()||l.isFreeWithTeam())&&(o=!1):(l.isFree()||l.isPlus()||l.isProBusiness())&&(o=!1),c(o,n,t),i=d,s=!0,r=$("#tmp-secondary-bar").find(".save-as-template"),l.hasTeam()?(l.isSingleFolioGuest()||l.isPremiumGuest())&&(s=!(i="Needs more access")):(l.isFree()||l.isPlus())&&(s=!1),c(s,r,i)})},updateLockStyleGuide:o,setShareFolioLinkLock:function(e,a){if(!_.isEmpty(e)){var n=l.isOwner()?"Business feature":"Needs more access";(t.editMode||t.isDashboard)&&l.setLock(function(e,a){var t=$("#tmp-popup-folio-share-link").find(".pass-select > .pass-protect");c(l.isBusinessTeamMember(),t,n,1e3)})}},teamAddLocks:function(e,a,t){if(2<t.Team.Role){if(3!==t.Team.Role)return void a.teamUserActionBlocked("invite-member",4===t.Team.Role?"Premium Guests":"Team Members");e.find(".r1").addClass("locked"),e.find(".r2").addClass("locked")}else e.find(".r1").removeClass("locked"),e.find(".r2").removeClass("locked")},setCollaboratorLocks:function(o,i,e){l.setLock(function(e,a){var t,n;t=i,n=o.find(".search-btn"),c(t,n,"Premium Feature")},e)},setCopyFolioLock:function(o,i,e){l.setLock(function(e,a){var t,n=!0;(l.isSingleFolioGuest()||l.isPremiumGuest())&&(n=!(t="Needs more access")),c(n,o.find(i),t)},e)}}},app.core.pageManager=function(e,a,i){var s,r={home:"home-page",edit:"edit-page"},l=e.editMode&&1<a.Role?r.edit:r.home;return{pages:r,showPage:function(e){$("#"+l).hide(),$("#"+e).show(),l=e,s.activatePreview()},hidePage:function(e){$("#"+e).hide()},setupEditPage:function(n,e,t){s=t;var a=$('<button type="button" class="btn btn-lg white-blue-btn edit-add-new-section">+ Add New Section</button>');function o(e){var a=t.createSection({Tag:e});return t.addModule("EmptyModule"),t.saveLayout(),a}$("#edit-sections").after($('<div class="preview-bottom" style="text-align: center; padding: 20px 0;"></div>').append(a).append($('<div class="tipped-icon addsection-icon"><i class="fa fa-info-circle"></i></div>'))),a.on("click",function(){n.setNewBlankCanvas=!0;var e=o();i.raiseEvent("NewSection",e[0].data("Tag"));var a=e[0];a.find(".add-btn").trigger("click"),console.log("$editSection",a),$("#tmp-add-module-popup").find(".addModule-canvasblock .block").last().trigger("click");var t=parseInt(a.find(".section-content div:last-child").data("key").toString().replace("_",""))+1;n.setNewBlankCanvas={key:t},console.log("canvas key",t)}),i.addListener("NewSection",o),l!=r.home?this.hidePage(r.home):(this.showPage(r.home),s.activatePreview())},isCurrent:function(e){return l==e},toggle:function(){l==r.home&&1<a.Role?this.showPage(r.edit):(this.showPage(r.home),s.activatePreview())},hideCurrent:function(){$("#"+l).hide()},restore:function(){$("#"+l).show()},getCurrentPage:function(){return l}}},app.core.plusHelper=function(m,d,n){var e,o,i,s,r=null,a=Date.now(),l=!1,t=!1,c=!1,p=!1,u={Plus:{10:"PlusMonthly",11:"PlusYearly",16:"ManualPlus"},Pro:{1:"Monthly",2:"Yearly",4:"Manual"},Business:{14:"BusinessYearlyGrandFather",19:"BusinessMonthlyGrandFather",22:"BusinessYearly",25:"BusinesMonthly"},Team:{12:"TeamMemberYearlyGrandFather",13:"TeamPremiumGuestYearlyGrandFather",20:"TeamMemberMonthlyGrandFather",21:"TeamPremiumGuestMonthlyGrandFather",15:"TeamEarlyAccess",23:"TeamMemberYearly",24:"TeamPremiumGuestYearly",26:"TeamMemberMonthly",27:"TeamPremiumGuestMonthly"},Other:{3:"VersionUpgrade",5:"Campaign",6:"Referral",7:"SignUpViaReferral",8:"Failed",9:"DiscountYearly",34:"FreeUserWithCreditPurchase"},ProBusiness:{28:"ProYearly",31:"ProMonthly"}};function f(){return!(!m.Team||!m.Team.Role)&&m.Team.Role}function h(){return!!(r&&r.End&&Date.now()<r.End)}function g(){if(!1===t&&r&&r.ST)for(var e in console.log("data.ST",r.ST),u)for(var a in u[e])if(a==r.ST){t=e;break}return!!h()&&t}function v(e,a,t){l?setTimeout(function(){v(1,a)},2e3):r?b(a):(l=!0,d.getFreePlusInfo({success:function(e){r=JSON.parse(e.Message),m.plusExpireTime=r.End,l=!1,b(a)},error:function(){l=!1,b(a)},complete:function(){l=!1}}))}function b(e,a){var t,n="";T(),r&&r.End&&(n=dayjs(r.End).format("MMMM Do, YYYY"),(t=r.AR)||(t=34==r.ST)),void 0!==e&&e(r,i,t,n)}function T(){i=!1,a=Date.now(),r&&r.End&&(i=new Date(r.End)>a)}function y(){var e="Free";if(!x()&&r&&r.ST)for(var a in console.log("data.ST",r.ST),u)for(var t in u[a])if(t==r.ST){e=a;break}return e}function C(e,a,t,n){switch(a){case"plus":e.plusPrompt("create",null,!0);break;case"pro":1==f()?e.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Pro Team."+n+"Please upgrade to Business for unlimited folios and other premium features, or delete active folios/templates to make room for a new folio.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.payment("showPlans")}}):e.message({heading:"You Cannot Perform this Action",message:"Folio Limit reached for Pro Team."+n+" Please reach out to your team owner to upgrade the account for more access, or delete active folios/templates to make room for a new folio.",btnText:"Ok",bodyCentered:!0,notMini:!0});break;case"team":t&&"Premium Guests"===t?e.teamUserActionBlocked("create","Premium Guests"):e.teamUserActionBlocked("create");break;case"personal":var o={heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User."+n+" Please upgrade to a premium plan for more folios and other premium features, or delete active folios/templates to make room for a new folio.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.payment("showPlans")}};"Free"!==t&&(o={heading:"Switch to your team dashboard",message:"Folio Limit reached for "+t+" User on personal dashboard. Please switch to your team dashboard.",btnText:"Ok",bodyCentered:!0,notMini:!0}),e.message(o);break;case"Free":1==f()?e.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User."+n+" Please upgrade to a premium plan for more folios and other premium features, or delete active folios/templates to make room for a new folio.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.payment("showPlans")}}):e.message({heading:"You Cannot Perform this Action",message:"Folio Limit reached for Free User."+n+" Please reach out to your team owner to upgrade the account for more access, or delete active folios/templates to make room for a new folio.",btnText:"Ok",bodyCentered:!0,notMini:!0})}}function w(e,a){return 1==a?e:e+"s"}function k(n,o,i){console.log("doUpgradePopup type",o,i),0<m.Team.Id?d.listALLMembers({data:{teamId:m.Team.Id},success:function(e){var a=e.Data.Data.members,t=0,r=[],l=[];a.forEach(function(s){d.getUserFolioCountFromTeam({username:s.Email,teamId:m.Team.Id,success:function(e){var a=JSON.parse(e.Data),t=a.TotalOwnedTeamTemplates,n=a.TotalOwnedUserTemplates,o=a.TotalOwnedFolios,i=s.Email==m.userEmail?"You have ":s.FullName+" has ";0<o&&r.push(i+o+" "+w("folio",o)),0<t+n&&l.push(i+t+" saved team "+w("template",t)+" and "+n+" saved personal "+w("template",n))},complete:function(){++t>=a.length&&C(n,o,i,'<ul class="folio-and-template-numbers">'+r.concat(l).map(function(e){return"<li>"+e+"</li>"}).join("")+"</ul>")}})})}}):C(n,o,i,"")}function x(){var e=!h();return r&&(e=0===r.ST||34===r.ST),e}function P(){return m.Team&&0<m.Team.Id&&(0===m.Team.ST||34===m.Team.ST)}function S(){return"ProBusiness"==g()}function D(){return 28===m.Team.ST||31===m.Team.ST}function F(){return 22===r.ST||25===r.ST}function I(){return m.Team&&0!==m.Team.Id&&0<m.Team.Role}function M(){return 4==f()}return setInterval(function(){T(),r&&r.End&&a>r.End&&!c&&(n.raiseEvent("plusCancelled"),c=p=!0)},2e3),_defineProperty(e={checkFolioRestrictions:function(l,d,c){var u=$("#folio-items-container");v(0,function(e,a,t,n){var i=0,s={},o=e.ST;if(t&&(10!=e.ST&&11!=e.ST||m.IsDelinquent||(i=5,s.currUser="Plus",s.limit=5)),a&&10!=e.ST&&11!=e.ST&&3!=e.ST&&16!=e.ST?(ispro=!0,u.find(".save-template-btn").removeClass("locked")):m.Team.Id<1&&u.find(".save-template-btn").addClass("locked"),a||(i=1,s.currUser="Free",s.limit=1),m.IsDelinquent&&(i=1,s.currUser="Free",s.limit=1),!a||10!=e.ST&&11!=e.ST&&16!=e.ST&&3!=e.ST||(isplus=!0,i=5,s.currUser="Plus",s.limit=5),28===o||31===o){var r=0<m.Team.Id?10:1;i=r,s.currUser="ProBusiness",s.limit=r,u.find(".save-template-btn").removeClass("locked")}console.log("limit",i,t,a,m.IsDelinquent),console.log("params",s),m.Team&&(m.IsDelinquent||m.Team.IsDelinquent)?d(s):0<i&&l.getUserActiveFoliosCount({success:function(e){var o=e.Data;console.log("user active folios:::",o),l.getUserTemplateCount({success:function(e){var a=e.Data;if(0===m.Team.Id){if(m.IsDelinquent||i<o||0<a){var t=$(".folio-item-shell.active"),n=$("#templates-items-container .folio-item.own");s.foliosCount=e.Data,(m.IsDelinquent||t.length>s.limit||0<n.length)&&0==m.Team.Id&&d(s)}}else"ProBusiness"===s.currUser&&l.getUserTeamsAndFolios({userEmail:m.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var a=_.find(JSON.parse(e.Data),{Id:m.Team.Id});void 0!==a?(a.TotalFolios>i||p)&&d(s):console.log("getUserTeamsAndFolios teamDetails ERR",m.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)},complete:function(){c&&"function"==typeof c&&c()}})},error:function(e){c&&"function"==typeof c&&c(),console.log("error: ",e)}})},error:function(e){c&&"function"==typeof c&&c(),console.log("error: ",e)}})})},checkFoliosLimitReached:function(e,t,n,a){a=void 0!==a&&a,console.log("exec checkFoliosLimitReached");var o=!1,i=!1,s=y();if(console.log("userType",s),m.IsDelinquent&&1===Faltu(m.folios).find({Status:0}).count())return k(t,"plus"),void(i=!0);if(!m.Team||0===m.Team.Id&&0===m.lastTeamId)m.Team&&0===m.Team.Id&&("Free"===s||S()||F())&&(o=!0,e.getUserActiveFoliosCount({success:function(e){if(console.log("getUserActiveFoliosCount response",e),1<=e.Data){var a=s;return"ProBusiness"===s&&(a="Pro"),k(t,"personal",a),void(i=!0)}i||"function"!=typeof n||n()},error:function(e){console.log("getUserActiveFoliosCount error",e)}}));else{var r=0!==m.Team.Id?m.Team.Id:m.lastTeamId;if(5==m.Team.Role)return k(t,"team"),void(i=!0);if(4==m.Team.Role&&!1===a)return k(t,"team","Premium Guests"),void(i=!1);if(P()&&!1===a){var l=m.userEmail;3!=m.Team.Role&&2!=m.Team.Role||(l=m.Team.ownerEmail),o=!0,e.getUserTeamsAndFolios({userEmail:l,success:function(e){console.log(s," getUserTeamsAndFolios response ",e);var a=_.find(JSON.parse(e.Data),{Id:r});if(void 0!==a){if(2<=a.TotalFolios)return k(t,"Free"),void(i=!0)}else console.log("getUserTeamsAndFolios teamDetails ERR",m.Team.Id);i||"function"!=typeof n||n()},error:function(e){console.log("getUserTeamsAndFolios error",e)}})}else"ProBusiness"!==s&&!D()||M()||(o=!0,e.getUserTeamsAndFolios({userEmail:m.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var a=_.find(JSON.parse(e.Data),{Id:r});if(void 0!==a){if(10<=a.TotalFolios)return k(t,"pro"),void(i=!0)}else console.log("getUserTeamsAndFolios teamDetails ERR",m.Team.Id);i||"function"!=typeof n||n()},error:function(e){console.log("getUserTeamsAndFolios error",e)}}))}i||"function"!=typeof n||!1!==o||n()},updateConfig:function(e){m.userEmail==e.Data.Email&&m.Team.Id==e.Data.TeamID&&(m.Team.Role=e.Data.Role)},getData:v,isFree:x,isFreeOnPersonalDash:function(){return m.Team&&0===m.Team.Id},isFreeWithTeam:P,isProBusiness:S,isProTeamMember:D,isBusinessTeamMember:function(){return 22===m.Team.ST||25===m.Team.ST},isNewBusiness:F,hasTeam:I,getUserPlan:y,getPlan:g,doUpgradePopup:k,isOldFreeUserNeverOnTrialOrPlan:function(){return!1===m.isTrial&&!1===m.isTrialCanceled&&0===m.Team.Id&&0===m.autoRenew&&null===m.ReActivationData.LastPlan},getPlanName:function(e){var a="";switch(e){case 14:a="Business Yearly (GrandFathered)";break;case 22:a="Business Yearly";break;case 28:a="Pro Yearly";break;case 19:a="Business Monthly (GrandFathered)";break;case 25:a="Business Monthly";break;case 31:a="Pro Monthly"}return a},isBusinessTeam:function(){return 14===m.Team.ST||19===m.Team.ST||22===m.Team.ST||25===m.Team.ST},loadStripe:function(e){var a,t,n;o?e&&e():(a="https://js.stripe.com/v2/",t=function(){o=1,Stripe.setPublishableKey(m.stripePublic),e&&e()},(n=document.createElement("script")).addEventListener("load",t),n.src=a,n.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(n))},refresh:function(){r=null,c=!1,this.getData(1,function(e,a){var t=a?"plusUnlocked":"plusCancelled";n.raiseEvent(t)})},isPlus:function(){return"Plus"==g()},isPro:function(){return"Pro"==g()}},"isProBusiness",function(){return"ProBusiness"===g()}),_defineProperty(e,"isBusiness",function(){return"Business"===g()}),_defineProperty(e,"isTeam",function(){return"Team"==g()}),_defineProperty(e,"isTeamActive",function(e){return!!e.Status}),_defineProperty(e,"ownsATeam",function(){return function(){var e=!1;for(var a in m.UserTeams)if(1==m.UserTeams[a].Role){e=!0;break}return!!h()&&e}()}),_defineProperty(e,"isOwner",function(){return 1==f()}),_defineProperty(e,"isAdmin",function(){return 2==f()}),_defineProperty(e,"isTeamMember",function(){return 3==f()}),_defineProperty(e,"isPremiumGuest",M),_defineProperty(e,"isSingleFolioGuest",function(){return 5==f()}),_defineProperty(e,"getRoleName",function(){return function(){var e=m.Team.Role;for(var a in m.TeamRoles)if(m.TeamRoles[a].Id==e)return m.TeamRoles[a].Name}()}),_defineProperty(e,"isSubscriptionExpired",function(){return p}),_defineProperty(e,"setLock",function(o,e){if(m.userName){var i="https://xtensio.com/pricing/";s&&o&&!e?o(s,i):this.getData(1,function(e,a,t,n){s=e,o&&o(e,i)},!0)}}),_defineProperty(e,"isTeamPlan",function(){var e=y();return"Business"===e||"ProBusiness"===e}),_defineProperty(e,"getExpirationDate",function(){return I()?!!(m.Team.IsTeamOwnerTrial&&m.Team.plusExpireTime>Date.now())&&m.Team.plusExpireTime:!!(m.isTrial&&m.plusExpireTime>Date.now())&&m.plusExpireTime}),_defineProperty(e,"getActiveUserTeams",function(e){return void 0===e?[]:e.filter(function(e){return 1==e.Status})}),_defineProperty(e,"isFolioOwner",function(e,a){if(a.isLabel)return!a.Email||a.Email==e;for(var t=0;t<a.Collaborators.length;t++)if(a.Collaborators[t].Email==e&&2<a.Collaborators[t].Privilege&&1==a.Collaborators[t].Accepted)return!0;return!1}),_defineProperty(e,"showUpgradePopup",function(e){if(M())popup.teamUserActionBlocked("guest-collab");else{var a=e?"OK":"See Plans",t=e?null:"Nevermind";popup.push($comp),popup.message({heading:"Please Upgrade Your Account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:a,cancelText:t,notMini:!e,handleOK:function(){e?popup.close():popup.payment("showPlans")}})}}),_defineProperty(e,"showFreeModuleBlocker",function(e,a){var t={heading:"Cannot Add New Module",message:"You've reached the limit for the number of modules you can add to this folio. On free accounts, each folio can have up to ".concat(a," modules, canvases and sections. <br><br>To add more modules, please delete other modules, create a new folio or upgrade your current plan."),btnText:"Ok",enterAsOK:!0,notMini:!0,bodyCentered:!0};m.Team&&1===m.Team.Role&&(t.btnText="See Plans",t.cancelText="Nevermind",t.handleOK=function(){e.payment("showPlans")}),e.message(t)}),e},app.core.store=function(){var t={},n=function(e){return t[e]||"undefined"==typeof Storage||(t[e]=localStorage.getItem(e)),t[e]};return{keys:{showSignupPropmt:"ssp",refCount:"refcount"},get:n,getNumber:function(e,a){return+(n(e)||a||0)},set:function(e,a){t[e]=a,"undefined"!=typeof Storage&&localStorage.setItem(e,a)},remove:function(e){delete t[e],"undefined"!=typeof Storage&&localStorage.removeItem(e)}}},app.core.utility=function(){var a,e=(a=0,function(e){return a++,e?a:"_"+a});var o=$("body"),i=$("<div>").css({position:"absolute",width:"100%",height:"100%",left:0,top:0});function t(e){return e=e.replace("#",""),(299*parseInt(e.substring(0,2),16)+587*parseInt(e.substring(2,4),16)+114*parseInt(e.substring(4,6),16))/1e3}function n(e){var t=[];return e.forEach(function(e,a){t.push(e.HexCode)}),t}function s(){return'<div class="module empty-module empty-canvas-cont"><p>No modules added yet.</p><button class="btn add-btn blue-btn">+ Add</button></div>'}function r(e,a,t){if(""===e.find(t).html()){e.find(t).html('<div class="module empty-module empty-canvas-cont"><p>No modules added yet.</p><button class="btn add-btn blue-btn">+ Add</button></div>'),e.find(t+" button").click(function(){a.find(".add-mod-btn:eq(0)").trigger("click")})}}var g=function(e){return function(){return window.location=e,!1}};function n(){return["#66D7C4","#FFD271","#D45D77","#9D557C","#3C688F","#1ab9d3","#fd9f4c","#c93555","#7e8589","#dcbc9f"]}return _defineProperty({sort:function(e,t,n){e&&(n=n||1,e.sort(function(e,a){return e[t]>a[t]?1*n:e[t]<a[t]?-1*n:0}))},contains:function(e,a){for(var t=0;t<e.length;t++)if(e[t]==a)return!0;return!1},obtain:function(e,a,t,n,o){if(t){for(var i=0;i<e.length;i++)if(e[i][a]==t)return e[i];for(i=0;i<e.length;i++)if(n&&e[i][n]==t)return e[i];for(i=0;i<e.length;i++)if(o&&e[i][o]==t)return e[i]}return null},findIndex:function(e,a,t){for(var n=-1,o=0;o<t.length;o++)if(t[o][a]===e){n=o;break}return n},createEventFunc:function(a,t){var n=!0;return function(e){n&&(n=!1,a.call(this,e),setTimeout(function(){n=!0},t||1e3))}},uniqueId:e,isPointInRect:function(e,a){return a.x>=e.left&&a.y>=e.top&&a.x<=e.right&&a.y<=e.bottom},pushUnique:function(e,a,t){for(var n=!1,o=0;o<e.length;o++)if(t&&e[t]==a||e[o]==a){n=!0;break}n||e.push(a)},getInitials:function(a){var t;try{t=1<(t=a.toUpperCase().match(/\b\w/g)).length?t.shift()+t.pop():t.shift()}catch(e){t=a.charAt(0)}return t},removeFromList:function(e,a,t,n){for(var o=0;o<e.length;o++)if(t&&e[o][t]==n||e[o]==a)return e.splice(o,1),a},indexOf:function(e,a){for(var t=0;t<e.length;t++)if(e[t]==a)return t;return-1},changeBg:function(e,a,t){e.busy();var n=new Image;n.onload=function(){a.prepend(i.attr("class",a.attr("class")).hide()),i.css("backgroundImage","url("+t+")"),i.show(),a.css("backgroundImage","url("+t+")"),o.append(i.hide()),e.close()},n.src=t},standardizeEmail:function(e){return e.toString().trim().toLowerCase()},getUrlVars:function(){var n={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,a,t){n[a]=t}),n},valToProp:function(e,t){var n=null;return $.each(e,function(e,a){if(a==t)return n=e,!1}),n},isValidURL:function(e){return/(\/?[\w-]+)(\/[\w-]+)*\/?|(((http|https):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?)/gi.test(e)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},rgb2hex:function(e){if(-1==e.search("rgb"))return e;var a=function(e){return("0"+parseInt(e).toString(16)).slice(-2)};return"#"+a((e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+a(e[2])+a(e[3])},hex2Rgb:function(e){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null},generateRandomColor:function(){return"#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6)},trimLowercase:function(e){return e.toString().toLowerCase().trim()},trimUppercase:function(e){return e.toString().toUpperCase().trim()},getColorBrightness:t,getColorContrast:function(e){return t(e)<=123?"#ffffff":"#000000"},compareArrays:function n(e,a){var t=Object.prototype.toString.call(e);if(t!==Object.prototype.toString.call(a))return!1;if(["[object Array]","[object Object]"].indexOf(t)<0)return!1;var o="[object Array]"===t?e.length:Object.keys(e).length;if(o!==("[object Array]"===t?a.length:Object.keys(a).length))return!1;var i=function(e,a){var t=Object.prototype.toString.call(e);if(0<=["[object Array]","[object Object]"].indexOf(t)){if(!n(e,a))return!1}else{if(t!==Object.prototype.toString.call(a))return!1;if("[object Function]"===t){if(e.toString()!==a.toString())return!1}else if(e!==a)return!1}};if("[object Array]"===t){for(var s=0;s<o;s++)if(!1===i(e[s],a[s]))return!1}else for(var r in e)if(e.hasOwnProperty(r)&&!1===i(e[r],a[r]))return!1;return!0},sortObjArray:function(t){var n=1;return"-"===t[0]&&(n=-1,t=t.substr(1)),function(e,a){return(e[t]<a[t]?-1:e[t]>a[t]?1:0)*n}},devWarnOnID:function(e,a,t){console.log("%c Did not find "+e+" on "+a+". Exec at "+t,"color: red")},devHighlightConsole:function(e,a){console.log("%c "+e.toString().toUpperCase(),"color: red; font-weight: bold"),console.log(a)},toggleElementViz:function(e,a){e?a.hide():a.show()},capitalizeFirstLetter:function(e){return e.toString().substr(0,1).toUpperCase()+e.toString().substr(1)},reloadWithoutHash:function(){window.location.hash="",setTimeout(function(){window.location.reload()},10)},doSetFocus:function(e,a){setTimeout(function(){e.focus(),console.log("setting focus to ",e)},1e3*(a||.5))},isSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},isIE9orLess:function(){return/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1])<10},getColors:n,canvasHasChildren:function(e){var a=!1;return e&&e.find(".edit-content .col").each(function(e){0<$(this).children().length&&(a=!0)}),a},getEmptyCanvasCont:s,generateEmptyCanvasModule:function(e,a){e&&(e.find(".edit-content .mods .resize-bars .resize-grip:eq(0)").css("left","calc(24.99% - 0px)"),e.find(".edit-content .mods .resize-bars .resize-grip:eq(1)").css("left","calc(74.97% - 0px)"),e.find(".edit-content .mods .mods-inner .col:eq(1)").removeClass("col-sm-7").addClass("col-sm-6"),e.find(".edit-content .mods .mods-inner .col:eq(2)").removeClass("col-sm-2").addClass("col-sm-3"),r(e,e,".edit-content .col:eq(1)")),a&&(a.find(".mods .mods-inner .col:eq(1)").removeClass("col-sm-7").addClass("col-sm-6"),a.find(".mods .mods-inner .col:eq(2)").removeClass("col-sm-2").addClass("col-sm-3"))},addEmptyMod:r,swapElementsInArray:function(e,a,t){if(a<0||a>e.length-1||t<0||t>e.length-1)return!1;var n=e[a];e[a]=e[t],e[t]=n},getAppUrl:function(e){var a="";return"live"==e?a="https://app.xtensio.com/":"dev"==e?a="https://app.xtensio.tech/":"local"==e&&(a="https://www.localhost.com:44301/"),a},getLocationOrigin:function(){var e=window.location;return e.protocol+"//"+e.host},addParamToUrl:function(e,a){var t=e.search(/\#/g),n=-1<t,o=e.search(/\?/g),i=-1<o&&(!(-1<t)||o<t);if(i&&!n)return e+"&"+a;if(i&&n){var s=e.substring(0,o),r=e.substring(t,e.length-1);return s+e.substring(o,t)+"&"+a+r}return i||!n?e+"?"+a:(s=e.substring(0,t))+"?"+a+(r=e.substring(t,e.length-1))},updateTeamsInMenu:function(e,a){if(console.log("this ",this),console.log("config.UserTeams ",e.UserTeams),0<e.UserTeams.length){if(this.isOnMultipleTeams(e,a)){$("#top-bar .user-menu-popup .section-title.workspace").show(),$("#top-bar .user-menu-popup .li-sep.team-item.workspace").show();for(var t=[],n=0;n<e.UserTeams.length;n++){var o=e.UserTeams[n];if(a.isTeamActive(o)){var i=e.Team.Id===o.Id?' <i class="icon-CheckMark"></i>':"",s=e.Team.Id===o.Id?"#7d858b":"#ccc",r=e.Team.Id===o.Id?"":"normal",l=e.Team.Id===o.Id?"auto":"",d='<li style="display: list-item; color:'.concat(s,"!important; font-weight:").concat(r,"!important; cursor:").concat(l,'!important;" class="item team-name ').concat("light"," team-item teamind-").concat(n,'">').concat(e.UserTeams[n].Name+i,"</li>");t.push(d)}$("#top-bar .nav-setmenu .team-item").show()}p=t,f=e,$(".nav-setmenu .item.team-name").remove(),$(p.join("")).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),f.UserTeams.forEach(function(e,a){if(f.Team.Id!=e.Id){var t=e.TeamUrl.indexOf("http")<0?"https://":"";$("#top-bar .nav-setmenu .team-item.teamind-"+a).click(g(t+e.TeamUrl))}})}else for(n=0;n<e.UserTeams.length;n++){if(o=e.UserTeams[n],a.isTeamActive(o)&&e.Team.Id!=o.Id){var c=o.TeamUrl.indexOf("http")<0?"https://":"",u=o.TeamUrl,m='<li class="item team-name team-item teamind-'.concat(n,'"><a  href="').concat(c+u,'">').concat(e.UserTeams[n].Name,"</a></li>");$("#top-bar .nav-setmenu .team-item a[href*='"+u+"']").length<1&&($(m).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item.teamind-"+n).click(g(c+u)))}$("#top-bar .nav-setmenu .team-item").show()}e.Team&&0<e.Team.Id&&e.Team.Role<=3&&((e.Team.ST&&(4==e.Team.ST||14==e.Team.ST||19==e.Team.ST||22==e.Team.ST||25==e.Team.ST||28==e.Team.ST||31==e.Team.ST)||a.isFreeWithTeam())&&e.Team.Role<3&&$('<li class="item team-menu team-edit">Manage Team Members</li>').insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"),e.Team.Role<3&&$('<li class="item team-menu team-settings">Team Settings</li>').insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"),$("#top-bar .nav-setmenu .team-menu").show(),console.log("in menu",(new Date).getTime()))}var p,f;if(e.Team&&0<e.Team.Id)if(e.PersonalSpaceFolios<=0||e.DisableP);else{var h='<li class="item team-menu import-folios">Import Folios</li>';$(h).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"),$("#top-bar .nav-setmenu .team-menu").show()}else e.PersonalSpaceFolios<=0||(h='<li class="item team-menu import-folios">Import Folios</li>',$(h).insertBefore("#top-bar .nav-setmenu .li-sep.free-menu"),$("#top-bar .nav-setmenu .free-menu").show())},isOnMultipleTeams:function(e,t){if(0<e.UserTeams.length){var n=0;return e.UserTeams.forEach(function(e,a){t.isTeamActive(e)&&n++}),console.log("countActive",n),1<n}return!1},isElementInViewport:function(e){var a=e.offset().top,t=a+e.outerHeight(),n=$(window).scrollTop(),o=n+$(window).height();return n<t&&a<o}},"getColors",n)},app.lib.googleFonts=function(e){var i={},a=[];return a.push("https://www.googleapis.com/webfonts/v1/webfonts"),a.push("?key=AIzaSyDrznrgWCKE_p-WP93QvFvpPeAynvQpakY"),{query:function(t,n){if(i[t])return console.log("cache called"),n?n(i[t]):i[t];a.push("&"+t);var o=new XMLHttpRequest;o.timeout=15e3,o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=JSON.parse(o.responseText);if(i[t]=e,console.log("added to cache"),!n)return e;n(e)}else if(0==XMLHttpRequest.readyState){var a={error:"Network error"};if(!n)return a;n(a)}},o.ontimeout=function(e){var a={error:"Network error"};if(console.log(e),!n)return a;n(a)},o.open("GET",a.join(""),!0),o.send(null)}}},app.dash.archivedFolioTopBanner=function(e,a,t,n){t&&1==t.Status&&($("#home-page").prepend($("#tmp-archived-topbar")).on("click",".unarchive",function(){return(!n.hasTeam()||e.IsDelinquent)&&1<=e.UserFolios?a.plusPrompt("create",null,!0):a.unarchive(t,function(){window.location.href="/"}),!1}),$("#tmp-power-by-footer").hide())},app.dash.archiveFolio=function(t,e,n){var o=$("#folio-items-container");o.on("click",".delete-folio",function(){var a=$(this).closest(".folio-item-shell");return n.archive(a.data("folio"),function(){a.animate({width:0,opacity:0,padding:0},500,"linear",function(){n.close();var e=a.toggleClass("active archived").removeClass("locked").attr("style","");$("#folio-arch-container").prepend(e),e.find(".collabs .initials:not(.add)").remove(),e.find(".edit").each(function(){console.log($(this),$(this).attr("href")),$(this).attr("href")&&$(this).attr("href",$(this).attr("href").replace("edit","folio"))}).eq(1).text("View Folio"),o.find(".folio-item-shell.active").length<1&&app.dash.emptyState(t,n).addNoFolio()})}),!1})},app.dash.changeView=function(e){"complete"==document.readyState?(0==e||2==e?(e=0==e?0:1,$(".filter-bar .filter-popup-menu .item").eq(e).click(),$(".filter-bar .filter").removeClass("menu-active"),$(".filter-bar .filter-popup-menu").hide()):1==e&&$("#tmp-sidebar .popup-menu .item").eq(2).click(),window.location.hash=""):setTimeout(function(){app.dash.changeView(e)},1e3)},app.dash.copyFolio=function(e,l,d,c,u,m,a){var s,t=$("#folio-items-container"),n=".copy-folio-btn";app.core.padlocks(m,a,u).setCopyFolioLock(t,n),t.on("click",n,function(){var i=$(this);return console.log("on copyFolio"),m.isSingleFolioGuest()||m.isPremiumGuest()?d.teamUserActionBlocked("create","Premium Guests"):(m.getData(1,function(e,a,t,n){var o=0,i={},s=e.ST;if(console.log("inside getData:::",e,a,t,n),t&&(10!=e.ST&&11!=e.ST||u.IsDelinquent||(o=5,i.currUser="Plus",i.limit=5)),a&&10!=e.ST&&11!=e.ST&&3!=e.ST&&16!=e.ST&&(ispro=!0),a||(o=1,i.currUser="Free",i.limit=1),u.IsDelinquent&&(o=1,i.currUser="Free",i.limit=1),m.isFreeWithTeam()&&(o=2,i.currUser="Free",i.limit=2),!a||10!=e.ST&&11!=e.ST&&16!=e.ST&&3!=e.ST||(isplus=!0,o=5,i.currUser="Plus",i.limit=5),28===s||31===s){var r=0<u.Team.Id?10:1;o=r,i.currUser="ProBusiness",i.limit=r}console.log("limit",o,t,a,u.IsDelinquent),u.Team&&u.Team.IsDelinquent?app.dash.downgrade(u,d,i,l,m,c):0<o&&(console.log("user limit:::",o),l.getUserActiveFoliosCount({success:function(e){var n=e.Data;console.log("user active folios:::",n),l.getUserTemplateCount({success:function(e){var a=e.Data,t=n+a;if(0===u.Team.Id&&(m.isProBusiness()||m.isProTeamMember()||m.isBusiness())||m.isFreeWithTeam()){if((u.IsDelinquent||o<=n||0<a)&&(i.foliosCount=e.Data,1===t))return void d.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User. Please upgrade to a premium plan for more folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){d.payment()}})}else"ProBusiness"===i.currUser&&l.getUserTeamsAndFolios({userEmail:u.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var a=_.find(JSON.parse(e.Data),{Id:u.Team.Id});void 0!==a?(a.TotalFolios>o||m.isSubscriptionExpired())&&app.dash.downgrade(u,d,i,l,m,c):console.log("getUserTeamsAndFolios teamDetails ERR",u.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}})},error:function(e){$comp.removeClass("busy"),console.log("error: ",e)}})},error:function(e){console.log("error: ",e)}}))}),m.checkFoliosLimitReached(l,d,function(){var e=i.data("token"),a=i.closest(".folio-item-shell"),t=a.find("h4"),n=a.data("copy-count")||1;a.data("copy-count",n+1);var o="Copy "+n+" - "+t.text();a.prepend($("#spinner-container > .loading-animation").clone()),u.duplicateFolioItem={FolioName:o,Token:e,IsDuplicate:!0},d.saveFolio(),u.saveFolioSuccess&&(s=u.saveFolioSuccess),"undefined"!==s&&""!==s?a.find(".loading-animation").remove():a.prepend($("#spinner-container > .loading-animation").clone())})),!1})},app.dash.createFolio=function(t,e,n,o,i,a){$("body").on("click",".folio-item .create-btn",function(e){if(console.log(".create-btn clicked..."),i.isSingleFolioGuest()||i.isPremiumGuest())o.teamUserActionBlocked("create","Premium Guests");else{var a=$(this);i.checkFoliosLimitReached(n,o,function(){t.saveFolioTemplate={id:a.closest(".folio-item").data("template"),name:a.closest(".folio-item").data("name")},o.saveFolio()})}}),$("body").on("click",".folio-item .create-ex-btn",function(e){if(console.log(".create-ex-btn clicked..."),i.isSingleFolioGuest()||i.isPremiumGuest())o.teamUserActionBlocked("create","Premium Guests");else{var a=$(this);i.checkFoliosLimitReached(n,o,function(){t.saveFolioExample={id:a.closest(".folio-item").data("template"),Token:a.closest(".folio-item").data("token"),name:a.closest(".folio-item").data("name")},o.saveFolio()})}})},app.dash.createNewMenu=function(a,t){$(".ribbon-button").on("click",function(){if(t.isPremiumGuest()||t.isSingleFolioGuest())return a.teamUserActionBlocked("create",t.getRoleName()+"s"),!1;var e=$(this).parent(".plus-menu");e.toggleClass("active"),e.hasClass("active")&&setTimeout(function(){$("body").on("click.remover",function(){e.removeClass("active"),$("body").off(".remover")})},100)})},app.dash.defaultLabel=function(e,a,t,n,o){var i=function(e){o.message({heading:"Are you sure?",message:"Set this channel as your default channel?",btnText:"Yes",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){t.makeLabelDefault({token:e.Token,success:function(){o.close(),setTimeout(function(){window.location="/"},500)},error:function(e){o.error(e.Message)}})}})};$("#all-labels-container").on("click",".default-btn",function(){return i($(this).data("label")),!1}),$(".label-details").on("click",".default",function(){return i($(this).closest(".label-details").data("label")),!1})},app.dash.delFolio=function(t,n){$("#folio-arch-container .warning #empty-trash").click(function(){var e=$("#folio-arch-container .folio-item-shell"),a=[];e.each(function(e){a.push($(this).data("token"))}),0<e.length?n.message({heading:'Are you sure you want to delete </br>all folios in trash forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete All",cancelText:"Cancel",enterAsOK:!0,notMini:!0,handleOK:function(){n.busy(),t.emptyTrash({success:function(){n.close(),$("#folio-arch-container .warning").hide(),e.each(function(e){$(this).animate({width:0,opacity:0,padding:0},500,"linear",function(){$(this).remove()})})},error:function(){n.error("There was an error. Please refresh page and try again.")}})}}):n.error("There is no folios in archived list.")}),$(".folios-container").on("click",".archived-options .delete",function(){var e=$(this).closest(".folio-item-shell");return n.message({heading:'Are you sure you want to <br/>delete forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){t.deleteFolio({data:{op:"del",token:e.data("token")},success:function(){e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})},error:function(){n.error("There was an error. Please refresh page and try again.")}})}}),!1}),$(".folios-container").find(".link").click(function(){n.payment("showPlans")})},app.dash.delLabel=function(o,i,s,r,l){var e=function(a,t){console.log("selected channel data",a);var e={heading:"Are you sure?",message:"All folios will be removed and the channel will be deleted. If you had any channel collaborators, they will no longer have access to this channel and may lose access to some folios. No folios will be deleted.",btnText:"Yes, Delete Channel",cancelText:"Cancel",bodyCentered:!0,notMini:!0,enterAsOK:!0},n={success:function(e){console.log(t.toString().toUpperCase()+" API response",e),$("#all-folios-button").hasClass("active")||setTimeout(function(){$("#all-folios-button").removeClass("active"),$("#all-folios-button").click()},500),$("#all-labels-container").find(".item[data-name="+a.Token+"]").remove(),i.removeFromList(o.labels,a),r.raiseEvent("labelChange")},error:function(e){console.log(t.toString().toUpperCase()+" API error",e),l.error(e.Message)}};"delete"===t?(n.token=a.Token,o.Team&&0<o.Team.Id?a.CanDelete?(e.handleOK=function(){s.removeCollabChan(n)},l.message(e)):l.message({heading:"Upgrade your privileges",message:"Channel members are not allowed to perform this action",btnText:"Ok",enterAsOK:!0,notMini:!0}):(e.handleOK=function(){s.removeLabel(n)},l.message(e))):o.Team&&0<o.Team.Id&&(n.data={labelToken:a.Token,memberEmail:o.userEmail,remove:!0},e.message="Leaving this channel will only remove the channel name.<br/> No folios will be deleted.",e.btnText="Yes, Leave Channel",e.handleOK=function(){s.addRemoveChannelCollaborator(n)},l.message(e))};$("#all-labels-container").on("click",".delete-btn",function(){return e($(this).data("label"),"delete"),!1}),$(".label-details").on("click",".delete",function(){return e($(this).closest(".label-details").data("label"),"delete"),!1}),$("#all-labels-container").on("click",".leave-btn",function(){return e($(this).data("label"),"leave"),!1}),$(".label-details").on("click",".leave",function(){return e($(this).closest(".label-details").data("label"),"leave"),!1})},app.dash.downgrade=function(n,o,i,s,r,e){var a=$(".folio-item-shell.active"),t=$("#templates-items-container .folio-item.own");if(console.log("=============== here???"),n.IsDelinquent||n.Team&&n.Team.IsDelinquent?n.trialConverted?o.trialExpirePopup():n.isTrialCanceled?o.downgradeNoticePopup():"Free"==i.currUser&&1==i.limit?o.trialExpirePopup(!0):o.trialExpirePopup():!n.IsDelinquent&&Date.now()>=n.plusInfo.End&&("Free"==i.currUser&&1==i.limit?o.trialExpirePopup(!0):0===n.autoRenew?o.downgradeNoticePopup():o.expiredBlocker(i)),n.Team&&0===n.Team.Id&&(n.trialConverted||"Free"===i.currUser)){var l=$("#tmp-downgrade-bar");l.find(".downgrade-bar .plan").text(i.currUser),l.find(".downgrade-bar .limit").text(i.limit),l.find(".downgrade-bar .s").text(1<i.limit?"s":""),$("#logo-bar").after(l),$("#dashboard-page").addClass("downgrade"),$(".upgrade-btn, .plus-menu").remove(),$(".sidebar #add-label").remove(),$(".folio-item.as-template .cta-btn.primary").addClass("visible-hidden"),l.find(".link").click(function(){var e=r.getActiveUserTeams(n.UserTeams).find(function(e){return 1==e.Role});0!==n.Team.Id?1===n.Team.Role&&"ProBusiness"===i.currUser?o.payment("showPlans"):3<n.Team.Role&&e&&(window.location=e.TeamUrl):o.billing()}),a.each(function(e,a){var t=$(a),n=t.data("folio"),o=Faltu(n.Collaborators).find({Accepted:!0}).count(),i=t.addClass("locked").find(".edit");i.eq(0).attr("href",i.eq(0).attr("href").replace("edit","folio")),i.eq(1).remove();var s=t.find(".archived-options").empty();2<n.Role&&s.append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>').data("token",n.Token),1<o&&n.Role<3&&s.append('<div class="action delete-folio" data-tip="Leave"><i class="icon-Transfer"></i></div>').data("token",n.Token)}),t.each(function(e,a){var t=$(a),n=(t.data("folio"),t.addClass("locked").find(".edit"));n.eq(0).removeAttr("href"),n.eq(1).remove(),t.find(".use-template").remove(),t.find(".archived-options").empty().append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>')}),t.on("click",".delete-folio",function(){var e=$(this).closest(".folio-item-shell");o.message({heading:"Delete this template?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){s.deleteUserTemplate({token:e.data("token"),op:"del",success:function(){e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})},error:function(e){$("#dashboard-page > .loader").hide(),o.message({heading:"Oops!",message:e.Message,btnText:"Ok",enterAsOK:!0})}})}})})}!function t(){var e=$(".folio-item-shell.active"),a=$("#templates-items-container .folio-item.own");e.length<=i.limit&&0==a.length?n.IsDelinquent||n.Team&&n.Team.IsDelinquent?n.trialConverted?o.failedPaymentBlocker(i):o.trialExpirePopup():"Free"==i.currUser&&1==i.limit?window.location.reload():r.isSubscriptionExpired()?o.expiredBlocker(i):0<n.Team.Id&&"ProBusiness"===i.currUser?s.getUserTeamsAndFolios({userEmail:n.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var a=_.find(JSON.parse(e.Data),{Id:n.Team.Id});void 0!==a?a.TotalFolios<=i.limit?window.location.reload():setTimeout(t,1e3):console.log("getUserTeamsAndFolios teamDetails ERR",n.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}}):window.location.reload():setTimeout(t,1e3)}()},app.dash.emptyState=function(s,r){var l=$("#folio-items-container"),d=$("#tmp-empty-state").html();function e(e){$("#tmp-dash-topbar a.template").click()}function a(e,a,t,n,o){var i=$(d);i.find("h2").text(e),i.find("p.tag").text(a),t?i.find("button").text(t).on("click",n):i.find("button").hide(),s.Team&&0<s.Team.Id&&s.Team.Role<4?s.PersonalSpaceFolios<=0?i.find("p.imp-folio").remove():i.find("p.imp-folio").on("click",function(){r.importFolioPopup()}):i.find("p.imp-folio").remove(),l.append(i.addClass(o||""))}return{addNoFolio:function(){a("You don't have any folios yet.","A folio is a living document or a presentation.","Create a Folio",e,"empty")},addNoShared:function(){a("Looks like no one's shared folios with you yet.","When collaborators add you to their folios, you will see them here.",!1,null,"empty-shared")},addNoMyFolio:function(){a("You don't have any folios yet.","A folio is a living document or a presentation.","Create a Folio",e,"my-empty")}}},app.dash.exampleLabels=function(o,t,e,a){var n,i=$(".folios-container.examples"),s=$("#tmp-example-sidebar"),r=$("#single-label").html(),l=$("#tmp-example-labels-container"),d=$("#dashboard-page .filter-bar .example-sort"),c=t.getColors(),u=$("#examples-items-container");t.sort(o.exampleLabels,"Name"),0===$("#dashboard-page").find("#exampleloader").length&&($("#dashboard-page").append($('<div id="exampleloader" class="example-loader"><div class="loading-animation"></div></div>')),n=$("#dashboard-page").find("#exampleloader"));var m,p,f,h=i.find(".label-details.example"),g=i.find(".example-labels-dropdown");function v(e){e?(u.css("visibility","hidden"),n.find(".loading-animation").html(a.spinner),n.show()):(u.css("visibility","visible"),n.hide())}function b(e){p=u.find(".as-example"),m.filter(p.filter("."+e))}$("#example-sidebar").append(s),e.addListener("reInitMixerTemplates",function(){v(!0),function(){if(o.exampleLabels){l.html("");for(var e=0;e<o.exampleLabels.length;e++){var a=o.exampleLabels[e],t=$(r).data("label",a);a.color=c[e%c.length],t.find(".label").css("background-color",a.color),t.find(".name").text(a.Name||"Untitled"),t.find(".options").remove(),t.on("click",T).data("label",a),l.append(t);var n=$("<option></option>");n.text(a.Name||"Untitled").val(a.Token),g.append(n)}}}(),function(){m&&m.destroy();var e=d.find(".item.active").data("value");e=void 0===e?"used:desc":e,m=mixitup(i,{animation:{duration:400},selectors:{target:".folio-item"},load:{filter:".xtensio",sort:e},callbacks:{onMixFail:function(e){v(!1),console.log("No items could be found matching the requested filter")}},debug:{enable:!0},controls:{enable:!1}}),clearTimeout(f),f=setTimeout(function(){m.forceRefresh()},1e3)}(),m.filter("all"),v(!1)});function T(){var e=$(this),a=e.data("label");if(s.find(".item").removeClass("active"),e.addClass("active"),u.find(".state").hide(),h.find(".label-name").css({paddingLeft:"10px"}),h.find(".label-name").css({display:"inline-block"}),a&&"own"==a.Token&&(h.find(".label-color").hide(),u.find(".own").removeClass("hidden")),!a)return m.filter(".xtensio"),h.addClass("normal").find(".label-name").text("Xtensio Examples"),void u.find(".state").hide();h.removeClass("normal"),h.find(".label-name").text(a.Name),h.find(".label-color").css("background-color",a.color),b(a.Token)}e.addListener("showExamplesTab",function(){$("#tmp-dashboard-content .x-select.example-labels-dropdown").hide(),h.find(".label-name").hide(),l.show(),l.find(".item").removeClass("active"),$("#tmp-dashboard-content .x-select.example-labels-dropdown").show(),h.find(".label-name").css({display:"inline-block"}),m&&m.filter("all"),h.addClass("normal").find(".label-name").text("Xtensio Examples")}),g.on("change",function(){var e=$(this).val(),a=t.obtain(o.exampleLabels,"Token",e);if(null===a)return m.filter("all"),void h.addClass("normal");b(a.Token),h.removeClass("normal")}),d.change(function(){m.sort($(this).data("value"))})},app.dash.examples=function(s,r,e,a,t,n,o){var i=$("#app-load-animation"),l=$("#examples-items-container"),d=$(".nav-main-menu a").not("a.help-center, a.examples-link"),c=r.getColors(),u=$(".tab-content"),m=$("#example-item").html();app.core.padlocks(t,o,s);function p(i,e){$.each(e.Labels,function(e,a){var t=r.obtain(s.exampleLabels,"Token",a),n=c[e%c.length];if(t){t.color=n;var o=$('<div class="label"></div>').css("background-color",n).text(t.Name);o.data("token",t.Token),i.addClass(t.Token),i.find(".labels").prepend(o)}})}function f(o){void 0!==s&&s.isDashboard&&a.getExampleData({success:function(e){console.log("getExampleData response",e);try{var a=JSON.parse(e.Data),t=JSON.parse(a.XtensioExamples),n=JSON.parse(a.ExampleLabels);console.log("--- examples data ---",a),s.exampleLabels=n,l.html(""),function(e){for(var a=0;a<e.length;a++){var t=e[a];tempFolio=$(m),tempFolio.attr("data-template",t.TemplateName).attr("data-name",t.PublicName||t.FolioName).attr("data-used",t.UsedCount).attr("data-type",!1).attr("data-date",t.CreatedDate).attr("data-token",t.FolioToken),p(tempFolio,t),t.Thumbnail&&tempFolio.find(".img").removeClass("hidden").find("img").attr("src",t.Thumbnail),t.UsedCount&&tempFolio.find(".used").text("Used "+t.UsedCount+" times");var n=t.FolioUrlSlug?t.FolioUrlSlug:t.FolioToken;url=s.baseUrl+"/"+n;var o=tempFolio.find("h4");o.text(t.PublicName||t.FolioName),setTimeout(function(){o.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),tempFolio.find(".preview, .link").attr("href",url),t.IsNew&&tempFolio.find(".new-label").removeClass("hidden"),tempFolio.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),tempFolio.find(".create-cont").hide(),tempFolio.find(".link-share-cont").hide(),tempFolio.find(".options").remove(),tempFolio.addClass("xtensio"),tempFolio.hide(),l.append(tempFolio),console.log("tempFolio",tempFolio)}}(t),"function"==typeof o&&o()}catch(e){console.trace("getExampleData error",e)}},error:function(e){console.log("getExampleData error",e)},complete:function(){n.raiseEvent("initToolTips")}})}tempFolio=null,url=null,$(".nav-main-menu a.examples-link").click(function(e){if(e.preventDefault(),1==s.enableExamplesTab){d.removeClass("active");var a=$(this),t=a.addClass("active").index();u.addClass("hidden").filter(":eq("+t+")").removeClass("hidden"),$("body").removeClass("colored-dashboard"),n.raiseEvent("clearTemplateSubmenu",a),tempInit=!0,l.css({opacity:0}),i.show(),f(function(){n.raiseEvent("reInitMixerTemplates"),setTimeout(function(){l.css({opacity:1}),n.raiseEvent("showExamplesTab"),i.hide()},2e3)})}else window.location.href="https://xtensio.com/examples/?_ga=2.65959978.561003538.1581718826-910912414.1580898754"})},app.dash.expiredTrials=function(e,o,a){function t(e){var a=e-Date.now(),t=Math.floor(a/864e5),n=Math.floor(a%864e5/36e5);return i.text(t+" days, "+n+" hours "),a<0&&o.expiredBlocker(),a}var n=$("#tmp-trial-expired-bar"),i=n.find(".trial-expired-bar .timer"),s=n.find(".trial-expired-bar .message"),r=a.getExpirationDate(),l=(t(r),setInterval(function(){t(r)<0&&clearInterval(l)},36e5));$("#dashboard-page").addClass("onTrial"),$("#edit-page").addClass("onTrial"),$("#logo-bar").before(n),a.isOwner()||!a.hasTeam()?(s.text("Your free trial expires in"),n.find(".trial-expired-bar p").append($('<span class="link">Upgrade Now</span>'))):s.text("Your team is on a free trial that expires in"),n.find(".link").click(function(){o.payment()})},app.dash.getExploreFolio=function(T,e,a){var y=$("#tmp-dashboard-content .explore .loading-animation");y.html(a.spinner),e.getFolioFullByToken({token:T.ExploreTabFolioToken,success:function(e){console.log("Success from GetFolioByTOken",e);var a,t,n,o,i,s=JSON.parse(e.Data).FolioData,r=app.core.main(T,s),l=r.utility,d=r.apiHelper,c=r.eventManager,u=r.pageManager,m=r.store,p=r.modStore,f=r.folioStore,h=r.configStore,g=r.appHub,v=r.plusHelper,b='<style id="folio-style" type="text/css">'+(f.get("style")||"")+"</style>";$("head").append(b),app.plugin.main(T,r,s,v,l),n=app.popup.main(T,c,l,d,u,v,p,m,s,f,h,g),a={},o=(t=app.managers.main(T,s,r,a,n)).modManager,i=t.rddm,console.log(s),app.factory.main(T,s,r,a,n,o,i,l),o.activatePreview(),T.EditTemplate="dash-explore",app.menutcopy(T,d,c,n,v,l),$("#home-page").after($("#presentation-buttons").addClass("public")),y.hide()},error:function(e){console.log("Error from GetFolioByTOken",e),$("#tmp-dash-topbar .explore").hide(),y.hide()}})},app.dash.filterBar=function(e,a,s,t,r,n,l){var d,o,i,c="private",u=$("#dashboard-page").find(".loader"),m=!1;function p(){s.message({heading:"Please Upgrade Your Account",message:"Channel collaboration is only available on team dashboards. Please upgrade or switch to your team dashboard to add people.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){s.payment("showPlans")}})}setTimeout(function(){$(".label-details:not(.temp)").find(".label-name").scrollText({speed:2e3,startEvent:"mouseenter",minScrollWidth:190,ellips:0,animBack:!0})},1e3),d=$(".filter-bar .private-button"),o=$(".filter-bar .add-new-people"),i=$(".filter-bar .initials.add"),l.Team&&0<l.Team.Id&&l.isDashboard?(o.hide(),d.click(function(){if(4===l.Team.Role||5===l.Team.Role){var e=$("#all-labels-container").find(".item.active").data("name"),a=_.findIndex(l.labels,["Token",e]);-1!==a&&(console.log("config.labels[labelID]",l.labels[a]),c=2===l.labels[a].AccessType?"team":"private"),s.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to change access type of channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0}),setTimeout(function(){doToggleHtml(c)},300)}}),d.change(function(){if(!m){var e=function(e){var a="private"===e?'<i class="icon-PadlockBig"></i> Private':'<i class="icon-UsersGroup"></i> Team Visible';a='<span class="text-current">'+a+'</span><i class="icon-Down-Arrow"></i>',d.find(".text").html(a)},a=function(e){(m=e)?(d.addClass("disable-ui"),u.show()):(u.hide(),d.removeClass("disable-ui"))},t=$(this).data("value"),n=$("#all-labels-container").find(".item.active").data("name"),o=_.findIndex(l.labels,["Token",n]);-1!==o&&(console.log("config.labels[labelID]",l.labels[o]),c=2===l.labels[o].AccessType?"team":"private"),console.log("private-button change",t),console.log("labelToken",n),e(t);var i="Are you sure you want to make this channel private? Your team members will be removed from folios within this channel. You can still add individual collaborators to the channel and folios.";"team"===t&&(i="Are you sure you want to make this channel team visible? All of your team members will have editing access to all folios added to this channel."),s.message({heading:"Channel Access Change",message:i,btnText:"Ok",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){a(!0),r.changeChannelAccess({data:{labelToken:n,newAccessType:"private"===t?1:2},success:function(e){c=t,console.log("changeChannelAccess response",e)},error:function(e){t=c,console.log("changeChannelAccess err",e)},complete:function(){a(!1),d.find(".item").removeClass("active"),d.find("div[data-name='"+t+"']").addClass("active"),e(t)}})},handleNo:function(){a(!1),e(c)}})}}),o.click(function(){4===l.Team.Role||5===l.Team.Role?s.message({heading:"You Cannot Perform this Action",message:"Guests cannot add collaborators. Please reach out to the team owner for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0}):s.teamChannelManagePopup(!0)}),i.click(function(){o.trigger("click")})):(d.addClass("fade-ui"),d.unbind("click"),o.addClass("fade-ui"),i.hide(),d.click(p),o.click(p))},app.dash.filter=function(c,u,e,m,a,t,n){var p,f,h,g,v,o,i,b=$(".folios-container:not(.templates)"),s=b.find(".folio-item-shell"),T=$(".label-details:not(.temp):not(.example)"),r=($(".content .filter-bar .labels-dropdown"),$(".my-shared-popup-menu")),l=$("#tmp-empty-channel-state").html(),d=$("#all-folios-button"),y="private",C='<i class="icon-PadlockBig"></i> Private',w='<i class="icon-UsersGroup"></i> Team Visible',k=$("#tmp-filter-bar"),x=$(k.html()),P=$(l),S=$("#dashboard-page > .loader"),D=$("#folio-arch-container #days-limit");S.find(".loading-animation").html(e.spinner);var F=app.plugin.popupMenu(d,r,!0);function I(e){S.show(),0===$("#folio-items-container .state.empty-label").length&&setTimeout(function(){A()},1e3),o.forceRefresh(),i.forceRefresh(),o.filter(e),i.filter(e),setTimeout(function(){S.hide()},500)}function M(){console.log("config.selectedChannel=====",c.selectedChannel),c.selectedChannel||(c.selectedChannel="all"),c.sortChannel||(c.sortChannel="saved:desc"),console.log("setMixer exec");var e={animation:{duration:400},selectors:{target:".folio-item-shell"},load:{filter:"all"===c.selectedChannel?c.selectedChannel:"."+c.selectedChannel,sort:c.sortChannel},controls:{enable:!1}};o&&o.destroy(),i&&i.destroy(),o=mixitup(b.eq(0),e),i=mixitup(b.eq(1),e),console.log("empty-label count",$("#folio-items-container .state.empty-label").length),0===$("#folio-items-container .state.empty-label").length&&setTimeout(function(){A()},1e3)}function E(e){b.removeClass("mine shared").addClass(e)}function U(e){console.log("applyFilter target",e);var a=(s=b.find(".folio-item-shell")).filter("."+e);I(a),N(e);var t=a.filter(".active").length,n=a.filter(".archived").length;$("#folio-items-container")[0<t?"addClass":"removeClass"]("has-label-folios"),$("#folio-arch-container")[0<n?"addClass":"removeClass"]("has-label-folios")}function N(e){m.setLastChannel({token:e,success:function(e){console.log("setLastChannel response",e)},error:function(e){console.log("setLastChannel err",e)}})}function A(){S.hide(),P.find("button.view-all").on("click",function(){d.click()}),console.log("createEmptyState exec"),$("#folio-items-container").append(P.addClass("empty-label"))}function L(){var a=$("#all-labels-container").find(".item.active").data("name");console.log("currentToken",a);var e=_.findIndex(c.labels,function(e){return e.Token===a});if(console.log("config.labels",c.labels),console.log("labelID",e),-1!==e){var t="";console.log("config.labels[labelID]",c.labels[e]),y=2===c.labels[e].AccessType?(t=w,"team"):(t=C,"private"),t='<span class="text-current">'+t+'</span><i class="icon-Down-Arrow"></i>',f.find(".text").html(t),f.find(".item").removeClass("active"),f.find("div[data-name='"+y+"']").addClass("active")}else console.log("Failed to retrieve current label's details")}$("#folio-items-container").before(x),$("#templates-items-container").before($("#tmp-temp-filter-bar").html()),$("#examples-items-container").before($("#tmp-examples-filter-bar").html()),$(".filter-bar .sort").change(function(){var e=$(this).data("value");c.sortChannel=e,($("#folio-items-container").hasClass("active")?o:i).sort(e)}),$(".filter-bar .filter").change(function(){"Deleted"==$(this).data("value")?(D.html(a.isBusinessTeamMember()?"180":a.isProTeamMember()?"90":(a.isFree()||a.isFreeWithTeam(),"14")),0<$("#folio-arch-container .folio-item-shell").length?($("#folio-arch-container .warning").show(),$("#dashboard-page").addClass("has-archived")):($("#folio-arch-container .warning").hide(),$("#dashboard-page").removeClass("has-archived"))):$("#dashboard-page").removeClass("has-archived"),$("#folio-items-container").removeClass("active archived").addClass($(this).data("value").replace("Deleted","Archived").toLowerCase());var e=x.find(".label-details");e.hasClass("normal")&&e.find(".label-name").text($(this).data("value")+" Folios")}),n.addListener("reInitChannelMixers",function(){M()}),d.click(function(){c.selectedChannel="all",$(this).hasClass("active")&&F()}),r.find(".item").on("click",function(){var e=$(this);e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),d.find(".name").text(e.data("show-name")),T.addClass("normal").find(".label-name").text(e.data("show-name")),E(e.data("orderby")))}),$(document).on("change",".content .filter-bar .labels-dropdown",function(e){var a=$(this).val(),t=u.obtain(c.labels,"Token",a);if(null===t)return"all"!=a?E(a):(E(""),I("all"),N("all")),s.removeClass("hidden"),void T.addClass("normal");E(""),U("chan-"+t.Token),T.removeClass("normal").data("label",t)}),c.Team&&0<c.Team.Id&&c.isDashboard&&n.addListener("refreshLabelData",function(){return L()}),M(),void 0===c.filterInit&&($("#dashboard-page").append('<div class="loader" style="position: fixed;width: 100%;height: 100%;top: 0;left: 0;display: none;z-index: 99999;"><div class="loading-animation"></div></div>'),$("#tmp-sidebar").on("click",".item:not(.pmenu)",function(e){if(!(0<$(e.target).closest(".options").length)){p=$("#tmp-sidebar .sidebar").find(".item:not(.pmenu)");var a=$(this);p.removeClass("active"),a.addClass("active");var t=a.data("name"),n=a.find(".name").text(),o=a.find(".label").attr("style");if(b.removeClass("has-label-folios"),!t)return b.removeClass("label-view"),I("all"),N("all"),void T.addClass("normal").find(".label-name").text(n);b.addClass("label-view"),(T=$(".label-details:not(.temp):not(.example)")).removeClass("normal").data("label",a.data("label")),T.find(".label-name").text(n),T.find(".label-name").stop(),T.find(".label-name").removeAttr("style"),T.find(".label-color").attr("style",o);var i=c.labels[u.findIndex(t,"Token",c.labels)],s=!0,r=!0,l=!0;if(console.log(i.IsDefault),T.find(".leave").hide(),i.IsDefault?r=!1:c.Team&&0<c.Team.Id?i.CanDelete&&4!==c.Team.Role&&5!==c.Team.Role?r=s=l=!1:2!==i.AccessType&&T.find(".leave").show():l=r=s=!1,u.toggleElementViz(l,T.find(".default")),u.toggleElementViz(s,T.find(".delete")),u.toggleElementViz(r,T.find(".rename")),c.Team&&0<c.Team.Id&&c.isDashboard){f=$(".filter-bar .private-button"),L();var d=$("#all-labels-container").find(".item.active").data("name");h=$(".filter-bar .add-new-people"),g=$(".filter-bar .initials.add"),v=$(".filter-bar .initials-list"),h.show(),g.hide(),v.empty(),m.getChannelCollaborators({data:{token:d},success:function(e){console.log("getChannelCollaborators response",e);var a=JSON.parse(e.Data);if(console.log("collaboratorsData",a),0<a.length){h.hide(),g.show(),v.empty();for(var t=3<a.length?3:a.length,n=0;n<t;n++){var o=$('<div data-tip="" class="initials"></div>'),i=a[n].FullName||a[n].Email;o.data("tip",i),o.text(u.getInitials(i)),v.append(o)}}},error:function(e){console.log("getChannelCollaborators response",e)}})}"all"!==t&&(t="chan-"+t),U(c.selectedChannel=t)}}),c.selectedChannel="",c.filterInit=!0)},app.dash.folios=function(f,h,c,g,v,u){Date.now(),f.plusInfo.End;var s,m=0,p=0,b=0,e=($("#home-page"),$("#dashboard-page")),a=$("#tmp-sidebar"),t=$("#tmp-dashboard-content"),T=t.find("#folio-items-container"),y=t.find("#folio-arch-container"),C=$("#folio-item").html(),n=($("#single-label"),a.find("#all-labels-container"),t.find("#sidebar")),w=($("#top-bar"),$("#app-load-animation"));function k(a,t){0===f.labels.length?$("#add-label").click():g.labels(t,a,function(e){a.find(".labels >*:not(:last-child)").remove(),x(a,t,!0)})}function x(s,r,l){var e=".folio-item-shell[data-token="+s.data("token")+"]",d=null;!0===l&&0<$(e).length&&(d=$(e)),s.find(".labels").empty(),!0===l&&d.find(".labels").empty(),$.each(r.Labels,function(e,a){var t=c.obtain(f.labels,"Token",a),n=_.findIndex(f.labels,function(e){return e.Token===a});if(t){var o=t.color||f.colors[n%f.colors.length],i=$('<div class="label"></div>').css("background-color",o).html(t.Name+'<div class="ghost"><i class="icon-Close"></i></div>');i.data("token",t.Token),i.find(".ghost").on("click",function(){(function(e,a){var t=$(this),n=t.data("token"),o=c.removeFromList(a.Labels,n);e.removeClass(o);var i={token:a.Token,id:$(this).data("token"),success:function(e){t.animate({width:0,opacity:0,padding:0},500,"linear",function(){t.hide()})},error:function(e){console.log(e),g.error(e.Message)}};if(f.Team&&0<f.Team.Id)if(4===f.Team.Role||5===f.Team.Role)g.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to add or remove folios to channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0});else{var s=_.findIndex(f.labels,["Token",n]);if(0<=s)var r=f.labels[s];else console.log("WARN DEV: token "+n+" not found on config.labels");!a.IsCurrentUserOwner&&0<=s&&(2==r.AccessType||1==r.AccessType&&0<r.ChannelMembers.length)?g.message({heading:"Do you really want to remove this folio?",message:"Removing the folio from <b>"+r.Name+"</b> will remove all channel collaborators, including you. The folio will return to <b>"+a.UserFullName+"'s</b> default channel.",btnText:"Yes, remove the folio",cancelText:"Nevermind",notMini:!0,handleOK:function(){v.removeFromCollabChan(i)}}):v.removeFromCollabChan(i)}else v.removeFromLabels(i)}).call(i,s,r)}),s.addClass("chan-"+t.Token),s.find(".labels").prepend(i),!0===l&&(d.addClass("chan-"+t.Token),d.find(".labels").prepend(i))}})}function P(e,a){if(!(a.Version<2)){var n=e.find(".collabs"),o=0,i=[],s=[];if($.each(a.Collaborators,function(e,a){if(a.Accepted&&0<a.Privilege&&a.Email!=f.userEmail)if(++o<=5){var t=$('<div class="outer"><div class="initials">MU</div></div>');t.find(".initials").text(c.getInitials(a.FullName||a.Email)).attr("data-tip",a.FullName).attr("data-email",a.Email),n.prepend(t.find(".initials"))}else i.push(a.Email),s.push(a.FullName)}),5<o){var t=n.find(".initials:last-child");s.unshift(t.attr("data-tip")),i.unshift(t.attr("data-email")),t.attr("data-html","true").text("+"+(o-5+1)).attr("data-email",i.join("-")).attr("data-tip",s.join("<br/>"))}var r,l=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');u.isSingleFolioGuest()||u.isPremiumGuest()?(l.attr("data-tip","Add / Remove People"),l.click(function(){g.teamUserActionBlocked("add-remove-collab","Guests")})):(1===a.Role?l.addClass("hidden"):l.removeClass("hidden"),l.attr("data-tip","Add / Remove People"),l.click((r=a,function(){return g.collaborators(r),!1}))),n.append(l)}}function S(a,e,t,n){var o=$(C),i=(f.baseUrl,a.Token,a.FolioName||"Untitled"),s=dayjs(a.LastSavedUtc);a.Status<1&&(p++,2<a.Role&&m++),a.Role<3&&b++,o.attr("data-token",a.Token).attr("data-saved",a.LastSavedUtc).attr("data-name",i.toLowerCase()).data("folio",a),o.addClass(0===a.Status?"active":"archived"),o.addClass(1<a.Role?a.Role<3?"shared edit-access":"mine":"shared");var r,l=o.find("h4");l.text((r=i,$("<div/>").html(r).text())),setTimeout(function(){l.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),o.find(".inline-title").val(i),0==a.Status&&o.find(".preview").attr("href",f.baseUrl+"/edit/"+a.Token+"#preview").removeClass("hidden"),o.find(".edit").attr("href",f.baseUrl+"/"+(0===a.Status?"edit":"folio")+"/"+a.Token);var d,c=1==a.Status?"View":"Edit";o.find(".options .edit").text(c+" Folio"),o.find(".delete-folio, .copy-folio-btn, .rename-folio-btn, .transfer-folio-btn").data("token",a.Token),o.find(".last-update").find("span").text(s.fromNow()).attr("title",s.format("lll")),a.Role<3&&(o.find(".delete-folio span").text("Leave"),o.find(".delete-folio i").removeClass("icon-Delete").addClass("icon-Transfer")),x(o,a),P(o,a),o.find(".manage-label").click(function(){f.Team&&0<f.Team.Id?(console.log("Role",f.Team.Role),console.log("$tempFolio",o),console.log("folio",a),4===f.Team.Role||5===f.Team.Role?g.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to add or remove folios to channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0}):k(o,a)):k(o,a)}),o.find(".share").click((d=a,function(){return g.shareLink(d),!1})),f.Team&&0==f.Team.Id&&!ispro&&(o.find(".save-template-btn").addClass("locked"),setTimeout(function(){var e=app.plugin.lockedTip(f,h);app.dash.folioStats(f,g,u,e,h)},100)),3!==a.Role&&o.find(".transfer-folio-btn").addClass("hidden"),e?($("body").animate({scrollTop:0},500),o.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),T.find('.folio-item-shell:not(".transfer-item"):eq(0)').before(o)):a.Status<1?(n&&($("body").animate({scrollTop:0},500),o.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),setTimeout(function(){o.removeClass("scaleup")},2e3)),t?T.prepend(o):T.append(o)):(y.find(".folio-item-shell[data-token='"+o.data("token")+"']").remove(),y.append(o)),h.addListener("labelChange",function(e){o.find(".labels >*:not(:last-child)").remove(),x(o,a)})}if(isplus=!1,ispro=!1,e.append(t),n.append(a),T.addClass("visible-hidden"),s=function(){if(f.lastChannel&&"all"!==f.lastChannel){var e=f.lastChannel.toString().replace("chan-","");$("#all-labels-container").find('div[data-name="'.concat(e,'"]')).click()}},f.isFollioDataInit=!1,w.show(),h.raiseEvent("folioDataLoading"),v.getFolioData({success:function(e){console.log("getFolioData response",e),T.find(".state.empty").remove();try{var a=JSON.parse(e.Data),t=""===a.UserFolios?[]:JSON.parse(a.UserFolios),n=""===a.TransferFolios?[]:JSON.parse(a.TransferFolios),o=""===a.PendingFolios?[]:JSON.parse(a.PendingFolios);f.folios=t,f.tansFolios=n,f.foliosPending=o,console.log("userFolios",f.folios),console.log("transferFolios",f.tansFolios),console.log("foliosPending",f.foliosPending),i=t,T.html(""),i.sort(function(e,a){return a.LastSavedUtc-e.LastSavedUtc}),i.forEach(function(e){return S(e)}),T.is(":empty")&&app.dash.emptyState(f,g).addNoFolio(),T.addClass("active").removeClass("visible-hidden"),w.hide(),f.isFollioDataInit=!0,h.raiseEvent("processPendingNotifications"),h.raiseEvent("processPendingTransfers"),h.raiseEvent("reInitChannelMixers"),s&&"function"==typeof s&&s()}catch(e){console.log("getFolioData error",e),w.hide()}var i},error:function(e){console.log("getFolioData error",e),w.hide()}}),$(".custom-select").on("click",function(){$(this).parent(".folio-item").toggleClass("selected",$(this).is(":checked"))}),h.addListener("collabChange",function(e){var a=$('.folio-item-shell[data-token="'+e.Token+'"]');a.find(".collabs").empty(),P(a,e),app.plugin.tooltip()}),h.addListener("folioRename",function(e){$('[data-token="'+e.Token+'"]  > .folio-item > a > h4').html(e.NewFolioName)}),u.checkFolioRestrictions(v,function(e){app.dash.downgrade(f,g,e,v,u,h)}),u.getExpirationDate()&&app.dash.expiredTrials(f,g,u),function(){p<1&&f.tansFolios&&0===f.tansFolios.length?0===T.find(".state.empty").length&&app.dash.emptyState(f,g).addNoFolio():T.find(".state.empty").remove();0<p&&m<1?0===T.find(".state.my-empty").length&&app.dash.emptyState(f,g).addNoMyFolio():T.find(".state.my-empty").remove()}(),b<1&&app.dash.emptyState(f,g).addNoShared(),h.addListener("collabreqaccpt",function(e,a){S(e,!1,a)}),h.addListener("folioArchived",function(e){var a;a=e.Token,f.isHome&&(T.find(".folio-item-shell[data-token='"+a+"']").remove(),console.log("folio cont length",T.find("div").length),0===T.find(".active").length&&0===T.find(".state.empty").length&&app.dash.emptyState(f,g).addNoFolio())}),h.addListener("foliosRecieved",function(e,a){e.Collaborators.push({Email:f.userEmail,FullName:f.fullName,Privilege:3,Accepted:!0}),S(e,!1,a,!0)}),f.Team&&0<f.Team.Id&&f.isDashboard){h.addListener("editorStatusOnDash",function(e){console.log("editorStatusOnDash in folios.js ",e);var a=f.currentlyEditing[e.email],t=1==e.status?a&&a.active?"editing":"active":"";!function(a){var e=$("[data-token='"+a.folioToken+"']").find("[data-email*='"+a.email+"']");if(e.attr("data-html")){var t=e.attr("data-email").split("-"),n=e.attr("data-tip").split("<br/>")[t.findIndex(function(e){return e==a.email})],o=$(".collabs .initials").filter(function(){return 0<!$(this).find("i").length&&!$(this).attr("data-html")});if(o.length){var i=$(o[0]),s=i.attr("data-tip"),r=i.attr("data-email");i.text(c.getInitials(n)).attr("data-tip",n).attr("data-email",a.email).attr("data-original-title",n),e.attr("data-tip",e.attr("data-tip").replace(n,s)).attr("data-original-title",e.attr("data-tip")).attr("data-email",e.attr("data-email").replace(a.email,r))}}}(e);var n=$("[data-token='"+e.folioToken+"']").find("[data-email*='"+e.email+"']");0==n.find(".status").length&&n.append("<i class='status'></i>"),0==n.find(".editing").length&&n.append("<i class='editing'></i>"),n.removeClass("active editing").addClass(t)}),h.addListener("updateFolioData",function(e){var n=e.data,o=e.cb;if(n&&n.FolioData){w.show(),h.raiseEvent("folioDataLoading");var i=n.FolioData,s=!0,r=!1;f.labels.forEach(function(e){e.Token===n.Token&&(r=!0)});var l=[];if(0<i.length){if(f.folios.forEach(function(a){var t=!1,n=!0;i.forEach(function(e){a.Token===e.Token&&(t=!0),f.labels.forEach(function(e){-1!==e.FolioTokens.indexOf(a.Token)&&(n=!1)})}),t||n||l.push(a)}),f.prevLabels){var a=f.prevLabels.find(function(e){return e.Token===n.Token});if(a){var t=[];if(a.FolioTokens&&0<a.FolioTokens.length&&(a.FolioTokens.forEach(function(e){-1===n.FolioTokens.indexOf(e)&&t.push(e)}),console.log("removedFolioTokens",t),0<t.length)){var d=[];if(t.forEach(function(a){var t=!1;f.labels.forEach(function(e){e.Token!==n.Token&&-1!==e.FolioTokens.indexOf(a)&&(t=!0)}),t&&d.push(a)}),console.log("foliosNeedUpdating",d),0<d.length){s=!1;var c=0,u=d.length,m=setInterval(function(){c===u&&(clearInterval(m),s=!0)},500);d.forEach(function(a){var i=_.findIndex(l,function(e){return e.Token===a});-1!==i?v.getRemovedFolioData({token:a,success:function(e){console.log("getRemovedFolioData response",e);var a=JSON.parse(e.Data),t=a.LabelTokens,n=a.Collaborators,o=l[i];console.log("rfolioData",o,i),o.LabelTokens=t,o.Collaborators=n,l.splice(i,1,o)},error:function(e){return console.log("getRemovedFolioData error",e)},complete:function(){return c++}}):c++})}}}}}else l=f.folios;var p=setInterval(function(){var e,a,t,n;s&&(clearInterval(p),e=r,a=l,t=i,n=o,f.folios=e?[].concat(_toConsumableArray(a),_toConsumableArray(t)):_toConsumableArray(a),T.html(""),f.folios.sort(function(e,a){return a.LastSavedUtc-e.LastSavedUtc}),f.folios.forEach(function(e){return S(e)}),T.is(":empty")&&app.dash.emptyState(f,g).addNoFolio(),T.addClass("active").removeClass("visible-hidden"),w.hide(),n&&"function"==typeof n&&n())},500)}})}},app.dash.folioStats=function(a,t,n,e,o){var i=$("#folio-items-container"),s=app.core.padlocks(n,e,a).setFolioStatsLock;o.addListener("userTeamRoleChanged",function(e){a.userEmail==e.Data.Email&&(console.log("access changed, updating logs"),s())}),s(),o.addListener("plusUnlocked",s),o.addListener("plusCancelled",s),o.addListener("updateStatsSaveAsTempLocks",s),i.on("click",".show-stats",function(){var e={heading:"Please Upgrade Your Account",message:"Folio stats are available on the Business plan. Please upgrade to access stats and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){t.payment("showPlans")}};if(!$(this).hasClass("locked")){var a=$(this).closest(".folio-item-shell");return t.folioStats(a.data("token"),a.find(".edit h4").text()),!1}n.hasTeam()?(console.log("is team"),(n.isProTeamMember()||n.isFreeWithTeam())&&n.isOwner()?t.message(e):(console.log("in guest"),t.teamUserActionBlocked("stats","Guests"))):(e.handleOK=function(){t.payment("showPlans")},t.message(e))}),s()},app.dash.globalAlert=function(e,a){var t=$("#tmp-global-alert"),n=t.find(".global-alert-container"),o=t.find("#gdpr");$p=n.find("p.content"),$close=n.find(".closebtn"),$p.html(o.html()),$("body").addClass("global-alert").prepend(n),$close.on("click",function(){a.setGdprConsent({success:function(){console.log("consent closed")}});var e=n.outerHeight();n.animate({opacity:.25,left:"-1200",height:"0px"},2e3,function(){n.remove()}),$("#top-bar, #home-page, #edit-page, #dashboard-page").animate({"margin-top":"-="+e+"px"},2e3,function(){$("#n-panel").css("top","50px"),$("body").removeClass("global-alert")})})},app.dash.inlineRename=function(r,l){$(" #folio-items-container, #templates-items-container").on("click",".inline-action-edit",function(){var e=$(this),a=$(this).next(".inline-action-save"),t=a.find(".inline-title"),n=e.prev(".edit").find("h4");a.removeClass("hidden"),e.addClass("inactive"),t.removeClass("error").focus().blur(function(){e.removeClass("inactive")}).on("keydown",function(e){13==(e.which||e.keyCode)?a.find(".save-icon").trigger("mousedown"):27==(e.which||e.keyCode)&&t.blur()}).data("lastVal",n.text()),n.text(t.data("lastVal")),t.val(n.text())}),$("#folio-items-container, #templates-items-container").on("mousedown",".save-icon",function(){var e=$(this),a=e.parent(".inline-action-save"),t=a.closest(".folio-item").find("h4"),n=a.find(".inline-title"),o=n.val(),i=a.find(".inline-save-error"),s=e.closest(".folio-item-shell").data("folio");if(o.length<3)return n.addClass("error"),i.removeClass("hidden"),void n.focus();o!=n.data("lastVal")?(t.text(o),a.addClass("fadeout"),n.off("keypress"),i.addClass("hidden"),$(".inline-action-edit").removeClass("inactive"),r.renameFolio({token:s.Token,name:o,success:function(){s.FolioName=o,s.LastSavedUtc=Date.now(),n.val(o).data("lastVal",o),a.removeClass("fadeout").addClass("hidden")},error:function(e){t.text(n.data("lastVal")),n.val(n.data("lastVal")),l.error(e.Message)}})):a.addClass("hidden")})},app.dash.labels=function(l,d,c,u,o,m){var i,s,r,p=$("#all-labels-container"),f=$("#single-label").html(),h=$(".labels-dropdown"),g=$("#app-load-animation");function v(s,e){var a=$(f).data("label",s),t=s.color||l.colors[e%l.colors.length];(a.find(".label").css("background-color",t),a.find(".name").text(s.Name||"Untitled"),l.selectedChannel)&&(l.selectedChannel.toString().replace("chan-","")===s.Token&&a.addClass("active"));a.find(".share").click(function(){if(l.Team&&0<l.Team.Id){var e=s.Token,i=_.findIndex(l.labels,["Token",e]);console.log("currentTOken",e),console.log("currentLabelID",i),-1!==i?d.getLabelOwner({data:{token:e},success:function(e){var a=JSON.parse(e.Data),t=l.userEmail===a.Email,n=m.isPremiumGuest()||m.isSingleFolioGuest(),o=!l.labels[i].Private;t||!n&&o?u.shareLink(s,null,null,t):u.message({heading:"You Cannot Perform this Action",message:"Only channel owners can adjust the channel's link sharing settings. Reach out to the channel owner to perform this action. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})},error:function(e){console.log("getLabelOwner error",e),u.message({heading:"Oops!",message:"Could not process request. Please try again later. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})}}):c.devHighlightConsole("Token not found on config.labels",e)}else u.shareLink(s)});var n=!0,o=!0,i=!0;a.find(".leave-btn").hide(),s.IsDefault?o=!1:l.Team&&0<l.Team.Id?s.CanDelete&&4!==l.Team.Role&&5!==l.Team.Role?o=n=i=!1:2!==s.AccessType&&a.find(".leave-btn").show():i=o=n=!1,c.toggleElementViz(i,a.find(".default-btn")),c.toggleElementViz(n,a.find(".delete-btn")),c.toggleElementViz(o,a.find(".rename-btn")),a.find(".default-btn, .delete-btn, .leave-btn, .rename-btn").data("label",s),a.attr("data-name",s.Token),p.append(a);var r=$("<option></option>");r.text(s.Name||"Untitled").val(s.Token),h.append(r)}function b(){var t,n;p.html(""),n=[],$.each(l.labels,function(e,a){a.IsDefault?t=a:n.push(a)}),t&&n.sort(function(e,a){return e.Name>a.Name}).unshift(t),l.labels=n,console.log("channels sorted");for(var e=0;e<l.labels.length;e++)v(l.labels[e],e)}function e(e,a){var t=p.find(".item").length;l.labels.push({Name:e,Token:a.Message,FolioTokens:[],Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:l.colors[t%l.colors.length]});var n=l.labels.length-1;v(l.labels[n],n),o.raiseEvent("reInitChannelMixers")}function a(e){var n;i=e.goToNewChannelCb,s=e.channelToken,r=e.openLabelsPopup,n=function(){o.raiseEvent("updateFolioData",{data:e,cb:function(){o.raiseEvent("refreshLabelData"),o.raiseEvent("refreshMemberData"),function(a){if(l.selectedChannel){var e=l.selectedChannel.toString().replace("chan-","");if(console.log("setChannelToAllFilter",e,a),e===a){g.show();var t=l.labels.filter(function(e){return e.Token===a});console.log("channel",t),0===t.length?setTimeout(function(){$("#all-folios-button").removeClass("active"),$("#all-folios-button").click(),g.hide()},1500):setTimeout(function(){p.find("[data-name='".concat(a,"']")).trigger("click"),g.hide()},1500)}}}(e.Token)}})},g.show(),d.getLabelData({success:function(e){try{console.log("getLabelData response",e);var a=JSON.parse(e.Data),t=""===a?[]:JSON.parse(a);t.forEach(function(e,a){return e.color=l.colors[a%l.colors.length]}),console.log("labels",t),l.prevLabels=_toConsumableArray(l.labels),l.labels=t,b(),n&&"function"==typeof n&&n(),i&&"function"==typeof i&&(i(s),s=i=!1),!0===r&&(u.labels(null,null,null,!0,s),o.raiseEvent("refreshLabelData"),r=!1)}catch(e){console.log("try catch getLabelData err",e)}},error:function(e){console.log("getLabelData err",e)},complete:function(){return g.hide()}})}$("#add-label").on("click",function(){if(l.Team&&0<l.Team.Id){if(5===l.Team.Role||4===l.Team.Role)return void u.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to create new channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0});u.teamChannelPopup()}else u.personalChannelPopup(e);return!1}),o.addListener("addlabel",function(e){v(l.labels[e],e),o.raiseEvent("reInitChannelMixers")}),l&&l.isDashboard&&(o.addListener("channelAdd",function(e){return a(e)}),o.addListener("userJoinedChannel",function(e){return a(e)}),o.addListener("channelChangedTeamVisible",function(e){return a(e)}),o.addListener("channelDelete",function(e){return a(e)}),o.addListener("userLeftChannel",function(e){return a(e)}),o.addListener("channelChangedPrivate",function(e){return a(e)}),o.addListener("userJoinedChannelOwner",function(e){return a(e)}),o.addListener("userLeftChannelOwner",function(e){return a(e)}),o.addListener("folioAddedToChannel",function(e){return a(e)}),o.addListener("folioRemovedFromChannel",function(e){return a(e)})),b()},app.dash.listRequests=function(n,e,o){var i=null,s=$("#tmp-dashboard-content").find("#folio-items-container"),r=$("#tmp-tranfer-item").html();function a(e){if(1<n.UserTeams.filter(function(e){return e.Role<4}).length&&-1==window.location.hash.search(/accepttransfer/))o.transferFolioToSpace({sameUser:!1,skipPersonal:!0,outsideRequest:!0,Data:{Token:e.Token,TeamID:n.Team.Id,Owner:n.userEmail}});else{var a=s.find("div").data();if((!a||a.code!=(e.Secret||e.Code))&&((i=$(r)).data("code",e.Secret||e.Code),i.data("item",e),i.find("h4").text(e.FolioName||e.Folio||"Untitled"),i.find(".description").text((e.UserName||e.Name)+" wants to transfer this folio to you."),s.prepend(i),-1<window.location.hash.search(/accepttransfer/))){var t=window.location.hash.split(/\//);2==t.length?e.Token==t[1]&&i.find(".request-btn.yes").eq(0).click():$("#folio-items-container .transfer-item .request-btn.yes").eq(0).click()}}}function l(e){(i=$(r)).addClass("collabRequest").data("Id",e.Data.Id).attr("data-token",e.Data.Token),i.find("h4").text(e.Data.Folio||"Untitled"),i.find(".description").text(e.Data.Name+" has invited you to "+(1<e.Privilege?"edit":"view")+" this folio."),s.prepend(i),$(".nav-main-menu a:eq(0)").click(),"#acceptcollab"==window.location.hash&&$("#folio-items-container .collabRequest .request-btn.yes").eq(0).click()}e.addListener("transferRequestArrived",a),e.addListener("collabRequestArrived",l),e.addListener("processPendingTransfers",function(){0<n.UserTeams.length&&(n.tansFolios&&0<n.tansFolios.length&&n.tansFolios.forEach(function(e){return a(e)}),n.foliosPending&&0<n.foliosPending.length&&n.foliosPending.forEach(function(e){var a=e.FolioName,t=e.Token,n=e.Role;l({Data:{Token:t,Id:e.AwaitingCollabID,Name:a,Privilege:n}})}))})},app.dash.main=function(e,a,t,n,o,i){for(var s=this,r=e.labels,l=e.colors,d=app.plugin.lockedTip(e,a),c=0;c<r.length;c++)r[c].isLabel=!0,r[c].color=l[c%l.length];e.currentlyEditing={},s.tabs(e),s.listRequests(e,a,o),s.folios(e,a,n,o,t,i),s.labels(e,t,n,o,a,i),s.createNewMenu(o,i),s.filter(e,n,o,t,i,!0,a),s.filterBar(app.plugin.popupMenu,a,o,i,t,n,e),s.subOptionsMenu(),s.subOptionLabelMenu(e,n,o,t,i),s.templateLabels(e,n,a,o),s.templates(e,n,o,t,i,a,d),s.examples(e,n,o,t,i,a,d),s.exampleLabels(e,n,a,o),s.delFolio(t,o),s.archiveFolio(e,t,o),s.saveAsTemplate(e,t,o,i),s.unarchiveFolio(t,o,e,i,a),s.createFolio(e,s,t,o,i,a),s.copyFolio(s,t,o,a,e,i,d),s.rename(s,t,o),s.inlineRename(t,o),s.processRequests(t,o,a,e,i),s.transferFolio(e,o),s.renameLabel(s,e,n,t,a,o),s.delLabel(e,n,t,a,o),s.defaultLabel(e,n,t,a,o),s.folioStats(e,o,i,d,a),app.plugin.tooltip()},app.dash.processRequests=function(i,s,e,r,a){function n(e,a){var t,n=a.data("item");t=r.UserTeams&&0<r.UserTeams.length&&0<n.TeamID?{verb:e,secret:a.data("code"),teamId:r.Team.Id}:{verb:e,secret:a.data("code")},i.processTransfer({data:t,success:function(){"accept"===e?(console.log("in processTransfer",n),n.isUseTemplate=!1,r.saveFolioTransferItem=n,s.saveFolio()):window.location="/"},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}})}$("#folio-items-container").on("click",".request-btn",function(e){console.log("on processRequests"),e.preventDefault(),s.busy();var a=$(this),t=a.hasClass("yes")?"accept":"reject",o=a.closest(".folio-item-shell");"reject"===t?o.hasClass("collabRequest")?i.processCollaborator({data:{verb:t,id:o.data().Id},success:function(){o.remove(),s.close(),window.location="/"},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}}):n(t,o):o.hasClass("collabRequest")?i.processCollaborator({data:{verb:t,id:o.data().Id},success:function(){if("accept"==t){console.log("collab func on dash");var n=o.data().token;$("#folio-items-container").find(".empty-shared, .empty").remove(),i.getFolioByToken({token:n,success:function(e){var t=JSON.parse(e.Data);i.getFolioCollaborators({token:n,success:function(a){console.log("response",a),i.getWorkspaceChannels({teamId:r.Team.Id,success:function(e){console.log("response channels",e),r.saveFolioCollabItem={FolioName:t.FolioName,Token:n,TeamID:t.TeamID,collaborators:JSON.parse(a.Data),labels:JSON.parse(e.Data)},console.log("saveFolioCollabItem",r.saveFolioCollabItem),s.saveFolio()},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})},error:function(e){console.log("error",e)}})}},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}}):n(t,o)})},app.dash.rename=function(t,n,o,e){$(".edit-link").each(function(){var e=$(this),a=e.text();e.data("name",a),t.setName(e,a)}),$(" #folio-items-container").on("click",".rename-folio-btn",function(){var e=$(this),a=e.data("token"),t=e.closest(".folio-item-shell").find("h4");return o.message({heading:"Rename Folio",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",emptyError:"Please provide a name for the folio",cancelText:"Cancel",input:t.text(),namespace:"rename-folio-popup",inputPlaceholder:"Enter name",handleOK:function(e){n.renameFolio({token:a,name:e,success:function(){t.text(e),o.close()},error:function(e){o.error(e.Message)}})}}),!1})},app.dash.renameLabel=function(e,a,t,n,o,i){var s=function(e,a,t){i.message({heading:"Rename Channel",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",cancelText:"Cancel",emptyError:"Please provide a name for the channel",namespace:"rename-label-popup",inputPlaceholder:"Enter name",input:e,handleOK:function(e){n.renameLabel({token:a.Token,name:e,success:function(){a.Name=e,o.raiseEvent("labelChange"),t(e),i.close()},error:function(e){i.error(e.Message)}})}})};$("#all-labels-container").on("click",".rename-btn",function(){var a=$(this),e=a.data("label"),t=a.closest(".item").find(".name");return s(t.text(),e,function(e){t.text(e),a.closest(".item").hasClass("active")&&$(".label-name").text(e)}),!1}),$(".label-details").on("click",".rename",function(){var e=$(this).closest(".label-details"),a=e.data("label"),t=e.find(".label-name");return s(a.Name,a,function(e){t.text(e),$("#all-labels-container").find(".item[data-name="+a.Token+"] .name").text(e),$(".labels-dropdown").find("option[value="+a.Token+"]").text(e)}),!1})},app.dash.saveAsTemplate=function(e,a,n,o){$("#folio-items-container").on("click",".save-template-btn",function(){if(!$(this).hasClass("locked")){var e=$(this).closest(".folio-item-shell"),a=e.data("token"),t=e.find("h4").text()+" - Template";return n.createTemplatePopup(t,a),!1}o.isOwner()?n.payment("showPlans"):n.teamUserActionBlocked("save-as-template","Guests")})},app.dash.subOptionLabelMenu=function(r,l,d,a,c){$("#sidebar").on("click",".menu",function(e){e.preventDefault();var a=$(this);a.toggleClass("active"),a.hasClass("active")&&setTimeout(function(){$("body").on("click.labelMenuRemover",function(){a.removeClass("active"),$("body").off(".labelMenuRemover")})},100)}),$(".left-section").on("click",".share",function(){if(r.Team&&0<r.Team.Id){var e=$(this).closest(".label-details").data("label").Token,i=_.findIndex(r.labels,["Token",e]),s=$(this);console.log("currentTOken",e),console.log("currentLabelID",i),-1!==i?a.getLabelOwner({data:{token:e},success:function(e){var a=JSON.parse(e.Data),t=r.userEmail===a.Email,n=c.isPremiumGuest()||c.isSingleFolioGuest(),o=!r.labels[i].Private;t||!n&&o?d.shareLink(l.obtain(r.labels,"Token",s.closest(".label-details").data("label").Token),null,null,t):d.message({heading:"You Cannot Perform this Action",message:"Only channel owners can adjust the channel's link sharing settings. Reach out to the channel owner to perform this action. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})},error:function(e){console.log("getLabelOwner error",e),d.message({heading:"Oops!",message:"Could not process request. Please try again later. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})}}):l.devHighlightConsole("Token not found on config.labels",e)}else d.shareLink(l.obtain(r.labels,"Token",$(this).closest(".label-details").data("label").Token))})},app.dash.subOptionsMenu=function(){$("#folio-items-container , #templates-items-container").on("click",".menu",function(e){e.preventDefault(),$(".more-options .menu").not(this).removeClass("active");var a=$(this);a.toggleClass("active"),a.next(".settings-btns").children().on("click",function(){a.removeClass("active")}),$("body").off(".menuRemover"),a.hasClass("active")&&setTimeout(function(){$("body").on("click.menuRemover",function(){a.removeClass("active"),$("body").off(".menuRemover")})},100)})},app.dash.tabs=function(e){$(".tab-content"),$(".nav-main-menu a").not("a.help-center"),$("#top-bar .template-subnav"),$("#dashboard-page");$("body").addClass("colored-dashboard")},app.dash.templateLabels=function(o,t,e,a){var n,i=$(".folios-container.templates"),s=$("#tmp-temp-sidebar"),r=$("#single-label").html(),l=$("#tmp-labels-container"),d=$("#tmp-my-labels-container"),c=$("#top-bar .template-subnav"),u=t.getColors();t.sort(o.templatesLabels,"Name"),0===$("#dashboard-page").find("#temploader").length&&($("#dashboard-page").append($('<div id="temploader" class="template-loader"><div class="loading-animation"></div></div>')),n=$("#dashboard-page").find("#temploader"));var m,p,f,h=i.find(".label-details.temp"),g=i.find(".tmp-labels-dropdown");function v(e){e?($("#templates-items-container").css("visibility","hidden"),n.find(".loading-animation").html(a.spinner),n.show()):($("#templates-items-container").css("visibility","visible"),n.hide())}function b(e){p=$("#templates-items-container .as-template"),m.filter(p.filter("."+e))}$("#tmplt-sidebar").append(s),e.addListener("reInitMixerTemplates",function(){v(!0),function(){if(o.templatesLabels){l.html("");for(var e=0;e<o.templatesLabels.length;e++){var a=o.templatesLabels[e],t=$(r).data("label",a);a.color=u[e%u.length],t.find(".label").css("background-color",a.color),t.find(".name").text(a.Name||"Untitled"),t.find(".options").remove(),t.on("click",T).data("label",a),l.append(t);var n=$("<option></option>");n.text(a.Name||"Untitled").val(a.Token),g.append(n)}}}(),function(){o.templateTab||(o.templateTab=".xtensio-temp"),m&&m.destroy();var e=c.find(".tmp-sort .item.active").data("value");e=void 0===e?"used:desc":e,m=mixitup(i,{animation:{duration:400},selectors:{target:".folio-item"},load:{filter:o.templateTab,sort:e},callbacks:{onMixFail:function(e){v(!1),console.log("No items could be found matching the requested filter")}},debug:{enable:!0},controls:{enable:!1}}),clearTimeout(f),f=setTimeout(function(){m.forceRefresh()},1e3)}(),o.templateTab||(o.templateTab=".xtensio-temp"),c.find(o.templateTab).click(),v(!1)});function T(){var e=$(this),a=e.data("label");if(s.find(".item").removeClass("active"),e.addClass("active"),$("#templates-items-container .state").hide(),h.find(".label-name").css({paddingLeft:"10px"}),h.find(".label-name").css({display:"inline-block"}),a&&"own"==a.Token&&(h.find(".label-color").hide(),$("#templates-items-container").find(".own").removeClass("hidden")),!a)return m.filter(".xtensio"),h.addClass("normal").find(".label-name").text("Xtensio Templates"),void $("#templates-items-container .state").hide();h.removeClass("normal"),h.find(".label-name").text(a.Name),h.find(".label-color").css("background-color",a.color),b(a.Token)}function y(){var e=$(this).attr("id"),a="",t="";switch(console.log("-- id --",e),$("#templates-items-container .empty-state-team-temp").hide(),$("#templates-items-container .empty-state-my-temp").hide(),$("#templates-items-container .cont-template-request").hide(),$("#tmp-dashboard-content .x-select.tmp-labels-dropdown").hide(),h.find(".label-name").hide(),e){case"all-temps-button":a=".xtensio",t="Xtensio Templates",$("#tmp-labels-container").show(),$("#tmp-labels-container .item").removeClass("active"),$("#templates-items-container .cont-template-request").show(),$("#tmp-dashboard-content .x-select.tmp-labels-dropdown").show(),h.find(".label-name").show(),o.templateTab=".xtensio-temp";break;case"my-temps-button":a=".my-temp",t="My Templates",$("#tmp-labels-container").hide(),o.templateTab=a,$("#templates-items-container").find(".my-temp").length<1&&$("#templates-items-container .empty-state-my-temp").show();break;case"team-temps-button":a=".team-temp",t="Team Templates",$("#tmp-labels-container").hide(),o.templateTab=a,$("#templates-items-container").find(".team-temp").length<1&&$("#templates-items-container .empty-state-team-temp").show()}m&&m.filter(a),h.addClass("normal").find(".label-name").text(t)}!function(e){var a=$(r).data("label",e);a.find(".name").text(e.Name||"Untitled"),a.find(".options").remove(),a.on("click",T).data("label",e),d.append(a),"xtensio"==e.Token&&a.find(".new").remove();var t=$("<option></option>");t.text(e.Name||"Untitled").val(e.Token),g.append(t)}(o.myLabel),$("#all-temps-button").on("click",y),$("#my-temps-button").on("click",y),$("#team-temps-button").on("click",y),g.on("change",function(){var e=$(this).val(),a=t.obtain(o.templatesLabels,"Token",e);if(null===a)return m.filter("all"),void h.addClass("normal");b(a.Token),h.removeClass("normal")}),c.find(".tmp-sort").change(function(){m.sort($(this).data("value"))})},app.dash.templates=function(p,s,r,n,f,t,e){var o=$(".nav-main-menu a").not("a.help-center, a.examples-link"),i=$("#app-load-animation"),l=!1,a=$("#dashboard-page"),d=$(".tab-content"),c=s.getColors(),u=$("#top-bar .template-subnav"),m=$("#top-bar .example-subnav"),h=($("#tmp-dashboard-content"),$("#templates-items-container")),g=$("#template-item").html(),v=($("#my-template-item").html(),app.core.padlocks(f,e,p)),b=null,T=null;function y(i,e){$.each(e.Labels,function(e,a){var t=s.obtain(p.templatesLabels,"Token",a),n=t.color=c[e%c.length];if(t){var o=$('<div class="label"></div>').css("background-color",n).text(t.Name);o.data("token",t.Token),i.addClass(t.Token),i.find(".labels").prepend(o)}})}function C(e){return function(){return r.shareLink(e),!1}}function w(t,e){if(!p.IsDelinquent||1!==Faltu(p.folios).find({Status:0}).count())return function(){if(!f.isSingleFolioGuest()&&!f.isPremiumGuest()){$(this);var e=t.Token,a="Untitled ( "+t.FolioName+" )";return p.userName?f.checkFoliosLimitReached(n,r,function(){p.saveFolioTransferItem={FolioName:a,Token:e,template:t.FolioName,isUseTemplate:!0},r.saveFolio()}):r.signUp(!0),!1}r.teamUserActionBlocked("create","Premium Guests")};r.plusPrompt("create",null,!0)}function k(e,a){return function(){return e?r.folioStats(a.Token,a.FolioName,{isTemplate:!0,UsedCount:a.UsedCount}):f.isOwner()?r.message({heading:"Please Upgrade Your Account",message:"Template stats are available on the Business plan. Please upgrade to access stats and other premium features.",btnText:"See Plans",cancelText:"Nevermind",enterAsOK:!0,notMini:!0,bodyCentered:!0,handleOK:function(){r.payment("showPlans")}}):r.teamUserActionBlocked("template-stats","Guests"),!1}}function x(e){return function(){return window.location=p.baseUrl+"/edit/"+e.Token,!1}}function P(o,i){return function(){return console.log("current",i),console.log("folio",o),$("#dashboard-page > .loader").show(),n.switchTemplateTypes({token:o.Token,op:"switch",success:function(e){console.log("switchTemplateTypes response",e);var a="team-temp"===i?" is now your private template in ":" is available to all team members in ",t="team-temp"===i?"my-temp":"team-temp",n="team-temp"===i?"My Template":"Team Template";r.message({heading:'Template Moved <i class="icon-CheckMark"></i>',message:"<b>"+o.FolioName+"</b>"+a+'<a href="#" class="popup-template-link" data-type="'+t+'">'+n+"s</a>",bodyCentered:!0,btnText:"Done",enterAsOK:!0,notMini:!0})},error:function(e){S(e)},complete:function(){$("#dashboard-page > .loader").hide()}}),!1}}function S(e){$("#dashboard-page > .loader").hide(),r.message({heading:"Oops!",message:e.Message,btnText:"Ok",enterAsOK:!0})}function D(e,a){return function(){return r.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,bodyCentered:!0,handleOK:function(){n.deleteUserTemplate({token:e.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),"my-temp"===a&&t.raiseEvent("teamTemplateUpdate")},error:function(e){S(e)}})},cancelText:"Cancel",handleNo:function(){r.close()}}),!1}}function F(o,e){$.each(e.Labels,function(e,a){var t=p.myLabel;if(t){var n=$('<div class="label"></div>').css("background-color",t.color).text(t.Name);n.data("token",t.Token),o.addClass(t.Token),o.find(".labels").prepend(n)}})}function I(e,a,t){for(var n=function(e,a,t){var n,o={};if(e&&a){var i=h.find(".folio-item."+e);i.length>t.length&&i.each(function(e,a){n=$(a).data("token"),o[n]=n})}return o}(a,t,e),o=0;o<e.length;o++){var i=h.find(".folio-item[data-token="+e[o].Token+"]");if(a){if(delete n[e[o].Token],t&&1==i.length&&i.data("type")==a&&i.hasClass(a))continue;i.remove()}i=e[o];var s=a?"false":"blank slate"==i.PublicName.toLowerCase();(b=$(g)).attr("data-template",i.TemplateName).attr("data-name",i.PublicName||i.FolioName).attr("data-used",i.UsedCount).attr("data-type",a).attr("data-date",i.CreatedDate),a?F(b,i):y(b,i),i.Thumbnail&&b.find(".img").removeClass("hidden").find("img").attr("src",i.Thumbnail),i.UsedCount&&!s&&b.find(".used").text("Used "+i.UsedCount+" times"),T=p.baseUrl+"/folio/"+i.FolioToken;var r=b.find("h4");if(r.text(i.PublicName||i.FolioName),setTimeout(function(){r.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),b.find(".preview, .link").attr("href",T),i.IsNew&&b.find(".new-label").removeClass("hidden"),s&&!a&&(b.find(".primary").addClass("red").text("Create New"),b.attr("data-used","9999999999").find(".preview").addClass("hidden")),b.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),a){var l=Faltu(i.Collaborators||[]).find({Email:p.userName}).get();l[0]&&(l[0].Privilege=3);var d=i.Private?"Off":"On";b.find(".link-share-cont span").text(d),b.find(".create-cont span.created-by").text(i.UserFullName),b.find(".create-cont span.created-at").text(dayjs(i.LastSavedUtc).fromNow()),setInterval(function(){b.find(".create-cont span.created-at").text(dayjs(i.LastSavedUtc).fromNow())},36e5);var c="team-temp"===a?"Move to My Templates":"Move to Team Templates";b.find(".move-template .settings-btn-text").text(c),i.Collaborators=l,b.attr("data-token",i.Token),b.attr("data-date",i.LastSavedUtc),b.data("folio",i),b.find(".used").hide(),b.find(".labels").hide(),b.find(".link").attr("href",p.baseUrl+"/edit/"+i.Token),b.addClass("own"),b.addClass(a),b.find(".cta-buttons").remove(),b.find(".use-template").click(w(i)),b.find(".share-btn").click(C(i)),"my-temp"===a&&b.find(".owner-info").hide();var u=!0;(0===p.Team.Id&&f.isFree()||f.isFreeWithTeam())&&(u=!1),0===p.Team.Id||"ProMonthly"!==p.Team.Plan&&"ProYearly"!==p.Team.Plan||(u=!1),!p.Team||4!==p.Team.Role&&5!==p.Team.Role||(u=!1),b.find(".show-stats").click(k(u,i)),"my-temp"===a||i.UserEmail===p.userEmail?b.find(".move-template").click(P(i,a)):b.find(".move-template").remove(),"my-temp"===a||i.UserEmail===p.userEmail||1===p.Team.Role||2===p.Team.Role?(b.find(".edit-template").click(x(i)),b.find(".delete-folio").click(D(i,a))):(b.find(".edit-template").remove(),b.find(".delete-folio").remove())}else{b.find(".create-cont").hide(),b.find(".link-share-cont").hide(),b.find(".options").remove(),b.addClass("xtensio");var m=p.baseUrl+"/"+i.FolioUrlSlug;i.FolioUrlSlug===i.FolioToken&&(m=p.baseUrl+"/folio/"+i.FolioToken),b.find(".preview, .link").attr("href",m)}s&&(b.find(".link").attr("href","#"),b.find(".link ").removeAttr("target")),b.hide(),a?h.prepend(b):h.append(b)}"object"===_typeof(n)&&0<Object.keys(n).length&&$.each(n,function(e,a){h.find(".folio-item[data-token="+a+"]").remove()}),0===h.find(".btn-request-template").length&&(h.append("<div class='cont-template-request' style='display:none;'>Can't find what you're looking for? <a class='btn-request-template' href='#'>Request a New Template</a></div>"),h.find(".btn-request-template").click(function(e){e.preventDefault(),window.Intercom&&window.Intercom("showNewMessage","Hi Xtensio team, \nCan you please add this template? \n\n(Please add the template's name as well as links and examples to help us understand your need better)")}))}function M(){setTimeout(function(){v.setTemplateStatsLock()},1500)}function E(s){void 0!==p&&p.isDashboard&&n.getTemplateData({success:function(e){console.log("getTemplateData response",e);try{var a=JSON.parse(e.Data),t=JSON.parse(a.XtensioTemplates),n=""===a.UserTemplates?[]:JSON.parse(a.UserTemplates),o=""===a.TeamTemplates?[]:JSON.parse(a.TeamTemplates),i=JSON.parse(a.TemplateLabels);console.log("--- template data ---",a),p.userTemplates=n,p.teamTemplates=o,p.templatesLabels=i,h.html(""),I(t,!1),setTimeout(function(){0<o.length?I(o,"team-temp",!0):$(".folio-item.team-temp").remove(),0<n.length?I(n,"my-temp",!0):$(".folio-item.my-temp").remove();var e=U("empty-state-my-temp"),a=U("empty-state-team-temp");e.hide(),a.hide(),h.prepend(e),h.prepend(a),"function"==typeof s&&s()},200)}catch(e){console.trace("getTemplateData error",e)}},error:function(e){console.log("getTemplateData error",e)},complete:function(){M()}})}function U(e){var a=$("#tmp-empty-state").html(),t=$(a),n="You haven't saved any templates yet.",o="empty-user-temp.png";return"empty-state-team-temp"===e&&(n="You don't have any Team Templates yet.",textEmpTeam="Save folios as team template for team members to use and repurpose.<br> Keep them private or share with the world.",o="empty-team-temp.png"),t.addClass(e),t.find("p.imp-folio").remove(),t.find("h2").text(n),t.find("button").remove(),t.find("p.tag").html('Save folios as templates to reuse and repurpose. <br>Keep them private or share with the world.<br><br><img src="/img/'+o+'" style="height: 170px" />'),t}function N(e){p.userTemplates&&0<p.userTemplates.length?u.find(".my-temp").click():p.teamTemplates&&0<p.teamTemplates.length?u.find(".team-temp").click():u.find(".xtensio-temp").click(),e.hasClass("template")&&e.hasClass("active")?(u.show(),m.hide(),a.addClass("template-sub-active")):(e.hasClass("examples-link")&&e.hasClass("active")?(u.hide(),m.show()):(u.hide(),m.hide()),a.removeClass("template-sub-active"))}p.templateTab=".xtensio-temp",t.addListener("initToolTips",function(){M()}),o.on("click",function(e){console.log("in initors"),$that=$(this),o.removeClass("active"),$(".nav-main-menu a.examples-link").removeClass("active");var a=$that.addClass("active").index();d.addClass("hidden").filter(":eq("+a+")").removeClass("hidden"),$("body").toggleClass("colored-dashboard",!$that.hasClass("template")),l?N($that):(l=!0,h.css({opacity:0}),i.show(),E(function(){t.raiseEvent("reInitMixerTemplates"),setTimeout(function(){N($that),h.css({opacity:1}),i.hide()},2e3)}))}),t.addListener("clearTemplateSubmenu",function(e){N(e)}),$(".use-template").on("click",function(){o.filter(":eq(1)").trigger("click")}),$(".plus-menu .create-new").on("click",function(){l?$('div[data-template="blank"]').find(".cta-btn.primary").trigger("click"):(i.show(),E(function(){$('div[data-template="blank"]').find(".cta-btn.primary").trigger("click"),setTimeout(function(){i.hide()},3e3)}))}),t.addListener("teamTemplateUpdate",function(){E(function(){t.raiseEvent("reInitMixerTemplates")})})},app.dash.transferFolio=function(a,t){$(" #folio-items-container").on("click",".transfer-folio-btn",function(e){return a.Team&&0<a.Team.Id?t.transferTeamFolio($(this).data("token")):t.transferFolio($(this).data("token")),!1})},app.dash.unarchiveFolio=function(o,i,s,r,l){$(".folios-container").on("click",".unarchive",function(){var e=$("#folio-items-container").find(".folio-item-shell.active").length,a=$(this).closest(".folio-item-shell"),t=a.data("folio");if(!((!r.hasTeam()||s.IsDelinquent)&&1<=e||r.isFreeWithTeam()||r.isProTeamMember()))return n(),!1;function n(){i.unarchive(t,function(){i.close(),t.Collaborators=Faltu(t.Collaborators).find({Email:s.userName}).get(),a.removeClass("archived").addClass("active").find(".edit").each(function(){$(this).attr("href",$(this).attr("href").replace("folio","edit"))}).eq(1).text("Edit Folio");var e=$("#folio-items-container");e.find(".state.empty").hide(),0<$("#folio-items-container").find(".collabRequest").length?e.find(".collabRequest").after(a):e.prepend(a),l.raiseEvent("updateStatsSaveAsTempLocks",{}),window.location.hash="active"})}r.checkFoliosLimitReached(o,i,function(){n()})})},app.dash.wizardDash=function(e,a,t,n){$("#top-bar .user-menu-popup").find(".dash-wizard");var o='NEXT <i class="fa fa-angle-right"></i>',i=function(e){return'<text style="color: #00bd9c"><b>'+e+"</b></text><br>"},s=function(e){return'<p style="color: #ffd371">'+e+" / 5</p>"};s(1),i("Start a New Project:"),s(2),i("Adjust Settings:"),s(3),i("Check Notifications:"),s(4),i("Get Organized with Channels:"),s(5),i("You are all set!");"string"==typeof e.ShowOnboarding&&(e.ShowOnboarding="not-set"===e.ShowOnboarding||JSON.parse(e.ShowOnboarding.toLowerCase()))};var logger=function(){try{var e=null,a={enableLogger:function(){null!=e&&(window.console.log=e)},disableLogger:function(){e=console.log,window.console.log=function(){}}}}catch(e){}return a}(),consologs=function(a){var t=[];return function(e){t.push(e),("localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||a.isAdmin)&&console.log(e)}},isConsoleAllow=function(a){return function(e){return"localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||a.isAdmin}};app.plugin.folioView=function(a){var t,n="";if(console.log("exec folioView scripts"),a.StyleGuides&&(""===a.userEmail?t=a.StyleGuides[0]:a.StyleGuides.forEach(function(e){e.TeamId===a.Team.Id&&(t=e)})),console.log("styleGuide",t),t){var e,o=t.DefaultFontFamily;if((e=t.TeamFonts.map(function(e){return{id:e.SourceIdentifier,data:e.FontJson,title:e.Name,default:o===e.SourceIdentifier,owner:e.SourceString,family:e.FontJson.FontLocalName?e.FontJson.Name:e.FontJson.IdString}})).length&&setTimeout(function(){e.forEach(function(e){var a;null!==(a=e.data).FontLocalName&&(n+='@font-face {\n                font-family: "'.concat(a.FontLocalName,'";\n                font-weight: "').concat(a.FontWeight,'";\n                font-style: "').concat(a.FontStyle,'";\n                src: local("').concat(a.FontLocalName,'"), url("').concat(a.FontUrl,"\")  format('woff2');\n                unicode-range: \"").concat(a.UnicodeRange,'";\n            }'))}),$("head").append("<style>".concat(n,"</sttyle>"))},1e3),t.TeamFonts.forEach(function(e){var a;e.SourceIdentifier===o&&(a=e.FontJson.Name,$("#modules-preview-main").css("font-family",'"'.concat(a,'", ').concat("Proxima-Light, Helvetica, sans-serif")))}),0<t.TeamColors.length){var i="";if(t.TeamColors.forEach(function(e,a){e.IsDefault&&(i=e.HexCode)}),""!==i&&(console.log("implementing default color: ",i),!a.isDashboard)){var s="#modules-edit-main, #modules-edit-main h1, ";s+="#modules-edit-main h2, ",s+="#modules-edit-main h3, ",s+="#modules-edit-main h4, ",s+="#modules-edit-main p, ",s+="#modules-preview-main, #modules-preview-main h1, ",s+="#modules-preview-main h2, ",s+="#modules-preview-main h3, ",s+="#modules-preview-main h4, ",s+="#modules-preview-main p, ",s+="#modules-preview-main .title > *:not(.fr-wrapper):first-child, ",s+="#modules-edit-main .title > *:not(.fr-wrapper):first-child, ",s+="#modules-preview-main .title .fr-view > *:first-child, ",s+="#modules-edit-main .title .fr-view > *:first-child { ",s+="color: "+i+"; ",s+="} ",s+="#modules-edit-main .module, #modules-preview-main .module { ",s+="border-color: "+i+"; ",s+="color: "+i+"; ",s+="} ",s+="#modules-preview-main .text-module .name, ",s+="#modules-preview-main .text-module .fr-view > ul, ",s+="#modules-preview-main .text-module .fr-view > ol, ",s+="#modules-edit-main .text-module .name, ",s+="#modules-edit-main .text-module .fr-view > ul, ",s+="#modules-edit-main .text-module .fr-view > ol {",s+="color: "+i+"; ";var r="<style id='defaultColor' type='text/css'> "+(s+="} ")+" </style>";setTimeout(function(){$("head style:eq(0)").before(r)},100),a.teamDefaultColorStyles=r}}}},app.plugin.froalaSetup=function(p,f,h,o,g){var v={__RequestVerificationToken:p.verificationToken,type:"froala",token:p.token},e=p.colors,a="d575355bb0d24163871dc640ba400f2a";FroalaEditor.DEFAULTS=$.extend(FroalaEditor.DEFAULTS,{key:"iTB2xB5C4C3D1D1C1wd1DBKSPF1WKTUCQOa1OURPJ1KDe2F-11D2C2D2I2C3B3B4D6D1B1==",embedlyKey:a,colorsText:e,colorsBackground:e,keepFormatOnDelete:!1,imageResizeWithPercent:!0,fontSize:["8","9","10","11","12","14","16","18","20","24","30","36","40","48","60","72","96"],imageAllowedTypes:["jpeg","jpg","png","gif"],htmlAllowedAttrs:FroalaEditor.DEFAULTS.htmlAllowedAttrs.concat(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"]),pasteDeniedAttrs:["class","id","width","min-width","style"],linkInsertButtons:[],linkEditButtons:["linkOpen","linkEdit","linkRemove"],htmlDoNotWrapTags:["script","style","br"]}),embedly("defaults",{cards:{key:a}});var t={toolbarInline:!0,toolbarVisibleWithoutSelection:!0,theme:"custom",tabSpaces:!1,placeholderText:null,embedlyKey:a,toolbarButtons:[],imageUploadURL:"/Apiv1/UploadImage",fileUploadURL:"",linkAlwaysNoFollow:!1,htmlRemoveTags:["script"],spellcheck:!0,toolbarContainer:"#toolbarContainer",htmlUntouched:!0,htmlSimpleAmpersand:!0,videoInsertButtons:["videoBack","|","videoByURL","videoEmbed"],embedlyInsertButtons:["embedlyBack","|","embedlyRemove"],listAdvancedTypes:!1,fontFamily:{},imageMaxSize:o?p.FreeUserLimitPerImage:p.PaidUserLimitPerImage,charCounterCount:!1};p.fontFamily&&(t.fontFamily=$.extend(t.fontFamily,p.fontFamily));var n=function(){if(p.StyleGuides){if(""===p.userEmail)return p.StyleGuides[0];for(var e=0;e<p.StyleGuides.length;e++){var a=p.StyleGuides[e];if(a.TeamId==p.Team.Id)return a}}return!1}(),i=!1;if(n&&0<n.TeamFonts.length){var s=document.createElement("style");n.DefaultFontFamily&&(i=n.DefaultFontFamily+",proxima-light,Helvetica,sans-serif");var r={};$.map(n.TeamFonts,function(e,a){if("Xtensio"!=e.SourceString&&"System"!=e.SourceString)return t=e,s.appendChild(document.createTextNode("  @font-face {      font-family: '"+t.FontJson.FontLocalName+"';      font-weight: "+t.FontJson.FontWeight+";       font-style: "+t.FontJson.FontStyle+";       src: local("+t.FontJson.FontLocalName+"), url("+t.FontJson.FontUrl+")  format('woff2');      unicode-range: "+t.FontJson.UnicodeRange+";   }  ")),e.FontJson.FontLocalName;var t});document.head.appendChild(s);for(var l=0;l<n.TeamFonts.length;l++){var d=n.TeamFonts[l];"Xtensio"==d.SourceString||"System"==d.SourceString?r["'"+d.FontJson.IdString+"',proxima-light,Helvetica,sans-serif"]=d.Name:r["'"+d.FontJson.FontLocalName+"',proxima-light,Helvetica,sans-serif"]=d.Name}}else r={"proxima-nova,Helvetica,sans-serif":"Proxima Nova","proxima-light,Helvetica,sans-serif":"Proxima Light","proxima-bold,Helvetica,sans-serif":"Proxima Bold","Tahoma,Geneva,sans-serif":"Tahoma","Times New Roman,Times,serif":"Times New Roman","Verdana,Geneva,sans-serif":"Verdana"};r&&(t.fontFamily=$.extend(t.fontFamily,r)),i&&(t.fontFamilyDefaultSelection=i);var b=$.extend({},t,{plainPaste:!0,multiLine:!1}),T=$.extend({},t,{imageUploadParams:v,toolbarButtons:[["undo","redo","paragraphFormat","fontFamily","fontSize","textColor","bold","italic","underline","align","lineHeight"],["more","outdent","indent","formatOL","formatUL","insertHR"],["insertTable","insertImage","insertVideo","insertLink","insertCTAButton","embedly","html","clearFormatting"]]}),c=$("<div>");function y(e){return c.html(e).html()}if(n&&0<n.TeamColors.length){console.log("styleGuide",n);var u="";if(n.TeamColors.forEach(function(e,a){e.IsDefault&&(u=e.HexCode)}),""!==u&&(console.log("implementing default color: ",u),!p.isDashboard)){var m="#modules-edit-main, #modules-edit-main h1, ";m+="#modules-edit-main h2, ",m+="#modules-edit-main h3, ",m+="#modules-edit-main h4, ",m+="#modules-edit-main p, ",m+="#modules-preview-main, #modules-preview-main h1, ",m+="#modules-preview-main h2, ",m+="#modules-preview-main h3, ",m+="#modules-preview-main h4, ",m+="#modules-preview-main p, ",m+="#modules-preview-main .title > *:not(.fr-wrapper):first-child, ",m+="#modules-edit-main .title > *:not(.fr-wrapper):first-child, ",m+="#modules-preview-main .title .fr-view > *:first-child, ",m+="#modules-edit-main .title .fr-view > *:first-child { ",m+="color: "+u+"; ",m+="} ",m+="#modules-edit-main .module, #modules-preview-main .module { ",m+="border-color: "+u+"; ",m+="color: "+u+"; ",m+="} ",m+="#modules-preview-main .text-module .name, ",m+="#modules-preview-main .text-module .fr-view > ul, ",m+="#modules-preview-main .text-module .fr-view > ol, ",m+="#modules-edit-main .text-module .name, ",m+="#modules-edit-main .text-module .fr-view > ul, ",m+="#modules-edit-main .text-module .fr-view > ol {",m+="color: "+u+"; ";var C="<style id='defaultColor' type='text/css'> "+(m+="} ")+" </style>";setTimeout(function(){$("head style:eq(0)").before(C)},100),p.teamDefaultColorStyles=C}}$.fn.editor=function(t,i,s,n){var c,r=this,e=$(this[0]),l=new diff_match_patch;"object"!==_typeof(n)&&(n={}),n=$.extend({},n),i[s]=i[s]||"",n.url&&(n.noHtml=!0);var a=n.noHtml?$.extend({},b):$.extend({},T);function d(e){var a=e.html.get();return n.noHtml&&(a=$("<div>").html(a).text()),a}function u(e){return n.cleanPTags&&1<$("<div>"+e+"</div>").find("p").length?"<p>"+$(e).text()+"</p>":e}function m(){$(r).find(".fr-embedly").each(function(){$(this).data().originalEmbed&&$(this).html($(this).data().originalEmbed)})}return a.multiLine=null==a.multiLine||a.multiLine,a.enter=FroalaEditor.ENTER_BR,a.htmlAllowedEmptyTags=["textarea","a","iframe","object","video","script",".fa","br"],a.paragraphFormat={P:"Normal",H1:"Heading 1",H2:"Heading 2",H3:"Heading 3",H4:"Heading 4",PRE:"Code"},a.events={initialized:function(){var o=this;r.data("unMountCb",function(){o.destroy()}),f.addListener("tokenRenewed",function(){v.__RequestVerificationToken=p.verificationToken,o("option","imageUploadParams",v)}),h.reg(t,s+(n.index||""),function(e,a){var t=d(o),n=u(l.patch_apply(a,t)[0]);n=y(n),i[s]=n,o.html.set(n),r.updateCaller(o)}),r.unstyle=function(){var e=d(o),a="h1, h2, h3, h4, h5, h6";e=$("<div>").html(e),"Title"==s&&(a+=", > p:first-child"),e.find(a).removeAttr("style").find("*").removeAttr("style"),o.html.set(e.html()),function(){var e=r.text();e=e||r.find("img, video, audio, iframe, table, embedly, lineHeight").length?d(o):(o.html.set(""),"");i[s]!=e&&(i[s]=e,t.save(),n.onSave&&n.onSave(e),r.updateCaller(o))}()}},contentChanged:function(){var e=u(d(this));if(!(55e3<(e=y(e)).length)){var a=l.patch_make(i[s],l.diff_main(i[s],e,!0));t.Data[s]&&(t.Data[s]=e),i[s]=e,h.sync(t,s+(n.index||""),a),r.updateCaller(this)}},keyup:function(e){if(46==e.keyCode||8==e.keyCode){var a=u(d(this));""!==(a=y(a))&&"<h1><br></h1>"!==a&&"<h2><br></h2>"!==a&&"<h3><br></h3>"!==a&&"<h4><br></h4>"!==a&&"<h5><br></h5>"!==a||this.html.set("<br>")}},blur:function(){var e=r.text();e=!e&&!r.find("img, video, audio, iframe, table, embedly, lineHeight").length?(this.html.set(""),""):d(this),i[s]!=e&&(i[s]=e,t.save(),n.onSave&&n.onSave(e),r.updateCaller(this))},"image.error":function(e,a){if(5==e.code){var t=this.popups.get("image.insert").find(".fr-image-progress-bar-layer");o?(t.find("h3").text("File size exceeds the 1MB limit,  but if you upgrade to a premium plan you can upload images up to 5MB."),f.raiseEvent("free-exceedsize")):t.find("h3").text("The image is too big. Maximum size for uploads is 5MB.")}},click:function(e){f.raiseEvent("froalaClick",{e:{},editor:this,clickEvent:e})},"commands.after":function(e,a,t){switch(f.raiseEvent("froalaCmdAfter",{e:{},editor:this,cmd:e,param1:a,param2:t}),e){case"textColor":var n=this.selection.blocks,o=$(n[0]).parent(),i=o.prop("tagName"),s=$(".fr-color-hex-layer");i&&("LI"===i&&(i=(o=$(n[0]).parent().parent()).prop("tagName")),console.log("parentTag",i),"UL"!==i&&"OL"!==i||o.css({color:a})),setTimeout(function(){s.find("input").addClass("fr-not-empty").val(c),s.find(".btn-picker").css("background-color",c)},0);break;case"embedlyInsert":var r=$(this.selection.blocks()[0]),l=r.parent(),d=r.next();(l.is("ul")||l.is("ol"))&&(r.detach().prependTo(d),r.after("<br>")),m();break;case"formatOL":case"formatUL":m()}},"commands.before":function(e,a,t){switch(f.raiseEvent("froalaCmdBefore",{e:{},editor:this,cmd:e,param1:a,param2:t}),e){case"textColor":c=g.rgb2hex($(this.selection.element()).css("color")).toUpperCase()}}},FroalaEditor.DefineIcon("more",{NAME:"more",SVG_KEY:"more"}),FroalaEditor.RegisterCommand("more",{title:"More Text",focus:!0,undo:!1,refreshAfterCallback:!1,callback:function(e,a,t){$(this.$tb).find("[id^='more-']").toggleClass("more-expanded")}}),setTimeout(function(){e[0]&&new FroalaEditor(e[0],a)}),r.updateCaller=function(e){t.renderPreview(),t.factory.folio.Role<2&&t.save(),n.changed&&n.changed(e)},r.html(i[s]||""),r}},app.plugin.lockedTip=function(e,a){return{add:function(e,a,t){var n,o,i,s,r,l;o=a,i=t,(n=e).addClass("locked"),n.find(".fa-lock").remove(),n.append('<i class="fa fa-lock" data-html="true"></i>'),s=n.find(".fa-lock"),r="bottom auto",l=o,s.tooltip({container:"body",html:!0,trigger:"manual",placement:r,title:function(){return l}}),setTimeout(function(){var e=null;n.mouseenter(function(){clearTimeout(e),n.tooltip("hide"),n.find(".fa-lock").tooltip("hide"),$(this).find(".fa-lock").tooltip("show")}).mouseleave(function(){$(".tooltip").remove(),$this=$(this),e=setTimeout(function(){$this.find(".fa-lock").tooltip("hide")},i)})},10)},remove:function(e){e.removeClass("locked"),e.find(".fa-lock").remove(),setTimeout(function(){app.plugin.tooltip()},100)}}},app.plugin.main=function(e,a,t,n,o){var i=a.apiHelper,s=a.appHub,r=a.eventManager,l=!0;l=(!e.Team||0===e.Team.Id)&&n.isFree(),e.editMode&&this.froalaSetup(e,r,s,l,o),(e.folioMode||e.dashboardMode)&&this.folioView(e),this.sliders(),this.uploader(e,i,n),this.misc(),this.social(),this.tooltip(),this.tipped(e,i,o,!1)},app.plugin.misc=function(){$.fn.unMount=function(){var e=this.data("unMountCb");e&&e()},$.fn.copier=function(){var e=this;return e.click(function(){e.select()}),e},$.fn.insertAt=function(e,a){return(e=Math.min(e,this.children().length))<1?this.prepend(a):this.find("> :eq("+(e-1)+")").after(a),this}},app.plugin.popupMenu=function(e,a,t){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=a.jquery?a:$(a),i=e.jquery?e:$(e);function s(){o.slideToggle(200,function(){var e=$(window).height()-$(".user-menu-popup").position().top;$(".user-menu-popup").css("max-height",e+"px")}),i.toggleClass("menu-active")}if($(document).mouseup(function(a){var e=i,t=n.some(function(e){return $(a.target).hasClass(e)||0<$(".".concat(e)).find($(a.target)).length});e.is(a.target)||0!==e.has(a.target).length||t||(o.slideUp(300),i.removeClass("menu-active"),o.find(".theme-picker").hide())}),o.on("mouseenter.popupMenu",function(){i.addClass("over")}),o.on("mouseleave.popupMenu",function(){i.removeClass("over")}),i.off("click.popupMenu"),t)return s;i.on("click.popupMenu",s)},app.plugin.sliders=function(){var n,o,i=null,s=0,r=null,l=function(e,a){null!==i&&(n=i.offset(),s=e.pageX-n.left,o=Math.ceil(s/i.width()*100),i.find("> .slider-bar").css("width",o+"%"),a.obj.Val=o,a.sync("Items"))},d=function(e,a){if(null!==i){n=i.offset(),mouseY=i.height()-(e.pageY-n.top),height=Math.ceil(mouseY/i.height()*100),height=100<height?100:height,i.find("> .slider-bar").css("height",height+"%"),a.obj.Height=height.toString();var t=i.closest(".vert-bar-module").find(".y-axis-max").text();a.obj.Val=Math.ceil(height*t/100).toString(),a.setTooltipPosVal(i.parent().find(".slider-tooltip"),height),a.sync("Items")}},c=function(e,a,t){null!==r&&(n=a.offset(),o=r.width(),s=e.pageX-n.left-o/2,o=Math.min(100-o/a.width()*100,Math.max(0,Math.ceil(s/(a.width()-o/2)*100))),r.css("left",o+"%"),t.obj.Val=o,t.sync("Items"))};$.fn.percentSlider=function(a){var t=this;return t.find(".slider-bar").css({width:Math.ceil(a.obj.Val)+"%"}),t.on("touchstart mousedown",function(e){$("body").addClass("disable-select"),i=t,l(e,a)}).on("touchmove mousemove",function(e){null!==i&&i.get(0)===this&&l(e,a)}).on("touchend mouseup touchcancel mouseleave",function(e){i=null,$("body").removeClass("disable-select")}),this},$.fn.percentVertSlider=function(a){var t=this;return a.obj.Height=parseFloat(100*a.obj.Val/a.yAxisMax),100<parseFloat(a.obj.Height)&&(a.obj.Height=100),a.obj.Height=a.obj.Height.toFixed(2),t.find(".slider-bar").css({height:Math.ceil(a.obj.Height)+"%"}),t.on("touchstart mousedown",function(e){$("body").addClass("disable-select"),i=t,d(e,a)}).on("touchmove mousemove",function(e){null!==i&&i.get(0)===this&&d(e,a)}).on("touchend mouseup touchcancel mouseleave",function(e){i=null,$("body").removeClass("disable-select")}),this},$.fn.thumbSlider=function(a){var t=this,n=t.find(".slider-bar");return n.css({left:a.obj.Val+"%"}),a.thumb&&t.css("cursor","auto"),t.on("touchstart mousedown",function(e){r=n,$("body").addClass("disable-select"),a.thumb||c(e,t,a)}).on("touchend mouseup touchcancel mouseleave",function(e){r=null}).on("touchmove mousemove",function(e){c(e,t,a)}),t},$(document).on("touchend mouseup touchcancel mouseleave",function(e){r=i=null,$("body").removeClass("disable-select")})},app.plugin.social=function(){$.fn.gPlus=function(e){return this.on("click",function(){window.open("https://plus.google.com/share?url="+encodeURIComponent(e),"height=300,width=600")}),this},$.fn.facebook=function(e){return this.on("click",function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),"facebook-share-dialog","width=626,height=436")}),this},$.fn.twitter=function(e,a){return this.on("click",function(){window.open("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(a),"height=300,width=600")}),this},$.fn.twitterVia=function(e){return this.on("click",function(){window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(e+" @xtensio_com"),"height=300,width=600")}),this},$.fn.linkedIn=function(e,a,t){return this.on("click",function(){window.open("https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(e)+"&title="+encodeURIComponent(a),"&summary="+encodeURIComponent(t),"height=300,width=600")}),this},$.fn.emailto=function(e){var a="mailto:?subject=Here's an invite for a free month of Xtensio Plus! Create one pagers, personas, lean canvases and more!&body=Hey there,%0D%0A%0D%0AI wanted to reach out to you because I just discovered Xtensio - a toolbox for smart and beautiful business documents. It comes with FREE tools to help you build one-pagers, user personas, lean canvases, and more.%0D%0A%0D%0AXtensio has been super helpful for my work, so I thought you might want to give it a try. You can sign up here:%0D%0A%0D%0A"+e+"%0D%0A%0D%0AIf you sign up with my link above, we'll both get a free month of premium features with Xtensio Plus!%0D%0A%0D%0ACheers,";this.attr("href",a)},$.socialLinks=function(e,a,t,n,o,i,s){a.find(t).gPlus(e),a.find(n).facebook(e),a.find(o).twitter(e,"I've got invites for a FREE month of Xtensio Plus. Create one pagers, personas, lean canvases for your #startup"),a.find(i).linkedIn(e,"Create an Xtensio account","Invitation to unlock a FREE month of Xtensio Plus. Looking to start a new company or restructure your business? Create dynamic one pagers, lite investor decks, lean canvases, user personas, and more."),a.find(s).emailto(e)},$.shareLinks=function(e,a,t,n,o,i,s,r){a.find(o).gPlus(e),a.find(i).facebook(e),a.find(s).twitter(e,n),a.find(r).linkedIn(e,t,n)}},app.plugin.tipped=function(t,n,e,a,o){var i,s,r,l=_defineProperty({skin:"light",size:"medium",radius:!1,close:!0},"close","overlap"),d=(_defineProperty(i={skin:"light",size:"medium",radius:!1,close:!1},"skin","xtensio"),_defineProperty(i,"hideOnClickOutside",!0),_defineProperty(i,"onShow",function(e,a){var t=$(a),n=t.parent().parent();t.hasClass("bg-panel-btn")?n.find(".bg-panel").is(":visible")&&Tipped.hideAll():t.hasClass("move-sec-btn")?(n.find(".bg-panel").is(":visible")||n.find(".move-menu").is(":visible"))&&Tipped.hideAll():t.hasClass("more-sec-btn")&&(n.find(".more-menu").is(":visible")||n.find(".move-menu").is(":visible")||n.find(".bg-panel").is(":visible"))&&Tipped.hideAll()}),i);function c(a){l.showOn={element:"mouseenter",tooltip:"mouseenter"},"Click"===a.Trigger&&(l.showOn={element:"click",tooltip:"mouseenter"}),0<(s=$(a.DivId)).length&&0==s.hasClass("tip-initialized")&&(s.addClass("tip-initialized tip-icon-"+a.DarkLight.toLowerCase()).find(".fa").removeClass().addClass("fa fa-"+a.Icon.toLowerCase()),1==a.pulsate?($(a.DivId).data("tooltipId",a.Id),e.isIE9orLess()?$(a.DivId).addClass("pulsating-circle-ie9"):$(a.DivId).addClass("pulsating-circle"),l.onShow=function(e,a){var t=parseInt($(a).data("tooltipId"));0<t&&n.setTooltipUserClick({tooltipId:t,type:0,complete:function(){$(a).hasClass("pulsating-circle")?$(a).removeClass("pulsating-circle"):$(a).hasClass("pulsating-circle-ie9")&&$(a).removeClass("pulsating-circle-ie9"),$(a).removeData("tooltipId")}})}):l.onShow=function(e,a){},Tipped.create(a.DivId,function(e){return console.log("tooltip icon",a.Icon),{content:'<div class="xt-tipped-wrapper">'+(a.Title?"<h4>"+a.Title+"</h4>":"")+a.html+"</div>"}},l))}o?(r=t.tippedData)&&0<r.length&&r.forEach(c):t&&(t.editMode||t.dashboardMode)&&(t&&""!==t.userEmail||a)&&(n.getTooltips({success:function(e){var a;a=JSON.parse(e.Data),(t.tippedData=a)&&0<a.length&&a.forEach(c),Tipped.create(".tipped-static",function(e){if(!$(e).hasClass("tip-initialized")){var a={};return $(e).addClass("tip-initialized"),$(e).data("title")&&(a.title=$(e).data("title")),$(e).data("content")&&(a.content=$(e).data("content")),a}},d)},error:function(e){console.log("getTooltips error",e)}}),$(".tipped-icon").click(function(e){e.stopPropagation()}))},app.plugin.tooltip=function(e){var a=$(".tooltip").not("#templates .tooltip"),t=$("[data-tip]").not("#templates [data-tip]");!0===e&&(a=$(".tooltip").not("#templates .tooltip, .tipped-tooltip-created"),t=$("[data-tip]").not("#templates [data-tip], .tipped-tooltip-created")),a.tooltip("destroy"),t.tooltip({delay:150,trigger:"hover",container:"body",placement:"bottom auto",title:function(){return $(this).data("tip")}}).addClass("tipped-tooltip-created").click(function(){$(this).tooltip("hide")})},app.plugin.uploader=function(d,c,u){$.fn.uploader=function(i){var a=i.module,t=i.success,n=i.imageLoaded,e=$('<input type="file" name="file" accept="image/*"/>'),o=$('<label class="file-label"></label>').append(e),s=$('<form encType="multipart/form-data" class="image-form"></form>').append(o),r=e[0],l=s[0];return i.imageLoaded=function(e){a&&a.hideSpinner(),n&&n(e)},i.success=function(e){t&&t(e),l.reset()},i.error=function(){a&&a.hideSpinner(),l.reset()},e.on("change",function(){var o=r.files&&r.files[0];o&&(a&&a.showSpinner(),u.getData(1,function(e,a,t,n){isfree=0===e.ST||34===e.ST,isfree&&!a&&0==d.Team.Id?c.uploadImage(l,o,i,!0):c.uploadImage(l,o,i,!1)},!0))}),this.append(s)}},app.popup.main=function(e,a,t,n,o,i,s,r,l,d,c,u){var m=this,p=$('<div id="popup-container"></div>'),f=[],h=app.plugin.lockedTip(e,a),g=app.lib.googleFonts();$("body").append(p),$("body").append($("#notify-popup")),m.spinner=$("#spinner-container > .loading-animation").html(),m.upgrade=$("#tmp-upgrade-panel").html(),$(document).on("keydown",function(e){var a=p.find(".show");if(a.length)if(27!=(e.keyCode||e.which)||a.hasClass("no-close")){var t=a.data("keydownCb");t&&t(e)}else{var n=a.data("closeCb");m.close(),n&&n()}});var v=!1;$(".popup-content input").mousedown(function(){v=!0}),$("#popup-container").mouseup(function(e){setTimeout(function(){v=!1},200)}),m.reg=function(e,a,t,n){e.data("closeCb",t),e.data("keydownCb",n),p.append(e),a&&(e.find(".popup-content").click(function(e){e.stopPropagation()}),e.find(".popup-wrapper").add(a).click(function(){p.find(".show").hasClass("no-close")||v||(m.close(),t&&t())}))},m.push=function(e){f.push(e)},m.pop=function(){f.pop()},m.signIn=app.popup.getSignIn(m,e,t,n),m.signUp=app.popup.getSignUp(m,e,t,n,e.campaignHandle,e.campaignSettings,a),m.signUpTeam=app.popup.getSignUpTeam(m,e,n,g,i,t),m.signUpDone=app.popup.getSignUpDone(m,t,n),m.signUpDoneInvited=app.popup.getSignUpDoneInvited(m,t,n),m.forgotPass=app.popup.getForgotPass(m,e,t,n),m.settings=app.popup.getSettings(m,e,a,t,n,i),m.emailSettings=app.popup.getEmailSettings(m,e,a,t,n),m.billing=app.popup.getBilling(m,e,t,n,i,a),m.payment=app.popup.getPayment(m,e,t,n,i),m.discPayment=app.popup.getDiscPayment(m,e,t,n,i),m.message=app.popup.getMessage(m,t),m.busy=app.popup.getBusyPopup(m),m.usermenu=app.popup.getUserMenu(e,m,a,i,t),m.plusPrompt=app.popup.getPlusPrompt(m,e,i),m.plusInfo=app.popup.getPlusInfo(m,e,t,i,a),m.signupPerformance=app.popup.getSignUpPerformance(e,m,t,n,a,s),m.transferFolio=app.popup.getTransferFolio(e,m,t,n,a),m.labels=app.popup.getLabelsPopup(e,m,t,n,a,s),m.collaborators=app.popup.getCollaboratorsPopup(e,m,t,n,i,h,a),m.archive=app.popup.getArchivePopup(e,m,n),m.unarchive=app.popup.getUnarchivePopup(m,n),m.shareLink=app.popup.getShareLink(n,m,e,i,h,a,c,t),m.folioVersion=app.popup.getFolioVersion(n,m,a,l,e,u,i),m.expiredBlocker=app.popup.getExpiredBlocker(e,m,i,n,a),m.failedPaymentBlocker=app.popup.getFailedPaymentBlocker(e,m,n,i,a),m.planExpireBlocker=app.popup.getPlanExpireBlocker(e,m,n,i,a),m.folioStats=app.popup.getFolioStatsPopup(e,m,n),m.copySectionPopup=app.popup.getCopySectionPopup(e,m,t,l,n),m.importFolioPopup=app.popup.getImportFolioPopup(e,m,n),m.addFolioToSpace=app.popup.getAddFolioToSpace(e,m,n,i,a),m.transferFolioToSpace=app.popup.getTransferFolioToSpace(e,m,n,i,a),m.saveFolio=app.popup.getSaveFolio(e,m,t,n,a,i),m.personalChannelPopup=app.popup.getPersonalChannelPopup(e,m,n,t),m.trialExpirePopup=app.popup.getTrialExpirePopup(e,m,n,t,i,a),m.signupPlansPopup=app.popup.getSignupPlansPopup(e,m,n,t,i,a),m.createTemplatePopup=app.popup.getCreateTemplatePopup(e,m,n,t,i,a),m.confirmDowngradePopup=app.popup.getConfirmDowngradePopup(e,m,n,t,i,a),m.confirmRemoveMember=app.popup.getConfirmRemoveMemberPopup(e,m,n,t,i,a),m.confirmAddMember=app.popup.getConfirmAddMemberPopup(e,m,n,t,i,a),m.downgradeNoticePopup=app.popup.getDowngradeNoticePopup(e,m,n,t,i,a),m.teamManagePopup=app.popup.getTeamManagePopup(e,m,n,t,i,a,app.plugin),m.failedPaymentAddUser=app.popup.getFailedPaymentAddUser(e,m,n,i,a),e.Team&&(m.teamSettingPopup=app.popup.getTeamSettingPopup(e,m,n,i,t),m.sfgUpgradePopup=app.popup.getSfgUpgradePopup(e,m,n,t),m.teamChannelManagePopup=app.popup.getTeamChannelManagePopup(e,m,n,h,t,i,a),m.styleGuidePopup=app.popup.getStyleGuidePopup(e,m,n,a,i,g,t,h),m.addTeamMemberPopup=app.popup.getAddTeamMemberPopup(e,m,n),m.setupTeamPopup=app.popup.getSetupTeamPopup(e,m),m.choosePlanPopup=app.popup.getChoosePlanPopup(e,m,n,i),m.teamUserActionBlocked=app.popup.getTeamUserActionBlocked(e,m,i),m.teamCollaborationPopup=app.popup.getTeamCollaborationPopup(e,m,t,n,i,h,a),m.addTeamMember=app.popup.getAddMembers(e,m,n),m.transferTeamFolio=app.popup.getTransferTeamFolio(e,m,t,n,a),m.teamChannelPopup=app.popup.getTeamChannelPopup(e,m,n,t,i,a),0<e.Team.Id&&(m.failedPaymentBlocker=app.popup.getFailedPaymentTeamBlocker(e,m,n,i,a))),e.editMode&&(m.addModule=m.getAddModule(m,n,e,d,i,t,u),m.exp=app.popup.getExport(e,m,t,n,a,i),m.expOption=app.popup.getExpOption(m,t,r),m.bgImageAdjust=app.popup.getBgImageAdjust(m)),m.error=function(e,a,t){m.message({heading:a||"Oops!",message:e||"There was an error, please try again.",btnText:"Close",bodyCentered:t||!1})};var b=p.find(".app-popup");return m.close=function(){p.hide(),o.restore();var e=f.pop();e&&m.show(e),location.hash&&history.pushState("","",location.pathname)},m.show=function(e,a){b.filter(".show").removeClass("show"),e.addClass("show"),e.hasClass("normal")&&o.hideCurrent(),p.show().toggleClass("normal",e.hasClass("normal")),p.show().toggleClass("solid",e.hasClass("solid")),p.show().toggleClass("dark",e.hasClass("dark")),a&&history[location.hash?"replaceState":"pushState"]("","","#"+a)},m},app.popup.getBilling=function(f,h,e,c,g,a){var v,t,s,n,o,i,r,l,d,b=!1,T=$("#tmp-billing"),u=T.find(".error-msg"),m=T.find(".save-card"),p=T.find(".save-plan"),y=T.find(".paper"),C=T.find(".status-tab"),w=(C.find(".expire"),C.find(".date")),k=(C.find(".upgrade-panel"),C.find(".user-plan"),C.find(".discount").find(".claim-offer"),C.find(".unlock"),T.find(".pay-tab")),x=k.find(".credit-card"),P=T.find(".invoice-tab"),S=(C.find(".right"),C.find(".details")),D=k.find(".month"),F=k.find(".year"),I=k.find(".existing"),M=k.find(".change-card"),E=k.find(".change-plan"),U=T.find(".radios a"),N=k.find(".change-renew"),A=k.find("input, select"),L=P.find(".history"),O=T.find(".tabs span"),R=T.find(".card-change-status"),B=T.find(".plan-change-status"),Y=x.find("#bln-ccnum"),G=x.find(".cvc"),H=x.find(".name"),z=!1,q=!0,K=T.find(".choose-plan"),j=T.find(".circular-switch"),V=0,J=T.find("section .plan-cont"),W=T.find(".success-panel"),X="",Q=$(".plan-billing-banner"),Z=C.find("section.team-owner-trial"),ee=C.find("section.team-owner-cancelled"),ae=!0;W.find(".no").click(function(){T.find(".popup-content").removeClass("success"),f.close(),window.location=h.baseUrl});var te=function(e){q=e||q?(j.attr("title","Yearly"),j.toggleClass("off",!e),j.find(".button-switch").text("Yearly"),!0):(j.attr("title",q?"Yearly":"Monthly"),j.toggleClass("off",!q),j.find(".button-switch").text("Monthly"),!1),j.find(".button-switch").text(q?"Yearly":"Monthly"),q?j.addClass("off"):j.removeClass("off"),$("#tmp-billing .paper section .button p").removeClass("selected"),$("#tmp-billing .paper section .button p:eq("+(q?0:1)+")").addClass("selected"),q?($("#tmp-billing .plan-block:eq(1) .plan-head h1 span.num").text("25"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small").text("$300/user/year"),$("#tmp-billing .plan-block:eq(1) .plan-head a").attr("href","/teams/create/?plan=year"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.num").text("15"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small").text("$180/user/year"),$("#tmp-billing .plan-block:eq(0) .plan-head a").attr("href","/teams/create/?plan=proyear")):($("#tmp-billing .plan-block:eq(1) .plan-head h1 span.num").text("30"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small-inline").text(""),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small").text("/user/mo"),$("#tmp-billing .plan-block:eq(1) .plan-head a").attr("href","/teams/create/?plan=month"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.num").text("20"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small-inline").text(""),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small").text("/user/mo"),$("#tmp-billing .plan-block:eq(0) .plan-head a").attr("href","/teams/create/?plan=promonth")),q?(J.addClass("yearly"),J.removeClass("monthly")):(J.addClass("monthly"),J.removeClass("yearly"))};j.on("click",function(){q=!q,te()}),te();for(K.click(function(){$("#tmp-payment .plan-banner").hide();var s="",r="",l=$(this).attr("data-plan");if("Team"!=l)if("Credits"!==l){var d=("Pro"==l?"":"Plus")+(q?"Year":"Month");g.getData(1,function(e,a,t,n){if(t){r="Are you sure you want to change your current plan to <b>Xtensio ",r+="Pro"==l?"Pro ":"Plus ",r+=q?"Yearly":"Monthly",r+="</b>?",1==V&&"Pro"==l?s="Upgrade Plan":2==V&&"Plus"==l?(s='<span style="font-size: 26px;">Are you sure you want to downgrade?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',r="By downgrading your plan, you'll no longer have unlimited folios and exports.</br></br>Are you sure you want to change your current plan?"):s="Change Plan";var i="Xtensio ";i+="Pro"==l?"Pro ":"Plus ",i+=q?"Yearly":"Monthly",T.addClass("busy"),c.getUserActiveFoliosCount({success:function(e){T.removeClass("busy");var o=e.Data;c.getUserTemplateCount({success:function(e){var a,t,n=e.Data;2==V&&"Plus"==l&&(5<o||0<n)?(5<o&&n<1?(a="Uh oh - You have more than 5 folios!",t="The Xtensio Plus plan has a limit of 5 folios. In order to downgrade your account, please delete extra folios on your dashboard."):5<o&&0<n?(a="Uh oh - You have more than 5 folios and saved templates",t="The Xtensio Plus plan has a limit of 5 folios and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):o<6&&0<n&&(a="Uh oh - You have saved templates!",t="The Xtensio Plus plan does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard."),f.push(T),f.message({heading:a,message:t,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){window.location=h.baseUrl}})):(f.push(T),f.message({heading:s,message:r,btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){se(d,function(){ne(0),g.refresh(),console.log("inside"),T.find(".popup-content").addClass("success"),T.find(".success-panel").addClass("plan-changed"),T.find(".success-panel .plan-change .plan-name").text(i),T.find(".success-panel .plan-change h3 span").text(i)})}}))},error:function(e){T.removeClass("busy"),console.log("error: ",e)}})},error:function(e){T.removeClass("busy"),console.log("error: ",e)}})}else{var o={planName:l,isYearly:q};f.payment(null,null,o)}},!0)}else f.payment(null,null,{planName:l,isYearly:q})}),T.find(".expire .not-charged").hide(),T.find(".expire .prox-bold").text(""),T.find(".loading-animation").html(f.spinner),f.reg(T,T.find(".icon-Close")),T.find(".icon-Close").click(function(){T.removeClass("cardDetailsOnly"),f.close(),ae||e.reloadWithoutHash()}),m.find(".loading-animation").html(f.spinner),p.find(".loading-animation").html(f.spinner),t=1;t<=12;t++)D.append('<option value="'+t+'">'+t+"</option>");for(t=(new Date).getFullYear();t<=2030;t++)F.append('<option value="'+t+'">'+t+"</option>");var ne=function(u,m){C.find(".right").show(),T.find("section .plan-cont .plan-block").removeClass("selected"),h.hasDiscount&&C.css({visibility:"hidden"});var p="Xtensio ";C.removeClass("paying").find(">div").hide(),T.addClass("busy"),E.add(M).removeClass("cancel"),g.getData(0,function(e,a,t,n){t||T.find(".cancel-plan-btn").hide(),b&&C.find("section.team-owner .date").text(n),ie(),T.find(".existing").toggleClass("yearly",2==e.ST);var o=":eq("+u+")",i="selected";if(O.removeClass(i).filter(o).addClass(i),y.removeClass(i).filter(o).addClass(i),T.find(".tabs span:eq(1)").toggleClass("disable",!t),T.find(".tabs span:eq(2)").toggleClass("disable",!t&&!h.everPlus),(h.everPlus||t||e.Count)&&re(),k.find(".auto-on, .auto-off").hide(),H.val(e.Name),L.empty(),$.each(e.Invoices,function(e,a){L.append('<p class="clearfix"><span class="time">'+dayjs(a.Time).format("MMMM DD, YYYY")+'</span><span class="gray">$'+a.Price+'</span><a target="_blank" href="/billing/invoice/'+a.Id+'">PDF</a></p>')}),e.Invoices.length<1&&L.append('<p class="clearfix">No invoices yet.</p>'),console.log("plusActive",a,"hasPaidPlus",t),a||t){if(v.text("Add Billing Information"),p+="Plus ",t||1==e.ST||2==e.ST||9==e.ST||10==e.ST||11==e.ST||14==e.ST||19==e.ST||22==e.ST||25==e.ST||28==e.ST||31==e.ST||34==e.ST){var s=e.Last4||"0000",r=e.Brand||"Card Not Found";X="xxxx xxxx xxxx "+s,Y.val(X),Y.on("click focusin",function(){$(this).val().includes("xxxx")&&$(this).val("")}),k.find(".left .existing").html("<h3>"+r+'</h3><p><span class="stars">**** **** **** </span>'+s+"</p>");var l=C.addClass("paying").find(".user-plan").show(),d=2==e.ST||11==e.ST||9==e.ST?"year":"month";l.find(".type").text(d+"ly"),l.find(".time").text(d),k.find(".date").text(n),C.find(".plan-verb").text(t?"will renew on":"will expire on"),T.find("section .date").text(n),9==e.ST?k.find(".package").text("Student"):1==e.ST||2==e.ST?k.find(".package").text("Pro"):10==e.ST||11==e.ST?k.find(".package").text("Plus"):k.find(".package").text("Free"),k.find(".period").text(2==e.ST||9==e.ST||11==e.ST?"Yearly":"Monthly"),e.AR?k.find(".auto-on").show():k.find(".auto-off").show(),T.find("section .plan-cont .plan-block:eq(0) button").text("Purchase Export Credits"),T.find("section .plan-cont .plan-block:eq(0) .plan-bot").removeClass("downgrade"),T.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro");var c="Xtensio ";9==e.ST?c+="Student ":1==e.ST||2==e.ST?(c+="Pro (GrandFathered)",T.find("section .plan-cont .plan-block:eq(1)").addClass("selected"),T.find("section .plan-cont .plan-block:eq(0) button").text("Downgrade to Plus"),T.find("section .plan-cont .plan-block:eq(0) .plan-bot").addClass("downgrade"),V=2):10!=e.ST&&11!=e.ST||(console.log("planName",c),c+="Plus ",T.find("section .plan-cont .plan-block:eq(0)").addClass("selected"),V=1),1==e.ST||10==e.ST?(c+="Monthly (GrandFathered)",q=!0,T.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),T.find("section .plan-cont .plan-block.selected").addClass("monthly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Yearly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").removeClass("gray"),Q.addClass("hidden")):2!=e.ST&&9!=e.ST&&11!=e.ST||(c+="Yearly (GrandFathered)",q=!1,T.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),T.find("section .plan-cont .plan-block.selected").addClass("yearly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Monthly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").addClass("gray"),Q.addClass("hidden")),te(m),T.find("section .plan-name:eq(0)").text(t?c:c+" is cancelled"),T.find("section .plan-name:eq(1)").text(c)}else C.find(".expire").show().find(".verb").text("will expire"),C.find(".upgrade-panel").show(),k.find(".auto-off").show().find(".date").text(n);T.find(".no-charge").toggleClass("hidden",e.CST<3)}else v.text("Upgrade"),C.find(".upgrade-panel").show(),(e.Count||e.Referrals.length)&&(C.find(".expire").show().find(".verb").text("expired"),T.find(".expire .prox-bold").text("Upgrade to regain access to Plus features."));1==e.ST||10==e.ST,1==e.ST||10==e.ST||2==e.ST||11==e.ST||9==e.ST||(C.find(".right").hide(),T.find(".plan-block .plan-bot").removeClass("downgrade"),T.find(".plan-block").removeClass("yearly"),T.find(".plan-block").removeClass("monthly"),T.find("section .plan-cont .plan-block:eq(0) button").text("Purchase Export Credits"),T.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro"),p="Xtensio (Free)",T.find(".upgrade-panel .right").css({marginTop:"0"}),T.find("section p .plan-name").text("Xtensio (Free)"),C.find(".plan-verb").text("has expired on"),a?(T.find(".expire .prox-bold").text("Add billing information to retain access to Plus features."),T.find(".expire .not-charged").show(),T.find(".upgrade-panel .right").css({marginTop:"20px"}),p="Xtensio Pro (Free)",!0,T.find("section p .plan-name").text("free Xtensio"),C.find(".plan-verb").text("will expire on")):e.Count||e.Referrals.length||(T.find(".expire .prox-bold").text("Unlock more features with Xtensio Plus."),T.find(".expire").show(),T.find(".expire .exp-txt").hide(),p="Xtensio (Free)",!0,z||h.everPlus||!h.Team||0!=h.Team.Id||f.payment()),"Xtensio (Free)"===p&&T.find(".team-member .plans-det p").hide(),T.find("section h3 .plan-name").text(p),a&&4==e.ST?(T.find("section p .plan-name").text("Free Pro"),T.find("section h3 .plan-name").text("Free Pro")):!a||16!=e.ST&&3!=e.ST||(T.find("section p .plan-name").text("Free Plus"),T.find("section h3 .plan-name").text("Free Plus"))),C.find(".plan").text(p),0!=e.ST||a?w.text(n):w.text(dayjs(Date(h.planCancel)).format("MMMM Do, YYYY")),C.css({visibility:"visible"})})};function oe(e){e=e||"Error - Please review the highlighted fields.",u.text(e).addClass("show")}function ie(){clearTimeout(d),d=setTimeout(function(){T.removeClass("busy")},4e3)}function se(e,a){T.addClass("busy"),c.changePlan({data:{plan:e,renew:e?1:0},success:function(e){ae=!1,g.refresh(),ne(1),a(e)},error:function(e){f.push(T),f.error(e.Message||"There was an error. Please try later.")},complete:function(){T.removeClass("busy")}})}O.click(function(){var e=$(this);return e.hasClass("disable")||ne(e.index()),!1}),v=T.find(".upgrade-panel").html(f.upgrade).find(".ok"),T.find(".invite-link").val(h.sharePlusLink).copier(),$.socialLinks(h.sharePlusLink,T,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),v.click(function(){f.payment()}),m.click(function(e){var a=0,t=Y.data("val"),n=G.val(),o=D.val(),i=F.val(),s=H.val();if(t==X)return R.html('<i class="fi-check"></i> Changes saved.').removeClass("hidden"),setTimeout(function(){R.html("").addClass("hidden")},3e3),!1;A.removeClass("error"),u.removeClass("show"),Stripe.card.validateCardNumber(t)||(a=1,Y.addClass("error")),Stripe.card.validateCVC(n)||(a=1,G.addClass("error")),Stripe.card.validateExpiry(o,i)||(a=1,D.add(F).addClass("error")),s||(a=1,H.addClass("error")),a?oe():(m.find(".loading-animation").removeClass("hidden"),m.find("span").text("Saving ..."),m.prop("disabled",!0),Stripe.card.createToken({number:t,cvc:n,exp_month:o,exp_year:i,name:s},function(e,a){if(a.error)oe(a.error.message);else{var t=a.card,n=a.id;c.card({data:{Token:n,CardId:t.id,Last4:t.last4,Brand:t.brand,Name:s},success:function(e){g.refresh(),ae=!1,M.trigger("click"),Y.val(""),m.find(".loading-animation").addClass("hidden"),m.find("span").text("Save"),m.prop("disabled",!1),R.html('<i class="fi-check"></i> Credit card changed successfuly.').removeClass("hidden"),setTimeout(function(){R.html("").addClass("hidden")},3e3)},error:function(e){oe(e.Message)},complete:function(){T.removeClass("busy")}})}}))}),p.click(function(){var e=U.filter(".selected").data("time"),a=$(this);a.find(".loading-animation").removeClass("hidden"),a.find("span").text("Saving ..."),a.prop("disabled",!0),se(e,function(){I.toggleClass("yearly","Year"==e),k.find(".period").text(e+"ly"),E.trigger("click"),p.find(".loading-animation").addClass("hidden"),p.find("span").text("Save"),p.prop("disabled",!1),B.html('<i class="fi-check"></i> Plan changed successfuly.').removeClass("hidden"),setTimeout(function(){B.html("").addClass("hidden"),window.location=h.baseUrl},3e3)})}),M.click(function(){T.find(".pay-tab").find(".change-card span:last-child").css({display:""}),T.find(".pay-tab").find(".change-card span:first-child").css({display:""}),T.find(".pay-tab").find(".change-card").hasClass("cancel")?(T.find(".pay-tab").find(".change-card span:last-child").css({display:"inline"}),T.find(".pay-tab").find(".change-card span:first-child").css({display:"none"})):(T.find(".pay-tab").find(".change-card span:last-child").css({display:"none"}),T.find(".pay-tab").find(".change-card span:first-child").css({display:"inline"})),$(this).toggleClass("cancel"),k.find(".left").toggleClass("edit")}),E.click(function(){$(this).toggleClass("cancel"),k.find(".right").toggleClass("edit")}),C.find(".plus-btn").click(function(){f.plusInfo()});var re=function(){c.getStripInvoiceData({success:function(e){if("Success"==e.Status){$("#billingUserInvoices").html(""),data=JSON.parse(e.Data);var a="https://static.accountdock.com/app.min.js";if(("localhost"==window.location.hostname||"www.localhost.com"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||-1<window.location.hostname.indexOf("xtensio.tech")||-1<window.location.hostname.indexOf("localhost.com"))&&(a="https://sandbox.accountdock.com/app.min.js"),"undefined"==typeof AccountDock){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=a,t.appendChild(n)}if("undefined"!=typeof AccountDock){var o=AccountDock.configure({key:data.AccountDockKey,customer:data.StripeCustomerId});$(function(){o.open({container:"#billingUserInvoices"})})}}}})};C.find(".cancel-plan-btn, .contact span").click(function(){return f.push(T),f.confirmDowngradePopup("cancel"),!1}),S.click(function(){ne(1)}),U.click(function(e){e.preventDefault();$(this).hasClass("selected")||U.toggleClass("selected")}),N.click(function(){$(this).toggleClass("selected")});function le(e){for(var a=0;a<h.TeamRoles.length;a++)if(h.TeamRoles[a].Id==e)return h.TeamRoles[a].Name}if(h.UserTeams&&0<h.UserTeams.length){for(var de=0;de<h.UserTeams.length;de++)T.find(".team-list").append('<span class="bold">'+h.UserTeams[de].Name+" ("+le(h.UserTeams[de].Role)+")</span><br>");C.find(".button span.team-mem").css("display","inline-block")}else T.find(".team-list").remove(),C.find("button span.team-mem").hide();if(h.UserTeams)for(de=0;de<h.UserTeams.length;de++)1==h.UserTeams[de].Role&&(b=!0);function ce(){var e=Date.now(),a=h.plusExpireTime-e;return Math.floor(a/864e5)+" days "+Math.floor(a%864e5/36e5)+" hours"}function ue(e,n){var o=g.isFree()||g.isFreeWithTeam();c.getTeamSetCount({data:{teamId:e},success:function(e){console.log("getTeamSetCount response",e);var a=JSON.parse(e.Data);if(n&&"function"==typeof n){var t=o?a.TotalUserCount:parseInt(a.GuestSeatsPurchased)+parseInt(a.MemberSeatsPurchased)+1;n(t)}},error:function(e){console.log("getTeamSetCount error",e)}})}function me(n,e){ue(e,function(e){var a=h.ReActivationData.LastPlan||h.Team.Plan;if(C.find("section.team-member").remove(),C.find("section.team-owner").remove(),Z.hide(),ee.show(),console.log("planType",a),ee.find(".plan-type").text(a),ee.find(".plan-duration").text(dayjs(h.plusExpireTime,"x").format("MMMM Do, YYYY")),ee.find(".plan-seats").text(e),n)ee.find(".plan-type-head").text(a+"  (Canceled)"),ee.find(".is-deactivated").hide(),ee.find(".is-ongoing").show();else{var t=_.find(h.UserTeams,function(e){return 1===e.Role});ee.find(".plan-type-head").text("Free Forever"),ee.find(".is-deactivated").show(),ee.find(".is-ongoing").hide(),ee.find(".seat-text").hide(),t?ee.find(".team-name").text(t.Name):ee.find(".team-text").hide()}})}function pe(){return g.isProBusiness()?"Pro":"Business"}return Z.find(".trial-compare").click(function(e){e.preventDefault(),f.payment("showPlans")}),Z.find(".trial-upgrade-now").click(function(e){e.preventDefault(),f.payment("showPlans")}),ee.find(".plan-upgrade-now").click(function(e){e.preventDefault(),f.payment("showPlans")}),C.find("section.team-owner .expired-upgrade-now").click(function(e){e.preventDefault(),f.payment("showPlans")}),C.find("section.team-member .member-upgrade-now").click(function(e){e.preventDefault(),f.payment()}),Z.find(".trial-seats, .mtm-popup-link").click(function(e){e.preventDefault(),f.teamManagePopup()}),ee.find(".mtm-popup-link, .plan-seats").click(function(e){e.preventDefault(),f.teamManagePopup()}),C.find("section.team-owner .see-payment").click(function(){ne(2)}),C.find(".cont-export-credits .purchase-btn").click(function(e){e.preventDefault(),g.isFree()&&!g.isFreeWithTeam()||g.isFreeWithTeam()&&(g.isOwner()||g.isAdmin())?(f.payment(),$("#tmp-payment").css("opacity",0),setTimeout(function(){$("#tmp-payment .btn-credits, .btn-creds").trigger("click"),setTimeout(function(){$("#tmp-payment").css("opacity",1)},200)},1e3)):f.message({heading:"You Cannot Perform this Action",message:"Please contact your team admins for more credits.",btnText:"Ok",bodyCentered:!0,notMini:!0})}),C.find("section.team-owner .change-plan").click(function(e){e.preventDefault(),f.payment("showPlans")}),C.find("section.team-owner .cont-owner-seats .btn-team-members").click(function(e){e.preventDefault(),h.Team&&0!==h.Team.Id?f.teamManagePopup():(f.push(T),f.error("Switch to your team dashboard to manage members.","Oops!",!0))}),$("[name=plan_type]").click(function(){console.log("$(this).val()",$(this).val()),n=$(this).val()}),$("[name=plan_cycle]").click(function(){console.log("$(this).val()",$(this).val()),o=$(this).val()}),C.find("section.team-owner .change-plan .switch-biz-plan").click(function(e){e.preventDefault(),n=pe(),i=pe(),19===s.ST||25===s.ST||31===s.ST?o=r="Month":14!==s.ST&&22!==s.ST&&28!==s.ST||(o=r="Year"),console.log("planChangeCycle",o),console.log("planChangeType",n),$("[name=plan_type][value="+n+"]").prop("checked",!0),$("[name=plan_cycle][value="+o+"]").prop("checked",!0)}),C.find(".team-change-plan .change-plan-btn").click(function(e){e.preventDefault(),function(e,a){T.addClass("busy");var t="Xtensio"+e+" "+a+"ly";console.log("planCycle",a),console.log("planType",e),console.log("planName",t),a===r&&e===i?(T.removeClass("busy"),f.push(T),f.error("You are already in "+t,"Oops!",!0)):(f.push(T),f.message({heading:"Change Plan",message:"Are you sure you want to change your current plan to "+t+"?",btnText:"Yes, I am sure",bodyCentered:!0,cancelText:"Nevermind",notMini:!0,handleOK:function(){c.changeTeamPlan({plan:e+a,success:function(e){T.removeClass("busy"),ae=!1,console.log("ChangeTeamPlan res",e),g.refresh(),T.find(".popup-content").addClass("success"),T.find(".success-panel").addClass("plan-changed"),T.find(".success-panel .plan-change .plan-name").text(t),T.find(".success-panel .plan-change h3 span").text(t)},error:function(e){T.removeClass("busy"),console.log("ChangeTeamPlan error",e),f.push(T),f.error(e.Message||"There was an error. Please try later.")}})},handleNo:function(){T.removeClass("busy")}}))}(n,o)}),function(e,a,t){"string"==typeof t&&T.addClass(t),T.addClass("busy"),j.hasClass("off")||j.trigger("click"),$("#tmp-billing").find(".status-tab").find(".discount").css({display:"none"}),T.find(".popup-content").removeClass("success"),z=a||0,g.loadStripe(function(){ne(e||0,!0)}),h.IsDelinquent&&(T.find(".pay-tab").find(".left").addClass("edit"),T.find(".pay-tab").find(".change-card span:first-child").css({display:"none"}),T.find(".pay-tab").find(".change-card span:last-child").css({display:"inline"})),T.addClass("busy"),b?g.getData(1,function(e,n,o,a){s=e,C.find("section.team-member").remove(),console.log("planDetails",s),console.log("config.ReActivationData.LastPlan",h.ReActivationData.LastPlan);var i=g.getPlanName(s.ST),t=null;h.Team&&0!==h.Team.Id?t=h.Team.Id:h.UserTeams&&0<h.UserTeams.length&&h.UserTeams.forEach(function(e,a){1===e.Role&&(t=e.Id)}),h.isTrial?t?ue(t,function(e){var a=g.isBusiness()?"Business":"Pro";C.find("section.team-owner").remove(),Z.find(".trial-type").text(a),Z.find(".trial-duration").text(ce()),Z.find(".trial-seats").text(e),clearInterval(l),l=setInterval(function(){Z.find(".trial-duration").text(ce())},36e5),h.isTrialCanceled&&(Z.find(".text-cancelled").text(" -  Canceled"),Z.find(".contact").hide(),Z.find(".trial-dur-text").hide(),Z.find(".trial-cancel-dur-text").show()),Z.show(),T.removeClass("busy")}):console.log("DEV WARNING: No useable TeamID available for calculation"):h.ReActivationData&&h.ReActivationData.LastPlan?me(!1,t):0===h.autoRenew&&0!==h.Team.ST&&34!==h.Team.ST&&!h.isTrialCanceled&&h.trialConverted?me(!0,t):(t||(t=0),ue(t,function(e){if(C.find(".seat-num").text(e),o&&n)19===s.ST||25===s.ST||31===s.ST?C.find("section.team-owner p:eq(0) span.bold:eq(0)").text("monthly"):14!==s.ST&&22!==s.ST&&28!==s.ST||C.find("section.team-owner p:eq(0) span.bold:eq(0)").text("yearly"),C.find("section.team-owner h2:eq(0) span.bold:eq(0)").text(i),C.find("section.team-owner .expire-upgrade-cont").hide();else{var a=h.ReActivationData.LastPlan||h.Team.Plan;C.find("section.team-member").remove(),C.find("section.team-owner").remove(),Z.hide(),ee.show(),console.log("planType",a),ee.find(".plan-type").text(a);var t=_.find(h.UserTeams,function(e){return 1===e.Role});ee.find(".plan-type-head").text("Free Forever"),c.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var a=JSON.parse(e.Data);$(".cont-export-credits").show(),$(".export-credits-num").text(a.CreditsLeft)},error:function(e){console.log("getCreditsLeft error",e),oe(e.Message)}}),"none"===a.toLowerCase()||-1<a.search(/export|credit/gi)?ee.find(".is-deactivated").hide():ee.find(".is-deactivated").show(),ee.find(".is-ongoing").hide(),t?ee.find(".team-name").text(t.Name):ee.find(".team-text").hide()}ie()}))}):(C.find("section.team-owner").hide(),ie(),C.find("section.team-member .feat-cont").hide(),C.find("section.team-member .plan-cont").hide(),C.find("section.team-member .plan-billing-banner").hide(),C.find("section.team-member .button").hide()),f.show(T,"billing"),Y.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),G.mask("0000")}},app.popup.getConfirmAddMemberPopup=function(s,r,l,e,d,a){var c,u=$("#tmp-confirm-add-member"),t=u.find(".cancel, .popup-close.icon-Close"),m=u.find(".loading-animation").html(r.spinner);return u.find(".cancel-add-btn").click(function(e){e.preventDefault(),r.close()}),u.find(".confirm-add-btn").click(function(e){e.preventDefault(),u.removeClass("show"),r.close(),"function"==typeof c&&c()}),r.reg(u,t),function(e,a,t){var n;c=t,!0?(m.hide(),u.find(".popup-content").show()):(m.show(),u.find(".popup-content").hide());var o,i=d.getPlanName(s.Team.ST);e=$.trim(e),19===s.Team.ST||25===s.Team.ST||31===s.Team.ST?(n="month",o=-1<i.search(/pro/i)?20:30):14!==s.Team.ST&&22!==s.Team.ST&&28!==s.Team.ST||(n="year",o=-1<i.search(/pro/i)?180:300),u.find(".member-type").text(e),u.find(".memberTypeInfo").hide(),u.find('.memberTypeInfo[data-member="'+e+'"]').show(),u.find(".amount-per").text("$"+o+" per "+n),u.find(".monthly-yearly").text(n+"ly"),u.find(".next-payment-date").text(dayjs(s.Team.plusExpireTime).format("MMMM Do, YYYY")),null==a||null==a?l.listALLMembers({data:{teamId:s.Team.Id},success:function(e){u.find(".next-total-payment").text("$"+(e.Data.Data.members.length+1)*o)},error:function(e){console.log(e)},complete:function(){r.show(u)}}):(u.find(".next-total-payment").text("$"+(a+1)*o),r.show(u))}},app.popup.getConfirmRemoveMemberPopup=function(n,o,i,e,a,t){var s,r=$("#tmp-confirm-remove-member"),l=r.find(".cancel, .popup-close.icon-Close"),d=r.find(".loading-animation").html(o.spinner);function c(e){e?(d.hide(),r.find(".popup-content").show()):(d.show(),r.find(".popup-content").hide())}return a.isFreeWithTeam()&&r.find(".hidden-on-free").hide(),r.find(".cancel-remove-btn").click(function(e){e.preventDefault(),o.close()}),r.find(".confirm-remove-btn").click(function(e){e.preventDefault(),c(!1),s&&"function"==typeof s&&s()}),o.reg(r,l),function(e,a,t){s=t,o.show(r),c(!1),$("#dashboard-page .loader").show(),r.find(".channel").text(a),i.getUserFolioCountFromTeam({username:e,teamId:n.Team.Id,success:function(e){console.log("getUserFolioCountFromTeam response",e);var a=JSON.parse(e.Data);console.log("data",a);var t=a.TotalOwnedFolios,n=a.TotalOwnedTeamTemplates,o=a.TotalOwnedUserTemplates;r.find(".folio").text(1===t?t+" folio":t+" folios"),r.find(".team-templates").text(1===n?n+" Team Template":n+" Team Templates"),r.find(".my-templates").text(1===o?o+" Personal Template":o+" Personal Templates")},error:function(e){console.log("WARNING"),console.log("getUserFolioCountFromTeam err",e)},complete:function(){$("#dashboard-page .loader").hide(),c(!0)}})}},app.popup.getDiscPayment=function(n,a,e,l,d){var t,o,c=$("#tmp-disc-payment"),u=c.find(".error-msg"),i=c.find(".checkout-btn"),m=c.find(".card-num"),p=c.find(".cvc"),f=c.find(".user-name"),h=(c.find(".radios a"),c.find(".month")),g=c.find(".year"),v=c.find("input, select"),s=c.find(".detail-btn"),b=c.find(".success-panel"),r=i.find(".txt"),T=c.find("h1"),y=!1;for(o=1;o<=12;o++)h.find(".filter-popup-menu").append('<div class="item" data-value="'+o+'">'+o+"</div>");for(o=(new Date).getFullYear();o<=2030;o++)g.find(".filter-popup-menu").append('<div class="item" data-value="'+o+'">'+o+"</div>");function C(e){e=e||"Error - Please review the highlighted fields.",u.text(e).addClass("show")}c.find(".loading-animation").html(n.spinner),n.reg(c,c.find(".icon-Close, .no"),function(){t&&t()}),s.click(function(){n.billing(1,!0)});var w=function(){c.addClass("busy");var e,a,t=$(this);t.find(".loading-animation").removeClass("hidden"),e="DiscountYearly",a=function(){setTimeout(function(){t.find(".loading-animation").removeClass("hidden")},3e3)},c.addClass("busy"),l.changePlan({data:{plan:e,renew:e?1:0},success:function(e){d.refresh(),d.getData(0,function(e,a,t,n){b.find(".time").text(n)}),c.find(".popup-content").addClass("success"),b.find(".period").text("year"),b.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Discount Applied!"),b.find(".msg-plus").hide(),b.find(".msg-free .act").text("updated")):(T.text("Welcome to Xtensio Plus"),b.find(".msg-free").hide()),a(e)},error:function(e){n.push(c),n.error(e.Message||"There was an error. Please try later.")},complete:function(){c.removeClass("busy")}})};return i.click(function(e){if(y)w();else{var a=0,t=m.val(),n=p.val(),o=parseInt(h.find(".item.active").attr("data-value")),i=parseInt(g.find(".item.active").attr("data-value")),s=f.val(),r="DiscountYearly";console.log(o+" y "+i),v.removeClass("error"),u.removeClass("show"),Stripe.card.validateCardNumber(t)||(a=1,m.addClass("error")),Stripe.card.validateCVC(n)||(a=1,p.addClass("error")),Stripe.card.validateExpiry(o,i)||(a=1,h.add(g).addClass("error")),s||(a=1,f.addClass("error")),a?C():(c.addClass("busy"),Stripe.card.createToken({number:t,cvc:n,exp_month:o,exp_year:i,name:s},function(e,a){if(a.error)c.removeClass("busy"),C(a.error.message);else{var t=a.card,n=a.id;r.toLowerCase();l.buy({data:{Token:n,CardId:t.id,Last4:t.last4,Brand:t.brand,Plan:r,Name:s},success:function(e){d.refresh(),c.removeClass("busy"),c.find(".popup-content").addClass("success"),b.find(".time").text(dayjs(+e.Message).format("MMMM Do, YYYY")),b.find(".period").text("year"),b.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Billing Information Saved!"),b.find(".msg-plus").hide()):(T.text("Welcome to Xtensio Plus"),b.find(".msg-free").hide()),console.log(y+"sd ")},error:function(e){c.removeClass("busy"),C(e.Message)}})}}))}}),$("#billing-link").click(function(){n.payment(null,!0)}),function(e){c.find(".filter-popup-menu").hide(),a.hasDiscount?(t=e,c.addClass("busy").find(".popup-content").removeClass("success"),T.text("Students and Faculty, Save 50%"),r.text("Upgrade"),d.loadStripe(function(){d.getData(1,function(e,a,t,n){c.removeClass("busy"),c.find(".msg").toggleClass("hidden",!a).find(".time").text(n),T.data("plus",a),T.data("end",n),t||e.Referrals.length||!a||r.text("Add Billing Information"),1==e.ST&&(r.text("Upgrade to Yearly"),c.find(".card-box").hide(),c.find(".item").hide(),y=!0,i.css({marginTop:0}),$(".total  ul li:nth-child(3)").hide()),m.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),p.mask("0000")})}),n.show(c,"studentbilling")):n.payment()}},app.popup.getForgotPass=function(a,e,t,n){var o,i,s,r=$("#tmp-fpass"),l=r.find(".email"),d=(r.find(".popup-cta"),r.find(".msg")),c=function(){d.attr("class","msg"+(i?" error":"")).text(s)},u=function(){o=l.val(),i=!validator.isEmail(o),empty=!o,s=i?"Please provide a valid email address.":"Sending Email. Please wait.",c(),empty&&d.html("Email  cannot be  Blank.").addClass("error"),i||n.forgotPassword({email:o,success:function(e){i=!1,s=e.Message,c()},error:function(a){function e(e){return a.apply(this,arguments)}return e.toString=function(){return a.toString()},e}(function(e){i=!0,s=e.Message||"There was an error. Please try again.",c()})})};return r.find(".sign-in").on("click",function(){a.signIn()}),l.on("keyup",function(e){13==e.which&&u(),c()}),r.find(".popup-cta").on("click",u),a.reg(r),function(e){o=e,l.val(o),c(),a.show(r)}},app.popup.getPayment=function(g,v,f,c,b){var T,e,y,C=$("#tmp-payment"),l=C.find(".error-msg"),a=C.find(".checkout-btn"),d=C.find(".card-num"),w=C.find("#crd-ccnum"),k=C.find(".cvc"),u=(C.find(".month-radio"),C.find(".year-radio"),C.find(".user-name")),m=(C.find(".radios a"),C.find(".month")),p=C.find(".year"),h=C.find("input, select"),t=C.find(".detail-btn"),i=(C.find(".charged"),C.find(".msg-end"),C.find(".success-panel")),x=(a.find(".txt"),C.find(".popup-header h1").first()),P=C.find(".checkout-title-box"),n=P.find(".chk-back-btn"),o=C.find(".circular-switch"),s=(o.find(".button-out"),o.find(".button-in"),C.find(".choose-plan")),S=!0,D=C.find(".card-details .select.confirm"),F=!1,I={},M=!1,E=C.find(".card-details"),r=E.find(".new-card-details"),U=E.find(".existing-card-details"),N=C.find(".container-plans"),A=C.find(".cont-upgrade-panel"),L=C.find(".popup-header"),O=C.find(".popup-header .intro-text"),R="monthly",B="business",Y=null,G=!1,H=null,z=!1,q=5,K=0,j=0,V=[],J=!1,W=$("#upg-ccnum"),X=A.find(".cvc"),Q=A.find(".user-name"),Z=$("#upg-ccdate"),ee=A.find(".upg-confirm"),ae=A.find(".upg-error-msg"),te=C.find(".cont-upgrade-success"),ne=(C.find(".back-btn"),N.find(".cont-compare-plans-full .table")),oe=!0,ie=N.find(".cont-compare-plans-full"),se=(ie.find(".btn-pro"),ie.find(".btn-pro + .curr"),ie.find(".btn-biz"),ie.find(".btn-biz + .curr"),ie.find(".btn-free-dg"),ie.find(".note-free-curr"),!1);n.click(function(){window.location.reload()});var re=function(e){S=e||S?(o.attr("title","Yearly"),o.toggleClass("off",!e),$("#tmp-payment .card-panel .paper").removeClass("monthly"),$("#tmp-payment .card-panel .paper").addClass("yearly"),o.find(".button-switch").text("Yearly"),!0):(o.attr("title",S?"Yearly":"Monthly"),o.toggleClass("off",!S),$("#tmp-payment .card-panel .paper").removeClass("yearly"),$("#tmp-payment .card-panel .paper").addClass("monthly"),o.find(".button-switch").text("Monthly"),!1),o.find(".button-switch").text(S?"Yearly":"Monthly"),S?o.addClass("off"):o.removeClass("off"),$("#tmp-payment .card-panel .popup-header p").removeClass("selected"),$("#tmp-payment .card-panel .popup-header p:eq("+(S?0:1)+")").addClass("selected"),console.log("isYearly",S)};function le(){$btn=ne.find(".btn-reveal"),$(window).width()<830?$btn.next().hide().end():$btn.next().show()}function de(e){var a=C.find("#compare-plans-wrapper .checkbox input");"yearly"===e.toLowerCase()&&!0===a.is(":checked")?a.click():"monthly"===e.toLowerCase()&&!1===a.is(":checked")&&a.click()}function ce(e){e?(A.find(".cont-back").hide(),A.find(".card-new").show(),A.find(".card-exists").hide()):(A.find(".card-new").hide(),A.find(".card-exists").show())}function ue(e,a){R=e.toString(),me(),C.find(a+"[value="+e+"]").prop("checked",!0)}function me(){var e="yearly"===R?"monthly":"yearly",a="business"===B?"pro":"business",t=(B+" "+R).toString(),n=f.capitalizeFirstLetter(B),o=n+" "+f.capitalizeFirstLetter(R);N.removeClass(e),N.addClass(R),A.removeClass(e),A.removeClass(a),A.addClass(t),A.find(".panel-title.normal-flow .plan-type").text(o),A.find(".panel-title.normal-flow .showOnSignUp .plan-type").text(n),A.find(".card-title.plan-title").text(n),A.find(".plandur").text(f.capitalizeFirstLetter(R));var i="yearly"===R?j:K;A.find(".upg-checkout-btn .cost-pay").text(ve(i)),A.find(".upg-checkout-btn .type").text(o);var s="business"===B?30:20,r="yearly"===R?s-5:s;te.find(".upg-success-type").text("Xtensio "+o),te.find(".upg-success-cost").text(ve(i,!0)+" USD"),te.find(".upg-success-seat-cost").text(ve(r)+"/month/seat, billed "+R),ee.find(".charge-amnt").text(ve(i,!0)),ee.find(".charge-duration").text(R.replace("ly","")),"business"===B?(A.find(".upg-business-flow").show(),A.find(".upg-pro-flow").hide()):(A.find(".upg-business-flow").hide(),A.find(".upg-pro-flow").show());var l=dayjs().add(1,"yearly"===R?"years":"months");te.find(".next-payment-date").text(l.format("MMMM Do, YYYY"));var d=f.getUrlVars(),c=d.promo?d.promo.toString():"",u=$("#checkout-subtotal-discount");if(u.hide(),v&&v.HasDiscount||""!==c){var m=.25*i,p=i-m;u.find(".disc-val").text(ve(m)),u.find(".disc-tot").text(ve(p)),te.find(".upg-success-cost").text(ve(p)+" USD"),A.find(".upg-checkout-btn .cost-pay").text(ve(p)),u.show()}!function(){if(console.log("config.Team ",v.Team),0!==v.Team.Id){var e=void 0===v.Team.Plan?"None":v.Team.Plan,a=-1!==e.toString().indexOf("Business")?"business":"pro",t=-1!==e.toString().indexOf("Yearly")?"yearly":"monthly";N.find(".plan-cont:eq(2)").removeClass("current"),N.find(".plan-cont:eq(0)").removeClass("current"),ie.removeClass("current"),ie.hasClass(a)||ie.addClass(a),a===B&&R===t&&G&&("pro"===B?(N.find(".plan-cont:eq(2)").addClass("current"),ie.addClass("current")):"business"===B&&(N.find(".plan-cont:eq(0)").addClass("current"),ie.addClass("current")))}}()}function pe(e){var a="Please Upgrade Your Account";"string"==typeof e&&"signUpMode"===e&&(a="Choose Your Plan"),me(),$("body").addClass("fullScreenPopupOpen"),window.scrollTo(0,0),A.hide(),N.addClass("upgrade"),x.text(a),O.text("No commitment. Switch plans or cancel anytime."),x.show(),L.show(),N.show()}function fe(e){function a(e){var a;console.log("listALLMembers response",e),a=se?v.teamMembersOnSignUp:e.Data.Data.members;var t="business"===B?30:20,n=t-5,o=(V=a).length;0===o&&(V.push({Email:v.userEmail}),o=1),K=t*o,j=n*o*12,A.find(".cost").text(ve(t)),A.find(".newcost").text(ve(n)),A.find(".totalcost-month").text(ve(K,!0)),A.find(".totalcost-year").text(ve(t*o*12,!0)),A.find(".newtotalcost").text(ve(j,!0));var i="",s="",r="",l="";V.forEach(function(e,a){if(e.Email===v.userEmail){var t="<li>"+e.Email+" <span>(You)</span></li>";i=t+i,r=t+r,l+=t}else{var n='<li><span class="email">'+e.Email+'</span><span class="pull-right"><a class="btn-remove" href="#"><i class="icon-Close"></i> Remove</a></span></li>';r+="<li>"+e.Email+"</li>",l+='<li><span class="email">'+e.Email+'</span><span class="pull-right"><a class="btn-remove-signUp" href="#">Remove <i class="icon-Close"></i></a></span></li>',a<q?i+=n:s+=n}}),i=he(i),r=he(r),s=he(s,'start="'+(q+1)+'"'),A.find(".upg-first-five").html(i),A.find(".upg-rest-list").html(s),te.find(".upg-success-seat-cont").html(r),se?A.find(".cont-seat-toggle").html(l):A.find(".cont-seat-toggle").html(r);var d=_.find(v.UserTeams,function(e){return 1===e.Role||se&&0===e.Role});console.log("teamDetais",d);var c=o+(1===o?" seat":" seats");if(A.find(".upg-num-seats").text(c),A.find(".seat-toggle span").text(c),te.find(".upg-success-seatnum").text(c),d){var u=-1===d.TeamUrl.toString().indexOf("https://")?"https://"+d.TeamUrl:d.TeamUrl,m=1===d.TotalFolios?" Folio":" Folios";A.find(".upg-team-url").text(u),A.find(".upg-team-name").text(d.Name),A.find(".upg-team-folios").text(d.TotalFolios+m),te.find(".upg-success-email").text(v.userEmail),te.find(".goto-team").attr("href",u),te.find(".goto-team span").text(d.Name)}me(),o<q&&(A.find(".btn-toggle-seats").hide(),A.find(".upg-rest-list").hide()),x.hide(),L.hide(),N.hide(),console.log("plusData",I),void 0!==I.Last4&&void 0!==I.Brand&&(z=!0,A.find(".card-exists .card-num span").text(I.Last4),ce(!1)),A.show(),C.removeClass("busy")}C.addClass("busy"),se?a():c.listALLMembers({data:{teamId:e},success:a,error:function(e){console.log("listALLMembers error",e)}})}function he(e,a){return"<ol "+(a||"")+">"+e+"</ol>"}function ge(){v&&v.Team?fe(Y=v.Team.Id):se?(Y=null,1!==v.Team.Role&&0!==v.Team.Role||(Y=v.Team.Id),Y||(console.log("DEV WARNING: No useable TeamID available for calculation"),console.log("defaulting teamID to 0."),Y=0),fe(Y)):!0===b.isOldFreeUserNeverOnTrialOrPlan()&&pe()}function ve(e,a){var t=a||!1,n=parseFloat(e,10).toFixed(2).toString();return t||(n=n.replace(".00","")),"$"+n}function be(){C.addClass("busy");var e=v.Team.TeamUrl.toString(),a=-1===e.indexOf("https://")?window.location.protocol+"//"+e:e;0<v.teamMembersOnSignUp.length?c.addMembers({data:{teamMembers:v.teamMembersOnSignUp},success:function(){window.location.href=a},error:function(e){console.log(e),C.removeClass("busy")}}):window.location.href=a}function Te(e){e=e||"Error - Please review the highlighted fields.",ae.text(e).addClass("show")}N.find(".cont-toggler-compare .btn-compare-plans").click(function(){N.find(".cont-toggler-compare .cont-compare-plans-full").slideToggle(200,function(){$(this).is(":visible")?(N.find(".cont-toggler-compare .btn-compare-plans .compare-icon").html('<i class="fa fa-angle-up"></i>'),N.find(".cont-toggler-compare").css("backgroundColor","#fff")):(N.find(".cont-toggler-compare .btn-compare-plans .compare-icon").html('<i class="fa fa-angle-down"></i>'),N.find(".cont-toggler-compare").css("backgroundColor","transparent"))}),le(),ne.find(".btn-reveal").click(function(e){e.preventDefault(),$(this).next().toggle().end().toggleClass("btn-hide"),$(this).hasClass("btn-hide")?$(this).html('Hide All Features <i class="ico-triangle"></i>'):$(this).html('View All Features <i class="ico-triangle"></i>')})}),N.find("a.btn-buy-credits").click(function(e){e.preventDefault(),se||Ce("credits")}),N.find(".popup-cta.free").click(function(e){e.preventDefault(),g.push(C),g.confirmDowngradePopup("cancel")}),C.find(".cont-toggler .arrow-btn").click(function(){C.find(".cont-toggler .banner-full").slideToggle(400,function(){$(this).is(":visible")?C.find(".cont-toggler .arrow-btn").html('<i class="fa fa-angle-up"></i>'):C.find(".cont-toggler .arrow-btn").html('<i class="fa fa-angle-down"></i>')})}),A.find(".btn-toggle-seats").click(function(e){e.preventDefault(),A.find(".upg-rest-list").slideToggle(400,function(){$(this).is(":visible")?A.find(".btn-toggle-seats").text("Hide"):A.find(".btn-toggle-seats").text("Show All")})}),C.find(".cont-plan-details .seat-toggle").click(function(e){e.preventDefault(),C.find(".cont-plan-details .cont-seat-toggle").slideToggle(400)}),A.find(".cont-seat-toggle").on("click",".btn-remove-signUp",function(e){e.preventDefault(),C.addClass("busy");var a=$(this).parent().parent().find(".email").text(),t=v.teamMembersOnSignUp;v.teamMembersOnSignUp=t.filter(function(e){return e.Email!==a}),fe(Y)}),A.find(".upg-team-members").on("click",".btn-remove",function(e){e.preventDefault(),C.addClass("busy");var a=$(this).parent().parent().find(".email").text();console.log("email",a),c.removeTeamMemberReactivation({userEmail:a,success:function(e){console.log("removeTeamMemberReactivation response",e),oe=!1,fe(Y)},error:function(e){console.log("removeTeamMemberReactivation err",e),function(e){H&&clearTimeout(H);var a=A.find(".member-err");a.text(e),a.show(),H=setTimeout(function(){a.hide()},5e3)}(e.Message)},complete:function(){C.removeClass("busy")}})}),C.find(".cont-upgrade-panel input[type=radio]").click(function(){var e=$(this).val();console.log("radio buttons on upgrade checkout panel: toggle plan value ",e),de(e),ue(e,".upgradeflow.cont-plan-year input[type=radio]")}),C.find(".upgradeflow.cont-plan-year input[type=radio]").click(function(){var e=$(this).val();console.log("radio buttons on upgrade plan screen: toggle plan value",e),de(e),ue(e,".cont-upgrade-panel input[type=radio]")}),A.find(".card-exists  a.edit-billing-btn").click(function(e){e.preventDefault(),ce(!(z=!1)),A.find(".cont-back").show()}),A.find(".cont-back").click(function(e){e.preventDefault(),ce(!(z=!0))}),A.find(".change-plan").click(function(e){e.preventDefault(),window.location.hash="seeplans",pe()}),N.find(".upg-button").click(function(e){var a;e.preventDefault(),B=$(this).data("plan"),!0===b.isOldFreeUserNeverOnTrialOrPlan()?(a=void 0===a?"":"?plan="+a,window.location.href="/teams/create"+a):ge()}),N.find(".choose-free").click(be),ee.click(function(e){e.preventDefault(),J=!J,A.find(".upg-confirm").toggleClass("selected",J),console.log("upgIsConfirmed",J)}),A.find(".upg-checkout-btn").click(function(e){e.preventDefault();var a=f.capitalizeFirstLetter(B)+f.capitalizeFirstLetter(R.replace("ly","")),t=0,n=W.data("val"),o=X.val(),i=Q.val(),s=Z.val(),r=s?s.toString().substr(0,2):"",l=s?s.toString().substr(3):"";if(console.log("num",n),console.log("date",s),console.log("== attempting to upgrade to ==",a),ae.removeClass("show"),W.removeClass("error"),X.removeClass("error"),Z.removeClass("error"),Q.removeClass("error"),ee.find("span.check").removeClass("error"),ee.find("p").removeClass("error"),z||(Stripe.card.validateCardNumber(n)||(t=1,W.addClass("error")),Stripe.card.validateCVC(o)||(t=1,X.addClass("error")),Stripe.card.validateExpiry(r,l)||(t=1,Z.addClass("error")),i||(t=1,Q.addClass("error"))),J||(t=1,ee.find("p").addClass("error"),ee.find("span.check").addClass("error")),t)Te();else{C.addClass("busy");var d={plan:a,success:function(e){console.log("upgrade response",e),oe=!1,b.refresh(),C.removeClass("busy"),A.hide(),te.show()},error:function(e){console.log("upgrade error",e),C.removeClass("busy"),Te(e.Message)}};se&&(d.teamMembers=v.teamMembersOnSignUp),console.log(a),z?c.upgrade(d):Stripe.card.createToken({number:n,cvc:o,exp_month:r,exp_year:l,name:i},function(e,a){if(a.error)console.log("Stripe createToken error",a),C.removeClass("busy"),Te(a.error.message);else{var t=a.card,n=a.id;d.data={Token:n,CardId:t.id,Last4:t.last4,Brand:t.brand,Name:i},console.log("apiData: ",d),c.upgrade(d)}})}}),o.on("click",function(){S=!S,re()}),re();var ye={Plusmonthly:10,Plusyearly:8,Promonthly:14,Proyearly:10,Credits:10};s.click(function(){(console.log("choose"),"Credits"===(y=$(this).attr("data-plan")))&&Ce(y,ye[y+(S?"yearly":"monthly")])});var Ce=function(e,a){console.log("plusData",I),console.log("typeof plusData.Brand",_typeof(I.Brand)),console.log("typeof plusData.Last4",_typeof(I.Last4)),we(!1);var t=a||ye[e];E.show(),P.show(),x.hide(),O.hide(),N.hide(),A.hide(),console.log("planPrice",t),console.log("planName",e)};function we(e){e?(U.find(".exist-card-cont h2").text(I.Brand),U.find(".exist-card-cont span.four-digits").text(I.Last4),r.find("input.card-num").val("**** **** **** "+I.Last4),r.find("input.user-name").val(I.Name),k.val("***"),r.hide(),U.show()):(r.show(),U.hide())}for(U.find(".btn-card-update").click(function(e){e.preventDefault(),we(!1)}),D.click(function(e){e.preventDefault(),F=!F,D.toggleClass("selected",F),console.log("isConfirmed",F)}),C.find(".pass-protect").toggleClass("selected"),e=1;e<=12;e++)m.find(".filter-popup-menu").append('<div class="item" data-value="'+e+'">'+e+"</div>");for(e=(new Date).getFullYear();e<=2030;e++)p.find(".filter-popup-menu").append('<div class="item" data-value="'+e+'">'+e+"</div>");function ke(e){e=e||"Error - Please review the highlighted fields.",l.text(e).addClass("show")}function xe(e,a,t,n){var o={success:function(e){oe=!1,b.refresh(),c.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var a=JSON.parse(e.Data);i.find(".credits").text(a.CreditsLeft),C.find(".popup-content").addClass("success"),setTimeout(function(){f.reloadWithoutHash()},4e3)},error:function(e){console.log("getCreditsLeft error",e),ke(e.Message)},complete:function(){busy=!1,C.removeClass("busy")}})},error:function(e){C.removeClass("busy"),ke(e.Message)}};M?c.buyCreditsWithoutCard(o):(o.data={Token:e,CardId:a.id,Last4:a.last4,Brand:a.brand,Plan:t,Name:n},c.buyCredits(o))}return C.find(".loading-animation").html(g.spinner),g.reg(C,C.find(".icon-Close, .no"),function(){T&&"function"==typeof T&&T()}),i.find(".no").click(function(){C.find(".popup-content").removeClass("success"),g.close(),oe||f.reloadWithoutHash()}),C.find(".icon-Close").click(function(){$("body").removeClass("fullScreenPopupOpen"),C.find(".popup-content").removeClass("success"),g.close(),oe||f.reloadWithoutHash()}),t.click(function(){g.billing(1)}),a.click(function(e){var a=0,t=w.data("val"),n=k.val(),o=parseInt(m.find(".item.active").attr("data-value"))||1,i=parseInt(p.find(".item.active").attr("data-value"))||(new Date).getFullYear(),s=u.val(),r=S?"Year":"Month";M=!1,h.removeClass("error"),l.removeClass("show"),m.add(p).removeClass("error"),D.find("span.check").removeClass("error"),D.find("h3").removeClass("error"),console.log("hasCardOnFile",!1),console.log("useCardOnFile",M),M||(Stripe.card.validateCardNumber(t)||(a=1,d.addClass("error")),Stripe.card.validateCVC(n)||(a=1,k.addClass("error")),Stripe.card.validateExpiry(o,i)||(a=1,m.add(p).addClass("error")),s||(a=1,u.addClass("error"))),F||(a=1,D.find("h3").addClass("error"),D.find("span.check").addClass("error")),a?ke():(C.addClass("busy"),M?xe():Stripe.card.createToken({number:t,cvc:n,exp_month:o,exp_year:i,name:s},function(e,a){if(a.error)C.removeClass("busy"),ke(a.error.message);else{var t=a.card;xe(a.id,t,r,s)}}))}),function(e,p,f,h){S=!0,T=e,C.addClass("busy").find(".popup-content").removeClass("success"),p||!1,C.find(".filter-popup-menu").hide(),b.loadStripe(function(){b.getData(1,function(e,a,t,n){I=e,C.removeClass("busy"),C.find(".msg").toggleClass("hidden",!a).find(".time").text(n),x.data("plus",a),x.data("end",n),a&&O.hide(),C.find(".plan-cont").removeClass("current"),console.log("free?",b.isFree()),console.log("pro?",b.isProBusiness()),console.log("business?",b.isBusiness());var o=$("#tmp-compare-plans");N.find(".cont-compare-plans-full").html(o.html());var i=N.find(".cont-compare-plans-full"),s=i.find(".btn-pro"),r=i.find(".btn-biz"),l=i.find(".btn-free-dg"),d=i.find(".note-free-curr"),c=$(window);ne.find(".table__instructions").removeClass("is-hidden"),$(document).on("change","#tmp-payment #compare-plans-wrapper .checkbox input",function(){var e=$(this);console.log("compare-plans checkbox change ",e,e[0],e.is(":checked")),e.is(":checked")?i.find(".checkbox .checkbox__pill").removeClass("active"):i.find(".checkbox .checkbox__pill").addClass("active"),$(this).is(":checked")?(N.find(".cont-compare-plans-full .yearly-price").show(),N.find(".cont-compare-plans-full .monthly-price").hide()):(N.find(".cont-compare-plans-full .yearly-price").hide(),N.find(".cont-compare-plans-full .monthly-price").show())}),c.on("orientationchange resize load",function(){c.width()<830&&ne.find(".table__head").css("height","auto"),le()}),!0===b.isOldFreeUserNeverOnTrialOrPlan()?(s.text("Start 7-Day Trial"),r.text("Start 14-Day Trial")):(s.text("Select Pro"),r.text("Select Business")),s.click(function(e){N.find(".upg-button[data-plan=pro]").click()}),r.click(function(e){N.find(".upg-button[data-plan=business]").click()}),i.find(".choose-free").click(be),i.find(".btn-credits, .btn-creds").click(function(e){e.preventDefault(),se||Ce("credits")}),v.isTrial||!v.isTrial&&!v.trialConverted?l.click(function(e){e.preventDefault(),g.push(C),g.confirmDowngradePopup("cancel")}):(x.text("Try it FREE"),O.text("No credit card required. Cancel any time."),me(),A.hide(),N.show(),x.show(),O.show(),L.show()),W.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),X.mask("0000"),w.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),k.mask("0000"),Z.mask("00/0000",{placeholder:"mm/yyyy"}),v.isTrialCanceled&&(l.addClass("disabled"),N.find(".popup-cta.free").addClass("disabled"));var u=_.find(v.UserTeams,{Role:1});if(b.isFree()?(N.find(".plan-cont:eq(1)").addClass("current"),l.hide(),d.css({display:"inline-block"})):u&&u.Plan&&-1!==u.Plan.toString().indexOf("Pro")?B="pro":u&&u.Plan&&-1!==u.Plan.toString().indexOf("Business")&&(B="business"),2==e.ST||11==e.ST||9==e.ST?S=!0:0!=e.ST&&(S=!1),v.ReActivationData&&v.ReActivationData.LastPlan||0===v.autoRenew&&!v.isTrialCanceled&&v.trialConverted&&(0!==v.Team.ST&&void 0!==v.Team.ST||u&&0!==u.ST)){console.log("==== UPGRADE FLOW: REACTIVATE ===="),!0,A.find(".reactivate").show(),A.find(".normal-flow").hide();var m=v.ReActivationData.LastPlan||v.Team.Plan;-1!==(m=m.toString().toLowerCase()).indexOf("business")?B="business":-1!==m.indexOf("pro")&&(B="pro"),A.find(".trial-flow").show(),A.find(".upg-flow").hide(),te.find(".trial-flow").show(),te.find(".upg-flow").hide(),R=-1!==m.indexOf("year")?"yearly":"monthly",A.find("input[type=radio][value="+R+"]").click()}else console.log("==== UPGRADE FLOW: NORMAL ===="),A.find(".normal-flow").show(),A.find(".reactivate").hide(),!v.isTrial&&v.trialConverted&&1===v.autoRenew?(G=!0,A.find(".trial-flow").hide(),A.find(".upg-flow").show(),te.find(".trial-flow").hide(),te.find(".upg-flow").show()):(A.find(".trial-flow").show(),A.find(".upg-flow").hide(),te.find(".trial-flow").show(),te.find(".upg-flow").hide());E.hide(),P.hide(),f?(S=f.isYearly,y=f.planName,Ce(f.planName)):(me(),ue(R,".cont-upgrade-panel input[type=radio]"),"string"==typeof p&&"signUpMode"===p&&(C.addClass("signUpMode"),se=!0,s.text("Choose Pro"),r.text("Choose Business"),"string"==typeof h&&(B=h)),A.find("input[type=radio][value=yearly]").click(),R="yearly",S=!0,"string"==typeof T&&"showPlans"===T?"string"==typeof p&&"signUpMode"===p?pe(p):pe():ge())})}),b.isAdmin()||b.isTeamMember()||b.isPremiumGuest()||b.isSingleFolioGuest()?window.location="/":g.show(C,"showPlans"===T?"seeplans":"billing")}},app.popup.getSettings=function(e,s,r,a,l,t){var d=0,n=$("#tmp-settings"),o=n.find(".tabs > span"),i=n.find(".tab"),c=n.find(".save"),u=n.find(".icon-Close , .cancel"),m=n.find(".email-text").val(s.userEmail),p=n.find(".full-n").val(s.fullName),f=n.find(".current-pass"),h=n.find(".new-pass"),g=n.find(".repeat-pass"),v=n.find(".msg"),b=n.find(".downgrade-upgrade");function T(e,a){a=a||"success",v.text(e).addClass(a),setTimeout(function(){v.removeClass("success error")},3e3)}return o.on("click",function(){var e=$(this).addClass("selected");o.not(e).removeClass("selected"),d=e.index(),v.text(""),i.removeClass("selected").filter(":eq("+d+")").addClass("selected")}),c.on("click",function(){switch(v.text("Saving ...").attr("class","msg"),d){case 1:(i=$.trim(m.val()))?i!=s.userEmail?validator.isEmail(i)?l.changeEmail({email:i,success:function(){T("Email saved."),s.userEmail=i},error:function(e){T(e.Message,"error")}}):T("Invalid email.","error"):T("Email saved"):T("Email cannot be empty.","error");break;case 2:a=f.val(),t=h.val(),n=g.val(),o="",a||(o+="<p>Please provide your current password.</p>"),(!t||t.length<8)&&(o+="<p>New Password must be at least 8 characters long.</p>"),t!=n&&(o+="<p>New password and password confirm do not match</p>"),o?v.addClass("error").html(o):l.changePassword({oldPassword:a,newPassword:t,confirmPassword:n,success:function(){T("Password saved")},error:function(e){T(e.Message,"error")}});break;default:(e=$.trim(p.val()))?e!=s.fullName?/[^a-zA-Z0-9\s\-\/]/.test(e)?T("Name Cannot Have Special characters","error"):l.changeFullName({fullName:e,success:function(){s.fullName=e,T("Name saved."),r.raiseEvent("nameChanged")},error:function(e){T(e,"error")}}):T("Name saved"):T("Name cannot be empty.","error")}var e,a,t,n,o,i}),n.find(".popup-footer .contact span").click(function(){window.Intercom&&window.Intercom("showNewMessage","Email: ("+s.userEmail+") I would like to DELETE my account and data.")}),e.reg(n,u),function(){v.removeClass("error success"),t.isOwner()||b.hide(),e.show(n),a.doSetFocus(p)}},app.popup.getSignIn=function(n,o,i,s){var r=$("#tmp-sign-in"),e=r.find(".popup-header"),a=r.find(".sign-up"),t=r.find(".forgot-btn"),l=r.find(".msg"),d=r.find(".sign-in"),c=r.find("form"),u=c.find(".email"),m=c.find(".pass"),p=r.find(".actions"),f=r.find(".popup-cta.ok"),h=r.find(".select"),g=!1,v=!1;h.on("click",function(){$(this).toggleClass("selected").parent().toggleClass("selected")}),l.on("click",".resend",function(e){return l.html("Resending verification email. Please wait.").attr("class","msg"),s.resendEmail({email:u.val(),success:function(){l.html("Verification email was resent.").attr("class","msg success")},error:function(){l.html("There was an error. Check your connection and try again.").attr("class","msg error")}}),!1}),"EmailConfirm"==o.loginState?(e.html('<h1>Email address confirmed.</h1><h3 class="message" style="font-size: 20px;">Please sign in to pick up where you left off.</h3>'),p.remove()):"PassReset"==o.loginState?(e.html('<h1>Password was reset.</h1><h3 class="message" style="font-size: 20px;">Please sign in to continue.</h3>'),p.remove()):e.html("<h1>Sign In</h1>"),a.on("click",function(){window.history.pushState("","","/account/signup"),n.signUp()}),t.on("click",function(){return n.forgotPass(u.val()),!1});var b=function(e){l.text(e).addClass("error").show("slow"),setTimeout(function(){l.removeClass("error").hide("slow")},5e3)};return c.submit(function(e){var a=u.val(),t=m.val(),n="";return g&&(n=o.token),a||t?validator.isEmail(a)?!t||t.length<8?b("Password must be at least 8 characters long."):!validator.isEmail(a)&&!t||t.length<8?b("Please provide a valid email and Password."):v||(v=!0,d.prop("disabled",!0),s.signIn(a,t,h.hasClass("selected"),function(e){window.location=e.Message||"/"},function(e){d.prop("disabled",!1),v=!1,l.attr("class","msg error"),3==e.StatusCode?l.html('Please first verify your email address. <a href="#" class="resend">Resend verification email.</a>'):l.html("Email or password was not valid. Please try again.")},n)):b("Please provide a valid email."):b("Email and Password cannot be Blank."),!1}),f.on("click",function(){c.submit()}),r.on("keyup.sign-in",function(e){13==(e.keyCode||e.which)&&f.click()}),o.Team&&0!=o.Team.Id&&(e.html("<h1>Sign in to "+o.Team.Name+"</h1><p>"+o.Team.TeamUrl+"</p>"),r.addClass("is-team")),n.reg(r),function(e,a,t){a,g=!!t,n.show(r),i.doSetFocus(u)}},app.popup.getSignUp=function(u,m,p,f,h,e,a){var t=$("#xtensio-refer-info"),n=t.length,o=$("#tmp-sign-up"),i=o.find(".sign-in"),s=(o.find(".pending-invite"),o.find(".msg")),g=o.find(".popup-cta"),r=o.find(".popup-cta.ok"),l=o.find("form"),v=l.find(".email").val(m.userEmail),b=l.find(".name").val(m.fullName),T=l.find(".pass"),y=l.find(".coupon"),d=o.find(".popup-header"),C=!1;if("True"==m.isInvite&&(v.val(m.inviteEmail),v.prop("readonly",!0),v.css({"background-color":"#f0f0f0"}),b.val(m.inviteFullName)),(n||h)&&o.find(".sign-in-container").hide(),n&&(o.find(".xtensio-agreement").append(t.find(".agreement")),o.find(".xtensio-refer-info").append(t.find("> a, .list")),d.after(d.find("h2")),d.append(t.find(".name-sender"))),h){var c=o.find(".popup-content");d.html(e.PopupTitle).css("padding-top","35px"),g.text(e.SubmitText),c.before(e.Header),c.after(e.Footer),$("head").append('<style type="text/css">'+e.Css+"</style>")}m.getCoupon&&y.removeClass("hidden");var w=function(e){s.text(e).addClass("error").show("slow"),setTimeout(function(){s.removeClass("error").hide("slow")},5e3)};return i.on("click",function(){window.history.pushState("","","/account/signin"),"true"==m.EditTemplate?u.signIn(!1,null,!0):u.signIn()}),l.submit(function(e){var a=T.val(),t=v.val(),n=b.val(),o=y.val(),i="";C&&(i=m.token);var s=p.getUrlVars(),r=s.plan?s.plan.toString():"",l=s.promo?s.promo.toString():"";if(n||t||a)if(!n||n.length<3||/[^a-zA-Z0-9\s\-\/]/.test(n))w("Please provide Valid  name.");else if(t&&validator.isEmail(t))if(!a||a.length<8)w("Password must be at least 8 characters long.");else if(m.getCoupon&&!o)w("Please provide activation code.");else{g.prop("disabled",!0);var d={Email:t,Password:a,FullName:n,coupon:o,campaign:h,FolioToken:i,Plan:r,Discount:l},c=document.location.href;c=c.toLowerCase(),m.isTeam?f.TeamSignUp(d,function(){u.message({heading:"All set!",message:"Your account is successfully created.",btnText:"Go To Your Dashboard",noClose:!0,bodyCentered:!0,notMini:!0,handleOK:function(){m.Team&&(window.location=m.baseUrl)}})},function(e){e.StatusCode&&15===e.StatusCode?e.Message&&(window.location.href=e.Message):(g.prop("disabled",!1),w(e.Message))}):f.signUp(d,function(){"True"==m.isInvite?window.location="/":u.signUpDone(t)},function(e){7==e.StatusCode?u.message({heading:"You have a pending invitation",message:e.Message,btnText:"OK",notMini:!0,handleOK:function(){window.location="/"}}):w(e.Message),g.prop("disabled",!1)})}else w("Please provide a valid email.");else w("Fields cannot be left Blank.");return!1}),r.on("click",function(){l.submit()}),$(document).on("keyup.submit_on_enter",function(e){13==(e.keyCode||e.which)&&r.click()}),u.reg(o),function(e){y.val("");try{var a=new URL(location.href).searchParams.get("email")}catch(e){if("TypeError"==e.name){var t=window.location.href.match(new RegExp(/email=([^&]*)/));a=t?t[1]:""}}"False"==m.isInvite&&v.val(a),C=!!e,u.show(o),p.doSetFocus(b)}},app.popup.getSignUpDone=function(a,e,t){var n=$("#tmp-sign-up-done"),o=n.find(".msg"),i=n.find(".email"),s=n.find(".popup-cta");return s.on("click",function(){s.attr("disabled",!0),o.html("Re-sending verification email. Please wait ...").removeClass("success error"),t.resendEmail({email:i.text(),success:function(){s.attr("disabled",!1),o.html("The verification email was re-sent.").addClass("success")},error:function(){s.attr("disabled",!1),o.html("Could not connect to the server. Please try again.").addClass("error")}})}),a.reg(n),function(e){i.text($.trim(e)),a.show(n)}},app.popup.getSignUpDoneInvited=function(e,a,t){var n=$("#tmp-sign-up-done-invited"),o=(n.find(".msg"),n.find(".popup-cta"));return e.reg(n),o.on("click",function(){return e.signIn(),!1}),function(){e.show(n)}},app.popup.getSignupPlansPopup=function(e,t,a,n,o,i){var s=$("#tmp-signup-plans"),r=s.find(".cancel, .popup-close, .icon-Close"),l=s.find(".loading-animation").html(t.spinner);return r.click(function(){t.close()}),s.find(".item-faq .i-btn, .item-faq .text").click(function(){var e;e=$(this).parent(),$that=e.find(".i-btn"),e.find(".item-full").slideToggle(200,function(){$(this).is(":visible")?($that.html('<i class="fa fa-minus-circle"></i>'),s.find(".item-full").not($(this)).slideUp(400,function(){$(this).parent().find(".i-btn").html('<i class="fa fa-plus-circle"></i>')})):$that.html('<i class="fa fa-plus-circle"></i>')})}),t.reg(s,r),function(){var e=window.location.href.toString(),a="https://www.localhost.com:44301";-1!==e.indexOf("xtensio.com")?a="https://app.xtensio.com":-1!==e.indexOf("xtensio.tech")&&(a="https://app.xtensio.tech"),s.find(".plan-cont.middle .popup-cta.pro").attr("href",a+"/teams/create/?plan=promonth"),l.hide(),t.show(s)}},app.popup.getSignUpTeam=function(n,o,i,e,a,t){var s,r=$("#tmp-sign-up-team"),l=r.find(".btn-next-trial"),d=r.find(".loading-animation").html(n.spinner),c=r.find(".change-logo"),u=(r.find(".icon-Close"),r.find("#uploadimage-form")[0]),m=(r.find("span.error"),""),p="",f="month",h=!1;r.find(".uploader").change(function(){var e=this.files&&this.files[0];e&&(r.addClass("busy"),u=r.find("#uploadimage-form")[0],i.uploadTeamImage(u,e,{type:"logo",isProgress:!1,success:function(e){r.removeClass("busy"),p=e.Message,s=e.Data,$(".team-signup .top-section .team-name").replaceWith('<img id="logo_img" src="'+p+'" title ="'+m+'"/>'),$(".uploaded-logo").replaceWith('<div style="float:left; text-align:center" class="uploaded-logo"><img id="logo_img" src="'+p+'" title ="'+m+'" /><div class="close-icon"><i class="icon-Close"></i></div></div>'),$(".uploaded-logo").removeClass("hidden"),$(".btn-upload").addClass("hidden"),$(".change-logo-cont").removeClass("hidden")}}))}),$(document).on("click",".btn-upload",function(){r.find(".uploader").click()}),$(document).on("click",".icon-Close",function(){p=null,$(".team-signup .uploaded-img").replaceWith('<a class="btn btn-yes btn-upload uploaded-img">Upload Logo</a>'),$("#logo_img").addClass("hidden"),$(".uploaded-logo").addClass("hidden"),$(".change-logo-cont").addClass("hidden")}),c.click(function(){r.find(".uploader").click()}),$("input#team_name").on("input",function(){var e=$(this),a=e.val(),t=/^[a-zA-Z\d-_ ]+$/,n=t.test(e.val()),o=a.replace(/[^a-z0-9]/gi,"");n?e.removeClass("invalid").addClass("valid"):e.removeClass("valid").addClass("invalid"),a.length<3?(e.removeClass("valid").addClass("invalid"),g(r.find("input#team_name"),"Name must be at least 3 characters long.")):a.match(t)?g(r.find("input#team_name"),""):(e.removeClass("valid").addClass("invalid"),g(r.find("input#team_name"),"Names may contain only alphabetical and numerical values, hyphens and underscores.")),$("#team_url").val(o)}),$("#team_url").on("input",function(){var e=$(this);/^[0-9a-zA-Z]+$/.test(e.val())?e.removeClass("invalid").addClass("valid"):e.removeClass("valid").addClass("invalid");var a=e.val();a.length<3?(r.removeClass("busy"),g(r.find("input#team_url"),"A url must be at least 3 characters long.")):a.match(/^[0-9a-zA-Z]+$/)?g(r.find("input#team_url"),""):(r.removeClass("busy"),g(r.find("input#team_url"),"URL may only contain alphabetical and numerical values."))});var g=function(e,a){var t=e.hasClass("valid"),n=$("span",e.parent());clearTimeout(h),t?(n.css("visibility","hidden"),n.removeClass("error_show",1e3,"easeOutSine")):(n.stop(!0,!0),r.removeClass("busy"),n.text(a).show(),n.css("visibility","visible"),n.addClass("error_show",1e3,"easeOutSine"),h=!1,h=setTimeout(function(){n.css("visibility","hidden"),n.removeClass("error_show",1e3,"easeOutSine")},5e3)),d.hide()};$(document).on("keydown","form",function(e){return"Enter"!=e.key}),l.click(function(e){d.show(),r.addClass("busy"),m=r.find("input#team_name").val();var a=r.find("input#team_url").val().toLowerCase(),t=r.find("input#team_name").val().toLowerCase();t.length<3?($("#team_name").removeClass("valid").addClass("invalid"),g(r.find("input#team_name"),"Name must be at least 3 characters long.")):t.match(/^[a-zA-Z\d-_ ]+$/)||($("#team_name").removeClass("valid").addClass("invalid"),g(r.find("input#team_name"),"Names may contain only alphabetical and numerical values, hyphens and underscores."));a.length<3?(r.removeClass("busy"),$("#team_url").removeClass("valid").addClass("invalid"),g(r.find("input#team_url"),"A url must be at least 3 characters long.")):a.match(/^[0-9a-zA-Z]+$/)?i.checkTeamURL({data:{teamUrl:a},success:function(e){console.log("res???",e.Data),1==e.Data?($("#team_url").removeClass("valid").addClass("invalid"),g(r.find("input#team_url"),"This url is already taken. Please choose another Url."),r.removeClass("busy")):("live"==o.Environment?a+=".xtensio.com":"dev"==o.Environment?a+=".xtensio.tech":"local"==o.Environment&&(a+=".localhost.com:44301"),function(e,a){r.addClass("busy");var t=[];i.purchaseTeam({data:{teamInfo:{Id:0,Name:e,LogoUrl:p,TeamUrl:a,Status:1,OwnerEmail:"",TeamMembers:t,ImageID:s,TeamFonts:[]},billingInfo:{plan:v(),MembersCount:t.length,Trial:!0}},success:function(e){console.log(e),n.teamManagePopup({mode:"signUp",data:e.Data})},error:function(e){g(r.find("input#gen_error"),e.Message)}})}(m,a))},error:function(e){console.log("error: ",e)}}):(r.removeClass("busy"),$("#team_url").removeClass("valid").addClass("invalid"),g(r.find("input#team_url"),"URL may only contain alphabetical and numerical values."))});function v(){return"promonth"===f.toLowerCase()?"ProMonth":"BusinessMonth"}return n.reg(r),function(){if("#managepeople"!==window.location.hash){f="BusinessMonth";var e=t.getUrlVars();console.log("params",e),e.plan&&-1!==e.plan.toString().indexOf("promonth")&&(f="ProMonth"),console.log("preplan",f),checkOut=!e.checkout,d.hide(),a.loadStripe(function(){console.log("Signing up ",v()),-1<window.location.hostname.search(/app\.xtensio/g)&&!1===$("body").hasClass("team-signup")&&$("body").addClass("team-signup"),n.show(r)})}else n.teamManagePopup({mode:"signUp",data:JSON.stringify(o.Team)})}},app.popup.getAddFolioToSpace=function(n,o,i,e,a){var t=$("#tmp-add-folio-to-space"),s=t.find(".no-show"),r=t.find(".cancel, .icon-Close"),l=t.find(".teams"),d=null,c=null,u=e.getActiveUserTeams(n.UserTeams);function m(a,e,t){console.log("on addFolioId func on addFolioToSpace popup"),console.log("id name url",a,e,t),console.log("fToken fName",d,c),i.getWorkspaceChannels({teamId:a||n.lastTeamId,success:function(e){console.log("response from getWorkspaceChannels on addFolioToSpace popup",e),o.close(),n.saveFolioEditPreview={teamId:a||n.lastTeamId,FolioName:c,Token:d,labels:JSON.parse(e.Data),isUseTemplate:!0},o.saveFolio()},error:function(e){console.log("error",e)}})}function p(e,a,t){return function(){console.log("getFolioToIdFunc func..."),m(e,a,t)}}if(t.find(".loading-animation").html(o.spinner),u&&n.Team)for(var f=$(s.html()),h=0;h<u.length;h++)5!=u[h].Role&&(f=$(s.html()),4!=u[h].Role&&5!=u[h].Role||(f.find("h3").hide(),f.find(".left").hide(),f.find(".right").hide(),f.find("h3").text(u[h].Name).hide()),f.find("h3").text(u[h].Name),console.log("userTeams[i].Id ",u[h].Id),f.on("click",p(u[h].Id,u[h].Name,u[h].TeamUrl)),l.append(f));return o.reg(t,r),function(e,a){console.log(e,a),c=a,d=e,console.log("==== userteams",u),1<u.length?o.show(t):1==u.length?m(u[0].Id,u[0].Name,u[0].TeamUrl):m(0,"","")}},app.popup.getArchivePopup=function(o,n,i){var s,r,l=$("#tmp-leave-popup"),e=l.find(".popup-content"),d=l.find(".loading-animation"),c=l.find(".archive-section"),u=l.find(".leave-section"),m=u.find("select"),a=u.find(".btn.ok"),t=u.find("input"),p=l.find(".leave-single-section .btn.ok"),f=l.find(".leave-sfg-section .btn.ok"),h=null;function g(){l.removeClass("sfg-leave");var n=0;m.empty(),$.each(s.Collaborators,function(e,a){if(0<a.Privilege&&a.Privilege<3&&a.Accepted){var t=$("<option></option>");if(t.val(a.Email).text(a.FullName),o.Team&&0<o.Team.Id)(function(e){if(h)for(var a=0;a<h.length;a++)if(h[a].Email==e)return h[a].Role;return 0})(a.Email)<4&&m.append(t);else m.append(t);n++}}),0<n?(e.hasClass("single")&&e.removeClass("single"),o.Team&&0<o.Team.Id&&5==o.Team.Role?(console.log("in team"),e.addClass(s.Role<3?"single":"").removeClass("archive leave"),l.addClass("sfg-leave"),l.find(".leave-sfg-section").find(".msg .team").text(o.Team.Name)):e.addClass("leave "+(s.Role<3?"single":"")).removeClass("archive")):e.addClass("archive").removeClass("leave single"),t.prop("checked",""),a.prop("disabled",!0).text("Leave Folio")}return d.html(n.spinner),c.find(".btn.ok").click(function(){n.busy(),i.deleteFolio({data:{token:s.Token},success:r,error:function(e){n.error("There was an error. Please refresh page and try again.")}})}),m.on("change",function(){$(this).closest("label").find("input").click()}),t.click(function(){a.prop("disabled","").text("archive"==$(this).val()?"Delete Folio":"Transfer Folio")}),a.click(function(){if("archive"==u.find("input:checked").val())c.find(".btn.ok").click();else{d.show();var e=m.find("option:checked"),a=e.val(),t=e.text();i.transfer({data:{token:s.Token,name:t,email:a},success:function(){d.hide(),n.message({heading:"Transfer Requested",message:"Folio transfer request has been sent to "+t+".<br/>Folio will be transfered once they accept.",btnText:"OK",handleOK:function(){n.close()}})},error:function(e){n.error(e.Message||"There was an error. Please try later.")}})}}),f.click(function(){i.removeSingleFolioGuest({data:{userEmail:o.userEmail,teamId:o.Team.Id},success:function(){var e="";"live"==o.Environment?e="https://app.xtensio.com/#dashboard":"dev"==o.Environment?e="https://app.xtensio.tech/#dashboard":"local"==o.Environment&&(e="https://www.localhost.com:44301/#dashboard"),window.location=e},error:function(e){showStatus(e.Message,"error")}})}),p.click(function(){d.show(),i.changeCollaborator({data:{verb:"drop",role:s.Role,token:s.Token,email:o.userEmail},success:function(){window.location.href="/"},error:function(e){d.hide(),n.error(e.Message)}})}),n.reg(l,l.find(".icon-Close, .btn.no")),function(a,t){h=null,o.Team&&0<o.Team.Id?(d.show(),i.listTeamMembers({data:{teamId:o.Team.Id},success:function(e){d.hide(),h=e.Data.Data,s=a,r=t,g(),n.show(l)},error:function(e){d.hide()}})):(s=a,r=t,g(),n.show(l))}},app.popup.getBusyPopup=function(t){var n=$("#tmp-busy");n.find(".busy, .anim").html(t.spinner);var o,i,s=n.find(".message"),r=n.find("h1"),l=n.find(".msg"),d=n.find(".anim");return t.reg(n),function(e,a){i=a||"",(o=e||"")?(d.hide(),s.show(),r.text(o),l.text(i).show()):(s.hide(),d.show()),t.show(n)}},app.popup.getCollaboratorsPopup=function(c,r,l,u,i,e,s){var m,d,p={main:1,notUser:2,aUser:3,pendingUser:4,sfgUser:5},f=$("#tmp-single-person"),h=$("#tmp-collaborators-popup"),o=h.find(".toggle"),n=h.find(".changes-applied"),g=$("#tmp-single-recent"),v=$(".recently-added"),b=h.find(".header-collaboration-blocker"),T=h.find(".popup-content"),y=T.find(".list"),C=y.find(".owner-list"),w=y.find(".folio-collab-list"),k=y.find(".channel-collab-list"),x=T.find(".selected"),P=x.find(".a-user"),S=x.find(".not-user"),D=x.find(".sfg-user"),F=h.find(".loading-animation"),I=h.find("#collab-search"),M=I.find("#collab_search"),a=h.find(".search-btn"),E=h.find(".popup-header h1.am-h .team"),U=h.find(".popup-header p.am-h .email"),N=h.find(".popup-header h1.sfg-h"),A=h.find(".popup-header p.sfg-h"),L=h.find(".popup-header p.pro-rated"),O=h.find(".success-panel p.pro-rated"),R=h.find(".team-add"),B=h.find(".add-team-member"),t=h.find(".add-team-member"),Y=t.find(".custom-msg"),G=t.find(".msg-content .icon-Close"),H=h.find(".back-button"),z=!0,q=!1,K=!1,j="",V="",J=0,W=null,X=[],Q=!1,Z=app.core.padlocks(i,e,c);i.isFreeWithTeam()&&(L.addClass("hidden-on-free"),O.addClass("hidden-on-free")),a.on("click",function(){z&&q||i.showUpgradePopup()}),i.getData(1,function(e,a,t,n){e=null==e?{}:e,console.log("data.ST",e.ST),14!==e.ST&&19!==e.ST||!0,c.Team&&0<c.Team.Id&&4!==c.Team.Role&&5!==c.Team.Role&&(q=!0),i.hasTeam()?(i.isSingleFolioGuest()||i.isPremiumGuest())&&(tip="Guests can not add collaborators.",z=!1):(i.isFree()||i.isPlus())&&(z=!1),Z.setCollaboratorLocks(h,z)},!0);if(b.find("a.btn").on("click",function(e){e.preventDefault(),window.location.hash="seeplans"}),Y.click(function(){t.find(".msg-content").show("slow")}),G.click(function(){t.find(".msg-content").hide("slow")}),B.find(".invite-confirm").click(function(){var e=B.find(".block:eq(1) .left input").val(),a=B.find(".block:eq(1) .right input").val(),t=B.find(".block:eq(2) .role .popup-menu .item.active").data("value"),n=B.find(".opts .msg-content textarea").val();validator.isEmail(e)?(F.show(),se(e,a,t,n)):oe("Please provide an valid email address.","error",1)}),c.recentCollaborators)for(var ee=0;ee<c.recentCollaborators.length;ee++)!c.recentCollaborators[ee].Email&&c.recentCollaborators[ee].FullName&&(c.recentCollaborators[ee].Email=c.recentCollaborators[ee].FullName);function ae(e,a,t,n){switch(h.removeClass("belong-to-team"),j=a?l.standardizeEmail(a.email):"",x.removeClass("not-user"),h.removeClass("team-deny-non-xtensio add-paidmem add-guest add-sfg-upgrade"),x.find(".not-user input.email").attr("readonly",!1),O.addClass("hidden"),function(e){switch(e){case p.main:T.removeClass("selected"),h.find(".popup-header h1.am-h").removeClass("hidden"),h.find(".popup-header p.am-h").removeClass("hidden"),E.removeClass("hidden"),U.removeClass("hidden"),h.find(".popup-header h1.sfg-h").addClass("hidden"),h.find(".popup-header p.sfg-h").addClass("hidden"),N.addClass("hidden"),A.addClass("hidden");break;case p.sfgUser:de(V);var a,t=le();a=22==c.Team.ST||28==c.Team.ST?"You will be charged $"+t+"/year/user. Our payments are non-refundable.":"You will be charged $"+t+"/mo/user. Our payments are non-refundable.",D.find(".msg-mem").html(a),h.find(".popup-header h1.am-h").addClass("hidden"),h.find(".popup-header p.am-h").addClass("hidden"),E.addClass("hidden"),U.addClass("hidden"),h.find(".popup-header h1.sfg-h").removeClass("hidden"),h.find(".popup-header p.sfg-h").removeClass("hidden"),N.removeClass("hidden"),A.removeClass("hidden")}}(e),e){case p.main:d&&H.removeClass("hidden"),T.removeClass("selected"),L.addClass("hidden");break;case p.notUser:d&&H.addClass("hidden"),T.addClass("selected"),L.addClass("hidden"),c.Team&&0!=c.Team.Id&&!t.teamMember?(Z.teamAddLocks(R,r,c),n?(h.addClass(n),"add-paidmem"===n&&(L.removeClass("hidden"),O.removeClass("hidden")),x.find(".username").text(V)):h.addClass("add-mem"),E.text(c.Team.Name),U.text(a.email),R.find(".email").text(j),R.find(".team").text(c.Team.Name),x.find(".email").val(V),x.find(".full-name").val(""),x.addClass("not-user").removeClass("a-user pending-user sfg-user"),x.find(".not-user input.email").attr("readonly",!0)):(x.find(".email").val(j),x.addClass("not-user").removeClass("a-user pending-user sfg-user"));break;case p.aUser:d&&H.addClass("hidden"),T.addClass("selected"),L.addClass("hidden"),c.Team&&0!=c.Team.Id&&!t.teamMember?(Z.teamAddLocks(R,r,c),n?(h.addClass(n),x.find(".username").text(V),"add-paidmem"===n&&(L.removeClass("hidden"),O.removeClass("hidden"))):h.addClass("add-mem"),E.text(c.Team.Name),U.text(j),R.find(".email").text(j),R.find(".team").text(c.Team.Name),T.addClass("selected"),x.find(".email").val(V),x.addClass("a-user").removeClass("not-user pending-user sfg-user"),x.find(".a-user input.email").attr("readonly",!0)):(c.Team&&0!=c.Team.Id&&t.teamMember&&(h.addClass("belong-to-team"),x.find(".team-role").text(" ("+t.RoleName+")"),x.find(".acc-lvl-txt").hide()),x.data("email",j).find(".username").text(a.name||j),x.find(".email").val(j),x.addClass("a-user").removeClass("not-user pending-user sfg-user")),P.show();break;case p.pendingUser:d&&H.addClass("hidden"),T.addClass("selected"),L.removeClass("hidden"),x.data("email",j).find(".username").text(a.name||j),x.addClass("pending-user").removeClass("not-user a-user sfg-user");break;case p.sfgUser:if(d&&H.addClass("hidden"),T.addClass("selected"),L.addClass("hidden"),c.Team&&0!=c.Team.Id&&!t.teamMember){if(2<c.Team.Role)return void r.teamUserActionBlocked("existing-sfg");n?(h.addClass(n),x.find(".username").text(V)):h.addClass("add-mem"),A.text(a.email),R.find(".email").text(j),R.find(".team").text(c.Team.Name),x.find(".email").val(V),x.find(".full-name").val(""),x.addClass("not-user").removeClass("a-user pending-user sfg-user"),x.find(".not-user input.email").attr("readonly",!0)}else{if(2<c.Team.Role)return void r.teamUserActionBlocked("existing-sfg");x.find(".email").val(j),x.addClass("sfg-user").removeClass("not-user pending-user a-user")}c.Team&&0!=c.Team.Id&&t.teamMember&&(h.addClass("add-sfg-upgrade"),x.find(".team-role").text(" ("+t.RoleName+")"),x.find(".acc-lvl-txt").hide()),x.data("email",j).find(".username").text(a.name||j),x.find(".email").val(j),x.addClass("sfg-user").removeClass("not-user pending-user a-user")}}function te(e){x.addClass(e),ne("",{email:V},e)}function ne(n,o,i){if(n!=p.main&&(F.show(),P.hide()),I.find("input").val(""),h.removeClass("add-mem add-sfg contact-supp non-user-add add-sfg-upgrade"),c.Team&&o&&0!=c.Team.Id){var s=l.standardizeEmail(o.email),t=p.notUser;u.getMember({data:{teamId:c.Team.Id,email:s},success:function(e){if(e.Data.Data.Email)teamUser=e.Data.Data,console.log("teamRole 405??",teamUser.Role),t=5===teamUser.Role?p.sfgUser:me(s)&&!K?p.pendingUser:p.aUser,n=t,console.log("onTeam view ??",n),u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){var a=e.Data.Data.members,t={isXUser:!0,teamMember:!1};a.forEach(function(e){l.standardizeEmail(e.Email)===s&&(t.teamMember=!0,t.RoleName=e.RoleName,t.Role=e.Role)}),c.Team&&4===c.Team.Role&&!t.teamMember&&r.teamUserActionBlocked("non-team-member","Premium Guests"),ae(n,o,t,i),h.find(".loading-animation").hide()},error:function(e){h.find(".loading-animation").hide()}});else{var a={teamMember:!1,RoleName:"",Role:0,isXUser:!1};ae(n=p.notUser,o,a,i),F.hide()}},error:function(e){console.log("getMember err??",e.Message),F.hide()}})}else ae(n,o,null,i),F.hide()}function oe(e,a,t){a=a||"success",F.hide(),t||ne(p.main),n.removeClass("hidden success error").addClass(a).text(e),setTimeout(function(){n.addClass("hidden")},3e3)}function ie(e,a){u.addCollaborator({data:e,success:a,error:function(e){10==e.StatusCode||oe(e.Message,"error")}})}function se(s,r,l,d){setTimeout(function(){if(h.hasClass("belong-to-team"))ie({name:r,token:m.Token,role:l,email:s,message:d},function(e){F.hide(),oe("A request has been sent to "+r),pe({Email:s,Accepted:null,FullName:r,Privilege:parseInt(l)})});else if(h.hasClass("add-guest")){var e=[],a={email:s,fullName:r,teamId:c.Team.Id,message:d,folioToken:m.Token,accessType:l,role:5};e.push(a),o=e,i=function(e){F.hide(),pe({Email:s,Accepted:null,FullName:r,Privilege:parseInt(l)}),oe(s+" has been added as a Single Folio Guest.")},u.addSingleFolioGuest({data:o,success:i,error:function(e){oe(e.Message,"error")}})}else if(h.hasClass("add-paidmem")||h.hasClass("add-pg")||h.hasClass("add-sfg-upgrade")){h.hasClass("add-paidmem")?3:h.hasClass("add-pg")&&4;e=[],a={email:s,fullName:r,teamId:c.Team.Id,message:d,folioToken:m.Token,accessType:l,role:J};e.push(a),t=e,n=function(e){F.hide(),pe({Email:s,Accepted:null,FullName:r,Privilege:parseInt(l)}),h.find(".success-panel .list-mems span").text(s),h.addClass("success")},u.addMembers({data:{teamMembers:t},success:n,error:function(e){oe(e.Message,"error")}})}var t,n,o,i},10)}function re(){var a=S.find(".full-name").val(),t=S.find(".email").val(),n=S.find(".role").data("value")?S.find(".role").data("value"):2,e=S.find(".msg-area.open").length?S.find("textarea").val():"";if(validator.isEmail(t)){if(X.push({name:a,email:t,role:n}),F.show(),c.Team&&0<c.Team.Id)return console.log("from notUserView??",t),void se(t,a,n,e);ie({name:a,token:m.Token,role:n,email:t,message:e},function(e){F.hide(),oe("A request has been sent to "+a),pe({Email:t,Accepted:null,FullName:a,Privilege:parseInt(n)})})}else oe("Please provide a valid email address.","error",1)}F.html(r.spinner),R.find(".get-in-touch").click(function(){window.Intercom&&window.Intercom("showNewMessage","I would like to add a new team member.")}),R.find(".add-member").click(function(){r.teamManagePopup(!0)}),T.on("click",".pending-user .btn.yes",function(){var e=function(e){for(var a=0;a<m.Collaborators.length;a++)if(l.standardizeEmail(m.Collaborators[a].Email)===e&&0<m.Collaborators[a].Privilege)return m.Collaborators[a];return null}(l.standardizeEmail(x.data("email")));ie({name:e.FullName,email:l.standardizeEmail(e.Email),role:e.Privilege,token:m.Token},function(){oe("An invitation has been sent again to "+e.FullName)})}),T.on("click",".pending-actions .b",function(){var e=$(this),a=e.closest(".person"),t=a.data("person");F.show(),e.text("Sending ...").css("cursor","default"),ie({name:t.FullName,email:t.Email,role:t.Privilege,token:m.Token},function(){F.hide(),e.text("Invitation Sent!"),a.find(".actions").addClass("active"),setTimeout(function(){e.text("Resend Invitation").css("cursor","pointer"),a.find(".actions").removeClass("active")},3e3)})}),x.find(".cancel").click(function(){ne(p.main)}),S.find(".add-collab").on("click",function(){0!=i.isFreeWithTeam()||1!=c.Team.Role&&2!=c.Team.Role?re():r.confirmAddMember(h.find(".popup-header h1.am-h .mem").text(),W.length,function(){r.collaborators(m,function(){h.addClass("show"),h.parent().show(),re()})})}),P.find(".add-collab").on("click",function(){F.show();var a=P.find(".username").text(),t=P.find(".role").data("value")?P.find(".role").data("value"):2,e=P.find(".msg-area.open").length?P.find("textarea").val():"";V=i;var n,o,i=x.find(".email").val()||V;if(d)F.hide(),oe("A request has been sent to "+a),pe({Email:i,Accepted:null,FullName:a,Privilege:parseInt(t)});else{if(c.Team&&0<c.Team.Id)return K&&(n={verb:"",token:m.Token,role:t,email:i},o=function(e){oe("A request has been sent to "+a),pe({Email:i,Accepted:null,FullName:a,Privilege:parseInt(t)})},u.changeCollaborator({data:n,success:o,error:function(e){oe(e.Message,"error")}})),void se(i,a,t,e);ie({token:m.Token,role:t,email:i,message:P.find(".msg-area.open").length?P.find("textarea").val():""},function(e){oe("A request has been sent to "+a),pe({Email:i,Accepted:null,FullName:a,Privilege:parseInt(t)})})}});var le=function(){var e=0;switch(c.Team.ST){case 19:case 25:e=30;break;case 14:case 22:e=300;break;case 31:e=20;break;case 28:e=180}return e};function de(e){u.findUser({email:e,success:function(e){h.find(".popup-header p.sfg-h .username").text(e.Message)},error:function(e){F.hide(),oe(e.Message,"error")}})}var ce=function(e){if(c.TeamRoles)for(var a=0;a<c.TeamRoles.length;a++)if(e===c.TeamRoles[a].Id)return c.TeamRoles[a].Name;return"Error in Team ID"};function ue(a,o,e,t){F.show(),u.changeMemberAccess({userEmail:a,userRole:o,teamId:c.Team.Id,folioToken:e,accessType:t,success:function(e){var t,n;t=a,n=J=o,$.each(W,function(e,a){a&&a.Email==t&&(W[e].Role=n,W[e].RoleName=ce(n))}),s.raiseEvent("collabChange",m),ye(),K=!0,setTimeout(function(){ne(p.aUser,{name:de(a),email:a})},0)},error:function(e){F.hide(),oe(e.Message,"error")}})}function me(e){for(var a=0;a<m.Collaborators.length;a++)if(m.Collaborators[a].Email==e&&!m.Collaborators[a].Accepted&&0<m.Collaborators[a].Privilege)return!0;return!1}function pe(t){var n=l.standardizeEmail(t.Email);if(Faltu(m.Collaborators).find({Email:n}).count())$.each(m.Collaborators,function(e,a){a&&l.standardizeEmail(a.Email)===n&&(m.Collaborators[e].Privilege=t.Privilege,m.Collaborators[e].Accepted=t.Accepted||null)});else{var e=t;m.Collaborators.push(e)}s.raiseEvent("collabChange",m)}function fe(t){$.each(m.Collaborators,function(e,a){a&&a.Email==t.Email&&(m.Collaborators[e].Privilege=0,m.Collaborators[e].Accepted=null)}),s.raiseEvent("collabChange",m),ye()}function he(e,a){e.Email==c.userEmail?c.isHome?$(".folio-item-shell[data-token="+m.Token+"]").find(".delete-folio").click():r.archive(m,function(){window.location.href="/"}):(F.show(),u.changeCollaborator({data:{verb:"drop",role:e.Privilege,token:m.Token,email:e.Email},success:function(){F.hide(),a.remove(),fe(e),e.Accepted?oe((e.FullName||e.Email)+" has been removed from folio."):oe("Invitation for "+(e.FullName||e.Email)+" has been cancelled.")},error:function(e){oe(e.Message,"error")}}))}function ge(i){return function(){var n=!1,o=$(this).closest(".person");if(!d)return c.Team&&c.Team.Id?(F.show(),void u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){e.Data.Data.members.forEach(function(e){var a,t;e.Email==i.Email&&5==e.Role&&(a=i,t=o,u.removeSingleFolioGuest({data:{userEmail:a.Email,teamId:c.Team.Id},success:function(){F.hide(),t.remove(),fe(a),oe((a.FullName||a.Email)+" has been removed from folio.")},error:function(e){oe(e.Message,"error")}}),n=!0)}),!n&&c.Team&&5==c.Team.Role?(r.teamUserActionBlocked("collab"),F.hide()):n||he(i,o)},error:function(e){F.hide(),oe(err.Message,"error")}})):void he(i,o);fe(i)}}function ve(e){if(W)for(var a=0;a<W.length;a++)if(W[a].Email==e)return W[a].Role;return 0}function be(t){var e=9;if(c.Team&&0<c.Team.Id&&(e=ve(t.Email)),0!==t.Privilege&&!1!==t.Accepted){h.find(".popup-header h1.sfg-h").addClass("hidden"),h.find(".popup-header p.sfg-h").addClass("hidden"),N.addClass("hidden"),A.addClass("hidden");var a=t.Privilege<3&&t.Email==c.userEmail,n=$(f.html());if(n.data("person",t).addClass(2<t.Privilege||a?"owner":"collabo").find(".isOwner").text(a?"You":"Owner"),n.addClass(null===t.Accepted&&0<t.Privilege?"pending":""),n.addClass("team-role-"+e).attr("team-role",e),n.find(".name").text(t.FullName||t.Email),n.find(".email").text(t.Email||t.FullName),setTimeout(function(){var a;n.find(".role").trigger("val",["value",t.Privilege]).on("change",(a=t,function(){if(c.Team&&5==c.Team.Role)return r.teamUserActionBlocked("collab"),!1;var e=$(this);u.changeCollaborator({data:{role:e.data("value"),token:m.Token,email:a.Email},success:function(){a.Privilege=e.data("value"),oe((a.FullName||a.Email)+" can "+(1==a.Privilege?"now view only.":"view and edit now."))},error:function(e){oe(e.Message,"error")}})}))},500),n.find(".remove").on("click",ge(t)).attr("data-tip",t.Accepted?2<t.Privilege||a?"Leave Folio":"Remove Collaborator":"Cancel Invitation"),3===t.Privilege)C.append(n),n.find(".actions span.remove").hide();else if(c.Team&&0<c.Team.Id&&c.isDashboard){var o=!1;c.labels.forEach(function(e,a){-1!==e.FolioTokens.indexOf(m.Token)&&-1!==e.ChannelMembers.indexOf(t.Email)&&(o=!0,n.find(".actions span.remove").hide())}),o?k.append(n):w.append(n),0<k.find(".person").length&&y.find(".chan.header").show(),0<w.find(".person").length&&y.find(".folio.header").show()}else w.append(n)}}function Te(e){if(console.log("f on listPersons",e),e){var t=0;C.empty(),w.empty(),k.empty(),y.find("p.header").hide(),$.each(e.Collaborators,function(e,a){0<a.Privilege&&a.Accepted&&t++,a.Privilege=void 0===a.Privilege?1:a.Privilege,be(a)}),t>(c.isHome?0:1)&&y.addClass("hasCollabs"),app.plugin.tooltip(),app.menu.xSelect()}}D.find(".add-collab").on("click",function(){F.show();var e,a,t,n,o=D.find(".role").data("value")?D.find(".role").data("value"):4,i=x.find(".email").val()||V;J=o,V=i,d?(pe({Email:i,Accepted:null,FullName:name,Privilege:parseInt(role)}),F.hide()):c.Team&&0<c.Team.Id&&(e=i,a=o,t=m.Token,n=2,r.push(h),0<c.Team.Id&&(1===c.Team.Role||2===c.Team.Role)?(F.hide(),r.message({heading:"Change Team Member Access ",message:"Do you really want to change access for <b>"+e+"</b> to <b>"+ce(a)+"</b>?",btnText:"Confirm",notMini:!0,cancelText:"Cancel",handleOK:function(){F.show(),ue(e,a,t,n)}})):F.hide())}),I.on("submit",function(e){if(!z)return event.preventDefault(),!1;if(V=l.standardizeEmail(I.find("input").val()),c.Team&&5==c.Team.Role)return r.teamUserActionBlocked("collab"),!1;var t=l.standardizeEmail(I.find("input").val()),n=t,o="";return F.show(),validator.isEmail(t)?i.isTeamMember()&&!ve(t)?r.teamUserActionBlocked("team-member-collab"):u.findUser({email:t,success:function(e){var a=p.notUser;e.Message?(o=e.Message,u.getMember({data:{teamId:c.Team.Id,email:n},success:function(e){teamUser=e.Data.Data,ne(a=5===teamUser.Role?p.sfgUser:me(n)&&!K?p.pendingUser:p.aUser,{name:o,email:t})},error:function(e){console.log("getMember error??",e.Message)}})):u.getMember({data:{teamId:c.Team.Id,email:n},success:function(e){null!=e.Data.Data&&(teamUser=e.Data.Data,console.log("returned result???",teamUser),null==teamUser.Email||0==teamUser.Role||0==teamUser.TeamID||(o=teamUser.FullName||teamUser.UserName,a=p.pendingUser),ne(a,{name:o,email:t}))},error:function(e){console.log("getMember error??",e.Message)}}),F.hide()},error:function(e){oe(e.Message,"error")}}):oe("Please provide a valid email address.","error"),!1});var ye=function(){if(m){v.empty(),I.removeClass("hasRecent");var o=0;c.recentCollaborators&&$.each(c.recentCollaborators,function(e,a){var t;if(!(3<=o)&&(!function(e){for(var a=l.standardizeEmail(e.Email),t=0;t<m.Collaborators.length;t++)if(l.standardizeEmail(m.Collaborators[t].Email)===a&&0<m.Collaborators[t].Privilege&&1==m.Collaborators[t].Accepted)return!0;return!1}(a)&&!me(a.Email))){var n=$(g.html());n.find(".name").text(a.FullName||a.Email),n.find(".email").text(a.Email||a.FullName),n.on("click",(t=a,function(){z&&q?(V=t.Email||t.FullName,ne(p.aUser,{name:t.FullName,email:t.Email})):i.showUpgradePopup()})),v.append(n),I.addClass("hasRecent"),o++}})}};function Ce(e){we(e,!0)}function we(e,a){var t=a||!1,n={getValue:function(e){return e.FullName+" "+e.Email},data:W,theme:"bootstrap",list:{match:{enabled:!0},onChooseEvent:function(){var e=M.getSelectedItemData();console.log(e),M.val(e.Email)}}};Te(e),ye(),t&&c.Team&&0<c.Team.Id?(h.find(".loading-animation").show(),u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){h.find(".loading-animation").hide(),W=e.Data.Data.members,M.easyAutocomplete(n)},error:function(e){h.find(".loading-animation").hide()}})):M.easyAutocomplete(n)}return T.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var a=$(this),t=a.closest(".person"),e=t.data("person");F.show(),a.text("Sending ...").css("cursor","default"),u.resendSFGEmailNotification({data:{userEmail:e.Email,teamId:c.Team.Id,folioToken:m.Token,accessType:e.Privilege},success:function(e){F.hide(),a.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){a.text("Remind").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)},error:function(e){a.text("Remind").css("cursor","pointer"),t.find(".actions").removeClass("active"),oe(e.Message,"error")}})}),R.find(".r1").click(function(){if($(this).hasClass("locked")){var e=4==c.Team.Role?"Premium Guests":"Team Members";r.teamUserActionBlocked("invite-member",e,function(e,a){r.show(h)})}else 4==c.Team.Role?r.teamUserActionBlocked("non-team-member","Premium Guests"):(h.find(".popup-header h1.am-h .mem").text("Team Member "),h.find(".popup-header p.am-h").addClass("hidden"),c.Team&&c.Team.ST&&(14==c.Team.ST||19==c.Team.ST||22==c.Team.ST||25==c.Team.ST||28==c.Team.ST||31==c.Team.ST)||i.isFreeWithTeam()?(B.find(".block:eq(1) .left input").val(V),J=3,te("add-paidmem")):h.addClass("contact-supp"))}),R.find(".r2").click(function(){if($(this).hasClass("locked")){var e=4==c.Team.Role?"Premium Guests":"Team Members";r.teamUserActionBlocked("invite-member",e,function(e,a){r.show(h)})}else 4==c.Team.Role?r.teamUserActionBlocked("non-team-member","Premium Guests"):(h.find(".popup-header h1.am-h .mem").text("Premium Guest "),h.find(".popup-header p.am-h").addClass("hidden"),c.Team&&c.Team.ST&&(14==c.Team.ST||19==c.Team.ST||22==c.Team.ST||25==c.Team.ST||28==c.Team.ST||31==c.Team.ST)||i.isFreeWithTeam()?(B.find(".block:eq(1) .left input").val(V),J=4,te("add-paidmem")):h.addClass("add-pg"))}),r.reg(h,h.find(".popup-close, .btn-close, .back-to, .back-button, .no"),function(){o.off("click"),m.Token?s.removeListener("collabChange",we):r.saveFolio(1,{teamUsersList:_.without(m.Collaborators,X),newTeamUsersList:X})}),s.addListener("refreshMemberData",function(){Q&&we(m,!0)}),function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{Token:null,Collaborators:[]},a=1<arguments.length?arguments[1]:void 0;if(Q=!0,"function"==typeof a)return r.show(h),void a();h.removeClass("success"),W=null,h.find(".loading-animation").show(),d=!(m=t).Token,F.show();for(var n=0;n<m.Collaborators.length;n++)!m.Collaborators[n].Email&&m.Collaborators[n].FullName&&(m.Collaborators[n].Email=m.Collaborators[n].FullName);h.find(".popup-header h1.am-h .mem").text(""),h.find(".popup-header p.am-h").removeClass("hidden"),h.find(".popup-header h1.sfg-h").addClass("hidden"),h.find(".popup-header p.sfg-h").addClass("hidden"),N.addClass("hidden"),A.addClass("hidden"),c.Team&&0<c.Team.Id?u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){h.find(".loading-animation").hide();var a=e.Data.Data.members;W=[],a.forEach(function(e,a){var t=e.FullName||"";e.search=e.Email+" "+t,W.push(e)}),ne(1),we(t,!0),s.addListener("collabChange",Ce),o.parent().removeClass("open"),o.on("click",function(){$(this).parent().toggleClass("open")}),F.hide()},error:function(e){h.find(".loading-animation").hide()}}):(h.find(".loading-animation").hide(),ne(1),Te(t),ye(),s.addListener("collabChange",we),o.parent().removeClass("open"),o.on("click",function(){$(this).parent().toggleClass("open")}),F.hide()),e=z?"5px":"130px",z||i.isFreeWithTeam()?(h.find(".popup-content").removeClass("remove-top-border"),b.addClass("hidden"),M.removeClass("disable-btns")):(h.find(".popup-content").addClass("remove-top-border"),b.removeClass("hidden"),M.addClass("disable-btns")),h.find(".cancel.icon-Close").css({top:e}),l.doSetFocus(M),r.show(h)}},app.popup.getConfirmDowngradePopup=function(a,t,e,n,o,i){var s=$("#tmp-confirm-downgrade"),r=s.find(".cancel, .popup-close.icon-Close"),l=s.find(".loading-animation").html(t.spinner),d=!1,c=!1;function u(e){e?(l.hide(),s.find(".popup-content").show()):(l.show(),s.find(".popup-content").hide())}return s.find(".cancel-dg-btn").click(function(e){e.preventDefault(),t.close()}),s.find(".confirm-dg-btn").click(function(e){e.preventDefault(),u(!1),t.trialExpirePopup(!0,d),setTimeout(function(){c||(c=!0,$("#pendo-button-fa73c61a").click(function(){t.trialExpirePopup(!0,d)}),$("#pendo-button-8fed2b42, #pendo-close-guide-77f71eb5").click(function(){u(!0),t.close()}))},500)}),t.reg(s,r),function(e){d=e||!1,!a.isTrial&&a.trialConverted&&s.find(".p-type").text("plan"),l.hide(),t.show(s)}},app.popup.getCopySectionPopup=function(i,s,r,l,d){var c=$("#tmp-copy-move-section"),u=c.find(".destination .filter-popup-menu"),n=(u.find(".item"),c.find(".order .filter-popup-menu")),m=c.find(".popup-cta.ok"),p=c.find(".destination .x-select .text"),f=0,h=null,g=null,e=c.find(".go-to-folio"),t=e.find(".gotofolio"),o=e.find(".name"),v=e.find(".verb"),b=!1;c.find(".loading-animation").html(s.spinner);var T=function(e,a){console.log(a),u.html("");for(var t=0;t<a.length;t++)i.token!=a[t].Token&&(itemHtml='<div class="item" data-totalsec = "'+a[t].TotalSections+'" data-token="'+a[t].Token+'">'+a[t].FolioName+"</div>",u.append(itemHtml));u.find(".item").click(function(){$this=$(this),function(e){n.html("");for(var a=1;a<=e+1;a++)n.append('<div class="item" data-count="'+a+'">'+a+"</div>");n.find(".item:eq(0)").addClass("active")}($this.data("totalsec")),m.removeClass("disabled")})};return m.click(function(){c.addClass("busy"),d.getCopySections({sourceToken:i.token,destinationToken:u.find(".active").data("token"),sectionTag:f,order:n.find(".active").data("count"),action:g,success:function(e){c.removeClass("busy"),t.attr("href",i.baseUrl+"/edit/"+u.find(".active").data("token")),o.text(u.find(".active").text());var a=b?"copied":"moved";v.text(a),c.addClass("success"),h&&h()},error:function(e){c.removeClass("busy"),s.message({heading:"Oops!",message:e.Message,btnText:"Ok"})}})}),s.reg(c,c.find(".icon-Close, .popup-cta.cancel")),function(t,e,a){var n;u.html(""),c.removeClass("success"),n=-1<e.indexOf("Move")?(g="move","copy"):(g="copy","move"),b=!(-1<e.indexOf("Move")),h=a||null,c.find(".popup-header .tipped-icon").css("display","inline-block"),c.find(".popup-header .tipped-icon."+n+"section-icon").hide(),c.addClass("busy"),c.find(".popup-header h1").contents().first().replaceWith(e),p.html("<span>Copy Section</span> To:"),p.find("span").text(e),m.text(e),m.addClass("disabled");var o=r.obtain(l.Modules,"Type","DataModule").Data.Sections;d.getUserFolios({teamId:i.Team.Id,success:function(e){c.removeClass("busy");var a=JSON.parse(e.Data);0<a.length&&T(o[t].Tag,a),f=o[t].Tag},error:function(e){c.removeClass("busy"),s.message({heading:"Oops!",message:e.Message,btnText:"Ok"})}}),s.show(c)}},app.popup.getCreateTemplatePopup=function(l,d,c,e,u,m){var p,f,t=$("#tmp-create-template"),a=t.find(".cancel, .popup-close, .icon-Close"),n=t.find(".loading-animation"),o=($("#top-bar .template-subnav"),n.html(d.spinner)),h="team-temp",g=t.find(".cont-field .temp-name"),i=t.find(".create-save-btn"),s=t.find("input[type=radio]"),v=t.find(".err-msg");function b(e){e?(o.hide(),g.removeClass("disable"),s.removeClass("disable"),i.removeClass("disable")):(o.show(),g.addClass("disable"),s.addClass("disable"),i.addClass("disable"))}return s.click(function(){console.log("toggle template type value",$(this).val()),h=$(this).val()}),i.click(function(e){e.preventDefault();var a,t=g.val();if(console.log("template name",t),console.log("folioToken",p),console.log("templateType",h),""===t)a="Please provide a template name",clearTimeout(f),v.text(a),v.show(),f=setTimeout(function(){v.hide()},5e3);else{b(!1);var n="team-temp"===h,o=n?"Team Template":"My Template",i=n?" is available to all team members in ":" is now your private template in ",s=l.isDashboard?"":"/",r=n?s+"#teamtemplates":s+"#mytemplates";c.saveAsTemplate({token:p,name:t,teamId:l.Team.Id,CopiedFromTemplate:!1,isTeamTemplate:n,success:function(){var e;n||m.raiseEvent("teamTemplateUpdate"),d.message((_defineProperty(e={heading:o+' Saved <i class="icon-CheckMark"></i>',message:"<b>"+t+"</b>"+i+'<a href="'+r+'">'+o+"s</a>",bodyCentered:!0,btnText:"Done",enterAsOK:!0,notMini:!0},"btnText","Go to "+o+"s"),_defineProperty(e,"cancelText","Ok"),_defineProperty(e,"handleOK",function(){window.location=r}),e))},error:function(e){u.doUpgradePopup(d,u.isProTeamMember()?"pro":"Free")},complete:function(){b(!0)}})}}),d.reg(t,a),function(e,a){g.val(e),p=a,o.hide(),d.show(t)}},app.popup.getDowngradeNoticePopup=function(t,e,a,n,o,i){var s=$("#tmp-downgrade-notice"),r=s.find(".cancel, .popup-close.icon-Close"),l=s.find(".loading-animation").html(e.spinner);return s.find(".dgn-close-btn, .popup-close.icon-Close").click(function(e){if(e.preventDefault(),t.plusExpireTime<=Date.now()){var a="";"live"==t.Environment?a="https://app.xtensio.com/#dashboard":"dev"==t.Environment?a="https://app.xtensio.tech/#dashboard":"local"==t.Environment&&(a="https://www.localhost.com:44301/#dashboard"),window.location=a}else n.reloadWithoutHash()}),e.reg(s,r),function(){$("#tmp-downgrade-bar").addClass("hideOverride"),t.plusExpireTime<=Date.now()?s.find(".status").html("Your plan has expired. <br>You are on the Free Forever plan."):t.isTrial||s.find(".status").html("When your plan expires, you will be downgraded to our Free Forever plan"),l.hide(),e.show(s)}},app.popup.getEmailSettings=function(a,e,t,n,o){var i,s,r=$("#tmp-email-settings"),l=r.find(".paper"),d=r.find(".yes"),c=r.find(".icon-Close , .no");function u(){i&&$.each(i,function(e,a){l.find("."+n.valToProp(s,a.eType)).val(a.sType)})}return l.find(".loading-animation").html(a.spinner),a.reg(r,c),u(),d.on("click",function(){l.addClass("busy");var e={Digest:l.find(".digest").val(),PlusExtended:l.find(".plusExtended").val(),PlusReminder:l.find(".plusReminder").val(),FormResponse:l.find(".formResponse").val(),TransferRequest:l.find(".transferRequest").val(),TransferResult:l.find(".transferResult").val(),CollaboratorRequest:l.find(".collaboratorRequest").val(),CollaboratorResult:l.find(".collaboratorResult").val(),CollaboratorRevoke:l.find(".collaboratorRevoke").val(),CollaboratorReminder:l.find(".collaboratorReminder").val(),CollaborationChannelUpdate:l.find(".collaborationChannel").val(),OwnerLeave:l.find(".ownerLeave").val()};o.emailSettings({data:{verb:"set",pairs:JSON.stringify(e)},success:function(e){l.removeClass("busy"),a.close()},error:function(){a.error(),l.removeClass("busy")}})}),function(){i||o.emailSettings({success:function(e){i=e.Data.Settings,s=e.Data.EmailTypes,e.Data.SettingTypes,u(),l.removeClass("busy")},error:function(){a.error()}}),a.show(r,"manage-notifications")}},app.popup.getExpiredBlocker=function(s,r,e,o,l){var d=$("#tmp-expired-blocker-popup"),a=d.find(".loading-animation"),t=d.find(".upgrade"),n=d.find(".downgrade");return a.html(r.spinner),t.click(function(){r.payment(r.expiredBlocker,!0)}),n.click(function(){return $anim.show(),r.push(d),e.getData(1,function(e,a,t,n){o.getUserActiveFoliosCount({success:function(e){var i=e.Data;o.getUserTemplateCount({success:function(e){var a,t,n=e.Data,o=1<i||0<n;if(o&&(1<i&&n<1?(a="Uh oh - You have more than 1 folio!",t="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(a="Uh oh - You have more than 1 folio and saved templates",t="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(a="Uh oh - You have saved templates!",t="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),$anim.hide(),o)r.message({heading:a,message:t,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}});else{2==currPlan?"Pro":1==currPlan&&"Plus",r.push(d),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to downgrade to the free plan?</span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, Downgrade to Free Forever",cancelText:"Nevermind",notMini:!0,handleOK:function(){$anim.hide(),setTimeout(function(){l.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close();"live"==s.Environment||("dev"==s.Environment||s.Environment)}})},0)}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),r.reg(d,d.find(".close-popup-btn, .no")),function(e){a.hide(),r.show(d)}},app.popup.getFailedPaymentBlocker=function(s,r,l,e,d){var c=$("#tmp-failed-payment-blocker-popup"),a=c.find(".loading-animation"),t=(c.find(".paper"),c.find(".upgrade")),u=(c.find(".success-panel"),s.Plan),n=c.find(".downgrade"),m=a.html(r.spinner);return t.click(function(){r.push(c),r.billing(1,!1)}),n.click(function(){return m.show(),r.push(c),e.getData(1,function(e,a,t,n){l.getUserActiveFoliosCount({success:function(e){var i=e.Data;l.getUserTemplateCount({success:function(e){var a,t,n=e.Data,o=1<i||0<n;if(o&&(1<i&&n<1?(a="Uh oh - You have more than 1 folio!",t="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(a="Uh oh - You have more than 1 folio and saved templates",t="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(a="Uh oh - You have saved templates!",t="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),m.hide(),o)r.message({heading:a,message:t,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}});else{2==u?"Pro":1==u&&"Plus",r.push(c),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to cancel?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){var e,a;m.show(),e=0,a=function(){m.hide(),d.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close();var e="";"live"==s.Environment?e="https://app.xtensio.com/#dashboard":"dev"==s.Environment?e="https://app.xtensio.tech/#dashboard":"local"==s.Environment&&(e="https://www.localhost.com:44301/#dashboard"),window.location=e}})},l.cancelPlan({data:{plan:e,renew:e?1:0},success:function(e){a(e)},error:function(e){r.error(e.Message||"There was an error. Please try later.")},complete:function(){}})}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),r.reg(c,c.find(".close-popup-btn, .no")),function(e){console.log("params",e),a.hide(),r.show(c)}},app.popup.getFailedPaymentAddUser=function(t,n,a,e,o){var i=$("#tmp-failed-payment-add-user-popup"),s=i.find(".loading-animation.forpopup"),r=i.find(".user-list"),l=$("#tmp-billing"),d=!1;function c(){i.find(".btn").toggleClass("disabled")}function u(){var e,a;1==t.isMembersPaymentFailed&&(!1===l.is(":visible")&&!1===d&&(e=t.failedMemberEmails,a=1<e.length?"users":"user",i.find(".paper p span, .remove-user span").html(a),r.html("<strong>"+e.join("<br>")+"</strong>"),n.show(i),d=!0),setTimeout(u,1e3))}return i.find(".remove-user").click(function(){if(!$(this).hasClass("disabled")){c();var e=t.failedMemberEmails;s.show(),a.removeUnpaidMembers({data:e,success:function(e){console.log(e)},error:function(e){console.log(e)},complete:function(){c(),s.hide(),window.location.reload()}})}}),i.find(".update-card-details").click(function(){$(this).hasClass("disabled")||(d=!1,n.billing(1,!1,"cardDetailsOnly"))}),s.html(n.spinner),n.reg(i),function(){u()}},app.popup.getFailedPaymentTeamBlocker=function(s,r,l,e,d){if(e.isOwner())s.IsDelinquent&&(c=$("#tmp-failed-payment-team-blocker-owner-popup")).find(".upgrade").click(function(){r.push(c),r.billing(1,!1)});else if(s.Team.IsDelinquent)var c=$("#tmp-failed-payment-team-blocker-popup");c&&(c.find(".downgrade").click(function(){return $anim.show(),r.push(c),e.getData(1,function(e,a,t,n){l.getUserActiveFoliosCount({success:function(e){var i=e.Data;l.getUserTemplateCount({success:function(e){var a,t,n=e.Data,o=1<i||0<n;o&&(1<i&&n<1?(a="Uh oh - You have more than 1 folio!",t="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(a="Uh oh - You have more than 1 folio and saved templates",t="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(a="Uh oh - You have saved templates!",t="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),$anim.hide(),o?r.message({heading:a,message:t,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}}):(r.push(c),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to cancel?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){var e,a;$anim.show(),e=0,a=function(){$anim.hide(),d.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close(),"live"==s.Environment||"dev"==s.Environment||s.Environment}})},l.cancelPlan({data:{plan:e,renew:e?1:0},success:function(e){a(e)},error:function(e){r.error(e.Message||"There was an error. Please try later.")},complete:function(){}})}}))},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),r.reg(c,c.find(".close-popup-btn, .no")));return function(e){c&&r.show(c)}},app.popup.getFolioVersion=function(d,c,u,e,m,n,p){var f,a,t,o,i,s,h=6,g=!1,v=14,r=$("#tmp-folio-version"),l=r.find(".icon-Close"),b=r.find(".v-table.snapshot"),T=r.find(".v-table.localstorage"),y=$("#tmp-folio-version-table"),C=r.find(".btn-save"),w=y.html(),k=$('<div class="nonplus hidden"></div>'),x=$('<div class="overlay"></div>'),P=r.find(".loading-animation"),S=r.find(".showmore");g=!1;P.html(c.spinner);var D=function(){g&&b.find(".v-table-row:eq(0)").removeClass("previous").addClass("current").find(".note-edit").remove(),t=r.find(".note-edit"),o=r.find(".note-save"),i=r.find(".note-container input"),t.click(function(){$(this).parent().addClass("editable"),(i=$(this).parent().find("input")).prop("readonly",!1).focus()}),o.click(function(){var e=$(this).closest(".v-table-row").data("item").Id;$(this).parent().removeClass("editable"),(i=$(this).parent().find("input")).prop("readonly",!0),d.folioVersion({data:{id:e,verb:"note",note:i.val(),token:f},success:function(){},error:function(){}})}),i.on("keydown",function(e){13==(e.which||e.keyCode)&&o.click()})};function F(e,a){d.getChannelsOfAFolio({data:{folioToken:e,teamId:m.Team.Id},success:function(e){console.log("getChannelsOfAFolio response",e),a&&"function"==typeof a&&a(e)},error:function(e){console.log("getChannelsOfAFolio error",e),c.error(e.Message)},complete:function(){P.hide()}})}function I(){var r,l;if(g=!1,console.log("num of days to keep revisions",v),r=dayjs().subtract(v,"day"),b.find(".v-table-row").remove(),$.each(s.splice(0,h),function(e,a){var t,n,o,i,s;t=$(w),(n=dayjs(a.Time)).isAfter(r)&&(t.data("item",a),t.find(".date").text(n.format("MM/DD/YY")),t.find(".time").text(n.format("h:mm a")),t.find(".note-container input").val(a.Notes||""),t.find(".preview-btn").prop("href","/version-preview/"+f+"/"+a.Id),t.find(".revert-btn").on("click",(s=function(){P.show(),d.folioVersion({data:{id:i.Id,token:f,verb:"revert"},success:function(e){c.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){u.raiseEvent("removeCollabs")}})},error:function(e){c.error(e.Message)}})},"Last revision before update"==(i=a).Notes?function(){c.message({heading:"Warning",message:"You are going to revert folio to older version so your collaborators would be removed.",btnText:"Go ahead",cancelText:"Cancel",handleOK:s})}:function(){P.show(),d.folioVersion({data:{id:i.Id,token:f,verb:"revert"},success:function(e){c.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){c.error(e.Message)}})})),t.find(".btn-copy").on("click",(o=a,function(){p.checkFoliosLimitReached(d,c,function(){console.log("item",o),console.log("token",f),P.show(),F(f,function(e){m.saveFolioFromSnapshot={token:f,id:o.Id,verb:"makecopy",channels:JSON.parse(e.Data),fromLocalStorage:!1},c.saveFolio()})})})),"Last revision before update"!==a.Notes&&(a.IsCurrent?g||(g=!0,t.removeClass("previous").find(".actions").text("Currently Live"),l=t):b.append(t)))}),l&&(b.find(".current").removeClass("current"),l.addClass("current"),b.find(".v-table-top").after(l)),0===s.length&&S.addClass("hidden"),D(),console.log("apphub",n),n){var e=n.loadFolioDataFromLocal();if(e){var a=dayjs(e.timestamp),t=$(w);T.find(".v-table-row").remove(),t.find(".date").text(a.format("MM/DD/YY")),t.find(".time").text(a.format("h:mm a")),t.find(".preview-btn").css({opacity:0,pointerEvents:"none"}),t.find(".note-container").css({opacity:0,pointerEvents:"none"}),t.find(".revert-btn").on("click",function(){n.loadLocalToFolio("overwrite")}),t.find(".btn-copy").on("click",function(){p.checkFoliosLimitReached(d,c,function(){console.log("token",f),P.show(),F(f,function(e){n.loadLocalToFolio("saveasacopy",JSON.parse(e.Data))})})}),T.append(t)}}}function M(e){var a='<img src="'+m.baseUrl+'/img/loader.gif" />';e?(C.removeClass("disable"),C.css("height","35px").html("Save a New Revision")):(C.addClass("disable"),C.css("height","45px").html(a))}function E(){I(),h<a&&S.removeClass("hidden"),g||b.find(".v-table-row:eq(0)").removeClass("previous").addClass("current").find(".actions").text("Currently Live"),D()}function U(){P.show(),m.plusExpireTime>=Date.now(),k.empty(),d.folioVersion({data:{token:f},success:function(e){s=JSON.parse(e.Message),a=s.length,E(),P.hide()},error:function(e){console.log("folioversion error",e),P.hide()}})}return S.click(I),x.append("<p class='plus-note'>You need <a href='https://www.xtensio.com/plus'>Xtensio Plus</a> to revert to an older version.</p>"),C.click(function(e){e.preventDefault(),M(!1),u.raiseEvent("saveCurrentRevision")}),u.addListener("doneSavingRevision",function(){M(!0),U()}),r.find(".btn-seeplans").click(function(e){e.preventDefault(),m.Team&&1===m.Team.Role&&c.payment("showPlans")}),c.reg(r,l),function(e,a){if(f=a,U(),e.Team){var t="Free";22===e.Team.ST||25===e.Team.ST||14===e.Team.ST||19===e.Team.ST?(t="Business",v=180):28!==e.Team.ST&&31!==e.Team.ST||(t="Pro",v=90),e.Team&&1!==e.Team.Role&&r.find(".free-notice a.btn-seeplans").addClass("nolink"),r.find(".free-notice .plan").text(t),r.find(".free-notice .duration").text(v)}c.show(r)}},app.popup.getFolioStatsPopup=function(e,n,a){var i=$("#tmp-folio-stats-popup"),s=i.find(".paper"),t=i.find(".popup-cta.cancel"),o=i.find(".icon-Close"),r=s.find(".folio-stats-section"),l=-1,d=!1;n.reg(i,t),n.reg(i,o);var c=function(e){return""==e?"never":dayjs(new Date(e+" UTC")).fromNow()};function u(e){s.find(".folio-stats-section").css({opacity:0}),i.find(".loading-animation").show(),a.getFolioDataPoints({token:e,success:function(e){null!=e.Data&&function(e){var a=JSON.parse(e),t=dayjs(new Date(a.Created+" UTC")).format("lll");r.find(".dp-created").text(t),-1<l?r.find(".dp-used").text(l).parent().show():r.find(".dp-used").parent().hide();var n=c(a.LastEdited);r.find(".dp-lastEdited").text(n);var o=c(a.LastViewed);r.find(".dp-lastViewed").text(o),r.find(".dp-edits").text(a.Edits),d?r.find(".dp-collaborators").parent().hide():r.find(".dp-collaborators").text(a.Collaborators).parent().show(),r.find(".dp-revisions").text(a.Revisions),r.find(".dp-exports").text(a.Exports),r.find(".dp-private").text(a.Private),r.find(".dp-views").text(a.Views),r.find(".dp-password").text(a.Password),setTimeout(function(){i.find(".loading-animation").hide(),s.find(".folio-stats-section").css({opacity:1})},500)}(e.Data)},error:function(e){console.log("error stats: ",e)}})}return i.find(".loading-animation").html(n.spinner),function(e,a,t){t&&(l=t.UsedCount,d=t.isTemplate),u(e),i.find(".popup-header h1").text(a),n.show(i)}},app.popup.getImportFolioPopup=function(o,a,e){var i=$("#tmp-import-folios"),t=(i.find(".paper"),i.find(".popup-header")),s=i.find(".list-of-folios"),n=i.find(".select-all"),r=i.find(".select-folios .ok"),l=i.find(".team-name"),d=[],c=!1,u=i.find(".error"),m=i.find(".confirm-move .back"),p=i.find(".confirm-move .ok"),f=i.find(".succ .ok"),h=i.find(".icon-Close"),g=i.find(".confirm-move .team-url"),v=i.find(".loading-animation");v.html(a.spinner),n.click(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),s.find(".select").removeClass("selected")):($(this).addClass("selected"),s.find(".select").addClass("selected"))});var b=function(e){u.text(e).show("slow"),setTimeout(function(){u.hide("slow")},3e3)};r.click(function(){if(d=[],c){if($moveables=s.find(".selected"),$moveables.length<1)return void b("Please Select a Folio to move.");for(var e=0;e<$moveables.length;e++)d.push($moveables[e].getAttribute("data-token"));console.log(d),t.find("h3 .number").text(d.length),t.find("h3 .verb").text(1<d.length?"folios":"folio"),g.attr("href","https://"+o.Team.TeamUrl).text(o.Team.TeamUrl),T("confirmation")}else a.close()}),m.click(function(){T("")}),p.click(function(){v.show(),e.moveUserFolios({userEmail:o.userEmail,source:0,destination:o.Team.Id,folios:d,success:function(e){i.find(".succ .message").text(e.Message),v.hide(),T("complete"),$("#folio-items-container").find(".empty").remove(),$("#folio-items-container").find(".my-empty").remove()},error:function(e){b(e.Message),v.hide()}})}),f.click(function(){window.location=o.baseUrl});var T=function(e){i.removeClass("no-folio"),i.removeClass("complete"),i.removeClass("confirmation"),i.addClass(e)};return a.reg(i,i.find(".icon-Close, .cancel, .succ .ok")),h.click(function(){window.location=o.baseUrl}),function(){T(""),console.log(l,o.Team.Name),l.text(o.Team.Name),v.show(),a.show(i),e.getUserOwnFolios({success:function(e){s.empty();var a=JSON.parse(e.Data);if(0<a.length){c=!0,console.log("folio list",a);for(var t=0;t<a.length;t++){var n='<a href="#" class="select" data-token="'+a[t].Token+'"><span class="check"></span><span class="name">'+a[t].FolioName+"</span></a>";s.append(n),s.find(".select:last-child").click(function(e){$(this).toggleClass("selected"),e.preventDefault()})}r.text("Move to "+o.Team.Name)}else c=!1,T("no-folio"),i.find(".msg .cancel").text("Cancel");v.hide()},error:function(e){v.hide()}})}},app.popup.getLabelsPopup=function(s,i,r,l,e,a){var d,c,o,u,m,p,f=$("#tmp-label-item").html(),h=($("#all-labels-container"),$("#single-label").html(),$(".labels-dropdown"),$("#tmp-labels")),g=h.find(".labels"),v=$(".changes-applied"),b=$(".add-missing-label"),t=h.find(".loading-animation"),T=!1,y="";function C(){if(v.addClass("hidden"),s.Team&&0<s.Team.Id)l.changeCollabChan({token:d.Token,labelToken:y,success:function(){v.removeClass("hidden"),c(),setTimeout(function(){v.addClass("hidden")},3e3)},error:function(e){i.error(e.Message)},complete:function(){x(!0)}});else{var e=d.Labels.join();e!=d.lastSaved&&(d.lastSaved=e,l.changeLabels({token:d.Token,list:e,success:function(){v.removeClass("hidden"),c(),setTimeout(function(){v.addClass("hidden")},3e3)},error:function(e){i.error(e.Message)},complete:function(){x(!0)}}))}}function w(e,a){v.addClass("hidden");var t={token:d.Token,id:e,success:function(){!function(e){r.removeFromList(d.Labels,e);for(var a=0;a<s.folios.length;a++)if(s.folios[a].Token==d.Token){r.removeFromList(s.folios[a].Labels,e);break}}(e),v.removeClass("hidden"),c(),setTimeout(function(){v.addClass("hidden")},3e3)},error:function(e){i.error(e.Message)},complete:function(){x(!0)}};if(s.Team&&0<s.Team.Id){console.log("folio",d);var n,o=_.findIndex(s.labels,["Token",e]);0<=o?n=s.labels[o]:console.log("WARN DEV: token "+e+" not found on config.labels"),!d.IsCurrentUserOwner&&0<=o&&(2==n.AccessType||1==n.AccessType&&0<n.ChannelMembers.length)?(i.push(h),a.prop("checked",!0),console.log("id",o),console.log("labelID",e),x(!0),i.message({heading:"Do you really want to remove this folio?",message:"Removing the folio from <b>"+n.Name+"</b> will remove all channel collaborators. Collaborators added at the folio level will still have access and the folio will return to <b>"+d.UserFullName+"'s</b> default channel.",btnText:"Yes, remove the folio",cancelText:"Nevermind",notMini:!0,bodyCentered:!0,handleOK:function(){x(!1),a.prop("checked",!1),m.removeClass(r.removeFromList(d.Labels,e)),l.removeFromCollabChan(t)}})):l.removeFromCollabChan(t)}else l.removeFromLabels(t)}t.html(i.spinner),g.on("click",".label-check",function(e){if(!T){var a=$(this);x(!1),clearTimeout(o);var t=$(this),n=t.data("id");n,t[0].checked?(r.pushUnique(d.Labels,n),y=n,o=setTimeout(C,800)):w(currentRemovedChannel=n,a)}});var k=function(e){if(13!=(e.which||e.keyCode)){var a=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();u.show().filter(function(){return!~$(this).text().replace(/\s+/g," ").toLowerCase().indexOf(a)}).hide().length==u.length?(b.removeClass("hidden").find("span").text($(this).val()),g.hide()):(b.addClass("hidden"),g.show())}else b.click()};function x(e){T=!e,e?(t.hide(),g.removeClass("disable-ui")):(t.show(),g.addClass("disable-ui"))}function P(){g.empty().hide();for(var e=null,a=0;a<s.labels.length;a++){var t=s.labels[a],n=$(f),o=n.find(".label-check").data("id",t.Token);if(console.log("item token",t.Token),p===t.Token&&(e=o,p=null),n.find(".label-name").css("background-color",t.color).text(t.Name),d&&d.Labels){var i=r.indexOf(d.Labels,t.Token);0<=i?o[0].checked=!0:console.log("WARN DEV: index = "+i+" token "+t.Token+" not found on folio.Labels")}g.append(n)}u=g.find("label"),$("#labels-search").keyup(k).val(""),b.on("click",function(){$(this).off("click"),$("#add-label-from-popup").data("suggestedName",$(this).find("span").text()).click()}).addClass("hidden"),g.show(),null!==e&&(e.click(),e=null)}return $("#add-label-from-popup").on("click",function(){if(s.Team&&0<s.Team.Id){if(5===s.Team.Role||4===s.Team.Role)return void i.teamUserActionBlocked("label");i.teamChannelPopup({openLabelsPopupOnClose:!0})}else i.personalChannelPopup(function(){window.location.reload()});return!1}),e.addListener("refreshLabelData",function(){return P()}),i.reg(h,h.find(".icon-Close")),function(e,a,t,n,o){p=o,!0!==n?s.Team&&0<s.Team.Id&&5==s.Team.Role?i.teamUserActionBlocked("label"):(m=a,c=t,(d=e).lastSaved=d.Labels.join(),P(),i.show(h)):i.show(h)}},app.popup.getMessage=function(n,o){var a,t,i,s,r,l,d,c,u,m,p,f,h,g,v,b,T,y=$("#tmp-message"),C=!1,w=y.find("h1"),k=y.find(".msg"),x=y.find(".text-area"),P=y.find(".input").not("#valid-popup-ok"),S=y.find(".ok"),D=y.find(".no"),F=y.find(".popup-content"),I=y.find(".icon-Close"),M=y.find(".cta-btns"),E=!1,U=$(".nav-main-menu a").not("a.help-center, a.examples-link");return $(".popup-validation-message").removeClass("error"),S.on("click",function(){if(T){if(!T())return $(".popup-validation-message").addClass("error").html(v),!1;$(".popup-validation-message").removeClass("error")}if(r){var e=!0,a=P.val(),t=x.val();g&&!a?k.addClass("error").html(g):"email"==p?(e=validator.isEmail(a))||k.addClass("error").html("Invalid email. Please provide a valid email address."):"url"===p&&(e=o.isValidURL(a),console.log("isValid",e),e||k.addClass("error").html("Invalid url. Please provide a valid url.")),e&&(n.close(),f&&n.busy(),r(a,t))}else n.close();return!!c}),n.reg(y,D.add(I),0,function(e){C&&13==(e.keyCode||e.which)&&S.click()}),D.click(function(){l&&l()}),I.click(function(){l&&l(),n.close()}),k.on("click",".popup-template-link",function(e){e.preventDefault();var a="a."+$(this).data("type");console.log("tempType",a),U.filter(":eq(1)").trigger("click"),a&&setTimeout(function(){$("#top-bar .template-subnav "+a).trigger("click"),n.close()},600)}),function(e){a=e.heading,t=e.message||"",i=e.input,s=e.btnText||"Save",h=e.showArea,r=e.handleOK,T=e.beforeHandle,d=e.cancelText,c=e.url,u=!!e.noClose,p=e.validateFor,f=e.showBusy,l=e.handleNo,m=e.showInput||i,C=e.enterAsOK,e.defaultInputValue,g=e.emptyError,v=e.validationError,e.handleError,b=e.notMini,E=e.bodyCentered,S.addClass(e.okClass),e.isSwitchCta?M.addClass("is-switch"):M.removeClass("is-switch"),P.attr("placeholder",e.inputPlaceholder||""),x.val(e.areaText||"").attr({rows:e.rows||3,placeholder:e.areaPlaceholder||"Message (Optional)"}),y.attr("class","app-popup "+(e.namespace||"")),y.toggleClass("no-close",u),w.html(a),D.toggleClass("hidden",!d&&!l).text(d),I.toggleClass("hidden",u),P.toggleClass("hidden",!m).val(i),S.text(s).attr("href",c||"#"),k.removeClass("error").html(t),E&&k.addClass("text-center"),x.toggleClass("hidden",!h),F.toggleClass("mini",!b),n.show(y)}},app.popup.getPlanExpireBlocker=function(s,r,o,a,l){var d=$("#tmp-plan-expire-blocker-popup"),t=d.find(".loading-animation"),e=(d.find(".paper"),d.find(".upgrade")),c=(d.find(".success-panel"),s.Plan),n=d.find(".downgrade"),u=t.html(r.spinner);return e.click(function(){r.push(d),r.billing(1,!1)}),n.click(function(){if(!a.isTeamPlan()||!s.IsDelinquent)return u.show(),r.push(d),a.getData(1,function(e,a,t,n){o.getUserActiveFoliosCount({success:function(e){var i=e.Data;o.getUserTemplateCount({success:function(e){var a,t,n=e.Data,o=1<i||0<n;if(o&&(1<i&&n<1?(a="Uh oh - You have more than 1 folio!",t="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(a="Uh oh - You have more than 1 folio and saved templates",t="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(a="Uh oh - You have saved templates!",t="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),u.hide(),o)r.message({heading:a,message:t,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}});else{2==c?"Pro":1==c&&"Plus",r.push(d),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to downgrade to the free plan?</span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, Downgrade to Free Forever",cancelText:"Nevermind",notMini:!0,handleOK:function(){u.hide(),l.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close(),window.location=s.baseUrl}})}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1;window.Intercom&&window.Intercom("showNewMessage")}),r.reg(d,d.find(".close-popup-btn, .no")),function(e){e&&e.limit&&e.currUser&&(d.find(".left .plan").text(e.currUser),d.find(".left .limit").text(e.limit)),a.isTeamPlan()&&s.IsDelinquent,t.hide(),r.show(d)}},app.popup.getPlusInfo=function(e,a,t,n,o){var i=$(e.spinner),s=$("#tmp-xtensio-plus"),r=s.find(".icon-Close"),l=(s.find(".ends-text"),s.find(".earned"),s.find(".percent-inner"),s.find(".joined"),s.find("input"));s.find(".unlock-head");return l.val(a.sharePlusLink).copier(),s.find(".loading-animation").append(i),$.socialLinks(a.sharePlusLink,s,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),s.find(".invite-link").attr("href",a.sharePlusLink),e.reg(s,r),s.find(".upgrade-btn").click(function(){e.payment(function(){e.plusInfo()})}),function(){e.message({heading:"Sorry",message:"This campaign is no longer available.",btnText:"OK"})}},app.popup.getPlusPrompt=function(r,l,d){l.plusInfo?l.plusExpireTime=l.plusInfo.End:l.plusExpireTime=Date.now();var c=$("#tmp-plus-prompt"),u=c.find(".msg");return c.find(".upgrade-panel").html(r.upgrade),c.find(".invite-link").val(l.sharePlusLink).copier(),$.socialLinks(l.sharePlusLink,c,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),r.reg(c,c.find(".icon-Close")),c.find(".ok").click(function(){r.payment()}),function(e,o,a,t){var n=Date.now();if("pass"==e)d.getData(1,function(e,a,t,n){a?10==e.ST||11==e.ST||3==e.ST||16==e.ST?r.billing():o():r.payment()});else if((l.autoRenew||n<l.plusExpireTime)&&o)o();else{if(a)return void("create"==e||r.payment());if(t)return void r.billing();var i='Unlock <a class="x-plus" target="_blank" href="//xtensio.com/plus">Xtensio Plus</a> ',s="Xtensio Plus allows you to export your folio as PDF or PNG";u.show(),"export"==e?i+="to export this folio":"export-mod"==e?i+="to export this module":"export-sec"==e?i+="to export this section":"pass"==e?(i+="for password protection",s="Xtensio Plus enables you to password protect any of your folios"):"create"==e?(i+="to create more folios",s="With a free account, you're limited to 1 folio"):(i+="to access this feature",u.hide()),c.find("h1").html(i),c.find(".desc").text(s),r.show(c)}}},app.popup.getSaveFolio=function(u,m,p,f,e,o){var s,h,g,v,b,T,y,C,w,n,k,x=$("#tmp-save-folio"),P=!1,S=x.find(".loading-animation").html(m.spinner),a=x.find(".popup-close"),t=x.find(".changes-applied"),D=$("#folio_name"),i=$("#collab-cont"),r=$("#collab-list"),l=$(".collabs"),d=x.find(".add-new"),c=(x.find(".add-btn"),x.find(".team-add")),F=$("#collab"),I=[],M=[],E={Token:null,Collaborators:[]},U=!1,N=!1,A=$("#channels"),L=x.find(".save-folio");function O(e){var a,t=(a=u.baseUrl,T&&void 0!==T.baseUrl&&""!==T.baseUrl&&u.Team&&0<u.Team.Id&&teamId===u.Team.Id&&(a=T.baseUrl),C&&void 0!==C.TeamUrl&&""!==C.TeamUrl&&(a=C.TeamUrl),a);window.location=t+"/edit/"+e+"#new",u.editMode&&!isDuplicate&&setTimeout(function(){window.location.reload()},300)}function R(e){var o,i,a=e.Message;0<M.length?(o=a,i=0,M.forEach(function(e){var a=e.name,t=e.email,n=e.role;f.addCollaborator({data:{name:a,email:t,role:n,token:o},success:function(){++i==M.length&&O(o)},error:function(e){10==e.StatusCode||Y(e.Message,"error")}})})):O(a),u.saveFolioSuccess={Result:!0},console.log("saveFolioSuccess",u.saveFolioSuccess)}x.find(".add-new, .add").click(function(){U?(i.show(),l.show(),d.hide(),u.saveCurrentStep=1,m.collaborators(E)):o.showUpgradePopup(N)}),c.find(".r3").click(function(){5==u.Team.Role&&(x.find(".popup-header h1.am-h .mem").text("Single Folio Guest "),c.find(".add-single-folio-guest").trigger("click"))}),$(".fgroup").on("click","div.selectize-input div.item",function(e){var a=x.find(".selectize-input.has-items").children(".item").length;if(console.log("channel items number",a),1<a){s[0].selectize;var t=$(this).attr("data-value");s[0].selectize.removeItem(t),s[0].selectize.refreshItems(),s[0].selectize.refreshOptions()}else Y("A Folio must be included in at least one channel. Add a different channel if you want to remove this one.","error"),console.log("need to have at least 1")}),L.click(function(e){if(!P){S.show(),P=!0,L.addClass("disable");var a=f.sanitizeText(D.val().trim()),t=[],n=[],o=null;if(D.val(a),a.length<3)return Y("Folio names must be at least three characters long.<br>Please provide a valid folio name.","error"),void L.removeClass("disable");if(x.find(".selectize-input.has-items").children(".item").each(function(){var e=p.findIndex($(this).data("value"),"name",k);-1!==e&&(t.push(k[e]),n.push(k[e].token))}),w)w.fromLocalStorage?f.makeFolioFromSnapshot({data:w.data,token:w.token,verb:w.verb,channels:JSON.stringify(n),name:a,success:function(e){console.log("makeFolioFromSnapshot res",e),e&&e.Message?(console.log("folioVersion response",e),window.location.href=u.baseUrl+"/edit/"+e.Message):m.error("Folio token not found")},error:function(e){console.log("makeFolioFromSnapshot error",e),m.error(e.Message)}}):f.folioVersion({data:{id:w.id,token:w.token,verb:w.verb,channels:JSON.stringify(n),name:a},success:function(e){e&&e.Message?(console.log("folioVersion response",e),window.location.href=u.baseUrl+"/edit/"+e.Message):m.error("Folio token not found")},error:function(e){console.log("folioVersion error",err),m.error(err.Message)}});else{var i=null;b?i=b.Token:T?i=T.Token:C?i=C.Token:h&&(i=h.Token),!i&&u.token&&(i=u.token);var s=!1;b&&null!==b.isUseTemplate?s=b.isUseTemplate:y&&null!==y.isUseTemplate&&(s=y.isUseTemplate);var r=!1;h&&null!==h.IsDuplicate&&(r=h.IsDuplicate);var l=0;if(C&&void 0!==C.TeamID)console.log("saveFolio saveFolioCollabItem.TeamID:::",C.TeamID),l=C.TeamID;else if(y&&void 0!==y.teamId)l=y.teamId;else if(u.Team&&0<u.Team.Id&&0<u.UserTeams.length){var d=p.findIndex(u.Team.Id,"Id",u.UserTeams);console.log("teamIdIndex",d),-1<d&&(l=u.Team.Id)}v&&(o=v.id),g&&(o=g.id);var c={teamId:l,folioToken:i,templateId:o,isUserTemplate:s,isDuplicate:r,data:{folioName:a,collaborators:I,channels:t,newChannels:[]},success:R,error:function(e){S.hide(),L.removeClass("disable"),Y(e.Message,"error"),u.saveFolioSuccess={Result:!0}}};console.log("apiData after save folio ",c),f.saveFolio(c)}}});var B=0;function Y(e,a){a=a||"success",S.hide(),t.removeClass("hidden success error").addClass(a).html(e),setTimeout(function(){t.addClass("hidden"),P=!1},3e3)}function _(e){return"Untitled ("+e+")"}function G(e){var i=[],a=[],t=$('<div class="selectize-custom-err"><div class="custom-msg">Channel does not exist.</div></div>');if(e){e.length;e.forEach(function(e,a){var t=e.ID||null,n=e.Token||e.LabelToken,o=e.color||"#FFFFFF"!==u.colors[a]?u.colors[a]:"#1abad3";i.push({id:t,name:e.Name,color:o,IsDefault:e.IsDefault,token:n})});var n=p.findIndex(!0,"IsDefault",e);console.log("defIndex",n),w?e.forEach(function(e){e.Existing&&a.push(e.Name)}):-1!==n&&a.push(e[n].Name)}k=i,console.log("channelsData",k),s=A.selectize({maxItems:null,valueField:"name",labelField:"name",searchField:"name",options:i,render:{item:function(e,a){return'<div class="item" '+(e.color?'style="background-color:'+e.color+'"':"")+">#"+a(e.name)+'<i class="fa fa-times" aria-hidden="true"></i></div>'}},items:a,create:!1,disableDelete:!0,onType:function(e){x.find(".selectize-control .selectize-custom-err").hide(),clearTimeout(void 0),3<=e.toString().length&&(this.currentResults.items.length||(clearTimeout(void 0),x.find(".selectize-control .selectize-custom-err").show(),hideInterval=setTimeout(function(){x.find(".selectize-control .selectize-custom-err").hide()},3e3)))}}),x.find(".selectize-control").append(t)}function H(e){var a=null;I=[],e.forEach(function(e){("undefined"!==I||0<I.length)&&-1===I.indexOf(e.Email)&&(3===parseInt(e.Privilege,10)?(console.log("existing owner:",e),a=e):(console.log("loggin collab before push:",e),I.push(e)))});var t=p.findIndex(n,"Email",e);n!==a.Email&&1===parseInt(e[t].Privilege,10)&&(D.addClass("disable"),d.addClass("disable"),F.addClass("disable"),r.addClass("disable"))}function z(){a.click(function(){window.location="/"}),x.addClass("no-close")}return m.reg(x,a),function(e,a){if(I=[],1===e)return I=_toConsumableArray(a.teamUsersList),M=_toConsumableArray(a.newTeamUsersList),E.Collaborators=I,function(){var t=0,n=[];if(l.empty(),B=0,showCollabButton=!1,1===I.length&&(showCollabButton=!0),I.forEach(function(e){if(parseInt(e.Privilege,10),0<e.Privilege&&e.Email!=u.userEmail)if(++t<=5){var a=$('<div class="outer"><div class="initials">MU</div></div>');a.find(".initials").text(p.getInitials(e.FullName||e.Email)).attr("data-tip",e.FullName),l.prepend(a.find(".initials"))}else n.push(e.FullName)}),5<t){var e=l.find(".initials:last-child");n.unshift(e.attr("data-tip")),e.attr("data-html","true").text("+"+(t-5+1)).attr("data-tip",n.join("<br/>"))}var a=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');o.isSingleFolioGuest()?(a.attr("data-tip","Add / Remove People"),a.click(function(){m.teamUserActionBlocked("add-remove-collab","Guests")})):(a.show(),a.attr("data-tip","Add / Remove People"),a.click(function(){m.collaborators(E)})),0===B&&!1===showCollabButton?(l.append(a),B+=1):0===B&&!0===showCollabButton&&d.show()}(),void m.show(x);x.find(".icon-Close").css({top:"15px"}),S.hide(),L.removeClass("disable"),D.removeClass("disable"),d.removeClass("disable"),F.removeClass("disable"),r.removeClass("disable"),D.val("Untitled"),r.empty(),l.empty(),x.removeClass("no-close"),s&&($(".fgroup").find("div.selectize-input div.item").each(function(){var e=$(this).attr("data-value");s[0].selectize.removeItem(e)}),s[0].selectize.refreshItems(),s[0].selectize.refreshOptions()),A.selectize()[0].selectize.destroy(),i.hide(),l.hide(),d.show(),teamMemList=null,u.userEmail?n=p.standardizeEmail(u.userEmail):u.userName&&(n=p.standardizeEmail(u.userName)),u.Team&&0<u.Team.Id&&f.listALLMembers({data:{teamId:u.Team.Id},success:function(e){teamMemList=e.Data.Data.members},error:function(e){}}),o.getData(1,function(e,a,t,n){if(console.log("data.ST",e&&e.ST),!e||14!==e.ST&&19!==e.ST||(N=!0),0<u.Team.Id&&4!==u.Team.Role&&5!==u.Team.Role&&(U=!0),u.saveFolioTemplate)console.log("using config for xtensio template flow"),D.val(_(u.saveFolioTemplate.name)),g=u.saveFolioTemplate,u.saveFolioTemplate=null,G(u.labels);else if(u.saveFolioExample)console.log("using config for xtensio template flow"),D.val(_(u.saveFolioExample.name)),v=u.saveFolioExample,u.saveFolioExample=null,G(u.labels);else if(u.saveFolioTransferItem){console.log("using config for transfer folio or user template");var o=(b=u.saveFolioTransferItem).FolioName?b.FolioName:b.Folio;D.val(o),b.isUseTemplate||z(),G(b.labels?b.labels:u.labels),u.saveFolioTransferItem=null}else if(u.saveFolioTransferWithTeam)console.log("using config for transfer folio with team context"),T=u.saveFolioTransferWithTeam,D.val(T.FolioName),G(T.labels),H(T.collaborators);else if(u.saveFolioEditPreview){if(console.log("using config for edit folio on preview"),y=u.saveFolioEditPreview,D.val(y.FolioName),G(y.labels),y&&void 0!==y.teamId&&(U=!1,0<y.teamId)){var i=p.findIndex(y.teamId,"Id",u.UserTeams);if(-1!==i){var s=u.UserTeams[i];4!==s.Role&&5!==s.Role&&(U=!0)}}}else u.sfgButtonClicked?(sfgButtonClicked=u.sfgButtonClicked,u.sfgButtonClicked=null,G(u.labels)):u.saveFolioCollabItem?(console.log("using config for collaboration request"),C=u.saveFolioCollabItem,D.val(C.FolioName),G(C.labels),H(C.collaborators),z()):u.duplicateFolioItem?(console.log("using config for duplicate folio."),h=u.duplicateFolioItem,D.val(h.FolioName),G(u.labels)):u.saveFolioFromSnapshot&&(console.log("using config for save folio from snapshot."),w=u.saveFolioFromSnapshot,D.val($("#tmp-primary-bar input.folio-name").val()||""),w.labels=u.saveFolioFromSnapshot.channels,G(w.labels));var r=D.val();w&&(r+=" - Copy From Revision"),D.val(r.toString().replace(" - Template","")),P=!1,m.show(x),p.doSetFocus(D)},!0)}},app.popup.getShareLink=function(i,l,d,c,u,e,s,m){var r,p={},f=!1,h=$("#tmp-popup-folio-share-link"),g=h.find(".copy-field"),v=h.find(".copy-field.folio-link"),b=h.find(".embed-url").copier(),T=h.find(".popup-content"),a=h.find(".tabs span"),t=h.find(".tab"),n=h.find(".button-bg"),o=n.find(".button-out"),y=n.find(".button-in"),C=h.find(".msg-content").hide(),w=h.find(".email-link"),k=C.find(".close-msg-btn"),x=C.find(".email-msg").val(""),P=h.find(".add-msg"),S=h.find(".input-pass-dot"),D=(h.find(".input-pass-visible"),h.find(".icon-Preview"),h.find(".send-email")),F=h.find(".btn-save-pass"),I=h.find(".pass-section"),M=I.find(".error"),E=h.find(".busy .msg"),U=(h.find(".loading-animation").html(l.spinner),h.find(".pass-protect")),N=h.find(".change-indexed"),A=h.find(".change-present"),L=h.find(".email-result"),O=h.find("h1"),R=$("#spinner-container > .loading-animation").clone().addClass("size-30"),B=h.find(".share-url-desc-up.desc-btn"),Y=h.find(".label-footer"),_=h.find(".labelnam"),G=Y.find(".save-label-detail"),H=Y.find(".no"),z=(h.find(".header-desc"),h.find(".preview")),q=h.find(".btn-edit-link"),K=h.find(".btn-default-link"),j=h.find(".edit-mode"),V=h.find(".view-mode"),J=h.find(".edit-field"),W=h.find(".btn-cancel"),X=h.find(".btn-save-link"),Q=h.find(".btn-copy-link"),Z=h.find(".error-messge"),ee=h.find(".error"),ae=h.find(".add-people"),te=h.find(".collabs"),ne=$("#templates-items-container"),oe="",ie=0,se=370,re=app.core.padlocks(c,u,d),le=c.isOwner()?"Business feature":"Needs more access",de=386,ce='\'var _self=this;this.contentWindow.postMessage("requestDocHeight", "'+m.getLocationOrigin()+'");window.addEventListener("message", function(event){console.log("message received by parent ",event);_self.style.height=event.data+"px";}, false);\'',ue='width="100%" height="100%" style="border:none;min-height: 100vh;"',me="embed=iframe";$(".input-pass").xpassword({preview:!0,previewFontClass:"icon-Preview"}),v.on("click",function(){window.open(v.val(),"_blank")}),e.addListener("plusUnlocked",function(){re.setShareFolioLinkLock(p,r)}),e.addListener("plusCancelled",function(){re.setShareFolioLinkLock(p,r)}),G.click(function(){fe("Saving"),p.Title=$.trim(h.find(".title").val()),p.Description=$.trim(h.find(".desc").val()),i.changeLabelProps(p,{success:function(){G.find("i").removeClass("hidden"),G.find("span").text("Saved"),H.text("Close"),setTimeout(function(){G.find("i").addClass("hidden"),G.find("span").text("Save"),H.click()},2e3)},error:function(e){l.error(e.Message)},complete:function(){fe()}})});var pe=function(){p.isLabel?(O.text("Link Sharing"),n.attr("title","Link Sharing is "+(p.Private?"Off":"On")),p.Private?(o.text(""),y.text("Off")):(o.text("On"),y.text("")),h.find(".title").val(""==p.Title||null==p.Title||null==p.Title?p.Name:p.Title)):(O.text("Link Sharing is "+(p.Private?"Off":"On")),n.attr("title","Link Sharing is "+(p.Private?"Off":"On")),h.find(".title").val(p.Title)),h.find(".desc").val(p.Description)};F.find(".loading-animation").html(l.spinner);var fe=function(e){f=!!e,E.text(e),T.toggleClass("busy",f)},he=function(){i.updatePrivacy(p,{success:function(){},error:function(e){l.error(e.Message)},complete:function(){fe(),T.toggleClass("private",p.Private),ne.find(".folio-item[data-token="+p.Token+"] .link-share-cont span").text(p.Private?"Off":"On"),$e(),N.prop("checked",p.Indexed),p.isLabel||Te()}})};function ge(){l.show(h),fe("Restoring default url"),i.removeFoliosCurl({data:{token:p.Token},success:function(e){oe=p.Token,s.folioStorage(p.Token).store("curl",oe),xe(),ke(),J.val(oe),fe()},error:function(e){l.error(e.Message),fe()}})}function ve(){l.show(h)}K.on("click",function(e){e.preventDefault(),l.message({heading:"Restore to Default",message:"You are about to restore the default url for this folio.",btnText:"Go ahead",cancelText:"Cancel",handleOK:ge,handleNo:ve})}),n.on("click",function(){c.isSingleFolioGuest()?l.teamUserActionBlocked("link"):(p.IsUserTemplate||p.IsTeamTemplate?fe("Making template "+(p.Private?"public.":"private.")):p.isLabel?fe("Making Label "+(p.Private?"public.":"private.")):fe("Making folio "+(p.Private?"public.":"private.")),p.Private=!p.Private,p.Private&&(p.Indexed=!1),he(),pe())}),N.on("click",function(){if(c.isSingleFolioGuest())return N.prop("checked",p.Indexed),l.push(h),void l.teamUserActionBlocked("link");p.Indexed=$(this).is(":checked"),he()}),A.on("click",function(){if(c.isSingleFolioGuest())return A.prop("checked",p.PresentationMode),l.push(h),void l.teamUserActionBlocked("link");var e=p.PresentationMode=$(this).is(":checked");i.changePresentMode({token:p.Token,present:e,error:function(e){l.error(e.Message)}})}),U.on("click",function(){var e=null!=r?r:c.isFolioOwner(d.userEmail,p),a=$(this);if(l.push(h),M.hide(),d.Team&&d.Team.Id){if(c.isProTeamMember()||c.isFreeWithTeam()||c.isBusinessTeamMember()&&!e)return void function(){var e=null!=r?r:c.isFolioOwner(d.userEmail,p);if(heading="You Cannot Perform this Action",popupOpts={notMini:!0,bodyCentered:!0},c.isBusinessTeamMember())e||l.teamUserActionBlocked("password-protect-biz",null!=r?"channel":"folio");else if(c.isOwner()){popupOpts.btnText="See Plans",popupOpts.cancelText="Nevermind",popupOpts.handleOK=function(){l.payment("showPlans")},popupOpts.handleNo=function(){l.show(h)},popupOpts.heading=heading,popupOpts.message="Password protection is only available on the Business plan. Please upgrade.",l.message(popupOpts)}else l.teamUserActionBlocked("password-protect")}();if(5===d.Team.Role)return void l.teamUserActionBlocked("link")}0<d.Team.Id&&0<d.Team.Role&&d.Team.Role<5?(l.pop(),e?(I.show(),fe("Removing folio password."),i.removeObjPass({isLabel:p.isLabel,token:p.Token,success:function(){a.toggleClass("selected"),p.HasPass=!1,h.find(".input-pass-dot").val(""),c.isSingleFolioGuest()&&U.removeClass("selected"),a.hasClass("selected")?I.show():I.hide()},error:function(e){l.push(h),l.error(e.Message)},complete:function(){fe()}})):l.teamUserActionBlocked("password-protect-biz")):(l.pop(),e?(I.show(),fe("Removing folio password."),i.removeObjPass({isLabel:p.isLabel,token:p.Token,success:function(){a.toggleClass("selected"),p.HasPass=!1,h.find(".input-pass-dot").val(""),a.hasClass("locked")&&U.removeClass("selected"),a.hasClass("selected")?I.show():I.hide()},error:function(e){l.push(h),l.message({heading:"Oops!",message:e.Message,btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){l.payment("showPlans")}})},complete:function(){fe()}})):l.teamUserActionBlocked("password-protect-biz"))}),F.click(function(){var e=c.isFolioOwner(d.userEmail,p);l.push(h);var a=h.find(".input-pass-dot").val();a?(M.hide(),0<d.Team.Id&&0<d.Team.Role?(l.pop(),e?(F.find(".loading-animation").removeClass("hidden"),F.find("span").text("Saving"),i.setObjPass({isLabel:p.isLabel,token:p.Token,pass:a,success:function(){p.HasPass=!0},error:function(e){l.push(h),l.error(e.Message)},complete:function(){F.find(".loading-animation").addClass("hidden"),F.find("img").removeClass("hidden"),F.find("span").text("Saved"),setTimeout(function(){F.find("img").addClass("hidden"),F.find("span").text("Save")},3e3)}})):l.teamUserActionBlocked("password-protect-biz")):e?(F.find(".loading-animation").removeClass("hidden"),F.find("span").text("Saving"),i.setObjPass({isLabel:p.isLabel,token:p.Token,pass:a,success:function(){p.HasPass=!0},error:function(e){l.push(h),l.error(e.Message)},complete:function(){F.find(".loading-animation").addClass("hidden"),F.find("img").removeClass("hidden"),F.find("span").text("Saved"),setTimeout(function(){F.find("img").addClass("hidden"),F.find("span").text("Save")},3e3)}})):l.error("Only the folio owner can set the password. Get in touch with the owner of this folio to add a password.")):M.show()}),P.on("click",function(){C.show(),P.hide()}),k.on("click",function(){C.hide(),x.val(""),P.show()}),a.on("click",function(){a.removeClass("selected"),t.removeClass("selected").filter(":eq("+$(this).addClass("selected").index()+")").addClass("selected"),p.isLabel&&(Y.hide(),B.removeClass("hideLabel"))}),D.click(function(){if(!f){var e=$.trim(w.val()),a=x.val();if(L.removeClass("error success").hide(),e&&0<e.length){var t=e.split(","),n=[];if($.each(t,function(e,a){validator.isEmail($.trim(a))||n.push(a)}),n.length)1==n.length?L.text('"'+n[0]+'" is not a valid email.').addClass("error").show():L.text(n.map(function(e){return'"'+e+'"'}).join(", ")+" are not valid email addresses.").addClass("error").show();else{D.find("span").text("Sending"),D.prepend(R),f=!0;var o={token:p.Token,addresses:e,message:a,modId:ie,success:function(){D.addClass("sent").find("span").text("Sent"),setTimeout(function(){D.removeClass("sent").find("span").text("Send Email")},3e3)},error:function(e){L.text(e.Message).addClass("error").show(),D.find("span").text("Send Email")},complete:function(){f=!1,R.remove()}};p.isLabel?i.sendLabelEmail(o):i.sendShareEmail(o)}}else L.text("Please type one or more valid emails addresses to send message.").addClass("error").show()}});B.on("click",function(){B.addClass("hideLabel"),Y.show()}),H.on("click",function(){p.Title||p.Description?B.text("Edit page title and description"):B.text("Add page title and description"),B.removeClass("hideLabel"),Y.hide()});function be(t,n){v.animate({"margin-left":"-="+t+"px",width:"+="+t+"px"},n,function(){var e,a;e=t,a=n,v.animate({"margin-left":"+="+e+"px",width:"-="+e+"px"},a,function(){be(e,a)})})}function Te(){var e=Ce(v.parent(),"copy-field folio-link");if(e<=de?(se=e,v.css("width",e+"px")):v.outerWidth()<de&&de<=e&&(se=de,v.css("width",de+"px")),(e-=1)>v.outerWidth()){var a=(e-v.outerWidth())/100*3500;a<2e3&&(a=2e3),be(e-v.outerWidth(),a)}else ye()}function ye(){v.stop(),v.css({"margin-left":"0",width:se+"px"})}function Ce(e,a){var t=$("<span>");t.css({visibility:"hidden","white-space":"pre"}).addClass(a+" tmp-calc").html(v.val()),p.isLabel&&t.css({"text-overflow":"unset","font-family":v.css("font-family"),"font-weight":v.css("font-weight"),"font-size":v.css("font-size")}),e.append(t);var n=e.find(".tmp-calc").outerWidth();return t.remove(),n}function we(e){if("view"==e)J.parent().addClass("hidden"),j.addClass("hidden"),V.removeClass("hidden"),z.removeClass("hidden"),Z.addClass("hidden"),g.removeClass("no-border"),ee.html(""),p.isLabel||(ye(),Te());else if("edit"==e){if(J.parent().removeClass("hidden"),j.removeClass("hidden"),V.addClass("hidden"),z.addClass("hidden"),v.val(d.baseUrl+"/"),g.addClass("no-border"),!p.isLabel){ye();var a=Ce(v.parent(),"copy-field folio-link");J.parent().css("left",a+"px")}ke()}}function ke(){s.folioStorage(p.Token).fetch("curl")||p.Curl;p.Token}function xe(){var e=d.baseUrl+Pe();v.val(e),z.attr({href:e}),b.val("<iframe onload="+ce+" "+ue+' src="'+m.addParamToUrl(e,me)+'"></iframe>')}function $e(){if(p.isLabel)var e=Ce($("body"),"copy-field folio-link");else e=Ce(v.parent(),"copy-field folio-link");se=v.outerWidth(),8==v.val().length&&(se=e,v.css("width",se+"px")),e<=de&&(se=e,v.css("width",se+"px"))}function Pe(){if(p.isLabel)return"/channel/"+p.Token;s.folioStorage(p.Token).fetch("curl")||p.Curl;return"/"+oe}function Se(e,a,t){var n,o,i,s,r;xe(),we("view"),p.Role<2&&h.addClass("user-cannot-edit"),p.IsUserTemplate||p.IsTeamTemplate?(h.find(".header-message .private .f-t").text("This template is set to private, only you (and your collaborators) can view/use it."),h.find(".header-message .public .f-t").text("Anyone with the link can use your template."),h.find(".header-pass-desc.f-t").text("Password protect your template"),h.find(".url-content h3.f-t").text("Template share URL"),h.find(".email-content h3.f-t").text("Send template via email"),h.find(".embed-content h3.f-t").text("Embed your template"),ae.addClass("hidden")):(h.find(".header-message .private .f-t").html("This folio is set to private. Only you and your collaborators can view or edit it. <br> Warning: If you publicly share the channel(s) this folio is in, <br>others may still be able to view this folio."),h.find(".header-message .public .f-t").text("Anyone with the link can view your folio."),h.find(".header-pass-desc.f-t").text("Password protect your folio"),h.find(".url-content h3.f-t").text("Folio share URL"),h.find(".url-content h3.f-t").text("Send a link"),h.find(".embed-content h3.f-t").text("Embed your folio")),p.isLabel?(_.text(p.Name),url=d.baseUrl+"/channel/"+oe,v.val(url),z.attr({href:url}),b.val("<iframe onload="+ce+" "+ue+' src="'+m.addParamToUrl(url,me)+'"></iframe>'),pe(),V.addClass("hidden")):(a=a||0,url=0<(ie=a)?d.baseUrl+"/folio"+Pe()+"/"+a:d.baseUrl+Pe()+"",v.val(url),z.attr({href:url}),b.val("<iframe onload="+ce+" "+ue+' src="'+m.addParamToUrl(url,me)+'"></iframe>'),n=a,o=t,h.toggleClass("mod-share",0<n),h.find(".modh1 .mod-type").text("Canvas"==o?"Canvas":"Module"),h.find(".modp .mod-type").text("Canvas"==o?"canvas":"module"),0<a?V.addClass("hidden"):d.isTeam&&d.Team.Role?(d.Team.Role<4?(V.removeClass("hidden"),J.val(oe),u.remove(q)):u.add(q,"Needs more access",1e3),(c.isProBusiness()||c.isProTeamMember()||c.isFreeWithTeam())&&u.add(q,le,1e3)):u.add(q,le,1e3)),pe(),i=url,r=p.isLabel?(s=p.Title||p.Name,p.Description||'All my folios labelled "'+p.Name+'" on Xtensio. #'+p.Name.replace(/ /g,"")):(s=p.FolioName,'My folio "'+p.FolioName+'" on Xtensio.'),$.shareLinks(i,h,s,r,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin"),p.isLabel?(B.removeClass("hideLabel"),Y.hide(),(p.Title||p.Description)&&B.text("Edit page title and description")):(B.addClass("hideLabel"),Y.hide()),l.show(h),$e(),p.isLabel||Te()}function De(e){if(!(e.Version<2)){ae.removeClass("hidden"),te.html(""),$.each(e.Collaborators,function(e,a){if(a.Accepted&&0<a.Privilege&&a.Email!=d.userEmail){te.removeClass("hidden"),ae.addClass("hidden");var t=$('<div class="outer"><div class="initials">MN</div></div>');t.find(".initials").text(m.getInitials(a.FullName||a.Email)).attr("data-tip",a.FullName),te.prepend(t.find(".initials"))}});var a=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');c.isSingleFolioGuest()?(a.attr("data-tip","Add / Remove People"),a.click(function(){l.teamUserActionBlocked("add-remove-collab","Guests")})):(1===e.Role?a.addClass("hidden"):a.removeClass("hidden"),a.attr("data-tip","Add / Remove People"),a.click(function(){return l.collaborators(p),!1})),te.append(a)}}return l.reg(h,h.find(".icon-Close")),q.on("click",function(){if(q.hasClass("locked"))return function(){heading="You Cannot Perform this Action";var e=c.isBusinessTeamMember()&&(c.isPremiumGuest()||c.isSingleFolioGuest())?"Premium Guests cannot customize shared links. Please contact the admin for more access.":"Custom links are only available on the Business plan. Please contact your team owner to upgrade your account.";if(popupOpts={notMini:!0,bodyCentered:!0},c.isPremiumGuest()||c.isSingleFolioGuest())heading="You Cannot Perform this Action",popupOpts.btnText="Ok",popupOpts.handleOK=function(){l.show(h)};else{if(c.isTeamMember()||c.isAdmin())return l.teamUserActionBlocked("edit-link","",function(){l.show(h)});popupOpts.btnText="See Plans",popupOpts.cancelText="Nevermind",popupOpts.handleOK=function(){l.payment("showPlans")},popupOpts.handleNo=function(){l.show(h)}}popupOpts.heading=heading,popupOpts.message=e,l.message(popupOpts)}(),!1;we("edit")}),W.on("click",function(){xe(),we("view")}),Q.click(function(){if(console.log("isSafari",m.isSafari()),Q.find(".loading-animation").removeClass("hidden"),m.isSafari()){var e=document.querySelector("#tmp-popup-folio-share-link .copy-field"),a=e.contentEditable,t=e.readOnly;e.contentEditable=!0,e.readOnly=!0;var n=document.createRange();n.selectNodeContents(e);var o=window.getSelection();o.removeAllRanges(),o.addRange(n),e.setSelectionRange(0,999999),e.contentEditable=a,e.readOnly=t}else g.select();document.execCommand("copy"),Q.find("span").text("Copied"),Q.find(".loading-animation").addClass("hidden"),Q.find("img").removeClass("hidden"),setTimeout(function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),Q.find("img").addClass("hidden"),Q.find("span").text("Copy link")},2e3)}),X.on("click",function(){Z.addClass("hidden"),ee.html("");var a=J.val().trim(),e=d.baseUrl+"/"+a;a.match(/^[a-z\d\-\s]+$/i)?255<e.length?(Z.removeClass("hidden"),ee.html("Url can have maximum of 255 characters.")):(a=a.replace(/ /g,"-"),X.find(".loading-animation").removeClass("hidden"),i.checkCurlAvailability({curl:a,token:p.Token,success:function(e){1==e.StatusCode?(X.find(".loading-animation").removeClass("hidden"),i.updateFolioCurl({curl:a,token:p.Token,success:function(){},error:function(e){l.push(h),l.error(e.Message)},complete:function(){X.find("img").removeClass("hidden"),X.find("span").text("Saved"),X.find(".loading-animation").addClass("hidden"),oe=a,s.folioStorage(p.Token).store("curl",oe),xe(),setTimeout(function(){X.find("img").addClass("hidden"),X.find("span").text("Save"),we("view")},3e3)}})):(X.find(".loading-animation").addClass("hidden"),l.push(h),l.error(e.Message))},error:function(e){3==e.StatusCode?(X.find("img").removeClass("hidden"),X.find("span").text("Saved"),X.find(".loading-animation").addClass("hidden"),setTimeout(function(){X.find("img").addClass("hidden"),X.find("span").text("Save"),we("view"),p.isLabel||Te()},3e3)):4==e.StatusCode?(X.find("img").removeClass("hidden"),X.find("span").text("Saved"),X.find(".loading-animation").addClass("hidden"),oe=a,s.folioStorage(p.Token).store("curl",oe),xe(),setTimeout(function(){X.find("img").addClass("hidden"),X.find("span").text("Save"),we("view")},3e3)):(X.find(".loading-animation").addClass("hidden"),l.push(h),l.error(e.Message))},complete:function(){}})):(Z.removeClass("hidden"),ee.html("Only numbers, letters and hyphens are allowed in custom links."))}),ae.click(function(e){l.collaborators(p)}),function(e,a,t,n){p=e,r=n,re.setShareFolioLinkLock(p,r),T=h.find(".popup-content").toggleClass("private",p.Private);var o,i=c.isBusinessTeamMember()&&c.isFolioOwner(d.userEmail,p);T.toggleClass("show-business-tooltip",i),p.HasPass?c.isSingleFolioGuest()?S.val(""):S.val("****"):S.val(""),I=h.find(".pass-section").toggle(p.HasPass),U=h.find(".pass-protect").toggleClass("selected",p.HasPass),I.removeClass("show-pass"),p.HasPass&&I.show(),N.prop("checked",p.Indexed),A.prop("checked",p.PresentationMode),h.find(".popup-wrapper").toggleClass("all-label",!!p.isLabel),h.find(".tab, .tabs span").removeClass("selected"),h.find(".tabs span:eq(0), .url-content").addClass("selected"),te.addClass("hidden"),p.isLabel||p.Role&&1===p.Role?ae.addClass("hidden"):(ae.removeClass("hidden"),De(p)),o=function(){Se(0,a,t)},oe=s.folioStorage(p.Token).fetch("curl")||p.Curl||p.Token,o&&o()}},app.popup.getSignUpPerformance=function(l,s,e,d,a,c){var u,m={},p=$("#tmp-sign-up-performance"),t=p.find(".icon-Close"),n=p.find(".export"),f=p.find(".total-count"),h=p.find(".new-items"),g=p.find(".f-name"),v=g.find("a"),b=p.find(".performance-table tbody"),T=p.find(".paper");function y(a,t,e){var n,o,r,i=m[u=a];i?(n=u,o=i.list,r=i.data,c.get(n,"viewed",function(i){var s=0;i=new Date(JSON.parse(i||JSON.stringify(new Date(2016,4,30).getTime()))),T.removeClass("busy"),r.t!=l.token?(v.text(r.n).attr("href","/edit/"+r.t),g.show()):g.hide(),f.html(o.length+(1==o.length?" Response":" Total Responses")),b.empty(),$.each(o,function(e,a){var t="</td><td>";a.Created>i&&(t="<span></span></td><td>",s++);var n=a.Created.getMonth()+1;n=n<10?"0"+n:n;var o=a.Created.getDate();o=o<10?"0"+o:o,b.append("<tr><td>"+t+n+"/"+o+"/"+a.Created.getFullYear()+"</td><td>"+a.Data.email+"</td></tr>")}),h.html(s+" New"),s&&c.set(n,"viewed",JSON.stringify(new Date))})):t?(m[u]={list:t,data:e},y(u,t,e)):(T.addClass("busy"),d.getRecords({id:u,success:function(e){t=JSON.parse(e.Message),$.each(t,function(e,a){a.Created=new Date(a.Created),a.Data=JSON.parse(a.Data)}),c.reg(a,JSON.parse(e.Data.s)),y(u,t,e.Data)},error:function(e){s.error()}})),s.show(p,i?"res-"+a:"")}return T.find(".loading-animation").html(s.spinner),s.reg(p,t),n.on("click",function(){var e=m[u];if(e){e=e.list;var n="data:text/csv;charset=utf-8,Date,Email\n",o=e.length;$.each(e,function(e,a){var t=1+a.Created.getMonth()+"/"+a.Created.getDate()+"/"+a.Created.getFullYear()+","+a.Data.email;n+=e<o?t+"\n":t});var a=encodeURI(n);window.open(a)}}),a.addListener("newSignUp",function(e){var a=m[e.Data.ModId];a&&a.list.unshift({ID:e.Data.RecId,Created:new Date(e.Time),Data:e.Data.Data})}),y.reg=function(e,a,t){m[e]={list:a,data:t}},y},app.popup.getTransferFolio=function(t,n,e,a,o){var i,s,r,l={search:1,busy:2,found:3,notFound:4,sent:5},d=$("#tmp-transfer"),c=d.find(".paper"),u=d.find(".popup-header h1"),m=c.find(".email").val(""),p=c.find(".msg-box"),f=p.find(".msg"),h=p.find(".msg-content"),g=p.find(".close-msg-btn"),v=c.find(".error"),b=c.find(".found").find(".name"),T=c.find(".not-found"),y=T.find(".name"),C=c.find(".add-msg"),w=c.find(".popup-cta"),k=c.find(".result"),x=c.find(".full-name").val(""),P=c.find(".back-btn"),S=t.token,D=!1;function F(e){var a=c.height()+16;switch(i=e,m.prop("readonly",!0),c.css("min-height",""),c.removeClass("busy search sent found not-found"),i){case l.busy:c.css("min-height",a).addClass("busy");break;case l.found:c.addClass("found"),b.text(s),w.text("Transfer");break;case l.notFound:c.addClass("not-found"),y.text(r),w.text("Invite & Transfer");break;case l.sent:c.addClass("sent"),w.addClass("no").removeClass("yes").text("Close"),k.find(".name").text(s||x.val()+" signs up and");break;default:c.addClass("search"),m.prop("readonly",!1),w.text("Search")}}function I(){F(l.busy),a.transfer({data:{token:S,name:s||x.val(),email:r,message:f.val(),AllowOutside:!0},success:function(e){F(l.sent)},error:function(e){F(l.search),v.show().text(e.Message||"There was an error. Please try later.")}})}return c.find(".loading-animation").html(n.spinner),C.click(function(){C.hide(),h.show()}),g.click(function(){C.show(),h.hide(),f.val("")}),P.click(function(){m.val(""),F(l.search)}),w.click(function(){switch(i){case l.search:r=$.trim(m.val());var e=validator.isEmail(r);e&&r==t.userEmail&&t.Team&&0<t.Team.Id&&1==t.Team.Role?n.transferFolioToSpace({sameUser:!0,Data:{Token:S,TeamID:t.Team.Id,Owner:r}}):e&&r==t.userEmail&&t.Team&&0==t.Team.Id?v.show().text("You can not transfer to yourself!"):e?(v.hide(),F(l.busy),a.findUser({email:r,success:function(e){t.Team&&0<t.Team.Id&&t.Team.Role<4&&e.Message&&(D?F(l.found):a.listTeamMembers({data:{teamId:t.Team.Id},success:function(e){for(var a=!1,t=0;t<e.Data.Data.length;t++)e.Data.Data[t].Email==r&&(a=!0,s=e.Data.Data[t].UserName,5==e.Data.Data[t].Role&&(a=!1,F(l.search),v.show().text(e.Message||"This user is a Single Folio User on this team."),!0));a?F(l.found):n.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){v.show().text(e.Message||"There was an error. Please try later.")}})),t.Team&&0<t.Team.Id&&t.Team.Role<4&&!e.Message?n.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(s=e.Message||s,F(e.Message?l.found:l.notFound))},error:function(){F(l.search),v.show().text("There was an error. Please try later.")}})):v.show().text("Invalid Email");break;case l.found:I();break;case l.notFound:s=x.val(),T.toggleClass("no-name",!s),s&&I();break;default:n.close()}}),d.find(".is-team-admin").click(function(){n.transferTeamFolio(S,{allowOutside:!0})}),n.reg(d,d.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(e,a){D=!1,a&&(D=a.allowOutside||!1),D?u.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>'):u.html("Transfer Ownership"),t.Team&&0<t.Team.Id&&5==t.Team.Role?n.teamUserActionBlocked("transfer"):t.Team&&0<t.Team.Id&&4==t.Team.Role?n.teamUserActionBlocked("transfer","Premium Guests"):(t.Team&&0<t.Team.Id&&(1==t.Team.Role||2==t.Team.Role)&&!D?d.addClass("team-allow-out"):d.removeClass("team-allow-out"),S=e||S,v.hide(),F(l.search),m.val(""),w.addClass("yes"),g.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&w.click()}),n.show(d))}},app.popup.getUnarchivePopup=function(t,n){return function(e,a){t.message({heading:"Are you sure you want to recover?",message:"This folio will return to your dashboard as an active folio. You will be able to edit and share this folio again.",btnText:"Yes, Recover This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){t.busy(),n.deleteFolio({data:{op:"undo",token:e.Token},success:a,error:function(e){5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error("There was an error. Please refresh page and try again.")}})}})}},app.popup.upgradePrompt=function(r,l,e,a,d,t){r.plusInfo?r.plusExpireTime=r.plusInfo.End:r.plusExpireTime=Date.now();var c=$("#tmp-upgrade-prompt"),u=c.find(".msg");return c.find(".upgrade-panel").html(l.upgrade),l.reg(c,c.find(".icon-Close")),c.find(".ok").click(function(){l.payment()}),function(e,o,a,t){var n=Date.now();if("pass"==e)d.getData(1,function(e,a,t,n){a?10==e.ST||11==e.ST||3==e.ST||16==e.ST?l.billing():o():l.payment()});else if((r.autoRenew||n<r.plusExpireTime)&&o)o();else{if(a)return void("create"==e?d.getData(1,function(e,a,t,n){var o=1,i="Free Forever";(a&&10==e.ST||11==e.ST)&&(o=5,i="Xtensio Plus"),(a&&16==e.ST||3==e.ST)&&(o=5,i="Free Plus");var s="Free Forever"==i?'The limit on your personal dashboard (<a href="http://app.xtensio.com" target="_blank">app.xtensio.com</a>) is one active folio at a time':"The "+i+" plan has a limit of "+o+" active folio"+(1<o?"s":"");l.message({heading:"You've reached your folio limit!",message:s+".  To work on more folios, please delete/leave some old folios or upgrade to premium plans.",btnText:"See Plans",cancelText:"Nevermind",notMini:!0,handleOK:function(){10==e.ST||11==e.ST?(console.log("From here..."),l.billing()):l.payment()}})}):l.payment());if(t)return void l.billing();var i='Unlock <a class="x-plus" target="_blank" href="//xtensio.com/plus">Xtensio Plus</a> ',s="Xtensio Plus allows you to export your folio as PDF or PNG";u.show(),"create"==e?(i+="to create more folios",s="With a free account, you're limited to 1 folio"):(i+="to access this feature",u.hide()),c.find("h1").html(i),c.find(".desc").text(s),l.show(c)}}},app.popup.getUserMenu=function(s,r,e,a,t){var n=Date.now()<s.plusExpireTime,o=$("#top-bar .user-menu-popup"),i=o.find(".e-settings"),l=o.find(".logout"),d=o.find(".billing"),c=o.find(".plus"),u=o.find(".settings"),m=(o.find(".nav-setmenu li"),!1);function p(){(n||s.everPlus)&&d.text("Billing")}function f(){$("#dashboard-page .upgrade-user").show(),$(".user-menu-popup .upgrade-user").show(),$("#tmp-dash-topbar .upgrade-btn, #tmp-primary-bar .upgrade-btn").remove(),$(".user-menu-popup li.item.upgrade").remove()}s.isTeam&&s.Team&&1!==s.Team.Role&&d.hide(),p(),e.addListener("plusUnlocked",p),u.click(function(){r.settings()}),c.click(function(){r.plusInfo()}),i.click(function(){r.emailSettings()}),l.click(function(){$("#logoutForm").submit()}),d.click(function(){a.getData(0,function(e,a,t,n){console.log(t,a,s.everPlus,e);var o=!1;if(s.UserTeams)for(var i=0;i<s.UserTeams.length;i++)1==s.UserTeams[i].Role&&(o=!0);1==e.ST||2==e.ST||9==e.ST||10==e.ST||11==e.ST||34==e.ST||s.everPlus||a||o?r.billing():r.payment()})}),setTimeout(function(){if(s.Team&&0!==s.Team.Id&&!m&&(m=!0,1!==s.Team.Role)){var e=_.find(s.UserTeams,function(e){return 1===e.Role});e||s.isTrial||s.isTrialCanceled?(!e&&s.ReActivationData&&s.ReActivationData.LastPlan||e&&0!==e.ST&&0===s.autoRenew&&!s.isTrialCanceled&&s.trialConverted)&&(f(),$("#dashboard-page .upgrade-user, .user-menu-popup .upgrade-user").click(function(e){e.preventDefault(),r.payment()})):(f(),$("#tmp-signup-plans i.icon-Close").show(),$("#dashboard-page .upgrade-user, .user-menu-popup .upgrade-user").click(function(e){e.preventDefault(),window.location.href=t.getAppUrl(s.Environment)+"teams/create"}))}},2500)},app.popup.folioPass=function(e){var a,t=$("#tmp-get-fpass"),n=t.find(".pass"),o=t.find(".agree-box"),i=t.find(".agree"),s=t.find(".folio-msg"),r=t.find(".project-msg"),l=t.find("form"),d=t.find(".error-msg").text(e.passError),c=t.find("button");t.find(".token").val(e.verificationToken),e.isProject&&(s.hide(),r.removeClass("hidden"),i.prop("checked",!e.disclaimer),e.disclaimer&&o.removeClass("hidden")),n.on("keyup",function(e){a=!n.val(),c.prop("disabled",a)}),l.submit(function(){return n.val()?e.isProject&&!0!==i[0].checked?(d.text("You must agree with the Disclaimer first."),!1):void 0:(d.text("No password given."),!1)}),$("body").append(t.addClass("show"))},app.popup.getAddMembers=function(e,a,t){var n=$("#tmp-add-member"),o=n.find(".no, .icon-Close"),i=n.find(".ok"),s=n.find("input");return n.find(".loading-animation").html(a.spinner),i.click(function(){console.log(s.val())}),a.reg(n,o),function(e){a.show(n)}},app.popup.getTeamUserActionBlocked=function(e,n,o){var i;return"You Cannot Perform this Action",function(e,a,t){switch(i='<div class="msg text-center">Sorry, '+(a||"Single Folio Guests")+" are not allowed to ","pwd"==e?i+="edit password of this folio.":"collab"==e?i+="modify the Collaborators.":"duplicate"==e?i+="duplicate folios.":"create"==e?i=(a||"Single Folio Guests")+" are not allowed to create folios. ":"link"==e?i+="modify link sharing settings.":"transfer"==e?i+="transfer folio.":"label"==e?i+="create new channels.":"non-team-member"==e?"Guests"==a||"Premium Guests"==a?i='<div class="msg text-center">Sorry, Premium Guests can only invite existing team members':i+="invite non team members.":i+="invite-member"==e?"add new paid users to the team.":"save-as-template"==e?"create custom templates.":"add-remove-collab"==e?"add/remove people.":"perform this action.",i+=" Please contact your admin for more access.",e){case"existing-sfg":i="This user is already a single folio guest on this team. Please contact your team admin to upgrade.";break;case"stats":o.isBusinessTeamMember()?"Guests"==a&&(i="Premium Guests cannot view Folio Stats. Please contact the admin for more access."):i="Folio stats are available on the Business plan. Please contact your team owner to upgrade your account.";break;case"template-stats":o.isBusinessTeamMember()?"Guests"==a&&(i="Premium Guests cannot view Template Stats. Please contact the admin for more access."):i="Template stats are available on the Business plan. Please contact your team owner to upgrade your account.";break;case"password-protect":i="Password protection is only available on the Business plan. Please contact your team owner to upgrade your account.";break;case"password-protect-biz":i="Only the ".concat("channel"==a?"channel":"folio"," owner can set/remove the password. Get in touch with the owner of this ").concat("channel"==a?"channel":"folio"," to add a password.");break;case"edit-link":o.isBusinessTeamMember()?"Single Folio Guests"!=a&&"Premium Guests"!=a||(i="Premium Guests cannot customize shared links. Please contact the admin for more access."):i="Custom links are only available on the Business Plan. Please contact your team owner to upgrade your account.";break;case"team-member-collab":i="Team members can only add collaborators that are already part of the team. If you'd like to add new users to the team, please reach out to your team owner for more access.";break;case"guest-collab":case"add-remove-collab":i="Guests cannot add collaborators. Please reach out to the team owner for more access."}n.message({heading:"You Cannot Perform this Action",message:i,btnText:"Ok",notMini:!0,bodyCentered:!0,handleOK:t||!1})}},app.popup.getTransferFolioToSpace=function(s,r,l,e,a){var d=$("#tmp-transfer-folio-to-space"),n=d.find(".no-show"),t=d.find(".cancel, .icon-Close"),o=d.find(".teams"),i=d.find(".btn-decline"),c=0,u=null,m=null,p=!1,f=0,h="",g="",v=!1,b=!1,T=!1;function y(n,o,i){console.log("transferFolioToSpace => doSaveFolio..."),console.log("token teamId url",n,o,i),l.getFolioByToken({token:n,success:function(e){var t=JSON.parse(e.Data);l.getFolioCollaborators({token:u,success:function(a){console.log("response collaborators",a),l.getWorkspaceChannels({teamId:o,success:function(e){console.log("response channels",e),p=!1,d.find(".loading-animation").hide(),s.saveFolioTransferWithTeam={FolioName:t.FolioName,Token:n,collaborators:JSON.parse(a.Data),labels:JSON.parse(e.Data),baseUrl:i},console.log("saveFolioTransferWithTeam",s.saveFolioTransferWithTeam),r.saveFolio()},error:function(e){console.log("error in getWorkspaceChannels",e)}})},error:function(e){console.log("error in getFolioCollaborators",e)}})},error:function(e){console.log("error in getFolioByToken",e)}})}d.find(".loading-animation").html(r.spinner);function C(e,i){return function(){var a,t,n,o;v?(n=e,o=i,console.log("transferFolioToSpace => moveToAnySpace..."),p=!0,d.find(".loading-animation").show(),l.moveUserFolios({userEmail:s.userEmail,source:f,destination:n,folios:u,success:function(e){var a=$("#folio-items-container").find(".folio-item-shell[data-token='"+u+"']");a.animate({width:0,opacity:0,padding:0},500,"linear",function(){a.remove()}),y(u,n,o)},error:function(e){p=!1,d.find(".loading-animation").hide(),5==e.StatusCode?r.plusPrompt("create",null,!0):10==e.StatusCode?r.plusPrompt("create",null,!1,!0):r.error(e.Message)}})):(a=e,t=i,p||(console.log("transferFolioToSpace => addFolioToId..."),p=!0,d.find(".loading-animation").show(),l.setUserDefinedTeam({notificationId:c,teamId:a,success:function(){l.processTransfer({data:{verb:"accept",secret:m,teamId:a},success:function(){if(0==a&&s.Team.Id==f&&h==s.userName&&s.isHome){var e=$("#folio-items-container").find(".folio-item-shell[data-token='"+u+"']");e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})}y(u,a,t)},error:function(e){p=!1,d.find(".loading-animation").hide(),5==e.StatusCode?r.plusPrompt("create",null,!0):10==e.StatusCode?r.plusPrompt("create",null,!1,!0):r.error(e.Message)}})},error:function(e){r.error(e.Message)}})))}}function w(e){return function(){0==e.search(/https/)?window.location.href=e+"#accepttransfer/"+u:window.location.href=window.location.protocol+"//"+e+"#accepttransfer/"+u}}return i.click(function(){!0===b&&!0===T?$("#n-panel .item.notificationItemToken-"+u+" .no").click():l.processTransfer({data:{verb:"reject",secret:m},success:function(){location.reload()},error:function(e){r.error(e.Message)}})}),r.reg(d,t),function(e){console.trace("on transferFolioToSpace"),b=e.skipPersonal,T=e.outsideRequest,e&&e.sameUser?(v=e.sameUser,u=e.Data.Token,f=e.Data.TeamID,h=e.Owner):e&&(c=e.Id,u=e.Data.Token,m=e.Data.Code,f=e.Data.TeamID,h=e.Owner),e.verb&&(g=e.verb),console.log("verb",g),"reject"===g?i.trigger("click"):(!function(){if(console.log("transferFolioToSpace => init..."),!0===b&&!0===T&&d.addClass("outside-transfer"),s.UserTeams&&s.Team&&0!=s.Team){o.empty();var e=$(n.html());!0!==b&&(e.find("h3").text("Personal Account"),e.on("click",C(0,"")),o.append(e));for(var a=0;a<s.UserTeams.length;a++){var t=!1;5!=s.UserTeams[a].Role&&(console.log(v,s.UserTeams[a].Id,s.Team.Id),v&&s.UserTeams[a].Id==s.Team.Id&&(t=!0),t||(e=$(n.html()),4!=s.UserTeams[a].Role&&5!=s.UserTeams[a].Role||(e.find("h3").hide(),e.find(".left").hide(),e.find(".right").hide(),e.find("h3").text(s.UserTeams[a].Name).hide()),e.find("h3").text(s.UserTeams[a].Name),!0===T?e.on("click",w(s.UserTeams[a].TeamUrl)):e.on("click",C(s.UserTeams[a].Id,s.UserTeams[a].TeamUrl)),o.append(e)))}}}(),r.show(d))}},app.popup.getTransferTeamFolio=function(t,n,e,o,a){var i,s,r,l={search:1,busy:2,found:3,notFound:4,sent:5},d=$("#tmp-team-transfer"),c=d.find(".paper"),u=d.find(".popup-header h1"),m=c.find(".email").val(""),p=c.find(".msg-box"),f=d.find(".keep-collaborator"),h=f.find(".keep-cb"),g=!1,v=p.find(".msg"),b=p.find(".msg-content"),T=p.find(".close-msg-btn"),y=c.find(".error"),C=c.find(".found").find(".name"),w=c.find(".not-found"),k=w.find(".name"),x=c.find(".add-msg"),P=c.find(".popup-cta"),S=c.find(".result"),D=c.find(".full-name").val(""),F=c.find(".back-btn"),I=d.find(".team-select"),M=t.token,E=!1;function U(e){var a=c.height()+16;switch(i=e,m.prop("readonly",!0),c.css("min-height",""),c.removeClass("busy search sent found not-found"),i){case l.busy:c.css("min-height",a).addClass("busy"),f.hide();break;case l.found:c.addClass("found"),C.text(s),P.text("Transfer"),g&&f.show();break;case l.notFound:c.addClass("not-found"),k.text(r),P.text("Invite & Transfer"),f.hide();break;case l.sent:c.addClass("sent"),P.addClass("no").removeClass("yes").text("Close"),S.find(".name").text(s||D.val()+" signs up and"),f.hide();break;default:c.addClass("search"),m.prop("readonly",!1),P.text("Search")}}function N(){U(l.busy);var e=h.hasClass("selected");console.log("keepOwnerAsCollaborator",e),g||(e=!1),o.transfer({data:{token:M,name:s||D.val(),email:r,message:v.val(),AllowOutside:E,keepOwnerAsCollaborator:e},success:function(e){U(l.sent)},error:function(e){U(l.search),y.show().text(e.Message||"There was an error. Please try later.")}})}return c.find(".loading-animation").html(n.spinner),h.click(function(e){e.preventDefault(),h.toggleClass("selected"),console.log(h.hasClass("selected"))}),x.click(function(){x.hide(),b.show()}),T.click(function(){x.show(),b.hide(),v.val("")}),F.click(function(){m.val(""),U(l.search)}),P.click(function(){switch(i){case l.search:""==(r=$.trim(m.val()))&&(r=I.find(".item.active").data("value"))&&m.val(r);var e=validator.isEmail(r);e&&r==t.userEmail&&t.Team&&0<t.Team.Id&&1==t.Team.Role?n.transferFolioToSpace({sameUser:!0,Data:{Token:M,TeamID:t.Team.Id,Owner:r}}):e?(y.hide(),U(l.busy),o.findUser({email:r,success:function(e){g=!1,t.Team&&0<t.Team.Id&&t.Team.Role<4&&e.Message&&(E?U(l.found):o.listTeamMembers({data:{teamId:t.Team.Id},success:function(e){for(var a=!1,t=0;t<e.Data.Data.length;t++)e.Data.Data[t].Email==r&&(a=!0,s=e.Data.Data[t].UserName,5==e.Data.Data[t].Role&&(a=!1,U(l.search),y.show().text(e.Message||"This user is a Single Folio User on this team."),!0));a?(g=!0,console.log("states.found"),U(l.found)):n.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){y.show().text(e.Message||"There was an error. Please try later.")}})),t.Team&&0<t.Team.Id&&t.Team.Role<4&&!e.Message?n.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(s=e.Message||s,U(e.Message?l.found:l.notFound))},error:function(){U(l.search),y.show().text("There was an error. Please try later.")}})):y.show().text("Invalid Email");break;case l.found:N();break;case l.notFound:s=D.val(),w.toggleClass("no-name",!s),s&&N();break;default:n.close()}}),d.find(".is-team-admin").click(function(){n.transferTeamFolio(M,{allowOutside:!0})}),n.reg(d,d.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(e,a){c.addClass("busy"),E=!1,f.hide(),a&&(E=a.allowOutside||!1),E?(d.addClass("is-outside"),u.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>')):(d.removeClass("is-outside"),u.html("Transfer Ownership")),console.log(a),t.Team&&0<t.Team.Id&&5==t.Team.Role?n.teamUserActionBlocked("transfer"):t.Team&&0<t.Team.Id&&4==t.Team.Role?n.teamUserActionBlocked("transfer","Premium Guests"):(t.Team&&0<t.Team.Id&&(1==t.Team.Role||2==t.Team.Role)&&!E?d.addClass("team-allow-out"):d.removeClass("team-allow-out"),M=e||M,y.hide(),U(l.search),m.val(""),P.addClass("yes"),T.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&P.click()}),o.listTeamMembers({data:{teamId:t.Team.Id},success:function(e){I.find(".filter-popup-menu .item").remove();for(var a=0;a<e.Data.Data.length;a++)4!=e.Data.Data[a].Role&&5!=e.Data.Data[a].Role&&e.Data.Data[a].Email!=t.userEmail&&I.find(".filter-popup-menu").append('<div class="item" data-value="'+e.Data.Data[a].Email+'">'+(e.Data.Data[a].FullName||e.Data.Data[a].Email)+"</div>");c.removeClass("busy")},error:function(e){y.show().text(e.Message||"There was an error. Please try later."),c.removeClass("busy")}}),n.show(d))}},app.popup.getTrialExpirePopup=function(a,s,o,e,t,n){var i=$("#tmp-trial-expire"),r=i.find(".cancel, .popup-close"),l=i.find(".loading-animation"),d=!1,c=l.html(s.spinner),u=!1;function m(){var e;a.Team&&a.Team.Plan&&(e=a.Team.Plan),function(e,a){console.log("plan",e),console.log("origin",d),$("#app-load-animation").show();var t={data:{plan:e||0,renew:0},success:function(e){console.log("response downgrade",e),a(e)},error:function(e){s.error(e.Message||"There was an error. Please try later.")},complete:function(){$("#app-load-animation").hide()}};d&&"cancel"===d?o.changePlan(t):(t.plan=0,o.cancelPlan(t))}(e,function(){c.hide(),n.raiseEvent("plusCancelled"),s.downgradeNoticePopup()})}return i.find(".tr-upgrade").click(function(e){e.preventDefault(),s.payment()}),i.find(".tr-downgrade").click(function(e){e.preventDefault(),s.push(i),s.confirmDowngradePopup()}),s.reg(i,r),function(e,a){d=a||!1,e&&!0===e&&(u=!0,i.find(".popup-content").css({opacity:0}),c.show(),u||(i.find(".popup-content").css({opacity:1}),s.push(i)),t.hasTeam()?m():t.getData(1,function(e,a,t,n){o.getUserActiveFoliosCount({success:function(e){var i=e.Data;o.getUserTemplateCount({success:function(e){var a,t,n=e.Data;if(1<i||0<n){var o={btnText:"Go to Dashboard",notMini:!0,handleOK:function(){s.close()}};1<i&&n<1?(a="Uh oh - You have more than 1 folio!",t="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard.",o.noClose=!0):1<i&&0<n?(a="Uh oh - You have more than 1 folio and saved templates",t="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard.",o.cancelText="Nevermind"):i<2&&0<n&&(a="Uh oh - You have saved templates!",t="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.",o.cancelText="Nevermind"),c.hide(),o.heading=a,o.message=t,s.message(o)}else m()},error:function(e){console.log("getUserTemplateCount error: ",e)}})},error:function(e){console.log("getUserActiveFoliosCount error: ",e)}})})),setTimeout(function(){c.hide(),s.show(i)},200)}},app.popup.getAddTeamMemberPopup=function(e,a,t){var n=$("#tmp-add-team-member"),o=n.find(".cancel, .icon-Close"),i=n.find(".loading-animation"),s=n.find("#member-search");n.find(".loading-animation").html(a.spinner);return s.on("submit",function(e){var a=$(e.target[0]).val();return i.show(),validator.isEmail(a)&&t.findUser({email:a,success:function(e){i.hide(),console.log(e)},error:function(e){e.Message}}),!1}),a.reg(n,o),function(){a.show(n),i.hide()}},app.popup.getChoosePlanPopup=function(e,a,t,n){var o=$("#tmp-choose-plan"),i=o.find(".select"),s=o.find(".ok");return a.reg(o,o.find(".icon-Close")),i.click(function(e){$(this).toggleClass("selected"),s.toggleClass("disabled",!(0<o.find(".select.selected").length)),e.preventDefault()}),function(e){e?a.push(o):a.show(o)}},app.popup.getPersonalChannelPopup=function(e,a,t,n){var o=$("#tmp-personal-channel"),i=o.find(".cancel, .popup-close"),s=o.find(".loading-animation").html(a.spinner),r=!1,l=o.find(".changes-applied"),d=$("#pchannel_name"),c=$("#pcollab-channel-cont"),u=o.find(".add-new"),m=o.find(".private-button"),p=o.find(".create-channel");function f(e){r=!e,e?(s.hide(),p.removeClass("disable")):(s.show(),p.addClass("disable"))}function h(e,a){a=a||"success",s.hide(),l.removeClass("hidden success error").addClass(a).text(e),setTimeout(function(){l.addClass("hidden"),r=!1},3e3)}return p.click(function(){if(!r){f(!1);var e=t.sanitizeText(d.val().trim());if(d.val(e),e.length<3)return h("Please provide a valid channel name.","error"),p.removeClass("disable"),void f(!0);t.createLabel({name:e,success:function(e){a.close(),window.location.reload()},error:function(e){h(e.Message||"Error creating new channel. Please try again later","error")},complete:function(){f(!0)}})}}),a.reg(o,i),function(e){d.val(""),l.addClass("hidden"),c.hide(),u.show(),m.addClass("perma-disable"),u.addClass("perma-disable"),o.find('[for="channel_access"]').addClass("perma-disable"),o.find('[for="collab"]').addClass("perma-disable"),e,a.show(o)}},app.popup.getSetupTeamPopup=function(e,a){return function(){e.PersonalSpaceFolios<=0||e.DisableP||a.message({heading:"Welcome to "+e.Team.Name+"!<br><h3>Let's finalize your setup.</h3>",message:'<div style="margin: 0 -20px; text-align: center;"><h3 style="margin-bottom: 10px;">Would you like to import any folios from your personal dashboard?</h3><span style="font-family: Proxima-Bold;">Tip:</span> This option is also available under your profile menu.</div>',btnText:"Import Folios",cancelText:"Skip",noClose:!0,notMini:!0,isSwitchCta:!0,okClass:"ok-blue",handleOK:function(){a.importFolioPopup()},handleNo:function(){a.close()}})}},app.popup.getSfgUpgradePopup=function(s,r,l,e){var d,c=$("#tmp-sfg-upgrade"),a=c.find(".popup-content"),t=c.find(".paper"),u=c.find(".popup-header"),n=t.find(".success-panel"),m=t.find(".sfg-user"),o=t.find(".status"),i=t.find(".cancel, .popup-close"),p=t.find(".btn-cancel"),f=t.find(".add-collab"),h=(t.find(".custom-msg"),t.find(".msg-content .icon-Close"),a.find(".loading-animation")),g="",v="",b="";function T(){if(h.show(),console.log("username???",v),m.find(".email").text(g),m.find(".email").val(g),m.find(".item input.email").attr("readonly",!0),0<s.Team.Id&&(1===s.Team.Role||2===s.Team.Role)){var e,a=function(){var e=0;switch(s.Team.ST){case 19:case 25:e=30;break;case 14:case 22:e=300;break;case 31:e=20;break;case 28:e=180}return e}();e=22==s.Team.ST||28==s.Team.ST?"You will be charged $"+a+"/year/user. Our payments are non-refundable.":"You will be charged $"+a+"/mo/user. Our payments are non-refundable.",console.log("config.Team.ST",s.Team.ST),console.log("msg",e),m.find(".msg-mem").html(e),h.hide()}else h.hide()}h.html(r.spinner);var y=function(e,a){h.hide(),o.text(e),o.show("slow"),"error"==a?(o.addClass("error"),o.removeClass("success")):(o.removeClass("error"),o.addClass("success")),setTimeout(function(){o.hide("slow")},3e3)};n.find(".back-to").click(function(){r.close()}),m.find(".back-to, .cancel, .btn-cancel").click(function(){r.close()}),p.click(function(){r.close()}),f.click(function(){if(h.show(),g){var e=m.find(".role").data("value")?m.find(".role").data("value"):4,a=m.data("email")||g;console.log("apiData???",a,e,b,d),t=a,n=e,o=b,i=d,l.changeMemberAccess({userEmail:t,userRole:n,teamId:s.Team.Id,folioToken:o,accessType:i,success:function(e){h.show(),setTimeout(function(){r.message({heading:"Success",message:"<b>"+t+"</b> has been successfully upgraded to <b>"+C(n)+"</b>",btnText:"Ok",notMini:!0,handleOK:function(){}})},2e3),h.hide()},error:function(e){h.hide(),y(e.Message,"error")}})}else y("Please add an Email to invite","error");var t,n,o,i});var C=function(e){if(s.TeamRoles)for(var a=0;a<s.TeamRoles.length;a++)if(e===s.TeamRoles[a].Id)return s.TeamRoles[a].Name;return"Error in Team ID"};return r.reg(c,i),function(e,a,t,n){var o,i;console.log("sfg data??",e,a,t,n),b=t,d=n,v=e,o=g=a,l.findUser({email:o,success:function(e){console.log("name:::",e.Message),u.find(".username").text(v||e.Message)},error:function(e){h.hide(),y(e.Message,"error")}}),i=t,l.getFolioByToken({token:i,success:function(e){JSON.parse(e.Data)},error:function(e){console.log("error",e)}}),T(),r.show(c)}},app.popup.getStyleGuidePopup=function(i,s,l,e,r,a,d,t){var n;$("#dropdown-menu-fontFamily-1 .fr-dropdown-list[role=presentation]");var o,c,u,m,p,f,h,g,v,b=$("#tmp-style-guide"),T=b.find("#template-user-font-entry"),y=b.find("#template-search-font-entry"),C=(b.find("#font-list"),b.find("#user-font-list")),w=b.find(".cancel, .popup-close"),k=b.find(".search-font"),x=b.find(".popup-cta.search"),P=b.find(".tabs > span[data-to]"),S=b.find(".tab"),D=(b.find(".msg"),b.find("#team-name")),F=b.find("#restore-defaults"),I=b.find(".loading-animation.forpopup"),M={},E={},U="proxima-light",N="Proxima-Light, Helvetica, sans-serif",A="No fonts found matching search keywords",L=15,O=!1,R=!1,B="",Y=b.find(".upload-font"),_=b.find(".color-palette-cont"),G=b.find("#colorinput"),H=$("#colorpicker"),z='<div class="add-item"><span>+</span></div>',q=b.find(".color-message"),K=b.find(".font-message"),j=b.find(".loading-animation.color-loader"),V=!1,J=b.find(".save-palette"),W=24,X="",Q=b.find(".color-tab"),Z=b.find(".url-selected-swatch"),ee=b.find(".results-url .colors-found"),ae=b.find(".results-url"),te=b.find(".results-url .update-color-palette"),ne="add",oe=b.find(".upload-selected-swatch"),ie=b.find(".results-upload .colors-found"),se=b.find(".results-upload"),re=b.find(".results-upload .update-color-palette"),le="add",de=b.find(".btn-upload");function ce(e){return p==e}function ue(e){if(console.log("loading font: ",e),M[e.IdString])return!1;var a,t;M[e.IdString]="Loaded",a=e,(t=document.createElement("style")).appendChild(document.createTextNode("\t    @font-face {\t        font-family: '"+a.FontLocalName+"';\t        font-weight: "+a.FontWeight+"; \t        font-style: "+a.FontStyle+"; \t        src: local("+a.FontLocalName+"), url("+a.FontUrl+")  format('woff2');\t        unicode-range: "+a.UnicodeRange+"; \t    }\t    ")),document.head.appendChild(t)}function me(){var e=$(".autocomplete-items");return e.length||((e=$("<div>")).addClass("autocomplete-items").css({width:k.css("width")}),k.parent().append(e)),e}b.find(".loading-animation").html(s.spinner),D.text(i.Team.Name),s.reg(b,w),c=function(){if(i.StyleGuides){if(""===i.userEmail)return i.StyleGuides[0];for(var e=0;e<i.StyleGuides.length;e++){var a=i.StyleGuides[e];if(a.TeamId==i.Team.Id)return p=a.DefaultFontFamily,U=a.FallbackFontFamily,L=a.maxNumberOfFonts,a}}return!1}();var pe=function(){return'<span class="add-font"><i class="icon icon-CheckMark"></i> Add to Team</span>'},fe=function(){s.show(b),I.show(),l.restoreDefaultFonts({data:{team_Id:c.TeamId,styleGuideId:c.Id},success:function(e){E={},I.hide();for(var a=!1,t=JSON.parse(e.Data),n=0;n<t.length;n++)t[n].TeamId==i.Team.Id&&(a=t[n]);if(!a)return!1;if(C.empty(),(u=$.map(a.TeamFonts,function(e){var a,t=(a=e.SourceIdentifier,U==a);return t&&(p=e.SourceIdentifier),{data:e.FontJson,id:e.SourceIdentifier,title:e.Name,default:t,owner:e.SourceString,family:e.FontJson.FontLocalName}})).length)for(n=0;n<u.length;n++){we(u[n],n,"styleguide")}},error:function(e){return console.log(e),!1}})},he=function(){s.show(b)};function ge(){O||(k.xautocomplete({container:$("#tmp-style-guide"),source:function(n){l.getAllFonts({success:function(e){var a=JSON.parse(e.Data),t=$.map(a,function(a){if(a.Name)try{var e=JSON.parse(a.FontJson);return"Xtensio"==a.SourceString||"System"==a.SourceString?{label:a.Name,value:e.IdString,data:{data:e,id:a.SourceIdentifier,title:a.Name,default:ce(a.SourceIdentifier),owner:a.SourceString,family:e.IdString}}:{label:a.Name,value:e.FontLocalName,data:{data:e,id:a.SourceIdentifier,title:a.Name,default:ce(a.SourceIdentifier),owner:a.SourceString,family:e.FontLocalName}}}catch(e){console.log(a,e)}});n(t)},error:function(e){return console.log(e),!1}})},minLength:3,errorMsg:A,select:function(e,a,t,n){},close:function(e,a){a.each(function(){$(e).closest(".autocomplete-items").get(0)!=$(this).get(0)&&$(this).remove()})},addElement:function(e,a,t,n,o,i){return ue(i.data),(m=$(y.html())).find(".owner").text(i.owner),(f=m.find(".title .family")).html(n),f.css("font-family",i.family),(h=m.find(".title .default")).append(pe()),m.find(".add-font").on("click",function(e){console.log(i),Pe($(this),i,1,e)}),m}}),Fe(),O=!0)}F.on("click",function(){s.message({heading:"Warning",message:"You are going to restore fonts for style guide.",btnText:"Go ahead",cancelText:"Cancel",handleOK:fe,handleNo:he})});var ve=function(){return'<span class="default"><i class="icon icon-Star"></i> Default Font</span>'},be=function(){return'<span class="make-default"><i class="icon icon-Star"></i> Make Default</span>'};function Te(e,a){var t="success"===a?"success":"error";K.html(e).removeClass("error").removeClass("success").addClass(t).show("slow"),setTimeout(function(){K.hide("slow").removeClass(t)},7e3)}function ye(e,a,t){return e.find(".loading-animation").html(s.spinner),e.find(".owner").text(a.owner),(f=e.find(".title .family")).text(a.title),f.css({"font-family":a.family}),e}function Ce(a,t){ue(a.data),(m=ye($(y.html()),a)).addClass("search-font-entry"),(h=m.find(".title .default")).append(pe()),m.find(".add-font").on("click",function(e){Pe($(this),a,t,e)}),(o=me()).append(m)}function we(a,t,e){E[a.id]=a,"styleguide"==e?console.log("font already added by froalasetup"):"Xtensio"!=a.owner&&"System"!=a.owner&&(console.log("fonts added by search fonts "),ue(a.data),function(e){console.log("adding font to froala ",e.family);var a=$('<li role="presentation">'),t=$('<a class="fr-command">'),n=$("#dropdown-menu-fontFamily-1 .fr-dropdown-list[role=presentation]");t.attr({"data-id":e.id,tabindex:"-1",role:"option","data-cmd":"fontFamily","data-param1":"'"+e.family+"', "+N,title:e.title,"aria-selected":"false"}).attr("style","font-family : '"+e.family+"', "+N+";").text(e.title),a.append(t),n.append(a)}(a)),(m=ye($(T.html()),a)).addClass("user-font-entry"),m.attr("id",a.id),m.attr("data-default",a.default),h=m.find(".title .default"),ce(a.id)?($e(a),h.append(ve())):h.append(be()),m.find(".make-default").on("click",function(e){var a=$(this).closest(".user-font-entry").attr("id");!function t(e,a,n,o){var i=e.closest(".font-entry");var s=i.closest("#user-font-list");var r=E[a];i.addClass("loading");l.makeDefault({data:{fontStringIdentifier:r.id,team_Id:c.TeamId,styleGuideId:c.Id},success:function(e){!1,$("[data-default]").attr("data-default",!1),i.attr("data-default",!0),p=r.id,xe(r.family+" is now default font for the style guide.",i);JSON.parse(e.Data);$e(r),i.removeClass("loading").addTimedClass("done",3e3),$fontDefaultEntry=s.find(".default .default").parent(),$fontDefaultEntry.empty().html(be()),$fontDefaultEntry.find(".make-default").on("click",function(e){var a=$(this).closest(".user-font-entry").attr("id");t($(this),a,n,e)}),i.find(".default:eq(0)").empty().html(ve())},error:function(e){i.removeClass("loading"),console.log(e)}})}($(this),a,t)}),m.find(".remove").on("click",function(e){!function(e,a,t,n){var o=a.id,i=e.closest(".font-entry");if(i.addClass("loading"),"true"==i.attr("data-default"))return i.removeClass("loading"),ke("Default font can not be removed from the style guide.",i);l.removeFont({data:{fontStringIdentifier:a.id,team_Id:c.TeamId,styleGuideId:c.Id},success:function(e){!1,xe(a.family+" is removed from the style guide.",i),E[o]&&delete E[o],i.remove(),function(e){console.log("removing font from froala ",e.family);var a="li a[data-param1^='\\'"+e.family+"\\',']",t=$("#dropdown-menu-fontFamily-1 .fr-dropdown-list[role=presentation]").find(a);console.log("xtensio/system/google",a),console.log("font to remove",t),t.length?t.closest("li").remove():console.log(t,"not found")}(a),i.removeClass("loading")},error:function(e){i.removeClass("loading"),console.log(e)}})}($(this),a)}),C.append(m)}x.on("click",function(e){e.stopPropagation(),(o=me()).empty(),I.show();var a=k.val();if(a.length<3)return o.html("You need to type at least 3 characters"),!1;l.searchFonts({data:{searchQuery:a},success:function(e){var a=JSON.parse(e.Data);if((u=$.map(a,function(e){var a=JSON.parse(e.FontJson);return{data:a,id:e.SourceIdentifier,title:e.Name,default:ce(e.SourceIdentifier),owner:e.SourceString,family:a.FontLocalName}})).length)for(var t=0;t<u.length;t++){Ce(u[t],t)}else o.html(A);I.hide()},error:function(){return I.hide(),!1}})}),Y.click(function(e){if(r.isBusinessTeam()){if(Object.keys(E).length>=L)return Te("You can't add more than "+L+" fonts to style guide.","error"),!1;b.find(".font-uploader").click()}else{var a=1===i.Team.Role,t=a?"See Plans":"Ok",n=a?"Nevermind":null,o=a?function(){s.payment("showPlans")}:null;s.push(b),s.message({heading:"You Cannot Perform this Action",message:"Uploading custom fonts is available only on the Business plan. Please upgrade your team.",btnText:t,cancelText:n,notMini:!0,bodyCentered:!0,handleOK:o})}}),b.find(".font-uploader").change(function(){var e=this.files&&this.files[0],a=b.find("#uploadfont-form")[0];e&&(Re(!0),Te("Uploading font...","success"),l.uploadCustomFont(a,e,{success:function(e){if(console.log("uploadCustomFont response",e),"Error"===e.Status)Te(e.Message,"error");else if(e.Data&&void 0!==e.Data){var a=$("#user-font-list").children().length,t=JSON.parse(e.Data);Se({data:t.FontJson,id:t.SourceIdentifier,title:t.Name,default:!1,owner:t.SourceString,family:t.FontJson.FontLocalName},!1,a,"custom")}else console.log("Error parsing response data");Re(!1),b.find(".font-uploader").val("")},error:function(e){console.log("uploadCustomFont error",e),Te(e.Message,"error"),Re(!1),b.find(".font-uploader").val("")}}))}),c&&(u=$.map(c.TeamFonts,function(e){return{id:e.SourceIdentifier,data:e.FontJson,title:e.Name,default:ce(e.SourceIdentifier),owner:e.SourceString,family:e.FontJson.FontLocalName?e.FontJson.FontLocalName:e.FontJson.IdString}})).length&&setTimeout(function(){for(var e=0;e<u.length;e++){we(u[e],e,"styleguide")}},2e3),P.on("click",function(){var e=$(this).addClass("selected");P.not(e).removeClass("selected"),current=e.index(),S.removeClass("selected").filter(":eq("+current+")").addClass("selected")});var ke=function(e,a){if(a)var t=a.find(".inline-msg");t.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){t.hide("slow").removeClass("error")},5e3),I.hide()},xe=function(e,a){if(a)var t=a.find(".inline-msg");t.html(e).addClass("success").removeClass("error").show("slow"),setTimeout(function(){t.hide("slow").removeClass("success")},5e3),I.hide()};function $e(e){$("#edit-sections, #modules-preview-main").css({"font-family":"'"+e.family+"', "+N})}function Pe(e,a,t,n){var o=a.id,i=e.closest(".font-entry");return Object.keys(E).length>=L?(ke("You can't add more than "+L+" fonts to style guide.",i),!1):!E[o]&&void Se(E[o]=a,i,t,"search")}function Se(a,t,n,e){l.addFont({data:{fontStringIdentifier:a.id,team_Id:c.TeamId,styleGuideId:c.Id},success:function(e){!1,t?xe(a.family+" is added to the style guide.",t):Te(a.family+" is added to the style guide.","success"),we(a,n,"search")},error:function(e){t&&t.removeClass("loading"),console.log(e)}})}function De(){if(n.hasClass("locked"))return r.hasTeam()?s.message({heading:"You Cannot Perform this Action",message:"Only team admins can manage the style guide. Please contact the admin for more access.",btnText:"Ok",bodyCentered:!0,notMini:!0}):s.message({heading:"Please Upgrade Your Account",message:"Style guide is only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){s.payment("showPlans")}}),!1;ge();var e=$.trim(window.location.hash.substr(1));B=""===e?"styleguide":e,s.show(b,B)}function Fe(){R||(R=!0,H.minicolors({inline:!0,letterCase:"lowercase",control:"brightness",opacity:!1,scale:1.9,change:function(e,a){if(e){try{G.val(e),b.find(".minicolors-swatch-color").css({backgroundColor:e})}catch(e){console.log("error in color picker",error)}$(this).select()}},theme:"bootstrap"}),i.StyleGuides&&void 0!==i.StyleGuides&&(void 0!==i.StyleGuides[0].maxNumberOfColors&&(W=i.StyleGuides[0].maxNumberOfColors),void 0!==i.StyleGuides[0].StylePickerApi&&(X=i.StyleGuides[0].StylePickerApi),console.log("maxColorSwatches",W),console.log("stylePickerApi",X)),function(){if(void 0!==i.StyleGuides){_.html("");for(var e=i.StyleGuides[0].TeamColors,a=e.length>W?W:e.length,t=0;t<a;t++)_.append('<div class="palette-item" style="background-color: '+e[t].HexCode+'"></div>'),e[t].IsDefault&&Be(_.find(".palette-item").last());_e()}}(),G.keyup(function(){var e=$(this).val().toString(),a=/(^#[0-9A-F]{6}$)/i.test(e);a&&-1!==e.indexOf("#")&&(console.log("input value is",e),H.minicolors("value",e))}),_.on("click",".palette-item",function(){var e=d.rgb2hex($(this).css("backgroundColor"));H.minicolors("value",e),Ye($(this))}),_.on("click",".add-item",function(){Re(!0);var a=setInterval(function(){var t=!0,n=d.generateRandomColor(),e=d.getColorBrightness(n);e<123?t=!1:b.find(".palette-item").each(function(e){var a=d.rgb2hex($(this).css("backgroundColor"));d.trimUppercase(a)===n&&(t=!1)}),t&&(clearInterval(a),l.addColor({data:{hexCode:n,team_Id:c.TeamId,styleGuideId:c.Id||0},success:function(e){console.log("addColor response",e),!1,Ge("Color added to your list.","success"),b.find(".add-item").remove(),_.append('<div class="palette-item" style="background-color: '+n+'"></div>'),Ye(b.find(".palette-item:last")),_e()},error:function(e){Ge("There was a problem processing your request. Try again later.","error"),console.log("addColor error",e)},complete:function(){Re(!1)}}))},500)}),b.find(".save-color").click(function(){Re(!0);var t=d.trimUppercase(d.rgb2hex(H.minicolors("value"))),e=""!==g.html(),n=!0;console.log("oldHex",v),console.log("hex",t),console.log("isDefault",e),d.trimUppercase(v)!==t?(b.find(".palette-item").each(function(e){var a=d.rgb2hex($(this).css("backgroundColor"));t===d.trimUppercase(a)&&(n=!1)}),n?l.updateColor({data:{oldHexCode:v,newHexCode:t,isDefault:e,team_Id:c.TeamId,styleGuideId:c.Id||0},success:function(e){console.log("updateColor response",e),!1,Ge("Color is updated.","success"),g.css("backgroundColor",t),v=t},error:function(e){Ge("There was a problem processing your request. Try again later.","error"),console.log("updateColor error",e)},complete:function(){Re(!1)}}):(Re(!1),Ge("Selected color already exists.","error"))):Re(!1)}),b.find(".undo").click(function(){console.log("revert to ",v),H.minicolors("value",v)}),b.find(".make-color-default").click(function(){Re(!0);var e=d.rgb2hex(H.minicolors("value"));l.makeColorDefault({data:{hexCode:e,team_Id:c.TeamId,styleGuideId:c.Id||0},success:function(e){console.log("makeColorDefault response",e),!1,Ge("Selected color is now the default color.","success"),Be(g)},error:function(e){Ge("There was a problem processing your request. Try again later.","error"),console.log("makeColorDefault error",e)},complete:function(){Re(!1)}})}),b.find(".icon-btn.delete").click(function(){""===g.html()?(Re(!0),l.removeColor({data:{hexCode:v,team_Id:c.TeamId,styleGuideId:c.Id||0},success:function(e){console.log("removeColor response",e),!1,Ge("Selected color is deleted from your list.","success"),g.addClass("hide-palette"),setTimeout(function(){g.remove(),Ye(b.find(".palette-item:eq(0)")),_e()},400)},error:function(e){Ge("There was a problem processing your request. Try again later.","error"),console.log("removeColor error",e)},complete:function(){Re(!1)}})):(console.log("error, cant delete default color"),Ge("Can not delete the default color. Please make another color default to delete the selected color.","error"))}),b.find(".restore-link").click(function(e){e.preventDefault(),s.push(b),s.message({heading:"Restore colors to default",message:"Your colors list will be updated with default Xtensio colors. This can not be undone.",btnText:"Restore",cancelText:"Cancel",notMini:!0,okClass:"ok-blue",handleOK:function(){Re(!0),l.restoreDefaultColors({data:{team_Id:c.TeamId,styleGuideId:c.Id||0},success:function(e){console.log("restoreDefaultColors",e),window.location.hash="managecolors",setTimeout(function(){window.location.reload()},50)},error:function(e){Ge("There was a problem processing your request. Try again later.","error"),console.log("restoreDefaultColors error",e)},complete:function(){Re(!1)}})}})}),b.find(".pick-url-btn").click(function(){var o,e,a=b.find(".url-input").val();ae.hide(),te.hide(),console.log("url input is",a),console.log(d.isValidURL(a)),-1===a.indexOf("http://")&&-1===a.indexOf("https://")&&(a="http://"+a),d.isValidURL(a)?(e=X+(o=a),Re(!0),$.ajax({url:e}).done(function(e){if(console.log("stylePickerApi response",e),void 0!==e.coloursBg&&void 0!==e.coloursText){var a=$.merge(Oe(e.coloursBg),Oe(e.coloursText)),t=[];$.each(a,function(e,a){-1===t.indexOf(a)&&t.push(a)}),console.log("websiteColors",t),ee.html(""),t.forEach(function(e,a){ee.append('<div class="palette-res-item" style="background-color: '+e+'"></div>')}),Ne(Z,ee,0),ae.show(),te.show(),Ge("Colors are successfully retrieved from "+o,"success")}else{var n=void 0!==e.error?e.error:"Your URL did not return any valid color values.";Ge(n,"error"),Re(!1)}}).fail(function(e){console.log("stylePickerApi error",e),Ge("There was a problem processing your request. Try again later.","error")}).always(function(){Re(!1)})):Ge("Please provide a valid website URL")}),te.click(function(){Ie(ae,ne)}),ae.on("click",".palette-res-item",function(){var e=d.rgb2hex($(this).css("backgroundColor")),a=Ue(e);$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).html(a):$(this).html(""),Ae($(this),ae,Z,ne)}),b.find(".results-url .x-select .item").on("click",function(){if(!V)return ne=$(this).attr("data-value"),b.find(".results-url .x-select .text").text($(this).text()),console.log("siteUpdateSwatch",ne),Me(ae,ne,Z),!0}),de.click(function(){b.find(".uploader").click()}),b.find(".uploader").change(function(){var e=this.files&&this.files[0];if(e){Re(!0),se.hide(),re.hide();var a=b.find("#uploadswatch-form")[0];l.uploadSwatch(a,e,{source:1,success:function(e){if(console.log("uploadSwatch response",e),!1,e.Data&&void 0!==e.Data){var a=$.parseJSON(e.Data),t=[],n=[];console.log("dataArr",a),a.forEach(function(e,a){t.push(e.HexCode)}),$.each(t,function(e,a){-1===n.indexOf(a)&&n.push(a)}),console.log("swatchColors",n),ie.html(""),n.forEach(function(e,a){ie.append('<div class="palette-res-item" style="background-color: '+e+'"></div>')}),Ne(oe,ie,0),se.show(),re.show(),Re(!1),Ge("Colors are successfully retrieved from swatch file","success")}else{var o=void 0!==e.Message?e.Message:"There was a problem processing your file.";Ge(o,"error"),Re(!1)}},error:function(e){Re(!1),console.log("uploadSwatch error",e),Ge("There was a problem processing your request. Try again later.","error")}})}}),b.find(".results-upload .x-select .item").on("click",function(){if(!V)return le=$(this).attr("data-value"),b.find(".results-upload .x-select .text").text($(this).text()),console.log("uploadUpdateSwatch",le),Me(se,le,oe),!0}),se.on("click",".palette-res-item",function(){var e=d.rgb2hex($(this).css("backgroundColor")),a=Ue(e);$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).html(a):$(this).html(""),Ae($(this),se,oe,le)}),re.click(function(){Ie(se,le)}),Q.click(function(){var e;e=$(this),Q.removeClass("selected"),e.addClass("selected"),e.hasClass("color-picker")?Le(".color-mid-content"):e.hasClass("color-site")?(ae.hide(),te.hide(),Le(".color-site-content")):e.hasClass("color-upload")&&(se.hide(),re.hide(),Le(".color-upload-content"))}),app.plugin.tooltip(),Ye(b.find(".palette-item:eq(0)")))}function Ie(e,i){var t=e.find(".palette-res-item.selected"),a=t.length,n="Limit reached. You can't have more than "+W+" colors in you palette.",o=!0;(console.log("counter",a),console.log("updateSwatchType",i),0===a)?(o=!1,n="Please select at least one color."):"add"===i?W-b.find(".palette-item").length<a&&(o=!1):"replace"===i&&W<a&&(o=!1);o?(s.push(b),s.message({heading:"Update Color List",message:"Your color list will be updated with the selected colors. This can not be undone.",btnText:"Update",cancelText:"Cancel",notMini:!0,okClass:"ok-blue",handleOK:function(){Re(!0);var a=[],o=_.find(".palette-item");t.each(function(e){var t=d.trimUppercase(d.rgb2hex($(this).css("backgroundColor"))),n=!0;console.log("hex",t),console.log("checkDupes","add"===i),-1===a.indexOf({HexCode:t,IsDefault:!1})&&("add"===i&&o.each(function(e,a){d.trimUppercase(d.rgb2hex($(a).css("backgroundColor")))===t&&(n=!1)}),n&&a.push({HexCode:t,IsDefault:!1}))}),"replace"===i&&(a[0].isDefault=!0),console.log("colorArray",a),l.savePalette({data:{colors:JSON.stringify(a),team_Id:c.TeamId,styleGuideId:c.Id||0,append:"add"===i?1:0},success:function(e){console.log("savePalette",e),window.location.hash="managecolors",setTimeout(function(){window.location.reload()},50)},error:function(e){Ge("There was a problem processing your request. Try again later.","error"),console.log("savePalette error",e)},complete:function(){Re(!1)}})}})):Ge(n,"error")}function Me(e,a,t){var n=e.find(".palette-res-item.selected").length,o=Ee(a);if(console.log("max",o),console.log("counter",n),o<n){var i=0,s=n-o;console.log("difference",s),e.find(".palette-res-item.selected").each(function(e,a){i<s&&($(a).removeClass("selected").html(""),i++)})}n=e.find(".palette-res-item.selected").length,Ne(t,e,n)}function Ee(e){return"add"===e?W-b.find(".palette-item").length:W}function Ue(e){return'<i class="icon-CheckMark" style="color: '+d.getColorContrast(e)+'"></i>'}function Ne(e,a,t){var n=a.find(".palette-res-item").length;e.html("<h3>"+t+" of "+n+" selected</h3>")}function Ae(e,a,t,n){var o=a.find(".palette-res-item.selected").length;o<=Ee(n)?Ne(t,a,o):e.hasClass("selected")&&(e.removeClass("selected"),e.html(""),Ge("Limit reached. You can't have more than "+W+" colors in you palette.","error"))}function Le(e){b.find(".color-content-tabs").hide(),".color-mid-content"===e?b.find(".color-bot-content").show():b.find(".color-bot-content").hide(),b.find(e).show()}function Oe(e){var t=[];return e.forEach(function(e,a){-1!==e[0].indexOf("#")&&t.push(d.trimUppercase(e[0]))}),t}function Re(e){(V=e)?(b.addClass("busy"),b.find(".pick-url-btn").addClass("disable-ui"),te.addClass("disable-ui"),J.addClass("disable-ui"),b.find(".icon-btn").addClass("disable-ui"),j.show()):(b.removeClass("busy"),b.find(".pick-url-btn").removeClass("disable-ui"),te.removeClass("disable-ui"),J.removeClass("disable-ui"),b.find(".icon-btn").removeClass("disable-ui"),j.hide())}function Be(e){var a=d.rgb2hex(e.css("backgroundColor")),t=d.getColorContrast(a);_.find(".palette-item").html(""),e.html('<i class="icon-Star" style="color: '+t+'"></i>')}function Ye(e){g=e;var a=d.rgb2hex(g.css("backgroundColor"));v=a,H.minicolors("value",a),_.find(".palette-item").removeClass("selected"),e.addClass("selected")}function _e(){b.find(".palette-item").length<W&&0===b.find(".add-item").length&&_.append(z)}function Ge(e,a){var t="success"===a?"success":"error";q.html(e).removeClass("error").removeClass("success").addClass(t).show("slow"),setTimeout(function(){q.hide("slow").removeClass(t)},7e3)}function He(){setTimeout(function(){if(!r.isBusinessTeam()){t.add($("#tmp-style-guide .upload-font"),"Business Feature",0)}},1e3)}return b.find(".tabs span:eq(1)").click(function(){Fe()}),i.editMode&&(b.find(".popup-close").click(function(){app.editor.upgradeStyleGuide(d)}),c&&""===i.userEmail&&(defaultFontId=c.DefaultFontFamily,c.TeamFonts.forEach(function(e){e.SourceIdentifier===defaultFontId&&$e({family:e.FontJson.FontLocalName})}))),function(){var e=$.trim(window.location.hash.substr(1));if(!0,("styleguide"==e||"managecolors"==e)&&(B=e,r.hasTeam()&&(r.isOwner()||r.isAdmin())))return console.log("showing styleguide before waiting to load menu",(new Date).getTime()),s.show(b,e),ge(),He(),!0;"styleguide"!==e&&""!==e||d.doSetFocus(k,1),console.log("in popup ",(new Date).getTime()),n?De():setTimeout(function(){console.log("in popup again",(new Date).getTime()),n=$(".user-menu-popup .style-guide"),De()},2250),He()}},app.popup.getTeamChannelPopup=function(o,i,n,s,r,l){var d=$("#tmp-team-channel"),e=d.find(".cancel, .popup-close"),c=d.find(".loading-animation").html(i.spinner),u=!1,t=d.find(".changes-applied"),m=$("#tmp-channel-single-email"),p=$("#channel_name"),f=$("#collab-channel-input"),h=d.find(".add-collaborators"),g=$("#collab-channel-cont"),v=$("#collab-channel-list"),a=d.find(".add-new"),b=d.find(".private-button"),T=[],y=[],C=!1,w=d.find(".add-btn"),k=[],x="private",P=d.find(".create-channel"),S='<i class="icon-PadlockBig"></i> Private <span class="desc">Only channel members can access and edit</span>',D='<i class="icon-Down-Arrow"></i>',F=!1;function I(e){var t,a=$(m.html()),n="";e.email&&(n=e.email.toLowerCase().trim()),a.find(".name").html(e.fullName||n),a.find(".email").html(n||e.fullName),a.find(".remove").on("click",(t=e,function(){if(u=!0,c.show(),t.owner)M("Cannot remove channel owner.","error");else{var e=o.userEmail;if(t.email!==e.toLowerCase().trim()){var a=[];k.forEach(function(e){e!==t.email&&a.push(e)}),k=a,$(this).closest(".item").remove(),M((t.fullName||t.email)+" has been removed from channel.")}else M("Cannot remove yourself as collaborator.","error")}})),a.find(".role").css("display","none"),a.find(".isOwner").text("Channel Owner"),e.owner?(ownerEmail=n,a.find(".remove").hide()):a.find(".isOwner").css("opacity",0),e.owner?v.prepend(a):v.append(a)}function M(e,a){a=a||"success",c.hide(),t.removeClass("hidden success error").addClass(a).text(e),setTimeout(function(){t.addClass("hidden"),u=!1},3e3)}function E(e){u=!e,e?(c.hide(),P.removeClass("disable")):(c.show(),P.addClass("disable"))}return a.click(function(){g.show(),a.hide(),C=!0}),b.change(function(){var e=$(this).data("value"),a="";console.log("action",e),"private"===e?(a=S,h.show(),C&&g.show()):(a='<i class="icon-UsersGroup"></i> Team Visible <span class="desc">All team members can access and edit</span>',h.hide(),g.hide()),b.find(".text").html(a+D),x=e}),w.click(function(e){if(e.preventDefault(),r.isPremiumGuest())i.teamUserActionBlocked("guest-collab");else{var a=s.standardizeEmail(f.val()),t=s.findIndex(a,"UserName",y);if(console.log("email",a),console.log("email indexof teamMembersListWithPending",-1===s.findIndex(a,"UserName",y)),validator.isEmail(a))if(-1===k.indexOf(a))if(-1===t)if(1===o.Team.Role||2===o.Team.Role){var n={heading:"This User is Not on Your Team Yet",message:"Please add this user as a team member or premium guest before giving them access to this channel.",bodyCentered:!0,notMini:!0,btnText:"Invite People",cancelText:"Cancel",handleOK:function(){i.teamManagePopup()}};i.push(d),i.message(n)}else i.teamUserActionBlocked("team-member-collab");else if(y[t].Id)k.push(a),f.val(""),I({email:a}),M("Collaborator added successfully.","success"),console.log("collabEmails",k);else{n={heading:"This User is Not on Your Team Yet",message:"This user has not accepted the team invitation yet. Please add them as a channel collaborator again once they've joined the team.",bodyCentered:!0,btnText:"Ok",enterAsOK:!0,notMini:!0};i.push(d),i.message(n)}else M("Collaborator already added.","error");else M("Please provide a valid email address.","error")}}),P.click(function(){if(!u){E(!1);var e=n.sanitizeText(p.val().trim());if(p.val(e),e.length<3)return M("Please provide a valid channel name.","error"),P.removeClass("disable"),void E(!0);var a=k.indexOf(o.userEmail);-1!==a&&k.splice(a,1);var t={data:{name:e,newAccessType:"private"===x?1:2,membersAdded:k.join(",")},success:function(e){console.log("createCollabChan res",e);var a=e.Message;!1===F?l.raiseEvent("channelAdd",{channelToken:a,goToNewChannelCb:function(e){$("#all-labels-container .item[data-name='"+e+"']").click()}}):(l.raiseEvent("channelAdd",{channelToken:a,openLabelsPopup:!0}),F=!1),i.close()},error:function(e){console.log("createCollabChan error",e),M(e.Message||"Error creating new channel. Please try again later","error"),E(!0)}};console.log("apiData",t),n.createCollabChan(t)}}),i.reg(d,e,function(){!0===F&&(i.labels(null,null,null,!0),F=!1)}),function(e){e&&(F=e.openLabelsPopupOnClose),E(!1),$("#new-team-channel-form").hide(),i.show(d),n.listALLMembers({data:{teamId:o.Team.Id},success:function(e){console.log("listALLMembers response",e),e.Data.Data.members.forEach(function(e,a){y.push(e),e.Id&&T.push(e)}),E(!0),p.val(""),C=!1,k=[],t.addClass("hidden"),v.empty(),g.hide(),a.show(),h.show(),b.find(".item").removeClass("active"),b.find("div[data-name='private']").addClass("active"),b.find(".text").html(S+D),f.easyAutocomplete({getValue:"UserName",data:T,theme:"bootstrap",list:{match:{enabled:!0}}}),k.push(o.userEmail),I({email:o.userEmail,fullName:o.userName,owner:!0}),$("#new-team-channel-form").show(),s.doSetFocus(p)},error:function(e){console.log("listALLMembers error",e)}})}},app.popup.getTeamChannelManagePopup=function(s,i,r,e,o,l,a){var d,c,u,m,p=$("#tmp-team-channel-manage"),t=p.find(".cancel, .popup-close"),f=$("#tmp-channel-single-email"),n=$("#all-labels-container"),h=p.find(".changes-applied"),g=[],v=[],b=[],T=!1,y=$("#collab-manage-channel-input"),C=p.find(".add-btn"),w=$("#collab-manage-channel-list"),k=w.find(".guests.title"),x=w.find(".members.title"),P=$(".save-list"),S="",D=p.find(".recent-members"),F=D.find(".recent-container"),I=[],M=$("#tmp-channel-single-recent"),E=p.find(".private-button"),U='<i class="icon-PadlockBig"></i> Private',N='<i class="icon-UsersGroup"></i> Team Visible',A="private",L=!1,O=p.find(".loading-animation").html(i.spinner);function R(a){if(D.hide(),F.empty(),I=[],2!==c.AccessType&&0<g.length){var e=_.reverse(g),t=3<e.length?3:e.length;console.log("reversed",e),console.log("maxNumToGet",t),console.log("collabEmails",b);for(var n=0;n<e.length;n++){var o=e[n].Email,i=""===e[n].FullName?o:e[n].FullName;if(console.log("memberEmail",o),I.length<t&&-1===b.indexOf(o)&&o!==m.Email){var s=$(M.html());s.click(function(){var e=$(this).find(".email").text();z(e,!1,function(){B({email:e,fullName:$(this).find(".name").text(),owner:!1,isGuest:!1}),R(a)})}),I.push(o),s.find(".name").text(i),s.find(".email").text(o),F.append(s)}}console.log("recentList",I),0<I.length&&D.show()}a&&"function"==typeof a&&a()}function B(e){b.push(e.email),function(e){var a=$(f.html()),t="";e.email&&(t=e.email.toLowerCase().trim());a.find(".name").html(e.fullName||t),a.find(".email").html(t||e.fullName),a.find(".remove").on("click",(n=e,function(){if(n.owner)Y("Cannot remove channel owner.","error");else{n.fullName||n.email;var e=$(this);i.push(p),i.message({heading:"Are you sure?",message:"Removing this user will revoke their editing access to all folios given at channel level. It will also remove any folios they own from the channel. You can still add collaborators to individual folios.",btnText:"Yes, Remove User",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){z(n.email,!0,function(){var a=[];b.forEach(function(e){e!==n.email&&a.push(e)}),b=a,e.closest(".item").remove(),R(),Y((n.fullName||n.email)+" has been removed from list."),G()})}})}})),a.find(".role").css("display","none"),a.find(".isOwner").text("Channel Owner"),e.owner?(ownerEmail=t,a.find(".remove").hide(),w.find(".owner-list").empty().append(a)):(a.find(".isOwner").css("opacity",0),e.isGuest?(a.find(".remove").show(),w.find(".guests.list").append(a)):(2===c.AccessType?a.find(".remove").hide():a.find(".remove").show(),w.find(".members.list").append(a)),G());var n}(e)}function Y(e,a){a=a||"success",O.hide(),h.removeClass("hidden success error").addClass(a).text(e),setTimeout(function(){h.addClass("hidden"),T=!1},3e3)}function G(){0<w.find(".guests.list").children().length?k.show():k.hide(),0<w.find(".members.list").children().length?x.show():x.hide()}function H(e){T=!e,e?(O.hide(),P.removeClass("disable")):(O.show(),P.addClass("disable"))}function z(e,a,t){H(!1),r.addRemoveChannelCollaborator({data:{labelToken:d,memberEmail:e,remove:a},success:function(e){console.log("addRemoveChannelCollaborator response",e),t&&"function"==typeof t&&t()},error:function(e){console.log("addRemoveChannelCollaborator error",e),Y(e.Message||"Error processing save list, please try again later","error")},complete:function(){H(!0)}})}function q(i){H(!1),g=[],r.listALLMembers({data:{teamId:s.Team.Id},success:function(e){console.log("listALLMembers response",e),e.Data.Data.members.forEach(function(e,a){v.push(e),e.Id&&g.push(e)}),console.log("teamMembersList",g),b=[],h.addClass("hidden"),w.find(".owner-list").empty(),w.find(".members.title").hide(),w.find(".members.list").empty(),w.find(".guests.title").hide(),w.find(".guests.list").empty(),y.easyAutocomplete({getValue:function(e){return e.FullName+" "+e.Email},data:g,theme:"bootstrap",list:{match:{enabled:!0},onChooseEvent:function(){var e=y.getSelectedItemData();console.log(e),y.val(e.Email)}}});var a,t,n,o=_.findIndex(s.labels,["Token",d]);-1!==o?(2===(c=s.labels[o]).AccessType?(a="All team members will have access to this channel. <br>You can also add premium guests as additional collaborators.",t=N,A="team"):(t=U,A="private",a="Only you and the individual collaborators you add to this channel will have access."),n='<span class="text-current">'+t+'</span><i class="icon-Down-Arrow"></i>',E.find(".text").html(n),E.find(".item").removeClass("active"),E.find("div[data-name='"+A+"']").addClass("active"),p.find(".popup-header .access-desc").html(a),console.log("channelData",c)):console.log("Error getting current label data");p.find(".popup-header .channel").text(S),r.getChannelCollaborators({data:{token:d},success:function(a){console.log("getChannelCollaborators response",a),r.getLabelOwner({data:{token:d},success:function(e){console.log("getLabelOwner response",e),B({email:(m=JSON.parse(e.Data)).Email,fullName:m.FullName,owner:!0}),u=JSON.parse(a.Data),console.log("collaboratorsData",u),0<u.length&&u.forEach(function(e,a){var t=_.findIndex(g,["Email",e.Email]),n=!1;-1!==t&&(n=4===g[t].Role),-1===b.indexOf(e.Email)&&e.Email!==m.Email&&B({email:e.Email,fullName:e.FullName,owner:!1,isGuest:n})}),R(i)},error:function(e){console.log("getLabelOwner error",e),Y(e.Message||"Error fetching channel owner details","error")},complete:function(){H(!0)}})},error:function(a){function e(e){return a.apply(this,arguments)}return e.toString=function(){return a.toString()},e}(function(e){console.log("getChannelCollaborators error",e),Y(e.Message||"Error fetching channel collaborators list","error")})})},error:function(e){console.log("listALLMembers error",e),Y(e.Message||"Error fetching team members list","error")}})}return E.change(function(){if(!T){var e=function(e){var a="private"===e?U:N;a='<span class="text-current">'+a+'</span><i class="icon-Down-Arrow"></i>',E.find(".text").html(a)},a=$(this).data("value"),t=$("#all-labels-container").find(".item.active").data("name"),n=_.findIndex(s.labels,["Token",t]);-1!==n&&(console.log("config.labels[labelID]",s.labels[n]),A=2===s.labels[n].AccessType?"team":"private"),console.log("private-button change",a),console.log("labelToken",t),e(a);var o="Are you sure you want to make this channel private? Your team members will be removed from folios within this channel. You can still add individual collaborators to the channel and folios.";"team"===a&&(o="Are you sure you want to make this channel team visible? All of your team members will have editing access to all folios added to this channel."),i.push(p),i.message({heading:"Channel Access Change",message:o,btnText:"Ok",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){H(!1),r.changeChannelAccess({data:{labelToken:t,newAccessType:"private"===a?1:2},success:function(e){A=a,console.log("changeChannelAccess response",e)},error:function(e){a=A,console.log("changeChannelAccess err",e)},complete:function(){H(!0),E.find(".item").removeClass("active"),E.find("div[data-name='"+a+"']").addClass("active"),e(a)}})},handleNo:function(){H(!0),e(A)}})}}),C.click(function(e){if(e.preventDefault(),l.isPremiumGuest())i.teamUserActionBlocked("guest-collab");else{var a=o.standardizeEmail(y.val()),t=_.findIndex(v,["Email",a]);if(console.log("email",a),console.log("email indexof teamMembersList",-1===t),validator.isEmail(a))if(-1===b.indexOf(a))if(-1===t)if(1===s.Team.Role||2===s.Team.Role){var n={heading:"This User is Not on Your Team Yet",message:"Please add this user as a team member or premium guest before giving them access to this channel.",bodyCentered:!0,notMini:!0,btnText:"Invite People",cancelText:"Cancel",handleOK:function(){i.teamManagePopup()}};i.push(p),i.message(n)}else i.teamUserActionBlocked("team-member-collab");else if(v[t].Id)z(a,!1,function(){y.val(""),B({email:a,isGuest:4===v[t].Role}),R(),Y("Collaborator email address added successfully.","success"),console.log("collabEmails",b)});else{n={heading:"This User is Not on Your Team Yet",message:"This user has not accepted the team invitation yet. Please add them as a channel collaborator again once they've joined the team.",bodyCentered:!0,btnText:"Ok",enterAsOK:!0,notMini:!0};i.push(p),i.message(n)}else Y("Email address already added.","error");else Y("Please provide a valid email address.","error")}}),a.addListener("refreshMemberData",function(){L&&setTimeout(function(){q()},200)}),i.reg(p,t),function(){L=!0,i.show(p),$("#collab-manage-channel-cont").hide();var e=n.find(".active");console.log("$channelEl",e),d=e.data("name"),S=e.find("span.name").text(),d,S,console.log("channelToken",d),console.log("channelName",S),q(function(){$("#collab-manage-channel-cont").show(),o.doSetFocus(y,1)})}},app.popup.getTeamCollaborationPopup=function(l,d,c,r,o,e,a){var u=$("#tmp-team-collaboration"),m={main:1,notUser:2,aUser:3,pendingUser:4},i=$("#collab-single-person"),t=u.find(".toggle"),n=u.find(".changes-applied"),s=$("#team-single-recent"),p=$(".recently-added"),f=u.find(".header-collaboration-blocker"),h=u.find(".popup-content"),g=h.find(".list"),v=h.find(".selected"),b=v.find(".a-user"),T=v.find(".not-user"),y=u.find(".loading-animation"),C=u.find("#member-search"),w=C.find("#member_search"),k=u.find(".search-btn"),x=u.find(".popup-header h1.am-h .team"),P=u.find(".popup-header p.am-h .email"),S=u.find(".team-add"),D=(u.find(".team-add div"),u.find(".add-team-member")),F=u.find(".add-team-member"),I=F.find(".custom-msg"),M=F.find(".msg-content .icon-Close"),E=(u.find(".success-panel"),!0),U=!1,N=!1,A="",L="",O=0,R=null,B=[],Y=[],_={},G=app.core.padlocks(o,e);function H(){if(o.isFreeWithTeam()&&o.isPremiumGuest())d.teamUserActionBlocked("guest-collab");else{var e=U?"OK":"See Plans",a=U?null:"Nevermind";d.push(u),d.message({heading:"Please Upgrade Your Account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:e,cancelText:a,notMini:!U,handleOK:function(){U?d.close():d.payment("showPlans")}})}}y.html(d.spinner),k.on("click",function(){E&&N||H()}),o.getData(1,function(e,a,t,n){e=null==e?{}:e,console.log("data.ST",e.ST),14!==e.ST&&19!==e.ST||(U=!0),l.Team&&0<l.Team.Id&&4!==l.Team.Role&&5!==l.Team.Role&&(N=!0),o.hasTeam()?(o.isSingleFolioGuest()||o.isPremiumGuest())&&(tip="Guests can not add collaborators.",E=!1):(o.isFree()||o.isPlus())&&(E=!1),G.setCollaboratorLocks(u,E)},!0);function z(e){for(var a=0;a<B.length;a++)if(c.standardizeEmail(B[a].Email)===e&&0<B[a].Privilege&&null===B[a].Accepted)return!0;return!1}function q(e,a,t,n){switch(u.removeClass("belong-to-team"),A=a?c.standardizeEmail(a.email):"",v.removeClass("not-user"),u.removeClass("team-deny-non-xtensio add-paidmem add-guest"),v.find(".not-user input.email").attr("readonly",!1),e){case m.main:h.removeClass("selected"),h.find(".back-button").removeClass("hidden");break;case m.notUser:if(h.addClass("selected"),h.find(".back-button").addClass("hidden"),l.Team&&0!=l.Team.Id&&!t.teamMember){if(2<l.Team.Role){if(3!==l.Team.Role){var o=4===l.Team.Role?"Premium Guests":"Team Members";return void d.teamUserActionBlocked("invite-member",o)}S.find(".r1").addClass("disabled"),S.find(".r2").addClass("disabled")}else S.find(".r1").removeClass("disabled"),S.find(".r2").removeClass("disabled");n?(u.addClass(n),v.find(".username").text(L)):u.addClass("add-mem"),x.text(l.Team.Name),P.text(a.email),S.find(".email").text(A),S.find(".team").text(l.Team.Name),v.find(".email").val(L),v.find(".full-name").val(""),v.addClass("not-user").removeClass("a-user pending-user"),v.find(".not-user input.email").attr("readonly",!0)}else v.find(".email").val(A),v.addClass("not-user").removeClass("a-user pending-user");break;case m.aUser:if(h.addClass("selected"),h.find(".back-button").addClass("hidden"),l.Team&&0!=l.Team.Id&&!t.teamMember){if(2<l.Team.Role){if(3!==l.Team.Role){o=4===l.Team.Role?"Premium Guests":"Team Members";return void d.teamUserActionBlocked("invite-member",o)}S.find(".r1").addClass("disabled"),S.find(".r2").addClass("disabled")}else S.find(".r1").removeClass("disabled"),S.find(".r2").removeClass("disabled");n?(u.addClass(n),v.find(".username").text(L)):u.addClass("add-mem"),x.text(l.Team.Name),P.text(A),S.find(".email").text(A),S.find(".team").text(l.Team.Name),h.addClass("selected"),h.find(".back-button").addClass("hidden"),v.find(".email").val(L),v.addClass("a-user").removeClass("not-user pending-user"),v.find(".a-user input.email").attr("readonly",!0)}else l.Team&&0!=l.Team.Id&&t.teamMember&&(u.addClass("belong-to-team"),v.find(".team-role").text(" ("+t.RoleName+")"),v.find(".acc-lvl-txt").hide()),v.data("email",A).find(".username").text(a.name||A),v.find(".email").val(A),v.addClass("a-user").removeClass("not-user pending-user");break;case m.pendingUser:h.addClass("selected"),h.find(".back-button").addClass("hidden"),v.data("email",A).find(".username").text(a.name),v.addClass("pending-user").removeClass("not-user a-user")}}function K(e){v.addClass(e),u.find(".popup-close").addClass(e),j("",{email:L},e)}function j(n,o,i){if(C.find("input").val(""),u.removeClass("add-mem add-sfg contact-supp non-user-add"),l.Team&&o&&0!=l.Team.Id){var s=c.standardizeEmail(o.email);r.findUser({email:s,success:function(e){if(e.Message)n=z(s)?m.pendingUser:m.aUser,r.listALLMembers({data:{teamId:l.Team.Id},success:function(e){for(var a={isXUser:!0,teamMember:!1},t=0;t<e.Data.Data.members.length;t++)c.standardizeEmail(e.Data.Data[t].Email)===s&&(a.teamMember=!0,a.RoleName=e.Data.Data[t].RoleName,a.Role=e.Data.Data[t].Role);l.Team&&4===l.Team.Role&&!a.teamMember&&d.teamUserActionBlocked("non-team-member","Premium Guests"),5===a.Role?V("This user is already a Single Folio Guest on this team.","error"):q(n,o,a,i),u.find(".loading-animation").hide()},error:function(e){u.find(".loading-animation").hide()}});else{var a={teamMember:!1,RoleName:"",Role:0,isXUser:!1};q(n=m.notUser,o,a,i)}},error:function(e){V(e.Message,"error")}})}else q(n,o,null,i)}function V(e,a,t){a=a||"success",y.hide(),t||j(m.main),n.removeClass("hidden success error").addClass(a).text(e),setTimeout(function(){n.addClass("hidden")},3e3)}function J(e,a,t,n){if(u.hasClass("belong-to-team"))y.hide(),V("A request has been sent to "+a),W(e,a,null,parseInt(t),n);else if(u.hasClass("add-guest")){X({Email:e,FullName:a,TeamId:l.Team.Id,Message:n,FolioToken:"",Accepted:null,AccessType:t,Privilege:t,Role:5})?(y.hide(),V(e+" has been added as a Single Folio Guest."),W(e,a,null,parseInt(t),n)):V(e+" is already added on your list.","error")}else if(u.hasClass("add-paidmem")||u.hasClass("add-pg")){u.hasClass("add-paidmem")?3:u.hasClass("add-pg")&&4,X({Email:e,FullName:a,TeamId:l.Team.Id,Message:n,FolioToken:"",Accepted:null,AccessType:t,Privilege:t,Role:O})?(y.hide(),u.find(".success-panel .list-mems span").text(L),u.addClass("success"),W(e,a,null,parseInt(t),n)):V(e+" is already added on your list.","error")}}function W(e,a,t,n,o){var i={};i.Email=e,i.FullName=a,i.Accepted=t,i.Privilege=n,i.Message=o;var s=c.standardizeEmail(i.Email);if(validator.isEmail(s))if(s!==l.userEmail){if(l.Team&&5===l.Team.Role)return d.teamUserActionBlocked("collab"),!1;var r;0<(r=i,Faltu(B).filter(function(e){return e.Email&&e.Email==r.Email&&0<e.Privilege}).get()).length?V("User is already added on your list.","error"):B.push(i),ie()}else V("You cannot add your email address as collaborator.","error");else V("Please provide a valid email address.","error")}function X(e){var a,t=!1;c.standardizeEmail(e.Email);return l.Team&&5===l.Team.Role?(d.teamUserActionBlocked("collab"),!1):(0<(a=e,Faltu(Y).filter(function(e){return e.Email&&e.Email==a.Email&&0<e.Privilege}).get()).length?V("User is already added on your list.","error"):(Y.push(e),t=!0),t)}function Q(t){$.each(B,function(e,a){a&&a.Email===t.Email&&(B[e].Privilege=0,B[e].Accepted=null)}),Z(t),oe(),ie()}function Z(t){$.each(Y,function(e,a){a&&a.Email===t.Email&&(Y[e].Privilege=0,Y[e].Accepted=null)}),oe()}function ee(e,a){e.Email==l.userEmail?l.isHome?d.close():d.archive(folio,function(){window.location.href="/"}):(y.show(),a.remove(),Q(e),y.hide(),e.Accepted?V((e.FullName||e.Email)+" has been removed from folio."):V("Invitation for "+(e.FullName||e.Email)+" has been cancelled."))}function ae(a){return function(){if(l.Team&&5===l.Team.Role)return d.teamUserActionBlocked("collab"),!1;var t,n,e=$(this);t=e.data("value"),n=a.Email,$.each(B,function(e,a){a&&a.Email===n&&(B[e].Privilege=t,B[e].Accepted=null)}),a.Privilege=e.data("value"),V((a.FullName||a.Email)+" can "+(1==a.Privilege?"now view only.":"view and edit now."))}}function te(e){var a=9;if(l.Team&&0<l.Team.Id&&(a=function(e){if(R)for(var a=0;a<R.length;a++)if(R[a].Email==e)return R[a].Role;return 0}(e.Email)),0!==e.Privilege&&!1!==e.Accepted){var t=3===e.Privilege&&e.Email===l.userEmail&&!0===e.Accepted;3===e.Privilege&&e.Email===l.userEmail&&!0===e.Accepted&&(owner=e);var s,n=e.Privilege<3&&e.Email==l.userEmail,o=$(i.html());o.data("person",e).addClass(2<e.Privilege||n?"owner":"collabo").find(".isOwner").text(n?"You":"Owner"),o.addClass(null===e.Accepted&&0<e.Privilege&&e.Privilege<3?"pending":""),o.addClass("team-role-"+a).attr("team-role",a),o.find(".name").text(e.FullName||e.Email),o.find(".email").text(e.Email||e.FullName),setTimeout(function(){o.find(".role").trigger("val",["value",e.Privilege]).on("change",ae(e))},500),o.find(".remove").on("click",(s=e,function(){var o=!1,i=$(this).closest(".person");if(l.Team&&l.Team.Id)return y.show(),void r.listALLMembers({data:{teamId:l.Team.Id},success:function(e){for(var a=0;a<e.Data.Data.length;a++)e.Data.Data[a].Email==s.Email&&5===e.Data.Data.members[a].Role&&(t=s,n=i,y.hide(),n.remove(),3!==t.Privilege?(Z(t),Q(t),V((t.FullName||t.Email)+" has been removed from folio.")):V("Cannot remove Folio owner.","error"),o=!0);var t,n;!o&&l.Team&&5===l.Team.Role?(d.teamUserActionBlocked("collab"),y.hide()):o||ee(s,i)},error:function(e){y.hide(),V(err.Message,"error")}});ee(s,i)})).attr("data-tip",e.Accepted?t||n?"Leave Folio":"Remove Collaborator":"Cancel Invitation"),e.Email!=l.userEmail&&3===e.Privilege?o.find(".remove").remove():e.Email===_.Email&&t&&o.find(".remove").remove(),g.append(o)}}function ne(){var t=0;g.empty(),$.each(B,function(e,a){0<a.Privilege&&a.Accepted&&t++,a.Privilege=void 0===a.Privilege?1:a.Privilege,te(a)}),t>(l.isHome?0:1)&&g.addClass("hasCollabs"),app.plugin.tooltip(),app.menu.xSelect()}f.find("a.btn").on("click",function(e){e.preventDefault(),window.location.hash="seeplans"}),I.click(function(){F.find(".msg-content").show("slow")}),M.click(function(){F.find(".msg-content").hide("slow")}),D.find(".invite-confirm").click(function(){var e=D.find(".block:eq(1) .left input").val(),a=D.find(".block:eq(1) .right input").val(),t=D.find(".block:eq(2) .role .popup-menu .item.active").data("value"),n=D.find(".opts .msg-content textarea").val();validator.isEmail(e)?(y.show(),J(e,a,t,n)):V("Please provide a valid email address.","error",1)}),y.html(d.spinner),S.find(".get-in-touch").click(function(){window.Intercom&&window.Intercom("showNewMessage","I would like to add a new team member.")}),S.find(".add-single-folio-guest").click(function(){K("add-guest")}),S.find(".add-member").click(function(){d.push(),d.teamManagePopup(!0)}),h.on("click",".pending-user .btn.yes",function(){V("An invitation has been sent again to "+function(e){for(var a=0;a<B.length;a++)if(c.standardizeEmail(B[a].Email)===e)return B[a];return null}(c.standardizeEmail(v.data("email"))).FullName)}),h.on("click",".pending-actions .b",function(){var e=$(this),a=e.closest(".person");a.data("person");y.show(),e.text("Sending ...").css("cursor","default"),y.hide(),e.text("Invitation Sent!"),a.find(".actions").addClass("active"),setTimeout(function(){e.text("Resend Invitation").css("cursor","pointer"),a.find(".actions").removeClass("active")},3e3)}),v.find(".cancel").click(function(){j(m.main)}),T.find(".add-collab").on("click",function(){var e=T.find(".full-name").val(),a=T.find(".email").val(),t=T.find(".role").data("value")?T.find(".role").data("value"):2,n=T.find(".msg-area.open").length?T.find("textarea").val():"";validator.isEmail(a)?(y.show(),l.Team&&0<l.Team.Id?J(a,e,t,n):(y.hide(),V("A request has been sent to "+e),W(a,e,null,parseInt(t),n))):V("Please provide an valid email address.","error",1)}),b.find(".add-collab").on("click",function(){y.show();var e=b.find(".username").text(),a=b.find(".role").data("value")?b.find(".role").data("value"):2,t=v.find(".email").val()||L,n=b.find(".msg-area.open").length?T.find("textarea").val():"";l.Team&&0<l.Team.Id?J(t,e,a,n):(V("A request has been sent to "+e),W(t,e,null,parseInt(a),b.find(".msg-area.open").length?b.find("textarea").val():""))}),C.on("submit",function(e){if(!E)return event.preventDefault(),!1;var a=c.standardizeEmail($(e.target[0]).val());return L=a,l.Team&&5===l.Team.Role?d.teamUserActionBlocked("collab"):(y.show(),validator.isEmail(a)?r.findUser({email:a,success:function(e){if(y.hide(),o.isFreeWithTeam()&&o.isTeamMember())return e.Message&&""!=e.Message&&null!=e.Message?void r.getMember({data:{teamId:l.Team.Id,email:a},success:function(e){teamUser=e.Data.Data,null!==teamUser.Id?(z(a)?val=m.pendingUser:val=m.aUser,j(val,{name:teamUser.FullName,email:a})):d.teamUserActionBlocked("team-member-collab")},error:function(e){console.log("getMember error??",e.Message)}}):void d.teamUserActionBlocked("team-member-collab");j(e.Message?z(a)?m.pendingUser:m.aUser:m.notUser,{name:e.Message,email:a})},error:function(e){V(e.Message,"error")}}):V("Please provide a valid email address.","error")),!1});var oe=function(){p.empty(),C.removeClass("hasRecent");var o=0;$.each(R,function(e,a){var t;if(!(3<=o)&&(!function(e){for(var a=c.standardizeEmail(e.Email),t=0;t<B.length;t++)if(c.standardizeEmail(B[t].Email)===a&&0<B[t].Privilege&&!0===B[t].Accepted)return!0;return!1}(a)&&!z(a.Email))){var n=$(s.html());n.find(".name").text(a.FullName||a.Email),n.find(".email").text(a.Email||a.FullName),n.on("click",(t=a,function(){E&&N?(L=t.Email||t.FullName,j(m.aUser,{name:t.FullName,email:t.Email})):H()})),p.append(n),C.addClass("hasRecent"),o++}})};function ie(){ne(),oe()}return h.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var e=$(this),a=e.closest(".person");a.data("person");y.show(),e.text("Sending ...").css("cursor","default"),y.hide(),e.text("Invitation Sent!"),a.find(".actions").addClass("active"),setTimeout(function(){e.text("Remind").css("cursor","pointer"),a.find(".actions").removeClass("active")},3e3)}),S.find(".r1").click(function(){if($(this).hasClass("disabled")){var e=4==l.Team.Role?"Premium Guests":"Team Members";d.teamUserActionBlocked("invite-member",e,function(e,a){d.show(u)})}else 4==l.Team.Role?d.teamUserActionBlocked("non-team-member","Premium Guests"):(u.find(".popup-header h1.am-h .mem").text("Team Member "),u.find(".popup-header p.am-h").addClass("hidden"),l.Team&&l.Team.ST&&(14==l.Team.ST||19==l.Team.ST||22==l.Team.ST||25==l.Team.ST||28==l.Team.ST||31==l.Team.ST)||o.isFreeWithTeam()?(D.find(".block:eq(1) .left input").val(L),O=3,K("add-paidmem")):u.addClass("contact-supp"))}),S.find(".r2").click(function(){if($(this).hasClass("disabled")){var e=4==l.Team.Role?"Premium Guests":"Team Members";d.teamUserActionBlocked("invite-member",e,function(e,a){d.show(u)})}else 4==l.Team.Role?d.teamUserActionBlocked("non-team-member","Premium Guests"):(u.find(".popup-header h1.am-h .mem").text("Premium Guest "),u.find(".popup-header p.am-h").addClass("hidden"),l.Team&&l.Team.ST&&(14==l.Team.ST||19==l.Team.ST||22==l.Team.ST||25==l.Team.ST||28==l.Team.ST||31==l.Team.ST)?(D.find(".block:eq(1) .left input").val(L),O=4,K("add-paidmem")):u.addClass("add-pg"))}),d.reg(u,u.find(".popup-close, .btn-close, .back-to, .back-button"),function(){t.off("click"),d.saveFolio(1,B,Y)}),function(e){var a;u.removeClass("success"),R=null,u.find(".loading-animation").show(),y.show(),B=[],Y=[],console.log("config??",l.userEmail),_={Email:l.userEmail,FullName:l.FullName,Privilege:3,Accepted:!0},"undefined"!=e&&0<e.length?e.forEach(function(e){B.push(e)}):"undefined"!=_.Email&&B.push(_),ne(),u.find(".popup-header h1.am-h .mem").text(""),u.find(".popup-header p.am-h").removeClass("hidden"),l.Team&&0<l.Team.Id?r.listALLMembers({data:{teamId:l.Team.Id},success:function(e){u.find(".loading-animation").hide(),R=e.Data.Data.members,j(1),ne(),oe(),t.parent().removeClass("open"),t.on("click",function(){$(this).parent().toggleClass("open")}),y.hide()},error:function(e){u.find(".loading-animation").hide()}}):(u.find(".loading-animation").hide(),j(1),ne(),oe(),t.parent().removeClass("open"),t.on("click",function(){$(this).parent().toggleClass("open")}),y.hide()),a=E?"15px":"130px",E||o.isFreeWithTeam()?(u.find(".popup-content").removeClass("remove-top-border"),f.addClass("hidden"),w.removeClass("disable-btns")):(u.find(".popup-content").addClass("remove-top-border"),f.removeClass("hidden"),w.addClass("disable-btns")),u.find(".icon-Close").css({top:a}),d.show(u)}},app.popup.getTeamManagePopup=function(g,v,b,s,r,e,n){var o,a,T=$("#tmp-team-manage"),t=T.find(".cancel, .popup-close"),i=T.find(".add-role"),l=T.find(".status"),y=$("#tmp-team-manage-single"),d=$("#invite-email"),c=$("#invite-name"),u=T.find(".invite-form .btn-invite"),m=T.find(".invite-form"),p=3,C=T.find(".members-list"),w=[],f=!1,h=T.find(".loading-animation.forpopup"),k=T.find(".disclaimer"),x=T.find(".disclaimer+.tipped-icon");h.html(v.spinner);var P=T.find(".select-plan"),S=T.find(".btn-skip-step"),D=!1,F=0,I=0,M=!1;function E(e,a,t){L(!1),b.addMembers({data:{teamMembers:[{email:e,fullName:a,role:t,message:"",folioToken:"",accessType:0,TeamID:g.Team.Id}]},success:function(e){A("User added to team successfully!"),G()},error:function(e){L(!0),A(e.Message,"error")}})}function U(){var e=window.location.search,a="";if(""!==e){e=e.substr(1).split("&");for(var t=0;t<e.length;t++){var n=e[t].split("=");"plan"===n[0]&&(a=n[1])}""!==a?v.payment("","signUpMode",null,a):v.payment("showPlans","signUpMode")}else v.payment("showPlans","signUpMode")}function N(e){var a="Team Member";switch(e){case 2:a="Admin";break;case 3:a="Team Member";break;case 4:a="Premium Guest";break;case 5:a="Single Folio Guest"}return a}function A(e,a){var t=e||"Error found",n="error"===a?"error":"success";clearTimeout(o),l.removeClass("success"),l.removeClass("error"),l.text(t),l.addClass(n),l.show(),o=setTimeout(function(){l.hide("slow")},5e3)}function L(e){f=!e,e?(h.hide(),C.removeClass("disabled"),m.removeClass("disabled")):(C.addClass("disabled"),m.addClass("disabled"),h.show())}function O(e){if(g.TeamRoles)for(var a=0;a<g.TeamRoles.length;a++)if(e===g.TeamRoles[a].Id)return g.TeamRoles[a].Name;return console.log("ERROR gtting role name, defaulted to Team Member"),"Team Member"}function R(a,t,e,n,o,i){var s=i.closest(".each");s.addClass("loading"),b.changeMemberAccess({userEmail:a,userRole:t,teamId:g.Team.Id,folioToken:e,accessType:n,success:function(e){setTimeout(function(){s.removeClass("done");for(var e=0;e<w.length;e++)w[e].Email==a&&(w[e].Role=t,w[e].RoleName=O(t));Y(w)},500)},error:function(e){A(e.Message,"error")},complete:function(){s.removeClass("loading")}})}function B(){var e=1===n?"active user.":"active users.",a=parseInt(F),t=parseInt(I)+1,n=a+t,o=1===n?"seat":"seats",i=1===a?"guest":"guests",s=1===t?"member":"members";(r.isFree()||r.isFreeWithTeam())&&T.find(".team-text").hide(),T.find(".team-text .num").text(n),T.find(".team-text .seat-txt").text(o),T.find(".team-text .num-team").text(t),T.find(".team-text .mem-txt").text(s),T.find(".team-text .num-guest").text(a),T.find(".team-text .guest-txt").text(i),T.find(".ws-text .ac-text").text(e),T.find(".ws-text .num").text(w.length||0)}function Y(e){C.empty(),e.forEach(function(e,a){var t,n,o,i,s,r,l,d=e.FullName||e.Email,c=$(y.html()),u=e.Email===g.userEmail?" (You)":"",m=1===e.NumberOfChannelMemberships?"channel":"channels",p=1===e.NumberOfFolios?"folio":"folios",f=1===e.NumberOfTemplates?"template":"templates",h=e.NumberOfChannelMemberships+" "+m+", "+e.NumberOfFolios+" "+p+", "+e.NumberOfTemplates+" "+f+".";c.data("each",e).addClass(1===e.Role?"owner":"").find(".is-owner").text("Team Owner"),c.find(".loading-animation").html(v.spinner),c.find(".name").text(d+u),c.find(".email").text(e.Email),c.find(".access-txt").text(h),c.find(".action .popup-menu .item[data-value="+e.Role+"]").addClass("active"),c.find(".action .role .text").text(O(e.Role)),c.find(".remove").on("click",(t=e.Email,n=a,i=""!==(o=d)?o:t,function(){if(M){var e=g.teamMembersOnSignUp;g.teamMembersOnSignUp=e.filter(function(e){return e.Email!==t}),G()}else v.push(T),v.confirmRemoveMember(t,i,function(){L(!1),b.removeMember({userEmail:t,success:function(e){C.find(".each:eq("+n+")").hide("slow",function(){C.find(".each:eq("+n+")").remove()});var a=_.filter(w,function(e){return e.Email!==t});w=a,B(),v.message({heading:"Success",message:i+" has been successfully removed from your team.",btnText:"Ok",notMini:!0,bodyCentered:!0})},error:function(e){A(e.Message,"error")},complete:function(){L(!0)}})})})),c.find(".action .popup-menu .item").on("click",(s=e.Email,r=a,l=e.Role,function(){var e=$(this),a=e.data("value"),t=e.closest(".each");if(T.find(".members-list .each:eq("+r+"1) .action .role .text").text(O(a)),t.find(".action .item").removeClass("active"),e.addClass("active"),a!==l&&5!==a)if(5===l){var n="Do you really want to change access for <b>"+s+"</b> to <b>"+O(a)+"</b>? <b>You will be charged a prorated amount minus any credits on your account.</b>";v.push(T),v.message({heading:"Change Team Member Access ",message:n,btnText:"Confirm",notMini:!0,cancelText:"Cancel",handleOK:function(){R(s,a,"","",0,e)}})}else R(s,a,"","",0,e)})),1===e.Role?C.prepend(c.addClass("owner")):(5!==e.Role&&c.find(".action .popup-menu .item[data-value=5]").remove(),C.append(null===e.Accepted?c.addClass("pending"):c.addClass("team-member")))}),B(),app.menu.xSelect()}function G(e,a){var t;L(!1),d.val(""),c.val(""),d.removeClass("error"),"string"==typeof e&&(g.Team=JSON.parse(e),g.UserTeams=[],g.UserTeams[0]=g.Team),console.log("config.Team ",g.Team),g.Team&&(t=g.Team.Id),M?0===g.teamMembersOnSignUp.length?b.listALLMembers({data:{teamId:t},success:function(e){w=e.Data.Data.members,console.log("teamMemList ",w),g.teamMembersOnSignUp.push(w[0]),g.userEmail=w[0].Email,Y(w),a&&"function"==typeof a&&a()},error:function(e){A(e.Message,"error")},complete:function(){L(!0)}}):(Y(g.teamMembersOnSignUp),L(!0)):b.listALLMembers({data:{teamId:t},success:function(e){console.log("listALLMembers",e),w=e.Data.Data.members,F=e.Data.Data.GuestSeatsPurchased,I=e.Data.Data.MemberSeatsPurchased,Y(w),a&&"function"==typeof a&&a()},error:function(e){A(e.Message,"error")},complete:function(){L(!0)}})}function H(){if(!r.hasTeam()||!r.isOwner()&&!r.isAdmin())return r.hasTeam()?v.message({heading:"You Cannot Perform this Action",message:"Only admins can add/remove team members and guests. Please contact the admin for more access.",btnText:"Ok",bodyCentered:!0,notMini:!0}):v.message({heading:"Please Upgrade Your Account",message:"Manage Team Members is only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){v.payment("showPlans")}}),!1;var e=$.trim(window.location.hash.substr(1));a=""===e?"managepeople":e,v.show(T,a)}return r.isFreeWithTeam()&&(k.hide(),x.hide()),i.change(function(){f||(p=$(this).data("value"),i.find(".text").html(N(p)))}),u.click(function(e){if(e.preventDefault(),!f){L(!1);var a=d.val(),t=c.val(),n=!0,o="";if(d.removeClass("error"),function(e){var a=w;M&&(a=g.teamMembersOnSignUp);for(var t=0;t<a.length;t++){var n=s.standardizeEmail(a[t].Email);if(n===e&&null==a[t].Accepted&&null==a[t].ProcessedTime)return!0}return!1}(a=s.standardizeEmail(a))&&(n=!(o="You have already invited this user.")),function(e){for(var a=0;a<w.length;a++){var t=s.standardizeEmail(w[a].Email);if(t===e&&1==w[a].Accepted&&null!=w[a].ProcessedTime)return!0}return!1}(a)&&(n=!(o="This user is already a member.")),validator.isEmail(a)||(o="Please provide a valid email address.",d.addClass("error"),n=!1),n)if(M)g.teamMembersOnSignUp.push({Email:a,FullName:t,Role:p,Accepted:null,AccessType:0,Id:null,IsOwner:!1,NumberOfChannelMemberships:0,NumberOfFolios:0,NumberOfTemplates:0,Privilege:null,ProcessedTime:null,UserName:a}),A("User added to team successfully!"),G();else if(0!=r.isFreeWithTeam()||1!=g.Team.Role&&2!=g.Team.Role)E(a,t,p);else{L(!0);var i=w.length;v.confirmAddMember(N(p),i,function(){E(a,t,p),v.teamManagePopup()})}else A(o,"error"),L(!0)}}),P.click(U),S.click(U),C.on("click",".pending-actions .b",function(){var a=$(this),t=a.closest(".each"),e=t.data("each");L(!1),a.text("Sending ...").css("cursor","default"),b.resendTeamUser({userEmail:e.Email,userRole:e.Role,teamId:g.Team.Id,folioToken:e.FolioToken,accessType:e.AccessType,success:function(e){a.text("Invitation Sent!"),t.find(".action").addClass("active"),setTimeout(function(){a.text("Resend Invitation").css("cursor","pointer"),t.find(".action").removeClass("active")},3e3)},error:function(e){A(e.Message,"error")},complete:function(){L(!0)}})}),e.addListener("refreshMemberData",function(){D&&G()}),v.reg(T,t),function(e,a){var t=void 0;D=!0,T.find(".members").hide(),"object"===_typeof(e)&&"signUp"==e.mode&&(T.addClass("signUpMode").addClass("no-close"),t=e.data,M=!0,n.tipped(g,b,s,!0),void 0===g.teamMembersOnSignUp&&(g.teamMembersOnSignUp=[])),a?T.find(".members").show():G(t,function(){T.find(".members").show()}),v.show(T),M||H()}},app.popup.getTeamSettingPopup=function(a,t,n,o,e){var i,s=$("#tmp-team-settings"),r=(s.find(".btn-upload"),s.find(".right")),l=s.find(".team-logo img"),d=s.find(".team-url"),c=s.find(".left input"),u=s.find(".cta-btns"),m=s.find(".cancel, .popup-close"),p=u.find(".btn.popup-cta.update"),f=s.find(".url-info"),h=s.find(".msg"),g=null,v=null,b="",T=null;s.find(".loading-animation").html(t.spinner),t.reg(s,m);var y=function(e){h.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){h.hide("slow").removeClass("error")},5e3),s.find(".loading-animation").hide()};r.click(function(){s.find(".uploader").trigger("click")}),f.click(function(e){$(e.target).is(f.find(".icon-Close"))?f.removeClass("show-info"):f.addClass("show-info")}),s.find(".uploader").change(function(){s.addClass("busy");var e=this.files&&this.files[0];e&&(form=s.find("#ts-uploadimage-form")[0],s.find(".loading-animation").show(),n.uploadTeamImage(form,e,{type:"logo",isProgress:!1,success:function(e){console.log("res",e),T=e.Data,b=e.Message,l.attr("src",b).prop("title",g),s.find(".loading-animation").hide()},error:y}))});function C(){if(i.hasClass("locked"))return o.hasTeam()?t.message({heading:"You Cannot Perform this Action",message:"Only team admins can manage the team settings. Please contact the admin for more access.",btnText:"Ok",bodyCentered:!0,notMini:!0}):t.message({heading:"Please Upgrade Your Account",message:"Team Settings is only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){t.payment("showPlans")}}),!1;var e=$.trim(window.location.hash.substr(1));hashVal=""===e?"teamsettings":e,t.show(s,hashVal)}return p.click(function(){var e;e=T?b:"",g=c.val(),s.find(".loading-animation").show(),n.saveTeam({data:{email:"",teamId:a.Team.Id,imageID:T,members:[],data:{Name:g,Status:a.Team.Status,TeamUrl:"",LogoURL:e}},success:function(e){var a;a="Updated Successfully.",h.html(a).addClass("success").removeClass("error").show("slow"),setTimeout(function(){h.hide("slow").removeClass("success")},5e3),s.find(".loading-animation").hide(),T&&(s.find(".loading-animation").hide(),$("#logo-bar .app-title a").html('<img style="max-width: 80px; max-height: 40px; margin-top: -4px; max-height:calc(100% - 4px);" src="'+b+'">').css({textAlign:"center"}))},error:function(e){y(e.Message),s.find(".loading-animation").hide()}})}),function(){g=a.Team.Name,v=a.Team.TeamUrl,b=a.Team.LogoUrl,l.attr("src",b),d.text(v),c.val(g),t.show(s),e.doSetFocus(c),console.log("in teamSettings popup: ",(new Date).getTime()),i?C():setTimeout(function(){console.log("in teamSettings popup again: ",(new Date).getTime()),i=$(".user-menu-popup .team-settings"),C()},2250)}},app.menutcopy=function(o,i,e,s,r,t){var a=$("#tmp-copy-template-topbar"),n=a.find(".ok.edit-preview-template"),l=a.find(".present"),d=app.editor.present(e),c=a.find(".white-curved-arrow"),u=a.find(".try-xtensio-text"),m=!1;if(console.log("config.EditTemplate: ",o.EditTemplate,o.isUserTemplate,o),console.log("enableExampleTemplateHeaders",o.enableExampleTemplateHeaders),1==o.enableExampleTemplateHeaders&&(1==o.showHeader||2==o.showHeader)){$homePage=$("#home-page");var p=$("#tmp-header-template"),f=$("#tmp-footer-template"),h=$("#tmp-faq");if(0===$homePage.find("#tmp-header-template").length){var g=p.find(".cont-right .use-temp"),v=1==o.showHeader?"Template":"Example",b=p.find(".back-link");p.find(".cont-center h1").text(o.seoTitle),p.find(".cont-center p").text(o.seoDescription),p.find(".cont-left img").attr("src",o.seoImage),p.find(".cont-right .use-num").text(o.useCount),b.text("< See All ".concat(v,"s")),g.text("Use ".concat(v)),o.lastModified?p.find(".cont-right .last-updated span").text(o.lastModified):p.find(".cont-right .last-updated").hide(),b.click(function(){var e="https://xtensio.com/examples/?_ga=2.65959978.561003538.1581718826-910912414.1580898754";if(""!==o.userName){var a="Example"===v?"examples":"xtensiotemplates";e="".concat(o.baseUrl,"/#").concat(a)}window.location.href=e}),o.relatedFolios&&0<o.relatedFolios.length&&o.relatedFolios.forEach(function(e){var a=$($("#tmp-header-item").html());a.find("h4").text(e.FolioTitle),a.find("img").attr("src",e.FolioThumbnail),a.find("a").attr("href",e.FolioUrl),a.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),p.find(".comparison .container").append(a)}),o.folioLabels&&0<o.folioLabels.length&&o.folioLabels.forEach(function(e){return p.find(".cont-center .tags").append($("<span>".concat(e.Name,"</span>")))}),$homePage.prepend(p)}if(0===$homePage.find("#tmp-faq").length){$homePage.append(h),h.find(".item-faq .i-btn, .item-faq .text").click(function(){var e;e=$(this).parent(),$that=e.find(".i-btn"),e.find(".item-full").slideToggle(200,function(){$(this).is(":visible")?($that.html('<i class="fa fa-minus-circle"></i>'),a.find(".item-full").not($(this)).slideUp(400,function(){$(this).parent().find(".i-btn").html('<i class="fa fa-plus-circle"></i>')})):$that.html('<i class="fa fa-plus-circle"></i>')})})}if(0===$homePage.find("#tmp-footer-template").length){var T=f.find(".get-started");$homePage.append(f)}}function y(){var e="https://app.xtensio.com/account/signup?t="+o.t,a=t.getUrlVars()._ga;a&&(e=e+"&_ga="+a),window.location.href=e}""!==o.userName?(n.text("Edit this Folio"),c.css("display","none"),u.text("").css("display","none")):(c.css("display","inline-block"),u.html("Start editing your "+o.FolioName.toLowerCase()+" and other collateral").css("display","inline-block"),n.text("Get Started - Free")),"true"==o.EditTemplate||o.isUserTemplate||o.isTeamTemplate?((o.isUserTemplate||o.isTeamTemplate)&&0<o.Team.Id&&(a.find("i.icon-Logo").remove(),a.find(".app-title a").append('<img src ="'+o.Team.LogoUrl+'" title="'+o.Team.Name+'" style="max-height:35px;margin-top: -12px;">'),a.find(".text").text(o.FolioName)),(o.isUserTemplate||o.isTeamTemplate)&&n.text("Use This Template"),$(document).click(function(e){s.close(),m&&(m=!1,$("body").removeClass("signupPopupOpen"),console.log("signup popup closed"))}),$("#popup-container .popup-content").click(function(e){e.stopPropagation()}),0<$("#antiForgeryContainer").length?$("#antiForgeryContainer").after(a):$("body").prepend(a),$("#home-page").css({paddingTop:"50px"})):$("body").append(l.addClass("fly")),o.presentationMode||l.hide(),"dash-explore"==o.EditTemplate&&(l.addClass("fly").css({top:"55px"}).show(),$("#tmp-dashboard-content .folios-container.explore").append(l));function C(a,t){i.getWorkspaceChannels({teamId:0,success:function(e){console.log("response from getWorkspaceChannels on copytemplatemenu",e),o.saveFolioTransferItem={FolioName:a,Token:t,labels:JSON.parse(e.Data),template:o.FolioName,isUseTemplate:!0},console.log("saveFolioTransferItem",o.saveFolioTransferItem),s.saveFolio()},error:function(e){console.log("error",e)}})}r.setLock(function(e,a){}),l.on("click",function(){a.hide(),l.hide();var e=$("#home-page").css("paddingTop");$("#home-page").css({paddingTop:"0px"}),d.start(function(){a.show(),l.show(),$("#home-page").css({paddingTop:e})})}),o.userName||a.find(".app-title a").attr("href","https://xtensio.com"),n.on("click",function(){$(this);var e=o.token,a=o.FolioName?"Untitled ("+o.FolioName+")":"Untitled";if(console.log("Fname: "+a),o.redirectToTeamSignup)console.log("popup.signupPlansPopup"),s.signupPlansPopup();else if(o.userName){var t=!!o.UserTeams&&0<o.UserTeams.length;console.log("in copytemplatemenu.js"),t?o.UserTeams&&0<o.UserTeams.length&&r.checkFoliosLimitReached(i,s,function(){console.log("token name",e,a),s.addFolioToSpace(e,a)}):r.checkFoliosLimitReached(i,s,function(){C(a,e)})}else!o.t||"library@xtensio.com"!=o.folioUserName&&"template@xtensio.com"!=o.folioUserName?($("body").addClass("signupPopupOpen"),m=!0,s.signUp(!0)):y();return!1}),setTimeout(function(){g&&g.click(function(e){e.preventDefault();$(this);var a=o.token,t=o.FolioName?"Untitled ("+o.FolioName+")":"Untitled";if(console.log("Fname: "+t),o.redirectToTeamSignup)console.log("popup.signupPlansPopup"),s.signupPlansPopup();else if(o.userName){var n=!!o.UserTeams&&0<o.UserTeams.length;console.log("in copytemplatemenu.js"),n?o.UserTeams&&0<o.UserTeams.length&&r.checkFoliosLimitReached(i,s,function(){console.log("token name",a,t),s.addFolioToSpace(a,t)}):r.checkFoliosLimitReached(i,s,function(){C(t,a)})}else!o.t||"library@xtensio.com"!=o.folioUserName&&"template@xtensio.com"!=o.folioUserName?($("body").addClass("signupPopupOpen"),m=!0,s.signUp(!0)):y();return!1}),T&&T.click(function(e){e.preventDefault();$(this);var a=o.token,t=o.FolioName?"Untitled ("+o.FolioName+")":"Untitled";if(console.log("Fname: "+t),o.redirectToTeamSignup)console.log("popup.signupPlansPopup"),s.signupPlansPopup();else if(o.userName){var n=!!o.UserTeams&&0<o.UserTeams.length;console.log("in copytemplatemenu.js"),n?o.UserTeams&&0<o.UserTeams.length&&r.checkFoliosLimitReached(i,s,function(){console.log("token name",a,t),s.addFolioToSpace(a,t)}):r.checkFoliosLimitReached(i,s,function(){C(t,a)})}else!o.t||"library@xtensio.com"!=o.folioUserName&&"template@xtensio.com"!=o.folioUserName?($("body").addClass("signupPopupOpen"),m=!0,s.signUp(!0)):y();return!1})},1e3)},app.main=function(n,e){app.console=consologs(n);var a,t,o,i=$("#notify-popup");function s(e){var a=$("#tmp-power-by-footer");if(a.removeClass("hidden"),isChannelOwner=n.Team&&1==n.Team.Role,"normal"==e&&isChannelOwner){var t=a.find(".power-by-footer");t.addClass("footer-on-free"),t.html('<p>Upgrade your account to remove Xtensio branding and access premium features.</p><a class="btn popup-cta see-plans" href="#seeplans">See Plans</a>'),t.find("a.see-plans").click(function(e){return e.preventDefault(),app.popup.payment("showPlans"),!1})}else a.find("upgrade"==e?".normal":".upgrade").addClass("hidden"),a.find("."+e).removeClass("hidden");return a}app.isconsole="localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||n.isAdmin;var r=["#66D7C4","#FFD271","#FD9F4D","#F67157","#E95F5E","#FFFFFF","#DCBB9F","#76D5E5","#6486A5","#2E5668","#D45D77","#9D557C","#7E8589","#FFFFFF","#000000","#052B3E"];function l(e){var t=[];return e.forEach(function(e,a){t.push(e.HexCode)}),t}if(0!==n.Team.Id&&void 0!==n.StyleGuides?r=l(n.StyleGuides[0].TeamColors):void 0!==n.DefaultColors&&(r=l(n.DefaultColors)),n.colors=r,app.menu.xSelect(),n.isBlocked||n.IsDelinquent)location.href="/";else{if(app.console(n),n.getPass||e&&e.GetPass)app.popup.folioPass(n);else{var d,c,u,m,p=app.core.main(n,e),f=p.eventManager,h=p.pageManager,g=p.store,v=p.modStore,b=p.folioStore,T=p.configStore,y=p.appHub,C={};if(a=p.utility,t=p.apiHelper,o=p.plusHelper,app.plugin.main(n,p,e,o,a),(n.dashboardMode||n.editMode||n.EditTemplate||n.isProject)&&(C=app.popup.main(n,f,a,t,h,o,v,g,e,b,T,y)),n.isProject)return n.banner&&$("#view-project").after(s("normal")),void((n.getPass||e&&e.GetPass)&&app.popup.folioPass(n));var w,k,x,P,S,D='<style id="folio-style" type="text/css">'+(b.get("style")||"")+"</style>";if($("head").append(D),d=n.editMode?app.menu.main(n,e,p,C):{},u=(c=app.managers.main(n,e,p,d,C,a)).modManager,m=c.rddm,app.factory.main(n,e,p,d,C,u,m,a),n.editMode)e.IsUserTemplate&&$("#tmp-collaborators").remove(),app.common.main(n,t,f,a,C,g,y,e,app.plugin,o),app.editor.main(n,e,t,f,h,C,a,g,u,b,o),h.setupEditPage(n,e,u),n.banner&&s("upgrade"),e.Version<1&&1!=g.get("upgrade-"+n.token)&&C.message({heading:"Upgrade Editor?",message:"This folio was created using an older version of our text editor.<br/>(Upgrading may affect the existing formatting minimally,<br/> but gives you super powers.)",btnText:"Use New Editor",cancelText:"Keep Existing",handleNo:function(){g.set("upgrade-"+n.token,1)},handleOK:function(){C.busy(),t.upgradeFolio({success:function(){C.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully upgraded. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){C.error(e.Message)}})}}),app.editor.viewOnly(e),0<$("#tmp-secondary-bar").length&&($(".module-container").length<1||$(".empty-module-container").length==$(".module-container").length)&&$("#tmp-secondary-bar .add-module-button").trigger("click"),window.IntersectionObserver&&(k=new IntersectionObserver(function(e){var a=!0,t=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done);a=!0)entry=o.value,entry.isIntersecting?$(entry.target).find(".section-settings").addClass("fixed-menu"):$(entry.target).find(".section-settings").removeClass("fixed-menu")}catch(e){t=!0,n=e}finally{try{a||null==i.return||i.return()}finally{if(t)throw n}}},{rootMargin:"-200px 0px -200px 0px"})),setTimeout(function(){var a="";$("#edit-sections").on("mouseover",".module-container",function(){if(!(w=$(this)).hasClass("canvas-module-container")&&!w.hasClass("empty-module-container")){if(1===w.parents(".canvas-module-container").length){var e=w.parents(".canvas-module-container");U($("#edit-sections .module-container"),!1),U($("#edit-sections .module.empty-module:not(.empty-canvas-cont)"),!1),a=e.attr("id"),U(e,!0)}else a="",U($("#edit-sections .module-container"),!1),U($("#edit-sections .module.empty-module:not(.empty-canvas-cont)"),!1);U(w,!0)}}),$("#edit-sections").on("mouseover",".canvas-module-container",function(){a!==$(this).attr("id")&&(E(),a=$(this).attr("id"),U($(this),!0))}),$("#edit-sections").on("mouseover",".module.empty-module:not(.empty-canvas-cont)",function(){a="",E(),U($(this),!0)}),$("#edit-sections").on("mouseover",".edit-div",function(){w&&w.parents(".edit-div").get(0)===this||(a="",E(),U($(this),!0))})},500),$(window).on("resize scroll",function(){null!==x&&clearTimeout(x),x=setTimeout(function(){(!S||S&&!a.isElementInViewport(P))&&M()},350)}),M();else $("#edit-page").remove(),u.activatePreview(),app.dash.archivedFolioTopBanner(n,C,e,o),app.menutcopy(n,t,f,C,o,a),$("#home-page").after($("#presentation-buttons").addClass("public"));app.editor.addWatermark(n,C,o,t)}var F;if(n.editMode&&-1<window.location.toString().indexOf("#new")){console.log(window.location.toString().indexOf("#new")+"    :::::::::");var I="Personal Dashboard";n.Team&&0!=n.Team.Id&&(I=n.Team.Name),i.find(".logged-in .text").html("Folio is saved to <b>"+I+"</b>"),i.removeClass("on").addClass("logged-in").show(),setTimeout(function(){i.hide("slow").removeClass("logged-in")},2500)}else n.editMode||(F=0,n.UserTeams&&n.editMode&&0<n.UserTeams.length&&(F=n.DisableP?parseInt(n.UserTeams.length):parseInt(n.UserTeams.length)+1,console.log("userSpaces mainJs??",F),1===F||1<F&&(n.Team&&0!=n.Team.Id?(i.find(".logged-in .text").html("You are logged into team: <b>"+n.Team.Name+"</b>"),$("#tmp-dash-topbar .upgrade-btn, #tmp-primary-bar .upgrade-btn").remove()):i.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),i.removeClass("on").addClass("logged-in").show(),setTimeout(function(){i.hide("slow").removeClass("logged-in")},2500))))}function M(){E(),$("#edit-sections").find(".edit-div").each(function(){if(a.isElementInViewport($(this)))return $(this).find(".section-content").trigger("mouseover"),!1})}function E(){U($("#edit-sections .module-container"),!1),U($("#edit-sections .module.empty-module:not(.empty-canvas-cont)"),!1)}function U(t,e){if(e){var a=t.closest(".edit-div").find('div[title="Section Settings"]'),n=t.hasClass("edit-div");if(n?(a=t.find('div[title="Section Settings"]'),t.find(".section-content").addClass("highlight")):t.addClass("highlight"),!a.hasClass("btn drop-down-open")){var o=.9*window.innerHeight,i=n?t:t.closest(".edit-div"),s=i.find(".section-settings");P=i,$('div[title="Section Settings"]').each(function(e){var a=$(this).closest(".section-settings");a.removeClass("fixed-menu"),a.find(".button-panel").fadeOut(200,function(){a.find(".button-panel").hide()}),$(this).removeClass("drop-down-open"),$(this).closest(".drop-down-container").removeClass("showing"),a.find(".move-menu").hide(),a.find(".more-menu").hide(),k&&k.unobserve(t.closest(".edit-div").get(0))}),i.height()>=o&&(s.addClass("fixed-menu"),k&&k.observe(i.get(0))),a.trigger("click"),S=!0}}else t.removeClass("highlight"),S=P=!1}},app.dashboard=function(e){app.console=consologs(e),console.log(e),e.isDashboard=!0;e.colors=["#66D7C4","#FFD271","#D45D77","#9D557C","#3C688F","#1ab9d3","#fd9f4c","#c93555","#7e8589","#dcbc9f"],e.myLabel={ID:0,Name:"My Templates",TimeStamp:0,Token:"own",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"},e.xtensioLabel={ID:0,Name:"Xtensio Templates",TimeStamp:0,Token:"xtensio",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"};var a,t=app.core.main(e),n=t.utility,o=t.apiHelper,i=t.eventManager,s=t.pageManager,r=t.store,l=t.appHub,d=t.modStore,c=t.plusHelper,u=t.configStore;app.plugin.main(e,t,null,c,n),a=app.popup.main(e,i,n,o,s,c,d,r,void 0,void 0,u,l);var m=document.location.href,p=$.trim(window.location.hash.substr(1));-1<(m=m.toLowerCase()).indexOf("teams/create")?a.signUpTeam():e.isSignup?a.signUp():e.loginState?a.signIn():"signup-plans"===p||e.redirectToTeamSignup?a.signUpTeam():(app.common.main(e,o,i,n,a,r,l,{},app.plugin,c),app.dash.main(e,i,o,n,a,c),app.menu.xSelect(),"not-set"!=e.ExploreTabFolioToken?($("#tmp-dash-topbar .explore").show(),$("#tmp-dash-topbar .explore").click(function(){0<$("#tmp-dashboard-content .explore.not-populated").length&&(app.dash.getExploreFolio(e,o,a),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated"))})):($("#tmp-dash-topbar a.explore").hide(),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated")));var f=$("#notify-popup"),h=0;e.UserTeams&&0<e.UserTeams.length&&(h=e.DisableP?parseInt(e.UserTeams.length):parseInt(e.UserTeams.length)+1,console.log("userSpaces??",h),1===h||1<h&&(e.Team&&0!=e.Team.Id?(f.find(".logged-in .text").html("You are logged into team: <b>"+e.Team.Name+"</b>"),(0==c.isFreeWithTeam()||c.isFreeWithTeam()&&!c.isOwner())&&($("#tmp-dash-topbar, #tmp-primary-bar").addClass("hide-upgrade-btn"),$("#tmp-dash-topbar .upgrade-btn, #tmp-primary-bar .upgrade-btn").remove())):f.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),f.removeClass("on").addClass("logged-in").show(),setTimeout(function(){f.hide("slow").removeClass("logged-in")},2500)),h=0)},app.charts.lineChart=function(){return{generateLineChart:function(){this.svg.append("path").datum(this.data).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",.5).attr("class","line").attr("d",this.line).style("stroke",this.strokeColor)},reColor:function(e){this.strokeColor=e,this.svg.selectAll(".line").style("stroke",this.strokeColor)},reRenderLineChart:function(e){console.log("reRenderLineChart ",e),this.data=e,this.xScale.domain([0,this.data.length-1]).range([0,this.width]),this.yScale.range([this.height,0]),this.svg.selectAll(".line").attr("d",this.line)},init:function(e,a,t){var n=this;n.arrayOfPoints=[],n.data=a,n.strokeColor=t,n.containerEl=e[0],n.chartEl=e.find(".svg-line-chart")[0],n.margin={top:0,right:0,bottom:0,left:0},n.width="100",n.height="100",n.xScale=d3.scale.linear().domain([0,n.data.length-1]).range([0,n.width]),n.yScale=d3.scale.linear().domain([0,100]).range([n.height,0]),n.line=d3.svg.line().x(function(e,a){return n.xScale(a)}).y(function(e){return n.yScale(e.Height)}).interpolate("cardinal"),n.svg=d3.select(n.chartEl).attr("width",n.width+"%").attr("height",n.height+"%").attr("preserveAspectRatio","none").attr("viewBox","0 0 100 100").append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),n.generateLineChart()}}},app.charts.pie=function(){return{draw:function(t){var e=d3.layout.pie().sort(null),a=t.$el.width();if(a<1&&(t.$el.parents(".module-container").hasClass("col-sm-2")?a=170:t.$el.parents(".module-container").hasClass("col-sm-4")?a=170:t.$el.parents(".module-container").hasClass("col-sm-6")?a=270:t.$el.parents(".module-container").hasClass("col-sm-8")?a=370:t.$el.parents(".module-container").hasClass("col-sm-10")?a=390:t.$el.parents(".module-container").hasClass("col-sm-12")&&(a=390)),0<a){t.$el.empty();var n=d3.select(t.$el.get(0)).append("svg").attr("width",a).attr("height",a).append("g"),o=Math.ceil(a/2);n.attr("transform","translate("+o+","+o+")");var i=d3.svg.arc().innerRadius(.98*o).outerRadius(Math.floor(.8*o));n.text("");var s=n.selectAll("path").data(e(t.items));s.enter().append("path").attr("fill",function(e,a){return t.colorFunc(a)}).attr("d",i),s.exit().remove()}}}},app.editor.collaboratorsMenu=function(o,n,e,a,i,s,t){var r,l=[],d=[],c=$("#tmp-collaborators"),u=c.find(".others"),m=u.find(".person"),p=$("#tmp-single-collab");function f(){var e=$(this).data("email"),a=o.currentlyEditing[e];a&&a.active&&a.module.bringInView()}function h(e){u.find(".person:not(.add)").remove();var n=0;if($.each(e.Collaborators,function(e,a){if(0<a.Privilege&&a.Email!=o.userEmail)if(++n<=5){var t=$(p.html());t.on("click",f).attr("data-tip",a.FullName).attr("data-email",a.Email).find(".initials").text(i.getInitials(a.FullName||a.Email)),u.prepend(t.addClass(d[a.Email]))}else l.push(a.FullName)}),n&&(c.find(".add-new").addClass("hidden"),u.find(".add").removeClass("hidden")),5<n){var a=u.find(".person:not(.add)").last();l.unshift(a.attr("data-tip")),a.removeClass("active").attr("data-html","true").attr("data-tip",l.join("<br/>")).find(".initials").text("+"+(n-5+1))}t.isSingleFolioGuest(),m.attr("data-tip","Add / Remove People"),app.plugin.tooltip()}c.on("click",".add-new, .add",function(){console.log(o),t.isSingleFolioGuest()?a.teamUserActionBlocked("add-remove-collab","Guests"):t.isPremiumGuest()?a.teamUserActionBlocked("guest-collab"):0<o.Team.Id&&0!==o.Team.Role&&4!==o.Team.Role&&5!==o.Team.Role?a.collaborators(n):a.message({heading:"Please Upgrade Your Account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:"See Plans",cancelText:"Nevermind",handleOK:function(){a.payment("showPlans")}})}),h(n),s.addListener("collabChange",h),s.addListener("editorStatus",function(t){setTimeout(function(){var e=o.currentlyEditing[t.email],a=1==t.status?e&&e.active?"editing":"active":"";u.find('.person[data-email="'+t.email+'"]').removeClass("active editing").addClass(a),d[t.email]=a,clearTimeout(r),e&&(e.active&&(e.name=function(e){for(var a=0;a<n.Collaborators.length;a++)if(n.Collaborators[a].Email==e)return n.Collaborators[a].FullName;return!1}(t.email),r=setTimeout(function(){o.currentlyEditing[t.email].active=!1,e.module.listEditors(),s.raiseEvent("editorStatus",t)},1e4)),1!=t.status&&(e.active=!1),e.module.listEditors())},500)}),$(".app-title .icon-Edit").after(c)},app.editor.copyFolio=function(l,d,c,u,m,e,t){var n,a=$("#tmp-secondary-bar"),o=".copy-folio-btn";app.core.padlocks(m,e,u).setCopyFolioLock(a,o),a.on("click",o,function(){if(!m.isSingleFolioGuest()&&!m.isPremiumGuest())return m.getData(1,function(e,a,t,n){var o=0,i={},s=e.ST;if(u.ST=s,console.log("Editor copyFolio inside getData:::",e,a,t,n),t&&(10!=e.ST&&11!=e.ST||u.IsDelinquent||(o=5,i.currUser="Plus",i.limit=5)),a&&10!=e.ST&&11!=e.ST&&3!=e.ST&&16!=e.ST&&(ispro=!0),a||(o=1,i.currUser="Free",i.limit=1),u.IsDelinquent&&(o=1,i.currUser="Free",i.limit=1),m.isFreeWithTeam()&&(o=2,i.currUser="Free",i.limit=2),!a||10!=e.ST&&11!=e.ST&&16!=e.ST&&3!=e.ST||(isplus=!0,o=5,i.currUser="Plus",i.limit=5),28===s||31===s){var r=0<u.Team.Id?10:1;o=r,i.currUser="ProBusiness",i.limit=r}console.log("limit",o,t,a,u.IsDelinquent),u.Team&&u.Team.IsDelinquent?app.dash.downgrade(u,d,i,l,m,c):0<o&&(console.log("user limit:::",o),l.getUserActiveFoliosCount({success:function(e){var n=e.Data;console.log("user active folios:::",n),l.getUserTemplateCount({success:function(e){var a=e.Data,t=n+a;if(0===u.Team.Id&&(m.isProBusiness()||m.isProTeamMember()||m.isBusiness())||m.isFreeWithTeam()){if((u.IsDelinquent||o<=n||0<a)&&(i.foliosCount=e.Data,1===t))return void d.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User. Please upgrade to a premium plan for more folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){d.payment()}})}else"ProBusiness"===i.currUser&&l.getUserTeamsAndFolios({userEmail:u.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var a=_.find(JSON.parse(e.Data),{Id:u.Team.Id});void 0!==a?(a.TotalFolios>o||m.isSubscriptionExpired())&&app.dash.downgrade(u,d,i,l,m,c):console.log("getUserTeamsAndFolios teamDetails ERR",u.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}})},error:function(e){$comp.removeClass("busy"),console.log("error: ",e)}})},error:function(e){console.log("error: ",e)}}))}),m.checkFoliosLimitReached(l,d,function(){l.getWorkspaceChannels({teamId:u.Team.Id,success:function(e){console.log("copyFolio Editor response channels",e),u.labels=JSON.parse(e.Data);var a="Copy - "+t.FolioName;u.duplicateFolioItem={FolioName:a,Token:t.Token,IsDuplicate:!0},d.saveFolio(),u.saveFolioSuccess&&(n=u.saveFolioSuccess),console.log("saveFolioSuccess: ",n)},error:function(e){console.log("error in getWorkspaceChannels",e)}})}),!1;d.teamUserActionBlocked("create","Premium Guests")})},app.editor.froala=function(o,e,a,n,t,i,s){$("#tmp-style-guide");var r=$('<div class="froala-styleguide-link">'),l=$('<div class="froala-manage-color-link">'),d=$('<div class="btn-picker"><i class="fa fa-eyedropper"></i></div>'),c="Manage/Add Colors",u=app.core.padlocks(t,i,o),m=l.text(c).on("click",function(e){e.preventDefault(),e.stopPropagation(),p()});function p(){n.styleGuidePopup(),setTimeout(function(){$("#tmp-style-guide .popup-header .tabs span:eq(1)").trigger("click")},1e3)}!function(){r.text("Manage Fonts").on("click",function(e){e.preventDefault(),e.stopPropagation(),n.styleGuidePopup()}).append('<i class="icon-Font">Aa</i>');var e=setInterval(function(){0<$("#dropdown-menu-fontFamily-1").find("ul.fr-dropdown-list").length&&(r.appendTo($("#dropdown-menu-fontFamily-1").find("ul.fr-dropdown-list").parent()),u.updateLockStyleGuide(),clearInterval(e))},500);$("#edit-page, .nav-settings").on("click",".theme-picker .manage-color-link",function(e){e.preventDefault(),e.stopPropagation(),p()});var a=setInterval(function(){if(0<$(".fr-color-hex-layer").parent().length){var e=$(".fr-color-hex-layer").parent();e.find(".fr-input-line input"),$('<div id="picker-container"></div>').appendTo($(".fr-color-hex-layer")),m.appendTo($(".fr-color-hex-layer")),e.find(".fr-input-line").css("position","relative"),e.find(".fr-input-line").append(d),d.colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var a=this.$UI;return e.hasClass("btn-picker")?a.appendTo("#picker-container"):a.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,a){var t=e.parent().find("input[type=text]");!0!==a&&t.addClass("fr-not-empty").val("#"+this.color.colors.HEX)}}),e.find(".fr-submit").click(function(){$(".cp-color-picker").hide()}),u.updateLockStyleGuide(),clearInterval(a)}},500),t=setInterval(function(){if(0<$(".fr-table-colors").parent().length){clearInterval(t),$(".fr-table-colors").parent().css("height","260px"),$(".fr-table-colors").parent().find(".fr-color-hex-layer").css({paddingBottom:0,height:"75px"});var e=[];$(".fr-table-colors").html(""),0!==o.Team.Id&&void 0!==o.StyleGuides?e=s.getColors(o.StyleGuides[0].TeamColors):void 0!==o.DefaultColors&&(e=s.getColors(o.DefaultColors));var n=0;$.each(e,function(e,a){var t=$('<span class="fr-command" tabindex="-1" role="button" data-param1="'+a+'" data-cmd="tableCellBackgroundColor"></span>').css("background-color",a).html('<span class="fr-sr-only">Color '+a+" </span>");$(".fr-table-colors").append(t),7==++n&&(n=0,$(".fr-table-colors").append($("<br>")))}),m.appendTo($(".fr-table-colors").parent()),u.updateLockStyleGuide()}},500)}(),u.setLockStyleGuide()},app.editor.main=function(l,e,a,t,n,d,o,i,s,r,c){l.currentlyEditing={};var u=app.plugin.lockedTip(l,t),m=$("#tmp-power-by-footer"),p=this.topBar(e,t,d);this.createSecondaryBar(l,e,a,t,s,d,n,p,r,c,u),this.templateMessage(l,e,i),this.wizardEditor(l,a,o,d),this.collaboratorsMenu(l,e,a,d,o,t,c),this.copyFolio(a,d,t,l,c,u,e),c.getData(1,function(e,a,t,n){var o=m.find(".power-by-footer"),i={heading:"Upgrade to premium plan",message:"By upgrading to any of our premium plans, you can remove Xtensio branding from your shared folios.",btnText:"Upgrade",cancelText:"Cancel",bodyCentered:!0,notMini:!0,handleOK:function(){d.billing()}},s=$("#home-page");function r(){0==s.find(".watermark-on-free").length&&0==s.find(".watermark-on-free-shared").length&&(s.append('<div class="watermark-on-free"></div>'),s.find(".watermark-on-free").hide())}if((0===e.ST||34===e.ST)&&!a&&0===l.Team.Id||c.isFreeWithTeam()){console.log("user is free user!");o.addClass("footer-on-free"),o.html('<p>Upgrade your account to remove Xtensio branding and access premium features.</p><a class="btn popup-cta see-plans" href="#seeplans">See Plans</a>'),o.find("a.see-plans").click(function(e){return e.preventDefault(),d.payment("showPlans"),!1}),r()}else void 0!==l&&l.isTrial?(console.log("user is on trial"),r()):(o.removeClass("footer-on-free"),m.find("a:not(.normal)").click(function(){return d.message(i),!1}));s.append(m)}),c.getExpirationDate()&&app.dash.expiredTrials(l,d,c),this.froala(l,a,t,d,c,u,o)},app.editor.present=function(o){var a,i,t=document,n=null,s=$("body")[0],r=$("#presentation-buttons"),l=r.find(".left-btn"),d=r.find(".right-btn"),c=r.find(".exit"),u=$("#home-page"),m=s.requestFullscreen||s.mozRequestFullScreen||s.webkitRequestFullscreen,p=!1;function f(e){if(!p){p=!0,e=e||0,document.body.scrollTop=document.documentElement.scrollTop=0;var a=$(".preview-div.current").css("min-height",""),t=a.index(),n=i-1;console.log("index",t),0<e&&t<n?a.add(a.next()).toggleClass("current"):e<0&&0<t&&a.add(a.prev()).toggleClass("current"),t+=e,a=$(".preview-div.current").css("min-height",window.innerHeight),l.toggleClass("disable",t<=0),d.toggleClass("disable",n<=t),o.raiseEvent("resize"),setTimeout(function(){$(document).scrollTop(0),p=!1,u.prop("tabIndex",u.prop("tabIndex")),u.focus()},10)}}function h(){if(t.fullscreenElement||t.mozFullScreen||t.webkitIsFullScreen){var e=t.cancelFullscreen||t.mozCancelFullScreen||t.webkitCancelFullScreen;e&&e.call(t)}r.hide(),$("html").css({backgroundColor:"","overflow-y":""}),$(".preview-div").css("min-height",""),$(".preview-available").removeClass("hidden"),$(window).off(".presentFix"),$("body, .preview-div").removeClass("present current"),clearTimeout(n),$("body").removeClass("idle"),$(t).off(".idleMouse .present"),a&&a()}function g(e){var a=e.which;32==a||39==a?f(1):37==a?f(-1):27==a&&h()}return{stop:h,start:function(e){a=e,$("html").css({backgroundColor:"#fff","overflow-y":"auto"}),$("body, .preview-div").addClass("present"),$(".preview-div:first-child").addClass("current"),m&&m.call(s),$(t).on("keydown.present",g),setTimeout(function(){r.show(),f()},100),$(".preview-available").addClass("hidden"),$(t).on("mousemove.idleMouse",function(){clearTimeout(n),$("body").removeClass("idle"),n=setTimeout(function(){$("body").addClass("idle")},2e3)}),l.click(function(){f(-1)}),d.click(function(){f(1)}),c.click(h),$(window).on("resize.presentFix",f),i=$(".preview-div").length,console.log("totalSlides",i)}}},app.editor.createSecondaryBar=function(n,i,e,a,s,r,l,t,o,d,c){var u="preview"==$.trim(window.location.hash.substr(1));u&&setTimeout(function(){setTimeout(function(){$("#top-bar").show()},50),Y(2),u=!1},0);var m,p=!0,f=0,h=0,g={edit:1,preview:2,present:3},v=app.editor.present(a),b=app.core.padlocks(d,c,n),T=$("#tmp-secondary-bar"),y=T.find(".navs-preview"),C=T.find(".export"),w=T.find(".share"),k=T.find(".add-module-button"),x=T.find(".more-opts"),P=T.find(".transfer"),S=T.find(".present"),D=T.find(".settings"),F=T.find(".navs-archive"),I=T.find(".save-as-template"),M=T.find(".navs-delete-template"),E=T.find(".navs-revision"),U=T.find(".navs-stats"),N=T.find(".nav-save-section"),A=$("#folio-bar"),L=$("#tmp-primary-bar, #tmp-secondary-bar .left, #tmp-secondary-bar .right > *:not(.preview-available), #intercom-container, .nav-save-section > *"),O=T.find(".nav-settings.popup-menu");function R(e){if((m=$("#intercom-container")).length)"show"==e?m.show():m.hide();else var a=setInterval(function(){$("#intercom-container").length&&(m=$("#intercom-container"),"show"==e?m.show():m.hide(),clearInterval(a))},200)}function B(){R("hide")}function Y(e){switch(e){case g.edit:p=!0,R("show"),t.toggle(1),A.removeClass("preview"),l.showPage("edit-page"),L.removeClass("visible-hidden"),y.addClass("in-edit-mode").removeClass("in-preview-mode"),$("#home-page .watermark-on-free").hide(),$("body").removeClass("preview-mode-on"),$(".image-outer").data("ui-sortable")&&$(".image-outer").sortable("enable");break;case g.preview:p=!1,B(),t.toggle(0,u?0:400),A.addClass("preview"),l.showPage("home-page"),L.addClass("visible-hidden"),y.addClass("in-preview-mode").removeClass("in-edit-mode"),$("#home-page .watermark-on-free").show(),$("body").addClass("preview-mode-on"),$(".image-outer").data("ui-sortable")&&$(".image-outer").sortable("disable");break;case g.present:p=!1,B(),t.toggle(0),l.showPage("home-page"),y.removeClass("in-edit-mode"),v.start(function(){Y(1)}),$("#home-page .watermark-on-free").show(),$(".image-outer").data("ui-sortable")&&$(".image-outer").sortable("disable"),$("body").removeClass("preview-mode-on")}}A.append(T),a.addListener("userTeamRoleChanged",function(e){n.userEmail==e.Data.Email&&b.setLockStatsSaveAsTemplate()}),U.click(function(){if($(this).hasClass("locked")){var e={heading:"Please Upgrade Your Account",message:"Folio stats are available on the Business plan. Please upgrade to access stats and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){r.payment("showPlans")}};d.hasTeam()?(d.isProBusiness()||d.isFreeWithTeam())&&d.isOwner()?r.message(e):r.teamUserActionBlocked("stats","Guests"):(e.handleOK=function(){r.payment("showPlans")},r.message(e))}else{var a=i.IsUserTemplate||!1,t=i.UsedCount||0;r.folioStats(n.token,i.FolioName,{isTemplate:a,UsedCount:t})}}),b.setLockStatsSaveAsTemplate(),a.addListener("plusUnlocked",function(){b.setLockStatsSaveAsTemplate()}),a.addListener("plusCancelled",function(){b.setLockStatsSaveAsTemplate()}),T.click(function(){var e=Date.now();e-h<1e3?f++:f=0,h=e,5==f&&($("body").addClass("show-adv"),$(".button-panel .cls-btn").removeClass("hidden-btn"))}),D.click(function(){r.message({heading:"Folio Styles",btnText:"Save",showArea:1,areaPlaceholder:"Folio Styles",rows:10,areaText:o.get("style"),handleOK:function(e,a){o.set("style",a);var t='<style id="folio-style">'+a+"</style>";$("head #folio-style").remove(),$("head").append(t)}})}),S.click(function(){Y(3)}),y.click(function(){1<i.Role&&Y(p?2:1)}),w.click(function(){r.shareLink(i)}),C.click(function(){var t,n="",o=$("#home-page"),e=s.getExport();r.exp(i,e,{$el:o,cb:function(e,a){n="",$("head").find(".module-style, #folio-style").each(function(e,a){n+="<style>"+a.innerHTML+"</style>"}),(t=l.isCurrent(l.pages.home))||l.showPage(l.pages.home),o.css("width",Math.max($(window).width(),1367)+"px"),setTimeout(function(){s.activatePreview(),n+=o.html(),a(n),o.css("width",""),t?s.activatePreview():l.showPage(l.pages.edit),s.saveData()},1e3)}})}),P.click(function(){n.Team&&0<n.Team.Id?r.transferTeamFolio():r.transferFolio()}),F.click(function(){r.archive(i,function(){window.location.href=window.location.href.replace("edit","folio")})}),i.IsUserTemplate?(F.remove(),P.remove(),U.find("span").text("Template Stats"),I.remove()):M.remove(),M.click(function(){r.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,handleOK:function(){e.deleteUserTemplate({token:i.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),window.location=n.baseUrl},error:function(e){$("#dashboard-page > .loader").hide(),r.message({heading:"Oops!",message:e.Message,btnText:"Ok",enterAsOK:!0})}})},cancelText:"Cancel",handleNo:function(){r.close()}})}),I.click(function(){if(I.hasClass("locked"))d.hasTeam()?r.teamUserActionBlocked("save-as-template","Guests"):r.message({heading:"Please Upgrade Your Account",message:"Save as Template is only available on premium plans. Please upgrade to access Save as Template and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){r.payment("showPlans")}});else{var e=i.Token,a=i.FolioName+" - Template";r.createTemplatePopup(a,e)}}),k.click(function(){r.addModule(s.addModule)}),E.click(function(){r.folioVersion(n,i.Token)}),N.click(function(){1<i.Role&&r.folioVersion(n,i.Token)}),i.Role<3&&(P.hide(),F.addClass("leave").html('Leave Folio <i class="icon-Transfer"></i>'),i.Role<2&&(E.addClass("hidden"),F.css({marginTop:"12px"}),N.addClass("view-only").tooltip("disable"))),app.plugin.popupMenu(x,O,null,["folio-color-scheme","theme-picker"])},app.editor.saveSpinner=function(e,a){var t=1,n=2,o=$("#tmp-secondary-bar").find(".nav-save-section").attr("class","nav-save-section info"),i=o.find(".info .saved-time");switch(e){case t:o.removeClass("saved").addClass("saving");break;case n:o.removeClass("saving").addClass("saved"),i.text(dayjs(a||Date.now()).locale("en").format("lll")),setTimeout(function(){o.removeClass("saved")},1500)}},app.editor.upgradeStyleGuide=function(a){function n(e){return e==s||a.rgb2hex(e)==s}var e,t=[],o=[],i=$(".color-palette-cont").children(".palette-item"),s=i.find(".icon-Star").parent().css("background-color");i.each(function(e){t.push(a.rgb2hex($(this).css("background-color")))}),$(".color-palette-cont").children(".palette-item").find(".icon-star").parent().css("background-color"),i.each(function(e){o.push($(this).css("background-color"))}),e=o.map(function(e){return $('<div class="color-btn col-sm-3"><i class="icon-CheckMark"></i></div>').css("background-color",e).data("color",a.rgb2hex(e)).addClass(n(e)?"selected":"")}),$(".color-list").html(e),$("#color-1").on("click",function(e){var a;e.preventDefault(),(a=t.map(function(e,a){var t='<span class="fr-command fr-select-color '+(n(e)?"fr-active-item":"")+'" style="background: '+e+';" tabindex="-1" aria-selected="false" role="button" data-cmd="textColor" data-param1="'+e+'"><span class="fr-sr-only">Color '+e+"C&nbsp;&nbsp;&nbsp;</span>"+(n(e)?'<span class="fr-selected-color" aria-hidden="true"></span>':"")+"</span>";return a%7==6&&(t+="<br>"),t})).push('<span class="fr-command fr-select-color" data-cmd="textColor" tabindex="-1" role="button" data-param1="REMOVE" title="Clear Formatting"><i class="fa fa-eraser" aria-hidden="true"></i><span class="fr-sr-only">Clear Formatting</span></span>'),$(".fr-color-set").html(a),$(this).off()})},app.editor.templateMessage=function(e,a,t){var n="hideTemplateMessage:"+a.ParentID;if(a.TemplateMessage&&"true"!==t.get(n)){var o=$("#template-message-wrapper");$("#template-message").html(a.TemplateMessage);var i=$('<span class="close-btn"></span>');o.prepend(i),i.on("click",function(){t.set(n,"true"),o.slideToggle(150),setTimeout(function(){o.remove()},1e3)})}},app.editor.topBar=function(e,a,t){var o,i=!0,s={duration:400,queue:!1},r=$(document),l=$("body"),d=$("#top-bar"),c=($("#n-panel"),parseInt($(".edit-div").css("padding-top")));return l.css("padding-top",86),a.addListener("resize",function(){i?setTimeout(function(){d.css("top",0),l.css({paddingTop:86})},0):d.animate({top:-$("#top-bar").height()},s)}),a.addListener("free-exceedsize",function(){$("#uploading-popup").hide(),$("#toolbarContainer").find(".fr-image-progress-bar-layer.fr-error").hide(),setTimeout(function(){t.message({heading:"The file is too big",message:"File size exceeds the 1MB limit, but if you upgrade to a premium plan you can upload images up to 5MB.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){t.payment("showPlans")}})},600)}),{toggle:function(e,a){void 0!==a&&(s.duration=a),i=e;var t=r.scrollTop(),n=$("#top-bar").height();i?(n<t?$("html, body").animate({scrollTop:t+n-$("#preview-bottom").height()},s):0<t&&$("html, body").animate({scrollTop:r.scrollTop()-o},s),l.animate({paddingTop:86},s),d.animate({top:o},s)):(o=parseInt(d.css("top")),n<t?($("html, body").scrollTop(t-n+$(".preview-available").height()+c),l.css("padding-top",0)):l.animate({paddingTop:0},s),d.animate({top:-n},s))}}},app.editor.viewOnly=function(e){e&&1===e.Role&&($("#edit-page").hide(),$(".folio-name").attr("readonly",!0),$(".others .person.add").remove(),$(".user-options .left").css("padding","5px 30px 3px").html('<p style="line-height: 28px;margin-bottom: 0;">You only have access to view this folio.</p>').css("font-size","14px"),$(".navs-preview").addClass("view-only").find(".preview").html("View Only"))},app.editor.addWatermark=function(i,o,s,e){function r(e,a,t){var n;console.log("banner",i.banner),console.log(t,e,s.isFreeWithTeam(),h),0===i.banner||t&&!e&&!h?($("#tmp-power-by-footer").addClass("hidden"),d.length&&d.find(".watermark").remove()):(!function(e){console.log("mode",e);var a=$("#tmp-power-by-footer");if(a.removeClass("hidden").find("upgrade"==e?".normal":".upgrade").addClass("hidden"),a.find("."+e).removeClass("hidden"),"free-user"===e){var t=a.find(".power-by-footer");t.addClass("footer-on-free"),t.html('<p>Upgrade your account to remove Xtensio branding and access premium features.</p><a class="btn popup-cta see-plans" href="http://xtensio.com/pricing">See Plans</a>'),t.find("a.see-plans").click(function(e){return e.preventDefault(),o.payment("showPlans"),!1})}}(a?"free-user":"upgrade"),0==(n=$("#home-page")).find(".watermark-on-free-shared").length&&0==n.find(".watermark-on-free").length&&n.append('<div class="watermark-on-free-shared"></div>'))}var l=i.isTrial||i.Team&&i.Team.IsTrial,d=(i.Team&&!i.Team.IsTrial&&(i.Team.plusExpireTime,Date.now()),$("#home-page .persona-canvas.canvas-module-container .canvas-module > .header-container")),c=$(location).attr("href"),u=0<=c.indexOf("/folio/"+i.token),m=0<=c.indexOf("/channel/"),p=i.Team&&0<i.Team.Id,a=!i.userName,f=i.Team&&1==i.Team.Role||i.userName==i.folioUserName,h=p&&(0==i.Team.ST||34==i.Team.ST);e&&e.getCreditsLeft&&e.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var a=JSON.parse(e.Data),t=a.LimitsImposed&&0<a.CreditsLeft,n=!(i.plusExpireTime>=Date.now()||t);if(u||m){var o=n;n=!(!(i.PlusEnd<Date.now()||l)||!o)}s.setLock(function(e,a){(n&&!i.isChannel&&!p||l)&&d.length&&(u||m?d.append('<div class="watermark"><a href="https://www.xtensio.com" target="_blank" ><div class="logo"></div></a></div>'):d.append('<div class="watermark"><a href="'+c+'#billing"><div class="logo"></div></a></div>')),r(l,f,p)})},error:function(e){console.log("getCreditsLeft error",e)}}),a&&r(l,f,p)},app.editor.wizardEditor=function(e,a,t,n){$("#top-bar .user-menu-popup").find(".edit-wizard");var o,i,s=$("#edit-sections"),r='NEXT <i class="fa fa-angle-right"></i>',l=function(e){return'<text style="color: #00bd9c"><b>'+e+"</b></text><br>"},d=function(e){return'<p style="color: #ffd371">'+e+" / 9</p>"},c=0,u=0,m=0;d(1),l("Add New Modules:"),d(2),l("These are your Modules:"),d(3),l("Modules live inside Sections:"),d(4),l("Add people:"),d(5),l("Auto-save and Revision History:"),d(6),l("Preview:"),d(7),l("Share, present, export:"),d(8),l("Folio Menu:"),d(9),l("You are all set!");function p(){$("#edit-sections .module-buttons.drop-down-container"+i).css({visibility:""}),$(".nav-save-section").css({color:"#4c7ba0"}),s.find(".sec-button-panel").css({display:""}),s.find(".drop-down-container").removeClass("showing")}"string"==typeof e.ShowOnboarding&&(e.ShowOnboarding="not-set"===e.ShowOnboarding||JSON.parse(e.ShowOnboarding.toLowerCase())),console.log("config.ShowOnboarding",e.ShowOnboarding)},app.managers.dragManager=function(e,a,t,c,d,u){var i,s,m,p,f,h=null,g=null,v=0,b=0,T=0,r=$("<div>"),n=$('<div style="background-color: gray;position: absolute; z-index: 9999999;">'),o=$('<div style="background-color: red;position: absolute; z-index: 99999;">'),l=$('<div style="position: absolute; height: 100%; z-index: 9999; left: 0; top: 0; width: 100%;">').hide(),y=$('<div style="position: absolute; z-index: 9990; left: 50%; top: 0; width: 1200px; margin-left: -600px;">'),C=$("#modules-edit-main").append(y).append(n).append(o),w=$("#modules-preview-main"),k=$('<div class="empty" style="display: inline-block; background-color: #F5F6F7; border: 1px dotted #4a7aa2; margin: 12px 0;">&nbsp;</div>');a.append(l);var x=function(e,a,t,n){var o=0;1200<C.width()&&(o=(C.width()-1200)/2),e.css({left:a.pageX-i-o,top:a.pageY-C.offset().top-s+14})};return e.on("touchmove mousemove",function(a){if(h){var e=Date.now();if(e-v<30)return;var t,n,o,i,s=a.pageX,r=a.pageY;v=e;var l=$(window).scrollTop();if(a.screenY>T+6&&a.clientY>window.innerHeight-140?($("html,body").animate({scrollTop:l+140},200),T=a.screenY):a.screenY<T-6&&a.clientY<140&&($("html,body").animate({scrollTop:l-140},200),T=a.screenY),x(h.$editNode,a),e-b<300)return;b=e,C.find(".edit-div").each(function(){var e=this;if(n=$(this),(t=n.offset()).bottom=t.top+n.height(),r>=t.top&&r<=t.bottom)return(o=n.find("> .section-content > .module-container")).each(function(){if(i=$(this),(t=i.offset()).right=t.left+i.width(),t.bottom=t.top+i.height(),s<t.right&&r<t.bottom)return h&&"Canvas"==h.Type||!d.isPointInRect(t,{x:s,y:r})||!i.hasClass("canvas-module-container")?(k.hasClass("animatable")||p===e||(p=e,k.addClass("animatable"),f=k.height(),k.height("1px")),$("#edit-page .empty").remove(),s<t.right-i.width()/3&&r<t.bottom-i.height()/2?i.before(k):i.after(k),k.height(f),setTimeout(function(){k.removeClass("animatable")},200),g=null):((g=u.getModule(i.data("key"))).editObj.move(a),k.remove()),!1}),o.filter(".canvas-module-container").each(function(){i=$(this);var e=u.getModule(i.data("key"));e!=g&&e.editObj.cancel()}),!1})}}),document.addEventListener("dragstart",function(e){e.stopImmediatePropagation(),$(e.target).hasClass("fr-uploading")?e.preventDefault():$(e.target).is("img")&&(m=e.target,$(".fr-image-resizer").removeClass("fr-active"))},!1),document.addEventListener("dragend",function(e){m=!1},!1),document.addEventListener("dragover",function(e){$(e.target).parent().hasClass("image-inner"),e.preventDefault()},!1),document.addEventListener("drop",function(e){if(e.preventDefault(),e.stopImmediatePropagation(),$(e.target).parents(".image-outer").length){var a=$(m).attr("src");if(a){var t=u.getModule($(e.target).closest(".module-container").data("key")),n=u.getModule($(m).closest(".module-container").data("key")),o=$(m).closest(".fr-element"),i=$(e.target).closest(".image-inner").index()+1;if(!t)return;t.editObj.addItem();var s=t.Data.Items.length-1,r=$(e.target).closest(".image-outer").children().last();t.Data.Items[s].Url=a,r.find("img").attr("src",a);var l=r.detach(),d=t.Data.Items.pop();$(e.target).closest(".image-inner").after(l),t.Data.Items.splice(i,0,d),t.save(),c.sync(t,"Items",t.Data.Items),m.parentNode&&m.parentNode.removeChild(m),n.Data.Html=o.html(),n.save(),c.sync(n,"Html",o.html())}}},!1),{end:function(){var e,a,t,n,o;h&&(h.detach&&h.detach(),g&&"Canvas"!=h.Type?(g.dragEnd(h),o=h):(t=h.$editNode,n=h.$previewNode),g&&g.Type&&"Canvas"===g.Type&&g.$editNode.find(".empty-canvas-cont").remove(),h.$editNode.removeClass("active default-drag-bg-color").css({position:"",opacity:"",left:"",top:"","z-index":""}),t&&(a=k.closest(".edit-div").index(),r.append(n),k.before(t),e=t.index(),w.find('.preview-div:eq("'+a+'")').find(".section-content").insertAt(e,n)),h.$editNode.find(".fr-embedly").each(function(){$(this).html($(this).data().originalEmbed)}),c.sync(h,"Pos",[e,a]),$("body").removeClass("disable-select"),u.saveLayout(),g=h=null,l.hide(),k.remove(),$(".empty").remove(),o&&o.resize&&o.resize())},add:function(o){o.$editNode.find(".move").on("mousedown",function(e){var a=$(this).offset();i=e.pageX-a.left,s=e.pageY-a.top,$("body").addClass("disable-select");var t=o.$editNode;t.addClass("active").css({position:"absolute",opacity:.6,"z-index":100}),o.Data.BgColor&&t.addClass("default-drag-bg-color"),h=o;var n=2*parseInt(k.css("border-width").replace("px"))+2;return k.css({height:t.height()-n,width:t.width()-n}),t.after(k),y.append(t),x(t,e),l.show(),!1})},move:function(e,a){var t,n,o,i;null!==a[0]&&(o=e.$editNode,i=e.$previewNode,o&&(t=a[0],n=a[1],r.append(i).append(o),w.find('.preview-div:eq("'+n+'")').find(".section-content").insertAt(t,i),C.find('.edit-div:eq("'+n+'")').find(".section-content").insertAt(t,o)))},remove:function(e){}}},app.managers.resizeManager=function(e,a){var i=null,s=!1,r=0,l="#modules-edit-main .grid-div",d=function(){null!==i&&(a.sync(i,"Cols",i.Data.Cols),i.$editNode.removeClass("re-sizing"),i=null,$("body").removeClass("disable-select re-sizing"))};return $(l).on("mouseenter","div",function(){if(null===i)d();else{var e=0,a=i,t=a.$editNode.position().left-a.$editNode.closest(".section-content").offset().left;0<t&&(e=Math.ceil(t/($(l).width()/6)));var n=$(this).index()-e;if((n*=2)!=r){var o=n-r;a.$editNode.removeClass("col-sm-"+a.Data.Cols),a.$previewNode.removeClass("col-sm-"+a.Data.Cols),s?(a.Data.Cols=Math.max(2,Math.min(12,a.Data.Cols-o)),r=n):0<n+2&&(a.Data.Cols=Math.max(2,Math.min(12,n+2)),r=n),a.$editNode.addClass("col-sm-"+a.Data.Cols),a.$previewNode.addClass("col-sm-"+a.Data.Cols),a.resize&&a.resize(a)}}}),{end:d,add:function(a){var e=$('<div class="resize-grip right"><div class="resize-rect"></div></div>');a.$editNode.prepend(e),e.on("mousedown touchstart",function(e){e.preventDefault(),r=a.Data.Cols-1,i=a,$("body").addClass("disable-select re-sizing"),i.$editNode.addClass("re-sizing"),s=!1}),e=$('<div class="resize-grip left"><div class="resize-rect"></div></div>'),a.$editNode.prepend(e),e.on("mousedown touchstart",function(e){e.preventDefault(),r=0,i=a,$("body").addClass("disable-select re-sizing"),i.$editNode.addClass("re-sizing"),s=!0})},remove:function(e){e.$editNode.find(".resize-grip").remove()}}},app.modHelper.createLayoutData=function(o,i,s){var r=[],l=!0;$("#edit-sections .edit-div").each(function(e,a){var t=$(a),n={Order:e+1,Tag:t.data("Tag"),ModIds:[]};t.data("bgUrl")&&(n.BgUrl=t.data("bgUrl"),n.BgPositionX=t.data("BgPositionX"),n.BgPositionY=t.data("BgPositionY"),n.BgSize=t.data("BgSize")),t.data("bgColor")&&(n.BgColor=t.data("bgColor")),t.find(".section-content > .module-container").each(function(e,a){var t=i.obtain(o.Modules,"Key",$(a).data("key"));if(t&&"EmptyModule"!=t.Type){if(!t.Tag)return l=!1,t.save(function(){app.modHelper.createLayoutData(o,i,s)}),!1;n.ModIds.push(t.Tag),t.editObj.saveMods&&t.editObj.saveMods()}}),r.push(n)}),l&&s(r)},app.modHelper.dragImages=function(t,m,r){function p(e){var a=$(e).closest(".module-container").attr("data-key");return t.find(function(e){return e.Key==a})}function n(){var n=null;$(".text-module > .edit-content").find(".fr-element").sortable({activate:function(e,a){n=$(a.item[0]).index()},receive:function(e,a){!function(e,a){var t=e.width();e.find("img").clone().insertAfter($(a).find(".image-inner")).addClass("fr-fil fr-draggable").width(t),$(a).find(".image-inner").remove();var n=p(a);n&&(n.Data.Html=$(a).html(),n.save(),m.sync(n,"Html",$(a).html()))}(a.item,this);var t=p(a.sender);t.Data.Items.splice(n,1),t.save(),m.sync(t,"Items",t.Data.Items)}})}function o(e,a,t){var n,o,i,s,r=p(e),l=p(a.sender),d=$(a.item[0]),c=d.index(),u=l.Data.Items.splice(t,1);r.Data.Items.splice(c,0,u[0]),r.save(),m.sync(r,"Items",r.Data.Items),n=d,o=r,i=u[0],s=r.Data.Items,n.find(".edit-btn").uploader({module:o,custom:"imgMod",success:function(e){var a,t=(a=e.Message)&&a.toString().replace("&amp;","&");i.Url=t,n.find("img").attr("src",t),m.sync(o,"Items",s)}}),l.save(),m.sync(l,"Items",l.Data.Items)}$(".image-outer").sortable({oldPosition:null,animation:200,cursor:"move",items:"> .image-inner",connectWith:".text-module > .edit-content .fr-element, .image-outer",activate:function(e,a){this.oldPosition=$(a.item[0]).index()},start:function(e,a){this.oldPosition=$(a.item[0]).index(),n(),$(this).sortable("refresh")},receive:function(e,a){o(this,a,this.oldPosition)},update:function(e,a){var t,n,o,i,s;null==a.sender&&a.item.parent().is($(this))&&(n=a,o=(t=this).oldPosition,i=p(t),s=$(n.item[0]).index(),r(i.Data.Items,o,s),i.save(),m.sync(i,"Items",i.Data.Items))},stop:function(e,a){$(".text-module > .edit-content").find(".fr-element").is(":ui-sortable")&&($(".text-module > .edit-content").find(".fr-element").sortable("destroy"),$(this).sortable("refresh"))}})},app.modHelper.dragTags=function(i,s,r){function t(e,a,t){var n,o=(n=$(e).closest(".module-container").attr("data-key"),i.find(function(e){return e.Key==n}));r(o.Data.Items,a,t),o.save(),s.sync(o,"Items",o.Data.Items)}$(".tag-container").sortable({cursor:"move",animation:200,items:"> .tag",cancel:"[contenteditable]",oldPosition:null,start:function(e,a){this.oldPosition=$(a.item[0]).index()},stop:function(e,a){newPosition=$(a.item[0]).index(),newPosition!=this.oldPosition&&t(this,this.oldPosition,newPosition)}})},app.modHelper.getGuiModules=function(e,a){for(var t,n=[],o=0;o<e.Modules.length;o++){var i=e.Modules[o];i.Key=i.Tag||a.uniqueId(),i.Data=JSON.parse(i.Data),i.lastSavedData=JSON.stringify(i.Data),(t=i.Records)&&$.each(t,function(e,a){a.Created=new Date(a.Created),a.Data=JSON.parse(a.Data)}),"DataModule"!=i.Type&&n.push(i)}return n},app.modHelper.sectionHelper=function(p,s,f,h,g,v,b,T,y,r,l,C,e){var w,k=h.changeImage,x=h.setCallback,d=$("#edit-sections"),c=$("#modules-preview-main");$("#modules-preview-header");var u=function(e){var a=$('<div class="preview-div clearfix"><div class="section-content clearfix"></div></div>');return e.BgUrl&&(a.css("backgroundImage","url("+e.BgUrl+")"),e.BgPositionY&&a.css("backgroundPositionY",e.BgPositionY),e.BgPositionX&&a.css("backgroundPositionX",e.BgPositionX),e.BgSize&&a.css("backgroundSize",e.BgSize),w=e.BgUrl),e.BgColor&&a.css("backgroundColor",e.BgColor),a},P=function(e,a){if("up"==e){var t=a.prev();t.length&&a.insertBefore(t)}else if("down"==e){var n=a.next();n.length&&a.insertAfter(n)}else"top"==e?a.parent().prepend(a):"bottom"==e&&a.parent().append(a)};var m=function(t,i){t.Tag=t.Tag||function e(){for(var a=y.Data.Sections,t=g.uniqueId(!0),n=0;n<a.length;n++)if(a[n].Tag==t||g.obtain(f.Modules,"Tag",t))return e();return t}();var n=$('<div class="edit-div clearfix"><div class="section-content clearfix"></div></div>').data("Tag",t.Tag).data("bgUrl",t.BgUrl).data("BgPositionX",t.BgPositionX).data("BgPositionY",t.BgPositionY).data("BgSize",t.BgSize).data("bgColor",t.BgColor);function o(e){P(e,n),P(e,i),"move"==p.currentAction()&&$("html,body").animate({scrollTop:n.offset().top},400)}function a(e){var o=[];n.find(".module-container").each(function(e,a){var t=g.obtain(f.Modules,"Key",$(a).data("key"));if(t){var n=T[t.Type];o.push(t.ID),t.noDelete=!0,n.removeModule(t,1)}}),e||app.factory.apiHelper.deleteModules(o),n.remove(),i.remove()}function s(e){t.BgColor=e,t.BgUrl="",n.data("bgColor",e),n.data("bgUrl",""),n.css("backgroundColor",e),n.css("backgroundImage",""),n.css("backgroundPositionX",""),n.css("backgroundPositionY",""),n.css("backgroundSize",""),i.css("backgroundColor",e),i.css("backgroundImage",""),i.css("backgroundPositionX",""),i.css("backgroundPositionY",""),i.css("backgroundSize","")}function r(e){t.BgColor="",t.BgUrl=e;var a=n.data("bgUrl");k(a,e),n.data("bgUrl",e),n.data("bgColor",""),g.changeBg(b,n,e),i.css("backgroundImage","url("+e+")")}function l(e){n.data("BgPositionX",e),n.css("backgroundPositionX",e),i.css("backgroundPositionX",e)}function d(e){n.data("BgPositionY",e),n.css("backgroundPositionY",e),i.css("backgroundPositionY",e)}function c(e){n.data("BgSize",e),n.css("backgroundSize",e),i.css("backgroundSize",e)}function u(e){l(e.backgroundPositionX),d(e.backgroundPositionY),c(e.backgroundSize)}function e(){k(t.BgUrl,""),t.BgColor="",t.BgUrl="",n.data("bgUrl",""),n.data("bgColor",""),n.css("backgroundImage",""),n.css("backgroundColor",""),i.css("backgroundImage",""),i.css("backgroundColor","")}t.BgUrl?(k("",t.BgUrl),n.css("backgroundImage","url("+t.BgUrl+")"),t.BgPositionY&&n.css("backgroundPositionY",t.BgPositionY),t.BgPositionX&&n.css("backgroundPositionX",t.BgPositionX),t.BgSize&&n.css("backgroundSize",t.BgSize),n.find(""),w=t.BgUrl):t.BgColor&&n.css("backgroundColor",t.BgColor),C.reg(t,"Sec_AddModule",function(e,a){p.addModule(a.Type,a,0,n.find(".section-content"),i.find(".section-content"))}),C.reg(t,"Sec_Move",function(e,a){o(a)}),C.reg(t,"Sec_Remove",function(){a(!0)}),C.reg(t,"Sec_Duplicate",function(e,a){t.newTag=a,p.duplicateSection(t,n,i)}),C.reg(t,"Sec_BgColor",function(e,a){s(a)}),C.reg(t,"Sec_BgURL",function(e,a){x(null),r(a)}),C.reg(t,"Sec_BgPositionX",function(e,a){l(a)}),C.reg(t,"Sec_BgPositionY",function(e,a){d(a)}),C.reg(t,"Sec_BgSize",function(e,a){c(a)}),C.reg(t,"Sec_BgReset",e);var m=h.sectionButtons(t,{addModule:function(){b.addModule(function(e,a){p.addModule(e,a,1,n.find(".section-content"),i.find(".section-content"))})},handleExport:function(){var t,n="",o=$("#home-page");b.exp(f,p.getExport(),{$el:i,target:"section",cb:function(e,a){n="",(t=v.isCurrent(v.pages.home))||v.showPage(v.pages.home),o.css("width",e+"px"),setTimeout(function(){p.activatePreview();var e=$('<div><div class="container-fluid"><div class="row" id="modules-preview-main">'+$("<div>").append(i.clone()).html()+"</div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,a){n+="<style>"+a.innerHTML+"</style>"}),n+=e.html(),n+=$("#tmp-power-by-footer").get(0).outerHTML,a(n),o.css("width",""),t?p.activatePreview():v.showPage(v.pages.edit),p.saveData()},20)}})},move:function(e){p.currentAction("move"),o(e),C.sync(t,"Sec_Move",e),p.saveLayout()},del:function(e){e?(a(),C.sync(t,"Sec_Remove",""),setTimeout(p.saveLayout,1e3)):b.message({heading:"Delete section?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:function(){a(),C.sync(t,"Sec_Remove",""),setTimeout(p.saveLayout,1e3)}})},dup:function(){p.currentAction("dup");var e=p.duplicateSection(t,n,i);C.sync(t,"Sec_Duplicate",e.Tag),p.saveLayout()},bgColor:function(e){s(e),C.sync(t,"Sec_BgColor",e),p.saveLayout()},bgUrl:function(a){w=a,b.bgImageAdjust(n,a,function(e){r(a),u(e),C.sync(t,"Sec_BgURL",a),C.sync(t,"Sec_BgPositionX",e.backgroundPositionX),C.sync(t,"Sec_BgPositionY",e.backgroundPositionY),C.sync(t,"Sec_BgSize",e.backgroundSize),p.saveLayout()})},adjustBgFn:function(){b.bgImageAdjust(n,w,function(e){r(w),u(e),C.sync(t,"Sec_BgURL",w),C.sync(t,"Sec_BgPositionX",e.backgroundPositionX),C.sync(t,"Sec_BgPositionY",e.backgroundPositionY),C.sync(t,"Sec_BgSize",e.backgroundSize),p.saveLayout()})},resetBg:function(){e(),C.sync(t,"Sec_BgReset",""),p.saveLayout()}});return n.prepend(m.$node),n};return{createSection:function(e){var a,t=e||{},n=u(t);return c.append(n),l&&(a=m(t,n),d.append(a)),[a,n]},init:function(){var e,a;e=y.Data.Sections,a=_.concat(_.flatten(_.map(e,"ModIds"))),_.isEqual(a,_.uniq(a))||b.message({heading:"Your Folio is Corrupt",message:"There was a glitch with the network that caused a bug in this folio. Please contact support and we'll get this fixed for you. Sorry for the inconvenience!",btnText:"Contact Support",noClose:!0,notMini:!0,handleOK:function(){window.Intercom&&window.Intercom("showNewMessage","My folio "+window.location.href+" is corrupt. Can you please look into it?")}}),$.each(y.Data.Sections,function(e,a){if(!(1==s.IsMod&&a.ModIds.length<=0)){var t,n,o;for(o=u(a),c.append(o),l&&(n=m(a,o),d.append(n),n=n.find(".section-content")),o=o.find(".section-content"),e=0;e<a.ModIds.length;e++){var i=p.getModule(a.ModIds[e]);i&&i.Tag&&(t=g.obtain(r,"Tag",i.Tag))&&T[t.Type].initModule(g,t,1,o,n)}p.addModule("EmptyModule")}})}}},app.managers.main=function(e,a,t,n,o,i){var s;return{modManager:s=this.getModManager(e,a,t,n,o,i),rddm:this.getRddm(e,a,t,s)}},app.managers.getModManager=function(c,u,e,a,n,m){var p,t,o,i,s,f={},h=u.TagStore,r=app.modHelper,g=(m=e.utility,e.appHub),l=e.apiHelper,d=e.eventManager,v=e.pageManager,b=m.obtain(u.Modules,"Type","DataModule"),T=r.getGuiModules(u,m);function y(e){Date.now()-1e3<=t||r.createLayoutData(u,m,function(e){b.Data.Sections=e,t=Date.now(),b.save()})}function C(){return Math.max.apply(null,h)}function w(){l.getTagStore({success:function(e){"Success"==e.Status&&(h=e.Data.TagStore)}})}function k(e){var a=(e=parseInt(e)||C())+1;return a<C()||m.obtain(u.Modules,"Tag",a)||m.obtain(b.Data.Sections,"Tag",a)?k(a):(clearTimeout(o),o=setTimeout(w,1e4),h.push(a),parseInt(a))}return d.addListener("removeCollabs",function(){var t=u;$.each(t.Collaborators,function(e,a){l.changeCollaborator({data:{verb:"drop",role:a.Privilege,token:t.Token,email:a.Email},success:function(e){console.log(e.Message),window.location="/"},error:function(e){5==e.StatusCode&&n.error(e.Message)}})})}),p={getNewTag:k,removeMod:function(e){return m.removeFromList(u.Modules,m.obtain(u.Modules,"Tag",e.Tag))},currentAction:(s=Date.now(),function(e){return e&&(i=e,s=Date.now()),i&&Date.now()-s<=3e3?i:""}),getModule:function(e){return m.obtain(u.Modules,"Tag",e,"Key","ID")},getFactory:function(e){return f[e.Type]},registerFactory:function(e){if(!e.type||f[e.type])throw console.log(e),{name:e.type+" is invalid."};f[e.type]=e},addModule:function(e,o,a,t,n,i){if("Canvas"==e&&o&&o.Data.Mods){$.each(o.Data.Mods,function(e,a){var t=k(),n={Key:t,Tag:t,Type:a.Type,Data:$.extend(!0,{},a.Data)};a.Tag=t,n.Syncd=o.Syncd,u.Modules.push(n)});var s=o.Tag;h&&h.indexOf(s)<0?h.push(s):(h||(h=[]),s=k()),o.Tag=s}var r,l,d=function(e,a,t,n,o,i){var s,r=f[e],l=u.Modules[0].Data.Theme;s=a?$.extend(a,{Key:m.uniqueId()}):{Key:m.uniqueId(),Type:e,Data:{Type:e}},i&&(s.ID=i.ID,s.Tag=i.Tag),u.Modules.push(s);var d="Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e||"Vertical Bar"==e;return("Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e||"Vertical Bar"==e)&&(s.Data.Head=1),d&&(s.Data.Titlehide=1),"Scale"==e&&(s.Data.Header="Scale Chart"),"Bar"==e&&(s.Data.Header="Bar Graph"),"Vertical Bar"==e&&(s.Data.Header="Bar Chart"),"DonutChart"==e&&(s.Data.Header="Pie Chart"),"DataCollection"==e&&(s.Data.Header="This is a form field to collect emails."),n||($("#modules-preview-main .preview-div:last-child").find(".section-content").length||p.createSection(),n=$("#edit-sections .edit-div:last-child").find(".section-content"),o=$("#modules-preview-main .preview-div:last-child").find(".section-content")),r.initModule(m,s,a,o,n,void 0,d,l),t&&s.bringInView(),c.setNewBlankCanvas=!1,s}(e,o,"EmptyModule"!=e&&null==a?1:a,t,n,i);return"EmptyModule"!=e&&(d.Syncd||d.CanvasMod?d.Tag=d.Tag:(d.Tag=s||k(),h.indexOf(d.Tag)<0&&h.push(d.Tag),d.factory.renderPreview(d),r=d,g.sync({Tag:l||r.$editNode.closest(".edit-div").data("Tag")},"Sec_AddModule",{Syncd:!0,Tag:r.Tag,Type:r.Type,Data:r.Data})),d.factory.renderPreview(d),d.save(y)),d},copyModule:function(e,a){f[e.Type];var t=$.extend(!0,{},e.Data),n=k(e.Tag),o={Key:n,Tag:n,Type:e.Type,Data:t};return u.Modules.push(o),"Canvas"==e.Type&&$.each(t.Mods,function(e,a){var t=k(a.Tag),n=p.getModule(a.Tag);if(n){var o={Key:t,Tag:t,Type:n.Type,Data:$.extend(!0,{},n.Data)};a.Tag=t,u.Modules.push(o),g.saveMod(o)}}),a&&a(o),g.saveMod(o,y),o},duplicateModule:function(t){console.log("dubplicate",t);var n=f[t.Type],o=t.$editNode.closest(".section-content"),i=t.$previewNode.closest(".section-content"),s=p.copyModule(t,function(e){var a=s||e;n.initModule(m,a,0,i,o,t),n.renderPreview(a),"dup"==p.currentAction()&&a.bringInView(),"Canvas"===a.Type&&0===a.Data.Mods.length&&m.generateEmptyCanvasModule(a.$editNode,a.$previewNode)});return s},getExport:function(){return b.Data.Exports||(b.Data.Exports={}),b.Data.Exports},getDonutData:function(){return b.Data.Donut||(b.Data.Donut={showError:!0}),b.Data.Donut},saveData:function(e){b.save()},saveLayout:y,activatePreview:function(e){if(e&&e.modId){var a=p.getModule(e.modId);a.factory.renderPreview(a)}else $.each(b.Data.Sections,function(e,a){$.each(a.ModIds,function(e,a){var t=p.getModule(a);t.factory.renderPreview(t)})})},duplicateSection:function(e,a,t){(e=$.extend(!0,{},e)).Tag=e.newTag,delete e.newTag;var n=p.createSection(e),i=n[0].find(".section-content"),s=n[1].find(".section-content");return p.addModule("EmptyModule"),a.find(".section-content > .module-container").each(function(e,a){var t,n,o=m.obtain(u.Modules,"Key",$(a).data("key"));o&&"EmptyModule"!=o.Type&&(n=f[o.Type],t=p.copyModule(o),n.initModule(m,t,0,s,i))}),a.after(n[0]),t.after(n[1]),"dup"==p.currentAction()&&$("html,body").animate({scrollTop:i.offset().top},400),e}},b.save=function(e){g.saveMod(b,e)},p=$.extend(p,r.sectionHelper(p,c,u,a,m,v,n,f,b,T,c.editMode,g,l))},app.managers.getRddm=function(e,a,t,n){var o=t.appHub,i=t.utility,s={},r=$(document),l=$("body"),d=i.swapElementsInArray,c=app.managers.resizeManager(r,o),u=app.managers.dragManager(r,l,s,o,i,n);return r.on("touchend mouseup touchcancel mouseleave",function(){c.end(),u.end()}),setTimeout(function(){e.presentationMode||(app.modHelper.dragImages(a.Modules,o,d),app.modHelper.dragTags(a.Modules,o,d))},0),{addModule:function(t){"Images"==t.Type?setTimeout(function(){app.modHelper.dragImages(a.Modules,o,d)},0):"Tag"==t.Type&&setTimeout(function(){app.modHelper.dragTags(a.Modules,o,d)},0),(s[t.Key]=t).noResize||c.add(t),t.noDrag||(u.add(t),o.reg(t,"Pos",function(e,a){u.move(t,a)}))},removeModule:function(e){c.remove(e),u.remove(e),delete s[e.Key]},dragManager:u}},app.factory.bgColor=function(e,a,t){e.$editNode&&e.$editNode.css("backgroundImage",""),e.$previewNode.css("backgroundImage",""),delete e.Data.BgUrl,e.$editNode&&e.$editNode.css("backgroundColor",a),e.$previewNode.css("backgroundColor",a),e.Data.BgColor=a,t||this.appHub.sync(e,"BgColor",a)},app.factory.bgUrl=function(e,a,t){e.$editNode&&this.utility.changeBg(this.popup,e.$editNode,a),e.$previewNode.css("backgroundImage","url("+a+")"),this.changeImage(e.Data.BgUrl,a),delete e.Data.BgColor,e.Data.BgUrl=a,t||this.appHub.sync(e,"BgUrl",a)},app.factory.bgPositionY=function(e,a,t){e.$editNode&&e.$editNode.css("backgroundPositionY",a.backgroundPositionY),e.$previewNode.css("backgroundPositionY",a.backgroundPositionY),e.Data.BgPositionY=a.backgroundPositionY,t||this.appHub.sync(e,"BgPositionY",a.backgroundPositionY)},app.factory.bgPositionX=function(e,a,t){e.$editNode&&e.$editNode.css("backgroundPositionX",a.backgroundPositionX),e.$previewNode.css("backgroundPositionX",a.backgroundPositionX),e.Data.BgPositionX=a.backgroundPositionX,t||this.appHub.sync(e,"BgPositionX",a.backgroundPositionX)},app.factory.bgSize=function(e,a,t){e.$editNode&&e.$editNode.css("backgroundSize",a.backgroundSize),e.$previewNode.css("backgroundSize",a.backgroundSize),e.Data.BgSize=a.backgroundSize,t||this.appHub.sync(e,"BgSize",a.backgroundSize)},app.factory.resetBg=function(e,a){delete e.Data.BgColor,delete e.Data.BgUrl,"Canvas"==e.Type?(e.$editNode&&e.$editNode.css("backgroundColor","rgba(0,0,0,0)"),e.$previewNode.css("backgroundColor","rgba(0,0,0,0)"),e.Data.BgColor="rgba(0,0,0,0)"):(e.$editNode&&e.$editNode.css("backgroundColor",""),e.$previewNode.css("backgroundColor","")),e.$editNode&&e.$editNode.css("backgroundImage","").css("backgroundPositionY","").css("backgroundPositionX","").css("backgroundSize",""),e.$previewNode.css("backgroundImage","").css("backgroundPositionY","").css("backgroundPositionX","").css("backgroundSize",""),a||this.appHub.sync(e,"ResetBg","")},app.factory.createStyle=function(e,a,t,n){var o="",i="#ed-"+e+" ",s=",#pr-"+e+" ",r=n||["h1","h2","h3","h4",".title > *:not(.fr-wrapper):first-child",".title .fr-view > *:first-child"],l="<style id=style"+e+' type="text/css" class="module-style">';a&&($.each(r,function(e,a){o+=i+a,o+=s+a+","}),o=o.slice(0,-1),o+="{ color: "+a+";}"),o+=i+s+"{ border-color:"+a+";border-style:solid;border-width:0;}",$.each(t,function(e,a){$.each(a.selectors,function(e,a){o+=i+a,o+=s+a+","}),o=o.slice(0,-1),o+="{"+a.prop+":"+a.value+";}"}),l+=o+"</style>",$("head #style"+e).remove(),$("#folio-style").before(l);var d,c=$("#folio-style").text().split("}"),u=c.length,m="<style id=stylefs"+e+' type="text/css" class="module-style">';for(d=0;d<u;d++){if(c[d].length)c[d]=$.trim(c[d])+"}",m+="#ed-"+e+c[d].replace(/,(\s)*./g,",#ed-"+e+".")+("#ed-"+e+" "+c[d].replace(/,(\s)*./g,",#ed-"+e+"."))+("#pr-"+e+c[d].replace(/,(\s)*./g,",#pr-"+e+"."))+("#pr-"+e+" "+c[d].replace(/,(\s)*./g,",#pr-"+e+"."))}m+="</style>",$("head #stylefs"+e).remove(),$("#folio-style").before(m)},app.factory.createDOMNodes=function(e,a,t,n){var o,i,s='<div class="header-container"><div class="header fr-view"></div></div>',r=e.Data,l=e.previewObj,d=e.editObj,c=e.Data.Theme||"#4C7BA0",u="module-container col-xs-12 col-sm-"+r.Cols+" "+(r.CssClass||r.FormatClass||"");e.containerClassName&&(u+=" "+e.containerClassName),(o=e.$previewNode=$('<div id="pr-'+e.Key+'"></div>')).addClass(u),r.BgColor&&o.css("backgroundColor",r.BgColor),r.BgUrl&&(o.css("backgroundImage","url("+r.BgUrl+")"),r.BgPositionY&&o.css("backgroundPositionY",r.BgPositionY),r.BgPositionX&&o.css("backgroundPositionX",r.BgPositionX),r.BgSize&&o.css("backgroundSize",r.BgSize)),n?o.insertAfter(n.$previewNode):a&&a.append(o),o.append(l.$node),"EmptyModule"!=e.Type&&l.$node.prepend(s),l.mount&&l.mount(),this.config.editMode&&((i=e.$editNode=$('<div data-key="'+e.Key+'" id="ed-'+e.Key+'"></div>')).append('<div class="others"></div>'),i.css({borderWidth:1==r.Border?"1px":"0"}),i.addClass(u),r.BgColor&&i.css("backgroundColor",r.BgColor),r.BgUrl&&(i.css("backgroundImage","url("+r.BgUrl+")"),this.changeImage("",r.BgUrl),r.BgPositionX&&i.css("backgroundPositionX",r.BgPositionX),r.BgPositionY&&i.css("backgroundPositionY",r.BgPositionY),r.BgSize&&i.css("backgroundSize",r.BgSize)),n?i.insertAfter(n.$editNode):t&&t.append(i),"EmptyModule"!=e.Type&&d.$node.prepend(s),i.append(this.menu.modButtons(this,e,d).$node),i.append(d.$node),d.$node.find("> .header-container").css({display:1==r.Head?"":"none"}).find(".header").editor(e,r,"Header",{allowEnter:!0,cleanPTags:!0}),this.rddm.addModule(e),d.mount&&d.mount(),e.Data.Titlehide&&e.$editNode.addClass("remove-title")),e.Data.Titlehide&&e.$previewNode.addClass("remove-title"),e.applyStyle&&(e.applyStyle(c),e.editObj&&e.editObj.applyStyle&&e.editObj.applyStyle(c))},app.factory.handleExport=function(t,e){var n=this;t.$editNode.addClass("keep-open");var o,i="",s=$("#home-page");t.Data.Exports||(t.Data.Exports={}),n.popup.exp(n.folio,t.Data.Exports,{$el:t.$previewNode,isMod:!0,target:"module",cb:function(e,a){i="",(o=n.pageManager.isCurrent(n.pageManager.pages.home))||n.pageManager.showPage(n.pageManager.pages.home),s.css("width",e+"px"),setTimeout(function(){n.modManager.activatePreview();var e=$('<div><div class="container-fluid"><div class="row" id="modules-preview-main"><div class="preview-div clearfix"><div class="section-content clearfix">'+$("<div>").append(t.$previewNode.clone()).html()+"</div></div></div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,a){i+="<style>"+a.innerHTML+"</style>"}),i+=e.html(),i+=$("#tmp-power-by-footer").get(0).outerHTML,a(i),s.css("width",""),o?n.modManager.activatePreview():n.pageManager.showPage(n.pageManager.pages.edit),t.save(),t.$editNode.removeClass("keep-open")},200)}})},app.factory.fixData=function(e){var n=this;$.each(e,function(e,t){t&&$.each(t,function(e,a){"Items"==e?n.fixData(a):t[e]=n.$div.html(a).html()})})},app.factory.initModule=function(e,i,a,t,n,o,s,r){var l=this,d=i.Data;a&&$.each(d,function(e,a){a&&("Items"==e?l.fixData(a):d[e]=l.decoder&&l.decoder(l.$div,e,a)||a)}),i.factory=l,d.Cols=d.Cols||l.cols,i.save=function(e){l.appHub.saveMod(i,e)},i.Data.Theme||(i.Data.Theme=r),l.setupModule&&l.setupModule(i),i.previewObj=l.getPreview(i),l.config.editMode&&(i.editObj=l.getEdit(i),i.listEditors=function(){var e,a=l.config.currentlyEditing,t=i.$editNode.find(".others");for(var n in t.empty(),a)if((e=a[n]).active&&e.module.Tag==i.Tag){$('.module-container .user[data-email="'+n+'"]').remove();var o=$('<span class="user" data-email="'+n+'" data-tip="'+e.name+'">'+app.core.utility().getInitials(e.name)+"</span>");t.append(o)}}),l.createDOMNodes(i,t,n,o),(l.modules[i.Key]=i).showSpinner=function(){i.$editNode.prepend($("#spinner-container > .loading-animation").clone())},i.hideSpinner=function(){i.$editNode.find(".loading-animation").remove()},i.bringInView=function(){var e=$("#ed-"+i.Key),a=$("#pr-"+i.Key),t=0<e.length?e:a,n=t.offset();t.addClass("active"),n&&$("html,body").animate({scrollTop:n.top-100},600,function(){setTimeout(function(){t.removeClass("active")},2e3)})},"Canvas"===i.Type&&(0!==d.Mods.length&&e.canvasHasChildren(i.$editNode)||e.generateEmptyCanvasModule(i.$editNode,i.$previewNode)),setTimeout(function(){app.plugin.tooltip(!0)},500)},app.factory.main=function(e,a,t,n,o,i,s,r){var l=this;l.config=e,l.folio=a,l.$div=$("<div>"),l.$store=$("<div>"),l.$modItemsDiv=$("#module-items"),l.apiHelper=t.apiHelper,l.appHub=t.appHub,l.eventManager=t.eventManager,l.pageManager=t.pageManager,l.store=t.store,l.utility=t.utility,l.modStore=t.modStore,l.menu=n,l.modManager=i,l.popup=o,l.rddm=s,l.changeImage=n.changeImage,l.editBase=app.mods.getEditBase(e,t.appHub,t.eventManager),l.renderPreview=function(e){var a=e.Data,t=a.Theme||"#4C7BA0";e.$previewNode.css({border:1==a.Border?"1px solid "+t:""}),e.$previewNode.find("> .module .header-container").css({display:1==a.Head?"":"none"}).find(".header").html(a.Header),e.renderPreview()};var d=function(e){var a=$.extend({},l,{modules:{},type:e.type,options:e,cols:e.cols||12});return i.registerFactory(a),a},c=app.mods;c.dataCollectionFactory(d),c.textFactory(d,r),c.donutFactory(e,d),c.canvasFactory(d,r),c.rowBreakFactory(d),c.plainHtmlFactory(d),c.emptyModuleFactory(d),c.imagesFactory(d),c.videosFactory(d,i,o),c.barFactory(d),c.vertBarFactory(d),c.scaleFactory(d),c.tagFactory(d,r),c.socialFactory(d),i.init()},app.factory.shareModule=function(e,a){this.popup.shareLink(e,[a.ID],a.Type)},app.factory.removeModule=function(e,a,t){var o=this,n=function(){if(o.rddm.removeModule(e),o.menu.detach(),e.$editNode.remove(),e.$previewNode.remove(),o.modManager.removeMod(e),e.noDelete||o.apiHelper.deleteModule(e),"Canvas"==e.Type){var n=[];$.each(e.Data.Mods,function(e,a){var t=o.modManager.getModule(a.Tag);t&&(n.push(t.ID),o.modManager.removeMod(t))}),o.apiHelper.deleteModules(n)}delete o.modules[e.Key],o.modManager.saveLayout(),t&&t()};if(a)n();else{var i="Canvas"==e.Type?"canvas":"module";o.popup.message({heading:"Delete "+i+"?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:n})}},app.mods.barFactory=function(e){var t=e({type:"Bar",cols:4});t.decoder=function(e,a,t){return t},t.setupModule=function(a){var e=a.Data;e.Head=e.Head||2,e.Txt=e.Txt||1,e.Title=e.Title||"<p>Bar Graph</p>",e.Items=e.Items||[{Name:"<p>Bar 1</p>",Val:50},{Name:"<p>Bar 2</p>",Val:75},{Name:"<p>Bar 3</p>",Val:25}],a.applyStyle=function(e){t.createStyle(a.Key,e,[{prop:"background-color",value:e,selectors:[".slider-bar"]},{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},t.getPreview=app.mods.barPreview(t),t.config.editMode&&(t.getEdit=app.mods.barEdit(t,app.mods.sliderBaseFunc(t.appHub,"width")))},app.mods.canvasFactory=function(e,s){var r=e({type:"Canvas",cols:12}),l=(s=r.utility,Date.now(),null);function d(n,e){var a=n.Data,o=1,i=[];$.each(a.Mods,function(e,a){var t=r.modManager.getModule(a.Tag);if(!t.Tag)return clearTimeout(l),l=setTimeout(function(){d(n)},1e3),o=0,!1;i.indexOf(t.Tag)<0&&i.push(t.Tag),a.Tag=t.Tag,t.save()}),o&&i.length==a.Mods.length&&r.appHub.saveMod(n,function(){e&&e(),n.saved&&n.saved()})}r.decoder=function(e,a,t){return t},r.include=function(a,t,e){var n=a.Data;e||(a.editObj.saveMods(),d(a)),t.detach=function(){t.Data.Theme=n.Theme,t.editObj.applyStyle&&(t.editObj.applyStyle(n.Theme),r.appHub.sync(t,"Theme",n.Theme));var e=r.utility.obtain(n.Mods,"Tag",t.Tag||t.Key);e&&(r.utility.removeFromList(n.Mods,e),t.detach=null,t.clone=null,r.appHub.sync(a,"Mods",n.Mods))},t.clone=function(){a.editObj.clone(t)}},r.setupModule=function(i){var e=i.Data;i.noResize=!0,i.containerClassName="canvas-module-container",e.Header=e.Header||"Title",e.Theme=e.Theme||"#4C7BA0",e.Mods=e.Mods||[],e.Arr=e.Arr||[3,6,3],e.Head=e.Head||2,e.Border=e.Border||2;$.each(e.Mods,function(e,a){var t,n=r.modManager.getModule(a.Tag);if(n){var o=r.modManager.getFactory(n);o&&(o.initModule(s,n,1),r.include(i,n,!0))}else a.Module&&((t=a.Module).Sync=!i.New,r.modManager.addModule(t.Type,t,!1))}),i.save=function(e){i.editObj.saveMods(),d(i,e)},i.applyStyle=function(e){r.createStyle(i.Key,e,[{prop:"background-color",value:e,selectors:[".canvas-module > .header-container"]},{prop:"background-color",value:e,selectors:[".canvas-module  .quote"]},{prop:"margin",value:"0 auto",selectors:[""]}],[".nope"])},r.editBase(i,{})},r.getPreview=app.mods.canvasPreview(r),r.config.editMode&&(r.getEdit=app.mods.canvasEdit(r,s))},app.mods.dataCollectionFactory=function(e){var t=e({type:"DataCollection",cols:12});t.decoder=function(e,a,t){return"ButtonText"==a?e.html(t).text():t},t.setupModule=function(a){a.Data.ButtonText=a.Data.ButtonText||"Join Us!",a.Data.Message=a.Data.Message||"<h3>Give them a good reason.</h3>",a.applyStyle=function(e){t.createStyle(a.Key,0,[{prop:"background-color",value:e,selectors:[".module-info-inner",".dc-join-us"]},{prop:"background-color",value:d3.rgb(e).darker(.2).toString(),selectors:[".module-info-inner:hover",".dc-join-us:hover"]},{prop:"color",value:e,selectors:[".header"]}])}},t.getPreview=app.mods.dataCollectionPreview(t),t.config.editMode&&(t.getEdit=app.mods.dataCollectionEdit(t))},app.mods.donutFactory=function(e,a){var o=$("<div>"),t=a({type:"DonutChart",cols:8});t.createColorFunc=function(a,e){var t=d3.rgb(e).brighter(3.7).toString();if(t.length<7)for(var n=7-t.length,o=0;o<n;o++)t=t.replace("#","#0");var i={colorStart:e,colorEnd:t},s=d3.interpolateRgb(i.colorStart,i.colorEnd);return function(e){return s(e/a)}},t.decoder=function(e,a,t){return t};var n=app.mods.donutBaseFunc(e,t);t.setupModule=function(n){var e,a=n.Data;if(n.breakup=[],a.Title=a.Title||"<p>Pie Chart</p>",a.Label=a.Label||"<h2>Click to edit label</h2>",a.Theme=a.Theme||"",!a.Items)for(a.Items=[],e=1;e<=5;e++)a.Items.push({Val:"<p>20% &nbsp;Segment "+e+"</p>"});$.each(a.Items,function(e,a){var t=parseInt(o.html($.trim(a.Val)).text());isNaN(t)||n.breakup.push(t)}),n.applyStyle=function(e){n.colorFunc=t.createColorFunc(a.Items.length,e),t.createStyle(n.Key,e,[{prop:"color",value:e,selectors:[".header",".donut-label"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},t.getPreview=app.mods.donutPreview(t,n),t.config.editMode&&(t.getEdit=app.mods.donutEdit(t,n))},app.mods.emptyModuleFactory=function(e){var a=e({type:"EmptyModule",cols:12});a.setupModule=function(e){e.noResize=!0,e.noDrag=!0,e.Data.Cols=12,e.containerClassName="empty-module-container"},a.getPreview=function(e){return e.renderPreview=function(){},{$node:$('<div class="module empty-module"></div>')}},a.config.editMode&&(a.getEdit=function(e){var a=$('<button class="btn add-btn blue-btn">+ Add</button>');return a.on("click",function(){a.closest(".edit-div").find(".add-mod-btn").trigger("click")}),{$node:$('<div class="module empty-module"><p>No modules added yet.</p></div>').append(a)}})},app.mods.imagesFactory=function(e){var t=e({type:"Images",cols:2}),n="/img/placeholder-img.png";t.defImg=n,t.decoder=function(e,a,t){return t},t.setupModule=function(a){var e=a.Data;e.Align=e.Align||"left",e.Html=e.Html||"Images",e.Items=e.Items||[{Url:n,Val:100}],e.Head=e.Head||2,e.Txt=e.Txt||2,a.applyStyle=function(e){t.createStyle(a.Key,e,[{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},t.getPreview=app.mods.imagesPreview(t),t.config.editMode&&(t.getEdit=app.mods.imagesEdit(t))},app.mods.plainHtmlFactory=function(e){var i=$("#tmp-edit-plainhtml").html(),n=$("#tmp-prev-plainhtml").html(),a=e({type:"PlainHtml",cols:6});a.setupModule=function(e){e.Data.Html=e.Data.Html||"<p>Write your HTML and style it anyway you want!</p><p>You can also use Twitter Bootstrap classes to style your HTML!</p>"},a.getPreview=function(e){var a=$(n),t=a.find(".content-box");return e.renderPreview=function(){t.html(e.Data.Html)},{$node:a}},a.config.editMode&&(a.getEdit=function(a){var e=$(i),t=e.find(".text-area"),n=Date.now(),o=e.find(".edit-btn");return t.val(a.Data.Html),t.on("keydown",function(){var e=Date.now();8e3<e-n&&(a.Data.Html=t.val(),a.save(),n=e)}),t.on("blur",function(){a.Data.Html=$(this).val(),"normal",e.removeClass("edit").addClass("normal"),a.save()}),o.on("click",function(){"edit",e.removeClass("normal").addClass("edit"),t.focus()}),{$node:e}})},app.mods.rowBreakFactory=function(e){var t=$("#tmp-edit-row-break").html(),a=$("#tmp-prev-row-break").html(),n=e({type:"RowBreak",cols:12});n.setupModule=function(e){e.noResize=!0,e.Data.Cols=12,e.containerClassName="row-break-module"},n.getPreview=function(e){return e.renderPreview=function(){},{$node:$(a)}},n.config.editMode&&(n.getEdit=function(e){var a=$(t);return n.editBase(e,{}),{$node:a}})},app.mods.scaleFactory=function(e){var t=e({type:"Scale",cols:4});t.decoder=function(e,a,t){return t},t.setupModule=function(a){var e=a.Data;e.Head=e.Head||2,e.Txt=e.Txt||1,e.Title=e.Title||"<p>Scale Chart</p>",e.Items=e.Items||[{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:30},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:70},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50}],a.applyStyle=function(e){t.createStyle(a.Key,e,[{prop:"background-color",value:e,selectors:[".slider-bar"]},{prop:"color",value:e,selectors:[".header-container .header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},t.getPreview=app.mods.scalePreview(t),t.config.editMode&&(t.getEdit=app.mods.scaleEdit(t,app.mods.sliderBaseFunc(t.appHub,"left")))},app.mods.socialFactory=function(e){var t=e({type:"Social",cols:4});t.decoder=function(e,a,t){return t},t.setupModule=function(a){var e=a.Data;e.Align=e.Align||"center",a.applyStyle=function(e){t.createStyle(a.Key,e,[{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},t.getPreview=app.mods.socialPreview(t),t.config.editMode&&(t.getEdit=app.mods.socialEdit(t))},app.mods.tagFactory=function(e,t){var n=e({type:"Tag",cols:4});n.decoder=function(e,a,t){return t},n.setupModule=function(a){var e=a.Data;e.Align=e.Align||"left",e.Items=e.Items||[{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"}],a.applyStyle=function(e){n.createStyle(a.Key,e,[{prop:"background-color",value:e,selectors:[".tag-inner"]},{prop:"color",value:t.getColorContrast(e),selectors:[".tag-inner p"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},n.getPreview=app.mods.tagPreview(n),n.config.editMode&&(n.getEdit=app.mods.tagEdit(n))},app.mods.textFactory=function(e,t){var o=$("#tmp-edit-text").html(),i=$("#tmp-prev-text").html(),s="loading"in HTMLImageElement.prototype,r=e({type:"Text",cols:4});r.setupModule=function(a){var e=a.Data;e.Align=e.Align||"left",e.Theme=e.Theme||"#052b3e",null==e.Html&&(e.Html="<h2>Text Module</h2><h4>Point. Click. Type.</h4><p>This is a pretty straightforward text editor. You can even place images, videos, tables, and links.</p>"),a.applyStyle=function(e){r.createStyle(a.Key,e,[{prop:"color",value:e,selectors:[".header","a",".text-module .name","h2 + ol","h2 + ul",".text-module .fr-view > ul",".text-module .fr-view > ol"]},{prop:"background-color",value:e,selectors:[".fr-cta-btn"]},{prop:"color",value:t.getColorContrast(e),selectors:[".fr-cta-btn-link"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},r.getPreview=function(e){var a=e.Data,t=$(i),n=t.find(".text-content");return e.renderPreview=function(){if($("#tmp-export").hasClass("show"))n.html(a.Html).css("text-align",a.Align);else{var e=a.Html.replace("<img",s?'<img loading="lazy" ':'<img class="lazyload" data-');n.html(e).css("text-align",a.Align)}},{$node:t}},r.config.editMode&&(r.getEdit=function(e){var a=e.Data,t=$(o).css("text-align",a.Align),n=t.find(".editor");return r.editBase(e,{}),n.editor(e,a,"Html",{allowEnter:!0}),{changeTheme:function(){n.unstyle()},align:function(){t.css("text-align",a.Align)},$node:t}})},app.mods.vertBarFactory=function(e){var t=e({type:"Vertical Bar",cols:4});t.decoder=function(e,a,t){return t},t.setupModule=function(a){var e=a.Data;e.Head=e.Head||2,e.Txt=e.Txt||1,e.Title=e.Title||"<p>Bar Chart</p>",e.Items=e.Items||[{Name:"<p>Bar 1</p>",Val:50,Height:50},{Name:"<p>Bar 2</p>",Val:75,Height:75},{Name:"<p>Bar 3</p>",Val:25,Height:25},{Name:"<p>Bar 4</p>",Val:50,Height:50},{Name:"<p>Bar 5</p>",Val:75,Height:75},{Name:"<p>Bar 6</p>",Val:25,Height:25}],e.yAxisMax=e.yAxisMax||"100",e.graphType=e.graphType||"Bar",a.applyStyle=function(e){t.createStyle(a.Key,e,[{prop:"background-color",value:e,selectors:[".slider-bar"]},{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},t.getPreview=app.mods.vertBarPreview(t),t.config.editMode&&(t.getEdit=app.mods.vertBarEdit(t,app.mods.sliderBaseFunc(t.appHub,"height")))},app.mods.videosFactory=function(e,a,t){var s=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,url_text:"https://www.youtube.com/embed/$1?$2",html:'<iframe width="640" height="360" src="{url}&wmode=opaque" frameborder="0" allowfullscreen></iframe>',provider:"youtube"},{test_regex:/^.*(?:vimeo.com)\/(?:channels(\/\w+\/)?|groups\/*\/videos\/\u200b\d+\/|video\/|)(\d+)(?:$|\/|\?)/,url_regex:/(?:https?:\/\/)?(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?(\/[a-zA-Z0-9_\-]+)?/i,url_text:"https://player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vimeo"},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"https://www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"dailymotion"},{test_regex:/^.+(screen.yahoo.com)\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"yahoo"},{test_regex:/^.+(rutube.ru)\/[^_&]+/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,url_text:"https://rutube.ru/play/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"rutube"},{test_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/,url_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/g,url_text:"https://play.vidyard.com/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vidyard"}],n=e({type:"Videos",cols:4}),o="/img/placeholder-img.png";n.defImg=o,n.decoder=function(e,a,t){return t},n.setupModule=function(a){var e=a.Data;e.Align=e.Align||"left",e.Html=e.Html||"Videos",e.Items=e.Items||[{Url:o,Val:100}],e.Head=e.Head||2,e.Txt=e.Txt||2,e.VideoUrl=e.VideoUrl||"",e.VideoUrl,a.applyStyle=function(e){n.createStyle(a.Key,e,[{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}};var i=function(e){for(var a,t=s,n=0;n<t.length;n++)if(t[n].test_regex.lastIndex=0,t[n].test_regex.test(e)){var o=t[n].url_text;t[n].url_regex.lastIndex=0;var i=t[n].url_regex.exec(e)[1];o=o.replace("$1",i),a=t[n].html.replace("{url}",o)}return a};n.getPreview=app.mods.videosPreview(n,i),n.config.editMode&&(n.getEdit=app.mods.videosEdit(n,i,a,t))},app.mods.donutBaseFunc=function(e,u){return{pie:app.charts.pie(),mount:function(){var e=this;u.eventManager.addListener("resize",function(){e.drawPie()})},updateLabel:function(){var e=this.$pieDiv.height()/2||this.getVal(this.$pieDiv,0)/2;if(e){var a=this.$pieDiv.closest(".donut-module").find(".donut-label");a.css("font-size",Math.max(12,e/2)+"%"),this.stack||(e=Math.max(e,this.$breakup.height()/2)),a.css({top:e-a.height()/2})}},drawChart:function(e){e.pie.draw({$el:e.$pieDiv,items:e.module.breakup,colorFunc:e.module.colorFunc}),e.updateLabel()},getVal:function(e,a){var t,n=e.height();return e.parents(".module-container").hasClass("col-sm-2")?(n=n||170,t=!0):e.parents(".module-container").hasClass("col-sm-4")?(n=n||170,t=!1):e.parents(".module-container").hasClass("col-sm-6")?(n=n||270,t=!1):e.parents(".module-container").hasClass("col-sm-8")?(n=n||370,t=!1):e.parents(".module-container").hasClass("col-sm-10")?(n=n||390,t=!1):e.parents(".module-container").hasClass("col-sm-12")&&(n=n||390,t=!1),0==a?n:1==a?t:2==a?n:void 0},drawPie:function(){var e,a,t=this,n=t.$pieDiv.parent(),o=t.$breakup.parent(),i=t.parentPage==u.pageManager.pages.edit?".edit-content":".module";if(t.stack=t.$pieDiv.closest(i).width()<400,e=t.$pieDiv.height(),a=(a=t.$breakup.height())||200,t.stack=t.$pieDiv.closest(i).width()<400,t.$pieDiv.parents(".module-container").hasClass("col-sm-2")?(e=e||170,t.stack=!0):t.$pieDiv.parents(".module-container").hasClass("col-sm-4")?(e=e||170,t.stack=!1):t.$pieDiv.parents(".module-container").hasClass("col-sm-6")?(e=e||270,t.stack=!1):t.$pieDiv.parents(".module-container").hasClass("col-sm-8")?(e=e||370,t.stack=!1):t.$pieDiv.parents(".module-container").hasClass("col-sm-10")?(e=e||390,t.stack=!1):t.$pieDiv.parents(".module-container").hasClass("col-sm-12")&&(e=e||390,t.stack=!1),t.$pieDiv.width(),t.stack)n.add(o).css({width:"100%","max-width":"100%"}),o.css({"padding-left":"10px"}),t.$pieDiv.add(t.$breakup).css("margin-top",""),t.drawChart(t);else{n.add(o).css({width:"","max-width":"","padding-left":""}),t.drawChart(t);var s=e/2,r=t.$pieDiv.closest(".donut-module").find(".donut-label");if(s){t.stack||(s=Math.max(s,a/2));var l=t.$breakup.find(".breakup-row").length,d=t.$breakup.find(".breakup-row").height()||40,c=0;c=(l%2||(c=l*d/2),(l-1)*d/2),s-r.height()/2-c-3}}}}},app.mods.getEditBase=function(s,a,r){return function(n,t){var o=n.Data;function i(){n.factory.renderPreview(n),n.factory.folio.Role<2&&n.save()}t.align&&a.reg(n,"Align",function(e,a){o.Align=a,n.menuCb("Align"),t.align(),i()}),a.reg(n,"Cols",function(e,a){var t=o.Cols;o.Cols=a,n.$editNode.removeClass("col-sm-"+t).addClass("col-sm-"+a),n.$previewNode.removeClass("col-sm-"+t).addClass("col-sm-"+a),"DonutChart"==n.Type&&n.factory.eventManager.raiseEvent("resize")}),a.reg(n,"Head",function(e,a){o.Head=a,n.menuCb("Head"),i()}),t.txt&&a.reg(n,"Txt",function(e,a){o.Txt=a,n.menuCb("Txt"),t.txt()}),a.reg(n,"Theme",function(e,a){o.Theme=a,n.menuCb("Theme"),t.theme&&t.theme(),i()}),t.itemVal&&a.reg(n,"Items",function(e,a){o.Items.length==a.length?$.each(a,function(e,a){o.Items[e].Val=a.Val,o.Items[e].Url=a.Url,"Videos"==n.Type?(o.Items[e]=a,t.itemVal(e,a)):"Vertical Bar"==n.Type?(o.Items[e].Height=a.Height,t.itemVal(e,a.Height),t.vertSlider(e,a.Height,a.Val)):t.itemVal(e,a.Val,a.Url)}):(t.$items.empty(),o.Items=a,$.each(a,t.addItem)),i()}),a.reg(n,"BgColor",function(e,a){o.BgColor=a,n.menuCb("BgColor")}),a.reg(n,"BgUrl",function(e,a){o.BgUrl=a,n.menuCb("BgUrl")}),a.reg(n,"BgPositionX",function(e,a){o.BgPositionX=a,n.menuCb("BgPositionX")}),a.reg(n,"BgPositionY",function(e,a){o.BgPositionY=a,n.menuCb("BgPositionY")}),a.reg(n,"BgSize",function(e,a){o.BgSize=a,n.menuCb("BgSize")}),a.reg(n,"ResetBg",function(e,a){n.menuCb("ResetBg")}),a.reg(n,"Border",function(e,a){o.Border=a,n.menuCb("Border"),i()}),a.reg(n,"DuplicateModule",function(e,a){n.menuCb("DuplicateModule")}),a.reg(n,"RemoveModule",function(e,a){n.menuCb("RemoveModule"),r.raiseEvent("moduleRemoved",{})}),a.reg(n,"Editor",function(e,a){s.currentlyEditing[a]={time:Date.now(),active:!0,module:n},r.raiseEvent("editorStatus",{email:a,status:1})}),setTimeout(function(){s.editMode&&n.$editNode.on("keydown click",function(){if("Canvas"!=n.Type){var e=s.currentlyEditing[s.userEmail];(!e||e.module.Tag!=n.Tag||5e3<=Date.now()-e.time)&&(a.sync(n,"Editor",s.userEmail),s.currentlyEditing[s.userEmail]={time:Date.now(),module:n})}})},50)}},app.mods.sliderBaseFunc=function(e,i){return function(e,a,o,t){var n=e.Data;e.factory.editBase(e,{addItem:a,$items:o,itemVal:function(e,a){o.find("> div:eq("+e+")").find(".slider-bar").css(i,a+"%")},vertSlider:function(e,a,t){var n=o.find("> div:eq("+e+")");n.find(".slider-tooltip").css("bottom",parseFloat(a)+4+"%"),n.find(".slider-val .fr-element").text(t)},txt:function(){t.css("display",1==n.Txt?"":"none")},theme:function(){t.unstyle()}})}},app.mods.barEdit=function(c,n){var o=$("#tmp-edit-bar").html(),u=$("#tmp-edit-bar-row").html();return function(s){var r=s.Data,e=$(o),a=e.find(".title").css("display",1==r.Txt?"":"none"),l=e.find(".pairs");function d(e){c.appHub.sync(s,e,r[e])}a.editor(s,r,"Title",{allowEnter:!0});var t=function(e,a){var t=$(u),n=t.find(".name"),o=t.find(".slider-container"),i=t.find(".item-close-btn");n.editor(s,a,"Name",{index:e,cleanPTags:!0}),o.percentSlider({obj:a,sync:d}),i.on("click",function(){c.utility.removeFromList(r.Items,a),n.unMount(),t.remove(),d("Items")}),l.append(t)};return $.each(r.Items,function(e,a){t(e,a)}),n(s,t,l,a),{$node:e,addItem:function(){var e={Name:"<p>Bar "+(r.Items.length+1)+"</p>",Val:50};t(r.Items.length,e),r.Items.push(e)},changeTheme:function(e){a.unstyle()},toggleTxt:function(){a.css("display",1==r.Txt?"":"none")},unMount:function(){a.unMount(),e.find(".name").unMount()}}}},app.mods.canvasEdit=function(g,v){var b,T,y=$("#tmp-edit-canvas").html(),C=$("#tmp-canvas-resize-col").html(),w=g.appHub,k=g.eventManager,x=g.modManager;v=g.utility;function P(e){$.each(e.Data.Mods,function(e,a){var t=x.getModule(a.Tag);t&&t.resize&&t.resize()})}function S(){if(b){var e,a=b.Data,t=0,n=a.Arr[T],o=a.Arr[T+1],i=n+o,s=$(this).index();for(e=0;e<T;e++)t+=a.Arr[e];return o=i-(n=1+s-t),0<n&&0<o&&(a.Arr[T]=n,a.Arr[T+1]=o,b.editObj.setLayout(),b.save()),P(b),w.sync(b,"CanvasColResize",{col:T,first:n,second:o}),!1}}return function(o){var e,r,l,s=o.Data,d=$(y),a=d.find(".edit-content"),c=a.find(".mods-inner"),i=a.find(".resize-bars"),t=d.find(".grid-div-wrapper"),n=d.find(".grid-div"),u=$('<div class="empty" style="border: 1px dotted blue; margin-top: 12px;">');for(i.on("mousedown",".resize-grip",function(){b=o,T=$(this).index(),$("body").addClass("disable-select"),t.show()}),e=0;e<s.Arr.length;e++)c.append($("<div>"));for(d.on("mouseup mouseleave",function(){b&&(b=null,$("body").removeClass("disable-select"),t.hide())}),e=0;e<12;e++){var m=$('<div class="col col-xs-1"></div>)');m.on("mouseenter",S),n.append(m)}function p(t){var e,a=s.Arr.length;if(console.log("$node",d),a!==t){var n,o,i;if(t<a){for(o=c.find(".col:eq("+(t-1)+")"),n=t;n<a;n++)s.Arr[t-1]+=s.Arr[n],i=c.find(".col:eq("+n+")").find(".module-container"),o.append(i);c.find(".col").each(function(e,a){t-1<e&&a.remove()}),1===t&&v.addEmptyMod(d,d.parent(),".edit-content .col:eq(0)")}else{for(n=a;n<t;n++)c.append($("<div>")),s.Arr[n]=1;for(e=t-a,n=-1;n<0&&(n=a-1),1<s.Arr[n]&&(s.Arr[n]-=1,e-=1),n--,0<e;);}s.Arr.length=t}}function f(e,a,t){var n=0;a=x.addModule(e,a,0,$("<div>"),$("<div>"));1<c.find(".col").length&&(n=1),c.find(".col:eq("+n+")").insertAt(0,a.$editNode),a.resize&&a.resize(),h.saveMods(),g.include(o,a),a.save(),c.find(".empty-canvas-cont").remove(),t&&t(a)}o.drag=function(i,s){s=s-d.find(".header").height()-30,c.find(".module-container").each(function(e,a){var t=$(a),n=t.closest(".col").position(),o=t.position();if(o.left+=n.left,o.top+=n.top,o.right=o.left+t.width(),o.bottom=o.top+t.height(),v.isPointInRect(o,{x:i,y:s}))return s>o.bottom/2?u.insertAfter(t):u.insertBefore(t),!1})},o.dragCancel=function(){u.remove()},o.dragEnd=function(e){var a,t;(t=u.closest(".col").index())<0&&(t=0,c.find(".col:eq(0)").prepend(u)),a=u.index(),w.sync(o,"CanvasModPos",{col:t,index:a,Tag:e.Tag}),c.find(".col:eq("+t+")").insertAt(a,e.$editNode),$(".empty").remove();var n=s.Theme;try{n=(n=JSON.parse(e.lastSavedData)).Theme}catch(e){n=s.Theme}e.editObj.applyStyle&&(e.Data.Theme=n,e.editObj.applyStyle(n),w.sync(e,"Theme",n)),e.Data.Theme=n,e.applyStyle&&e.applyStyle(n),g.include(o,e),w.sync(o,"Mods",s.Mods)},w.reg(o,"CanvasCol",function(e,a){p(a),h.setLayout()}),w.reg(o,"CanvasModPos",function(e,a){var t=$("#ed-"+a.Tag).parent(".col").index(),n=$("#ed-"+a.Tag).index();t==a.col&&n<a.index&&(a.index+=1);var o=x.getModule(a.Tag);c.find(".col:eq("+a.col+")").insertAt(a.index,o.$editNode),o.$editNode.find(".fr-embedly").each(function(){$(this).html($(this).data().originalEmbed)})}),w.reg(o,"CanvasColResize",function(e,a){var t=o.Data;t.Arr[a.col]=a.first,t.Arr[a.col+1]=a.second,P(o),o.editObj.setLayout()}),w.reg(o,"CanvasAddMod",function(e,a){a.Syncd=!0,f(a.Type,a)});var h={$node:d,mount:function(){$.each(s.Mods,function(e,a){var t=x.getModule(a.Tag)||a.Module;t&&c.find(".col:eq("+a.Col+")").insertAt(a.Row,t.$editNode)})},applyStyle:function(n,e){c.css({border:1==s.Border?"":"1px dashed "+n}),e&&$.each(s.Mods,function(e,a){var t=x.getModule(a.Tag);t&&(t.Data.ThemeOverride&&(t.Data[t.Data.ThemeOverride]=n,"BgColor"==t.Data.ThemeOverride&&g.bgColor(t,n,!0)),t.Data.Theme=n,t.applyStyle&&t.applyStyle(n),t.editObj&&t.editObj.applyStyle&&t.editObj.applyStyle(n),t.save())})},addModule:function(){g.popup.addModule(function(a){f(a,{Type:a,Data:{Type:a,Theme:s.Theme}},function(e){w.sync(o,"CanvasAddMod",{Tag:e.Tag,Type:a,Data:e.Data,CanvasMod:!0}),h.$node.find(".empty-canvas-cont").remove()})},1)},clone:function(e){var a=x.copyModule(e);x.getFactory(a).initModule(v,a),e.$editNode.after(a.$editNode),o.factory.include(o,a),a.save(),o.save()},setLayout:function(){var n,o=0;i.empty(),$.each(s.Arr,function(e,a){var t=isNaN(a)?1:a;c.find(">div:eq("+e+")").attr("class","col col-sm-"+t),0<e&&(o+=8.33*s.Arr[e-1],n=$(C).css("left","calc("+o+"% - 0px)"),i.append(n))})},saveMods:function(){s.Mods=[],c.find(".col").each(function(t,e){$(e).find(".module-container:not(.empty-module-container)").each(function(e,a){(a=x.getModule($(a).data("key")))&&s.Mods.push({Tag:a.Tag||a.Key,Col:t,Row:e})})})},changeColumns:function(e){p(e),h.setLayout(),o.save(),w.sync(o,"CanvasCol",e)},move:function(e){var t,n,o,a=e.pageX,i=e.pageY,s={x:a,y:i};c.find("> .col").each(function(e,a){if(n=$(a),n.width(),(t=n.offset()).top-=150,t.right=t.left+n.width()+10,t.bottom=t.top+c.height()+100,v.isPointInRect(t,s))return u.hasClass("animatable")||l===a||(l=a,u.addClass("animatable"),u.height("1px")),$("#edit-page .empty").remove(),n.prepend(u),n.find(".module-container").each(function(e,a){if(o=$(a),t.top=o.offset().top,t.bottom=t.top+o.height(),i>t.top&&i<t.bottom)return u.hasClass("animatable")||r===a||(r=a,u.addClass("animatable"),u.height("1px")),i<t.top+o.height()/2?o.before(u):o.after(u),u.height("100px"),setTimeout(function(){u.removeClass("animatable")},200),!1}),u.height("100px"),setTimeout(function(){u.removeClass("animatable")},200),!1}),u.index()<0&&c.find(".col:eq(0)").append(u)},cancel:function(){u.height("1px"),u.remove()}};return k.addListener("moduleRemoved",function(e){console.log("module removed:",e),console.log("current canvas",o),"Canvas"===o.Type&&o.Data&&o.Data.Mods&&0===o.Data.Mods.length&&!v.canvasHasChildren(o.$editNode)&&v.generateEmptyCanvasModule(o.$editNode,o.$previewNode)}),h.setLayout(),setTimeout(P,0,o),h}},app.mods.dataCollectionEdit=function(m){var p=$("#tmp-edit-dc").html();return function(a){var t,n,e=a.Data,o=0,i=$(p),s=i.find(".module-info-inner"),r=i.find(".dc-join-us"),l=i.find(".total"),d=i.find(".new-items"),c=i.find(".msg");function u(e,a){n+=e,o+=a,l.text(n+" RESPONSE"+(1==n?"":"S")),d.text(o+" New")}return a.Records=a.Records||[],a.Store=JSON.parse(a.Store||"{}"),a.Store.viewed=a.Store.viewed||JSON.stringify(new Date(2016,4,30).getTime()),t=new Date(JSON.parse(a.Store.viewed)),n=a.Records.length,$.each(a.Records,function(e,a){if(a.Created<t)return!1;o++}),l.text(n+" RESPONSE"+(1==n?"":"S")),d.text(o+" New"),s.on("click",function(){u(0,-o),m.popup.signupPerformance(a.ID,a.Records,{n:m.folio.FolioName,t:m.folio.Token})}),c.editor(a,e,"Message",{allowEnter:!0}),r.editor(a,e,"ButtonText",{noHtml:!0}),m.modStore.reg(a.ID,a.Store),m.eventManager.addListener("newSignUp",function(e){e.Data.ModId==a.ID&&u(1,1)}),u(0,0),function e(){a.ID?m.popup.signupPerformance.reg(a.ID,a.Records,{n:m.folio.FolioName,t:m.folio.Token}):setTimeout(e,500)}(),m.editBase(a,{}),{$node:i}}},app.mods.donutEdit=function(m,p){var f=$("#tmp-edit-donut-main").html(),s=$("#tmp-edit-donut-row").html(),l=$("<div>"),h=function(e,a,t){var n=0,o=!0,i=m.modManager.getDonutData();e.breakup=[];for(var s=0;s<a.length;s++){var r=parseFloat(l.html($.trim(a[s].Val)).text());isNaN(r)||(n+=r,e.breakup.push(r))}i.showError&&(o=100==n),t.closest(".breakup-col").find(".item-close-btn").toggleClass("hidden",1==e.breakup.length),t.toggleClass("hidden",o)},g=function(e,a){var t=e.module,n=t.Data;a&&(t.colorFunc=m.createColorFunc(n.Items.length,a)),h(t,n.Items,e.$error),e.$breakup.find(".breakup-row").each(function(e){$(this).find(".color").css("background-color",t.colorFunc(e))}),e.drawPie(),t.factory.renderPreview(t)},v=function(e,a,t){var n=e.module,o=$(s),i=o.find(".value");i.editor(n,a,"Val",{index:t,onSave:function(){g(e)},changed:function(){1<$("<div>"+a.Val+"</div>").find("p").length&&(a.Val="<p>"+$(a.Val).text()+"</p>",i.find(".fr-view").html(a.Val)),setTimeout(function(){g(e)},500)}}),e.$breakup.append(o)};return function(a){var e=a.Data,t=e.Theme||"#4C7BA0",n=e.Items,o=$(f),i=o.find(".title"),s=o.find(".donut-pie-container"),r=o.find(".donut-label"),l=o.find(".donut-breakup"),d=o.find(".invalid-100"),c=$.extend({parentPage:m.pageManager.pages.edit,$node:o,$pieDiv:s,$breakup:l,$error:d,module:a,data:e,breakup:n,changeTheme:function(e){i.unstyle(),a.applyStyle(e),c.applyStyle(e)},applyStyle:function(e){t=e,g(c)},addItem:function(){u(),m.appHub.sync(a,"PieItems",-1)},render:function(){g(c)}},p);$.each(n,function(e,a){v(c,a,e)});var u=function(){var e={Val:"<p>10% &nbsp;Segment  "+(n.length+1)+"</p>"};v(c,e,n.push(e)-1),g(c,t)};return m.appHub.reg(a,"PieItems",function(e,a){a<0?u():(l.find(".breakup-row").eq(a).remove(),n.splice(a,1),g(c,t))}),l.on("click",".item-close-btn",function(){var e=$(this).closest(".breakup-row");m.appHub.sync(a,"PieItems",e.index()),n.splice(e.index(),1),e.remove(),g(c,t),a.save()}),d.find(".item-close-btn").on("click",function(){m.modManager.getDonutData().showError=!1,h(a,n,d),d.find(".error-check").get(0).checked&&(m.eventManager.raiseEvent("donutError"),m.modManager.saveData())}),m.eventManager.addListener("donutError",function(){h(a,n,d)}),i.editor(a,e,"Title",{allowEnter:!0}),r.editor(a,e,"Label",{allowEnter:!0,changed:function(){c.updateLabel()}}),a.resize=function(){c.drawPie()},m.editBase(a,{}),c}},app.mods.imagesEdit=function(b){var T="loading"in HTMLImageElement.prototype,y=b.appHub,n=$("#tmp-edit-images").html(),C=$("#tmp-edit-image-item").html();return function(c){var u,m,p,f,h=c.Data,e=$(n),a=e.find(".title").css("display",1==h.Txt?"":"none"),g=e.find(".image-outer").css("text-align",h.Align);function v(e){return e&&e.toString().replace("&amp;","&")}function t(e,t){if(t){var a=Math.min(100,t.Val||33)+"%",n=$(C),o=n.find("img"),i=n.find(".edit-btn"),s=n.find(".link-btn"),r=n.find(".logo-resize-handle"),l=n.find(".close-btn");n.css("width",a),l.on("click",function(){b.utility.removeFromList(h.Items,t),c.save(),y.sync(c,"Items",h.Items),n.remove()}),r.on("mousedown touchstart",function(e){e.stopPropagation(),u=t,f=(m=n).width(),p=e.clientX,$("body").addClass("disable-select")}),i.uploader({module:c,custom:"imgMod",success:function(e){var a=v(e.Message);t.Url=a,o.attr("src",a),y.sync(c,"Items",h.Items)}}),s.click(function(){var e=t.link?v(t.link):"http://";b.popup.message({input:e,validateFor:"url",enterAsOK:!0,emptyError:"Please provide a valid URL.",heading:"Where do you want to link this image?",cancelText:"Cancel",handleOK:function(e){t.link=e,y.sync(c,"Items",h.Items)}})});var d=v(t.Url);o.attr(T?"src":"data-src",d),T?o.attr("loading","lazy"):o.addClass("lazyload"),g.append(n)}}return a.editor(c,h,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",function(){if(u){$("body").removeClass("disable-select");var e=g.width();u.Val=Math.round(100*m.width()/e),m.css("width",u.Val+"%"),u=null,y.sync(c,"Items",h.Items)}}),$(document).on("touchmove mousemove",function(e){if(u){var a=g.width();m.css("width",Math.max(50,Math.min(a,f+e.clientX-p))+"px")}}),$.each(h.Items,t),b.editBase(c,{addItem:t,$items:g,itemVal:function(e,a,t){var n=v(t);g.find("> div:eq("+e+")").css("width",a+"%").find("img").attr("src",n)},align:function(){g.css("text-align",h.Align)},txt:function(){a.css("display",1==h.Txt?"":"none")},theme:function(){a.unstyle()}}),{$node:e,changeTheme:function(e){a.unstyle()},addItem:function(){var e={Url:b.defImg,Val:100};t(h.Items.length,e),h.Items.push(e),$(".image-outer").sortable("refresh")},align:function(){g.css("text-align",h.Align)},toggleTxt:function(){a.css("display",1==h.Txt?"":"none")},unMount:function(){a.unMount()}}}},app.mods.scaleEdit=function(u,n){var o=$("#tmp-edit-scale").html(),m=$("#tmp-edit-scale-row").html();return function(r){var l=r.Data,e=$(o),a=e.find(".title").css("display",1==l.Txt?"":"none"),d=e.find(".pairs");function c(e){u.appHub.sync(r,e,l[e])}a.editor(r,l,"Title",{allowEnter:!0});var t=function(e,a){var t=$(m),n=t.find(".name-1"),o=t.find(".name-2"),i=t.find(".slider-container"),s=t.find(".item-close-btn");n.editor(r,a,"Name1",{index:e,cleanPTags:!0}),o.editor(r,a,"Name2",{index:e,cleanPTags:!0}),i.thumbSlider({obj:a,sync:c}),s.on("click",function(){u.utility.removeFromList(l.Items,a),r.save(),n.unMount(),o.unMount(),t.remove(),c("Items")}),d.append(t)};return $.each(l.Items,t),n(r,t,d,a),$.extend({$node:e,changeTheme:function(e){a.unstyle()},addItem:function(){var e={Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50};t(l.Items.length,e),l.Items.push(e),c("Items")},toggleTxt:function(){a.css("display",1==l.Txt?"":"none"),r.save()},unMount:function(){a.unMount(),e.find(".name-1, name-2").unMount()}})}},app.mods.socialEdit=function(w){var e=new Image,a=new Image;e.src="/img/instagramdark.png",a.src="/img/instagramhover.png";var k=$("#tmp-edit-social").html(),x=function(e,a,t,n,o,i,s,r){a.toggleClass("active",!!e.FacebookUrl),t.toggleClass("active",!!e.TwitterUrl),n.toggleClass("active",!!e.LinkedInUrl),o.toggleClass("active",!!e.PinterestUrl),i.toggleClass("active",!!e.YoutubeUrl),s.toggleClass("active",!!e.InstagramUrl),r.toggleClass("active",!!e.CustomUrl)},P=function(e,a,t,n,o,i,s,r){a.closest(".field-items").toggleClass("active",!!e.FacebookUrl),t.closest(".field-items").toggleClass("active",!!e.TwitterUrl),n.closest(".field-items").toggleClass("active",!!e.LinkedInUrl),o.closest(".field-items").toggleClass("active",!!e.PinterestUrl),i.closest(".field-items").toggleClass("active",!!e.YoutubeUrl),s.closest(".field-items").toggleClass("active",!!e.InstagramUrl),r.closest(".field-items").toggleClass("active",!!e.CustomUrl)};return function(t){var n=t.Data,e=$(k).css("text-align",n.Align),a=e.find(".social-info-box"),o=e.find(".social-info"),i=o.find(".edit-btn"),s=a.find(".social-info-close"),r=a.find(".facebook input, .twitter input, .linkedin input, .pinterest input, .youtube input, .instagram input, .custom-link input"),l=a.find(".facebook input"),d=a.find(".twitter input"),c=a.find(".linkedin input"),u=a.find(".pinterest input"),m=a.find(".youtube input"),p=a.find(".instagram input"),f=a.find(".custom-link input"),h=o.find(".facebook"),g=o.find(".twitter"),v=o.find(".linkedin"),b=o.find(".pinterest"),T=o.find(".youtube"),y=o.find(".instagram"),C=o.find(".custom");return x(n,h,g,v,b,T,y,C),P(n,l,d,c,u,m,p,f),l.val(n.FacebookUrl),d.val(n.TwitterUrl),c.val(n.LinkedInUrl),u.val(n.PinterestUrl),m.val(n.YoutubeUrl),p.val(n.InstagramUrl),f.val(n.CustomUrl),r.on("blur",function(){var e=$(this),a=$(this).data("name");n[a]=e.val(),x(n,h,g,v,b,T,y,C),P(n,l,d,c,u,m,p,f),t.save()}),s.add(i).on("click",function(){return $(".top-comp").removeClass("top-comp"),e.closest(".module").toggleClass("no-resize"),e.closest(".module-container").toggleClass("top-comp"),e.closest(".edit-div").toggleClass("top-comp"),a.slideToggle(150),$(".social-info-box").not(a).hide(),!1}),e.click(function(){return!1}),w.editBase(t,{}),{$node:e,align:function(){e.css("text-align",n.Align)}}}},app.mods.tagEdit=function(d){var t=$("#tmp-edit-tag").html(),c=$("#tmp-edit-tag-item").html();return function(i){var s=i.Data,e=$(t),r=e.find(".tag-container").css("text-align",s.Align);function l(e){d.appHub.sync(i,e,s[e])}s.Theme=s.Theme||"#F2F2F3";var a=function(e,a){var t=$(c),n=t.find(".tag-inner"),o=t.find(".tag-close");n.editor(i,a,"Name",{index:e,allowEnter:!1}),r.append(t),o.on("click",function(){n.unMount(),t.remove(),d.utility.removeFromList(s.Items,a),l("Items"),i.save()})};return $.each(s.Items,a),d.editBase(i,{$items:r,itemVal:function(e,a){},align:function(){r.css("text-align",s.Align)},addItem:a}),{$node:e,addItem:function(){var e={Name:"<p>Tag</p>"};a(s.Items.push(e)-1,e),l("Items")},align:function(){r.css("text-align",s.Align)},unMount:function(){r.find(".tag-inner").unMount()}}}},app.mods.vertBarEdit=function(y,s){var l=$("#tmp-edit-vert-bar").html(),C=$("#tmp-edit-vert-bar-row").html();return function(d){var u,m=d.Data,a=$(l),t=a.find(".title").css("display",1==m.Txt?"":"none"),p=a.find(".pairs"),e=a.find(".y-axis-max"),n=a.find(".vert-line-chart-container"),o=app.charts.lineChart(),f="show-num-error",r="show-max-error";function h(e,a,t){var o,n=(u=e.closest(".vert-bar-module")).find(".y-axis-max"),i=n.find(".fr-element"),s=n.attr("oldyaxismax");console.log("$yAxisMaxLocal ",n,n.attr("oldyaxismax")),void 0===a?a=i.text():i.text(a),console.log("oldYMax ",s," newYMax ",a),function(){for(var e,a=0,t=0;t<m.Items.length;t++)e=parseInt(m.Items[t].Val),a=a<e?e:a;return a}()<=parseInt(a)?(console.log("y-axis-max changed"),o=a,console.log("updateItems ",o),$.each(m.Items,function(e,a){var t=Math.ceil(a.Val/o*100);a.Height=t.toString();var n=u.find(".slider-outer").eq(e);n.find(".slider-bar").css("height",t+"%"),b(n.find(".slider-tooltip"),t,o)}),T("Items"),v(r),m.yAxisMax=a.toString(),n.attr("oldyaxismax",a),!0===t&&T("yAxisMax",s)):(g(r),i.text(s))}function g(e){u.find(".invalid-100").removeClass(f+" "+r+" hidden").addClass(e)}function v(e){var a=u.find(".invalid-100");a.removeClass(e),!1===a.hasClass(f)&&!1===a.hasClass(r)&&a.addClass("hidden")}function b(e,a,t,n){t=void 0===t?m.yAxisMax:t,void 0===n&&(n=parseInt(t*a/100)),e.css("bottom",parseFloat(a)+5.5+"%");var o=e.find(".slider-val");o.attr("oldval",n),o.find(".fr-element").text(n)}function T(e,a){if("yAxisMax"===e)var t,n=(t=new diff_match_patch).patch_make(m[e],t.diff_main(a,m[e],!0));else n=m[e];y.appHub.sync(d,e,n)}a.addClass("graph-type-"+m.graphType),t.editor(d,m,"Title",{allowEnter:!0}),e.attr("oldyaxismax",m.yAxisMax),console.log("oldyaxismax ",e.attr("oldyaxismax")),e.editor(d,m,"yAxisMax",{allowEnter:!1,noHtml:!0,changed:function(e){h(e.$el)}});var i=function(e,c){var a=$(C),t=a.find(".name"),n=a.find(".slider-container"),o=a.find(".slider-tooltip"),i=a.find(".slider-tooltip-name"),s=a.find(".slider-val"),r=a.find(".item-close-btn"),l=m.yAxisMax;t.editor(d,c,"Name",{index:e,cleanPTags:!0,allowEnter:!1,noHtml:!0,changed:function(){i.html(t.html()),T("Items")}}),i.editor(d,c,"Name",{index:e,cleanPTags:!0,allowEnter:!1,noHtml:!0,changed:function(){t.html(i.html()),T("Items")}}),s.attr("oldval",c.Val),s.editor(d,c,"Val",{index:e,allowEnter:!1,noHtml:!0,changed:function(e){console.log("$tooltipVal changed ",e);var a=e.$el,t=a.closest(".slider-val");u=a.closest(".vert-bar-module");var n,o,i,s,r=parseInt(a.text()),l=t.attr("oldval");if(r<0&&(a.text("0"),t.attr("oldval","0"),r=0),isNaN(r))a.text(l),g(f);else if(r>m.yAxisMax)h(a,r,!0),v(f);else{v(f);var d=parseFloat(100*r/m.yAxisMax).toFixed(2);c.Val=r.toString(),c.Height=d.toString(),n=a.closest(".slider-inner"),o=d,i=m.yAxisMax,s=r.toString(),n.find(".slider-bar").css("height",o+"%"),b(n.find(".slider-tooltip"),o,i,s),T("Items")}}}),n.percentVertSlider({obj:c,setTooltipPosVal:b,yAxisMax:l,sync:T}),r.on("click",function(){y.utility.removeFromList(m.Items,c),t.unMount(),a.remove(),T("Items")}),p.append(a),b(o,c.Height)};return $.each(m.Items,function(e,a){i(e,a)}),o.init(n,m.Items,m.Theme),s(d,i,p,t),{$node:a,addItem:function(){var e={Name:"<p>Bar "+(m.Items.length+1)+"</p>",Val:50,Height:50};i(m.Items.length,e,m.yAxisMax),m.Items.push(e),o.reRenderLineChart(m.Items)},changeTheme:function(e){console.log("changeTheme ",e),t.unstyle()},toggleTxt:function(){t.css("display",1==m.Txt?"":"none")},unMount:function(){t.unMount(),a.find(".name").unMount()},applyStyle:function(e,a){o.reColor(e)},changeGraphType:function(e){m.graphType=e,a.removeClass("graph-type-Bar graph-type-Line").addClass("graph-type-"+e),"Line"===e&&o.reRenderLineChart(m.Items),T("graphType")}}}},app.mods.videosEdit=function(v,b,T,y){var C=v.appHub,n=$("#tmp-edit-videos").html(),w=$("#tmp-edit-video-item").html();return function(d){var c,u,m,p,f=d.Data,e=$(n),a=e.find(".title").css("display",1==f.Txt?"":"none"),h=e.find(".video-outer").css("text-align",f.Align);function g(){if(c){$("body").removeClass("disable-select");var e=h.width();h.height();c.width=Math.round(100*u.width()/e),c.height=u.height(),u.css("width",c.width+"%"),c=null,C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag}),u.removeClass("video-disable")}}function t(e,t){var a=$(w),n=a.find(".edit-btn"),o=a.find(".link-btn"),i=a.find(".embed-btn"),s=a.find(".logo-resize-handle"),r=a.find(".close-btn"),l=a.find(".fr-video");a.css("width","100%"),r.on("click",function(){v.utility.removeFromList(f.Items,t),d.save(),C.sync(d,"Items",f.Items),a.remove(),T.activatePreview({modId:d.Tag})}),s.on("mousedown touchstart",function(e){t.$videoContainer=a,c=t,p=(u=a).width(),a.height(),m=e.clientX,e.clientY,$("body").addClass("disable-select")}),n.uploader({module:d,custom:"videoMod",success:function(e){var a=e.Message;t.VideoUrl=a,l.html(b(a)),C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag})}}),o.click(function(){v.popup.message({input:t.VideoUrl||" ",enterAsOK:!0,emptyError:"Please provide a valid URL.",heading:"Enter Video Url",cancelText:"Cancel",handleOK:function(e){0<e.length?l.html(b(e)):l.html(""),t.VideoUrl=e,t.EmbedCode=" ",d.VideoUrl=e,d.EmbedCode=" ",t.VideoUrl&&h.find(".video-inner").css({"background-image":""}),C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag}),h.find(".loading-animation").show(),setTimeout(function(){h.find(".loading-animation").hide()},3e3),g()}})}),i.click(function(){v.popup.message({input:t.EmbedCode||" ",enterAsOK:!0,emptyError:"Please provide a valid embed code.",heading:"Enter Video Embed Code",cancelText:"Cancel",handleOK:function(e){var a=e.replace(/<\/?(?!iframe)\w*\b[^>]*>/gi,"");0<e.length?l.html(a):l.html(""),t.EmbedCode=a,t.VideoUrl=" ",d.EmbedCode=a,d.VideoUrl=" ",t.EmbedCode&&h.find(".video-inner").css({"background-image":""}),C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag}),h.find(".loading-animation").show(),setTimeout(function(){h.find(".loading-animation").hide()},3e3),g()}})}),l.html(b(t.VideoUrl)),(t.VideoUrl||t.EmbedCode)&&h.find(".video-inner").css({"background-image":""}),a.css("width",t.width+"%"),h.append(a),h.find(".loading-animation").html(y.spinner),setTimeout(function(){T.activatePreview({modId:d.Tag})},1e3),setTimeout(function(){h.find(".loading-animation").hide()},3e3)}return a.editor(d,f,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",g),$(document).on("touchmove mousemove",function(e){if(c){u.addClass("video-disable");var a=h.width(),t=Math.max(50,Math.min(a,p+e.clientX-m));u.css("width",t+"px")}}),$.each(f.Items,t),v.editBase(d,{addItem:t,$items:h,itemVal:function(e,a){h.find("> div:eq("+e+")").css({width:a.width+"%"}),a.VideoUrl&&h.find(".video-inner").css({"background-image":""}),d.Data.Items[e].VideoUrl!=a.VideoUrl&&(h.find(".loading-animation").show(),setTimeout(function(){h.find(".loading-animation").hide()},3e3),h.find("> div:eq("+e+")").find(".fr-video").html(b(a.VideoUrl))),T.activatePreview({modId:d.Tag})},align:function(){h.css("text-align",f.Align),T.activatePreview({modId:d.Tag})},txt:function(){a.css("display",1==f.Txt?"":"none"),T.activatePreview({modId:d.Tag})},theme:function(){a.unstyle(),T.activatePreview({modId:d.Tag})}}),{$node:e,changeTheme:function(e){a.unstyle(),T.activatePreview({modId:d.Tag})},align:function(){h.css("text-align",f.Align),T.activatePreview({modId:d.Tag})},toggleTxt:function(){a.css("display",1==f.Txt?"":"none"),T.activatePreview({modId:d.Tag})},unMount:function(){a.unMount(),T.activatePreview({modId:d.Tag})}}}},app.mods.barPreview=function(e){var i=$("#tmp-prev-bar").html(),s=$("#tmp-prev-bar-row").html();return function(e){var a=$(i),t=a.find(".title"),n=a.find(".pairs"),o=e.Data;return e.renderPreview=function(){t.html(o.Title).css("display",1==o.Txt?"":"none"),n.empty(),$.each(o.Items,function(e,a){var t=$(s);t.find(".name").html(a.Name),t.find(".slider-bar").css({width:Math.ceil(a.Val)+"%"}),n.append(t)})},{$node:a}}},app.mods.canvasPreview=function(o){var i=$("#tmp-prev-canvas").html();return function(e){var t=e.Data,a=$(i),n=a.find(".mods-inner");return e.renderPreview=function(){n.empty();for(var e=0;e<t.Arr.length;e++){var a=$("<div>").attr("class","col col-sm-"+t.Arr[e]);n.append(a)}$.each(t.Mods,function(e,a){var t=o.modManager.getModule(a.Tag);t&&(n.find(".col:eq("+a.Col+")").insertAt(a.Row,t.$previewNode),o.renderPreview(t))})},{$node:a}}},app.mods.dataCollectionPreview=function(s){var r=$("#tmp-prev-dc").html(),l=$("#spinner-container > .loading-animation");return function(a){var e=$(r),t=l.clone().addClass("small").hide(),n=e.find(".msg"),o=e.find(".dc-join-us"),i=e.find(".dc-email-input");return o.prepend(t),o.on("click",function(){var e=i.val();e&&validator.isEmail(e)?(o.prop("disabled",!0),i.removeClass("email-invalid"),t.show(),s.apiHelper.saveModuleRecord({moduleId:a.ID,dataObj:{email:e},success:function(){t.hide(),i.val(""),o.text("Submitted")},error:function(){t.hide(),o.text("Error. Try again."),o.prop("disabled",!1),setTimeout(function(){o.text(a.Data.ButtonText)},3e3)}})):i.addClass("email-invalid")}),a.renderPreview=function(){n.html(a.Data.Message);var e=$("<div></div>").html(a.Data.ButtonText).text();o.text(e)},{$node:e}}},app.mods.donutPreview=function(d,c){var u=$("#tmp-prev-donut-main").html(),m=$("#tmp-prev-donut-row").html();return function(n){var e=n.Data,a=e.Items,t=$(u),o=t.find(".title"),i=t.find(".donut-pie-container"),s=t.find(".donut-label"),r=t.find(".donut-breakup"),l=$.extend({$node:t,parentPage:d.pageManager.pages.home,$pieDiv:i,$breakup:r,module:n},c);return n.renderPreview=function(){o.html(e.Title),s.html(e.Label),r.empty(),$.each(a,function(e,a){var t=$(m);t.find(".value").html(a.Val),t.find(".color").css("background-color",n.colorFunc(e)),r.append(t)}),l.drawPie()},l}},app.mods.imagesPreview=function(e){var o=$("#tmp-prev-images").html(),r="loading"in HTMLImageElement.prototype;return function(e){var a=$(o),t=e.Data,n=a.find(".title"),s=a.find(".image-outer");return e.renderPreview=function(){n.html(t.Html).css("display",1==t.Txt?"":"none"),s.empty().css("text-align",t.Align),$.each(t.Items,function(e,a){if(a){var t=a.Url&&a.Url.toString().replace("&amp;","&"),n=$("#tmp-export").hasClass("show")?"src":r?'loading="lazy" src':'class="lazyload" data-src',o='<div class="image-inner"><img '.concat(n,'="').concat(t,'" /></div>');a.link&&0<a.link.toString().length&&"http://"!==a.link&&(o='<div class="image-inner"><a href="'.concat(a.link,'" target="_blank"><img ').concat(n,'="').concat(t,'" /></a></div>'));var i=$(o);i.css({width:Math.min(100,a.Val||33)+"%"}),s.append(i)}})},{$node:a}}},app.mods.scalePreview=function(e){var i=$("#tmp-prev-scale").html(),s=$("#tmp-prev-scale-row").html();return function(e){var a=e.Data,t=$(i),n=t.find(".title"),o=t.find(".pairs");return e.renderPreview=function(){n.html(a.Title).css("display",1==a.Txt?"":"none"),o.empty(),$.each(a.Items,function(e,a){var t=$(s);t.find(".name-1").html(a.Name1),t.find(".name-2").html(a.Name2),t.find(".slider-bar").css({left:Math.round(a.Val)+"%"}),o.append(t)})},{$node:t}}},app.mods.socialPreview=function(e){var o=$("#tmp-prev-social").html();return function(e){var a=e.Data,t=$(o),n=t.find(".social-info-static");return e.renderPreview=function(){if(t.find(".header-container .header").html(a.Header),t.css("text-align",a.Align).addClass("module"),n.empty(),a.FacebookUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.FacebookUrl)||(a.FacebookUrl="https://"+a.FacebookUrl),n.append('<a target="_blank" class="facebook active" href="'+a.FacebookUrl+'"><i class="icon-SocialFacebook"></i></a>')),a.TwitterUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.TwitterUrl)||(a.TwitterUrl="https://"+a.TwitterUrl),n.append('<a target="_blank" class="twitter active" href="'+a.TwitterUrl+'"><i class="icon-SocialTwitter"></i></a>')),a.LinkedInUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.LinkedInUrl)||(a.LinkedInUrl="https://"+a.LinkedInUrl),n.append('<a target="_blank" class="linkedin active" href="'+a.LinkedInUrl+'"><i class="icon-SocialLinkedin"></i></a>')),a.PinterestUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.PinterestUrl)||(a.PinterestUrl="https://"+a.PinterestUrl),n.append('<a target="_blank" class="pinterest active" href="'+a.PinterestUrl+'"><i class="icon-SocialPinterest"></i></a>')),a.YoutubeUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.YoutubeUrl)||(a.YoutubeUrl="https://"+a.YoutubeUrl),n.append('<a target="_blank" class="youtube active" href="'+a.YoutubeUrl+'"><i class="icon-SocialYoutube"></i></a>')),a.InstagramUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.InstagramUrl)||(a.InstagramUrl="https://"+a.InstagramUrl),n.append('<a target="_blank" class="instagram active" href="'+a.InstagramUrl+'"><i class="img-instagram"></i></a>')),a.CustomUrl){var e=$.trim(a.CustomUrl);a.CustomUrl.indexOf("http")<0&&(e="https://"+e),n.append('<a target="_blank" class="custom active" href="'+e+'"><i class="icon-SocialLink"></i></a>')}},{$node:t}}},app.mods.tagPreview=function(e){var o=$("#tmp-prev-tag").html(),i=$("#tmp-prev-tag-item").html();return function(e){var a=$(o),n=a.find(".tag-container"),t=e.Data;return e.renderPreview=function(){n.empty().css("text-align",t.Align),$.each(t.Items,function(e,a){var t=$(i);t.find(".tag-inner").html(a.Name),n.append(t)})},{$node:a}}},app.mods.vertBarPreview=function(e){var l=$("#tmp-prev-vert-bar").html(),d=$("#tmp-prev-vert-bar-row").html();return function(e){var a=$(l),t=a.find(".title"),n=a.find(".pairs"),o=a.find(".y-axis-max"),i=a.find(".vert-line-chart-container"),s=e.Data,r=app.charts.lineChart();return e.renderPreview=function(){a.removeClass("graph-type-Bar graph-type-Line").addClass("graph-type-"+s.graphType),t.html(s.Title).css("display",1==s.Txt?"":"none"),o.text(s.yAxisMax),n.empty(),$.each(s.Items,function(e,a){var t=$(d);t.find(".name").html(a.Name),t.find(".slider-bar").css({height:parseFloat(a.Height)+"%"}),t.find(".slider-tooltip").css({bottom:parseFloat(a.Height)+5.5+"%"}),t.find(".slider-tooltip-name").html(a.Name),t.find(".slider-val").text(a.Val),n.append(t)}),i.find("svg").empty(),r.init(i,s.Items,s.Theme)},{$node:a}}},app.mods.videosPreview=function(e,i){var s=$("#tmp-prev-videos").html(),r=$("#tmp-edit-video-item").html();return function(e){var a=$(s),t=e.Data,n=a.find(".title"),o=a.find(".video-outer");return e.renderPreview=function(){n.html(t.Html).css("display",1==t.Txt?"":"none"),o.empty().css("text-align",t.Align),$.each(t.Items,function(e,a){var t=$(r);t.removeClass("edit"),t.find(".edit-btn").remove(),t.find(".link-btn").remove(),t.find(".embed-btn").remove(),t.find(".logo-resize-handle").remove(),t.find(".loading-animation").remove(),t.find(".close-btn").remove();var n=t.find(".fr-video");t.css("width",a.width+"%"),a.VideoUrl&&" "!==a.VideoUrl?n.html(i(a.VideoUrl)):a.EmbedCode&&" "!==a.EmbedCode&&n.html(a.EmbedCode),o.append(t),console.log("preview",e,a)})},{$node:a}}},app.popup.getAddModule=function(d,a,c,u,m,p,o){app.wType;var i,f,t=$("#tmp-add-module-popup"),n=(t.find("input"),t.find("h1")),e=t.find(".icon-Close"),s=t.find(".addModule-moduleblock"),r=t.find(".addModule-canvasblock"),l=(t.find(".addModule-importblock"),t.find(".addModule-eachfoliocont"),t.find("#addModule-select-folio-dropdown")),h=t.find("#addModule-select-folio-dropdown  li"),g=t.find("#addModule-select-folio-dropdown .addModule-textholder"),v=t.find(".tabs span"),b=t.find(".paper"),T=$("#tmp-new-mod-req"),y=$("#tmp-add-mod-item").html(),C="app.xtensio.tech"==location.hostname?1:0,w=!1,k=c.token,x=function(){var e=o.getModuleCount(),a=$(this);if(console.log("getModuleCount",e),80<=e){if(0===c.Team.ST)return void m.showFreeModuleBlocker(d,80);S(function(){return P(a)})}else P(a)};function P(e){var a=e.data("item");f(a.name),d.close()}function S(e){w?e():(w=!0,d.message({heading:"Your Folio Is Getting Too Big",message:"Please consider dividing your work into multiple folios.",btnText:"Ok",enterAsOK:!0,notMini:!0,bodyCentered:!0,handleOK:function(){e()}}))}function D(e){var i,s=[],r=[],l={};a.templateMods({name:e.template,token:k,success:function(o){setTimeout(function(){if(console.log("templateMods response",o),console.log("config.setNewBlankCanvas",c.setNewBlankCanvas),!1!==c.setNewBlankCanvas){_.remove(o.Data,function(e){return"Text"===e.Type});var e=o.Data.length-1,a=JSON.parse(o.Data[e].Data);a.Mods=[],o.Data[e].Data=JSON.stringify(a)}console.log("res.Data",o.Data),$.each(o.Data,function(e,a){if(a.Data=JSON.parse(a.Data),"DataModule"==a.Type)s=a.Data.Sections[0].ModIds;else if(-1<s.indexOf(a.Tag)){if(r.push(a),a.Store){var t=JSON.parse(a.Store).style;if(C&&console.log(t),t!=i){$("#folio-style").append(t),i=t;var n=u.get("style")||"";n=-1<n.indexOf(t)?n:n+t,u.set("style",n)}}}else l[a.Tag]=a;e==o.Data.length-1&&$.each(r,function(e,a){a.Data.Mods&&$.each(a.Data.Mods,function(e,a){var t=l[a.Tag];a.Type=t.Type,a.Data=t.Data}),a.New=!0,f(a.Type,a)}),app.editor.addWatermark(c,d,m),void 0!==c.setNewBlankCanvas&&!1!==c.setNewBlankCanvas&&setTimeout(function(){var e=c.setNewBlankCanvas.key;p.generateEmptyCanvasModule($("#ed-_"+e),$("#pr_"+e)),c.setNewBlankCanvas=!1},100)})},100)},error:function(e){d.error(e.Message)}}),d.close()}var F=function(t,e,n){t.empty(),$.each(e,function(e,a){(i=$(y)).data("item",a),a.isNew&&i.append("<div class='new-label'>New</div>"),a.img&&i.find("i").addClass(a.img),"Videos"==a.name&&(i.prepend('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.55 27.68"><defs><style>.cls-av-1{fill:none;stroke-width: 0;}.cls-av-1,.cls-av-2{fill-rule:evenodd;}.cls-av-2{fill:#fff;}</style></defs><title>0Asset 36</title><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-av-1" d="M0,26.42c0,1.1.79,1.57,1.75,1L24.83,14.8c1-.53,1-1.39,0-1.92L1.75.22C.79-.31,0,.16,0,1.26Z"/><polygon class="cls-av-2" points="2.24 24.81 22.24 13.84 2.24 2.87 2.24 24.81"/></g></g></svg>'),i.find("i").remove()),i.find("p").text(a.text),i.click(n).addClass(e<4?"r-1":"").addClass(3==e||7==e?"c-last":""),t.append(i)})},I=[{name:"Text",text:"Text",img:"text"},{name:"Images",text:"Image",img:"img"},{name:"Videos",text:"Video",img:"img"},{name:"DonutChart",text:"Pie Chart",img:"pie"},{name:"Scale",text:"Scale Chart",img:"scale"},{name:"Bar",text:"Bar Graph",img:"bar"},{name:"Tag",text:"Tags",img:"tags"},{name:"DataCollection",text:"Email Form",img:"form"},{name:"Social",text:"Social",img:"social"},{name:"RowBreak",text:"Row Break",img:"row"}],M=[{name:"Canvas",text:"Canvas",img:"canvas",template:"blank-canvas"}].concat(I);F(s,I,x),F(r,[{name:"Persona",text:"Persona",img:"persona",template:"user-persona"},{name:"Business",text:"Business Canvas",img:"canvas",template:"business-model-canvas"},{name:"Lean",text:"Lean Canvas",img:"canvas",template:"lean-canvas"},{name:"SWOT",text:"SWOT Analysis",img:"swot",template:"swot-analysis"},{name:"Canvas",text:"Canvas",img:"canvas",template:"blank-canvas"}],function(){var e=$(this).data("item");if(e.template){var a=0,t=o.getModuleCount();switch(e.template){case"user-persona":a=14;break;case"business-model-canvas":a=23;break;case"swot-analysis":a=6;break;case"lean-canvas":a=15;break;default:a=1}if(80<(t+=a)){if(0===c.Team.ST)return void m.showFreeModuleBlocker(d,80);S(function(){return D(e)})}else D(e)}else{var n={Tag:0,New:!0,Type:"Canvas",Data:{BgColor:"rgba(0,0,0,0)",Cols:"12",Type:"Canvas",Mods:[{Col:0,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 1</h3><p>Just like the rest of your folio, you can add and remove modules to your canvas, drag them in and out.</p>',Head:2}},{Col:1,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 2</h3><p>You can even change the number of columns and adjust their widths.</p>',Head:2}},{Col:2,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 3</h3><p>Changing the color scheme updates all modules within this canvas.</p>',Head:2}}]}};f(e.name,n),d.close()}}),t.find(".addModule-canvasblock .block").last().hide(),s.append(T);var E=function(e){b.add(v).removeClass("selected"),v.filter(":eq("+e+")").addClass("selected"),b.filter(":eq("+e+")").addClass("selected")};return v.click(function(){E($(this).index())}),l.click(function(){$(this).toggleClass("active")}),h.click(function(){g.text($(this).text())}),d.reg(t,e),function(e,a){f=e,F(s,a?I:M,x),s.append(T),a?(E(0),v.css("visibility","hidden"),n.text("Add Module")):(n.text("Add"),v.css("visibility","")),d.show(t)}},app.popup.getBgImageAdjust=function(n){var o,r,l,a,d,c,u,m,p,f,h,g,i=$("#tmp-popup-bg-image-adjust"),e=i.find(".cancel, .popup-close.icon-Close"),s=(i.find(".loading-animation").html(n.spinner),i.find(".bg-image-wrap"),i.find(".bg-image-to-adjust")),t=i.find(".set-bg"),v=i.find(".set-bg-cancel");function b(e){if(0<parseInt(e.w)){var a=d/e.w,t=c/e.h,n=Math.round(a*e.x*(f/d)),o=Math.round(t*e.y*(h/c)),i=Math.round(a*f),s=Math.round(i/p);g={backgroundPositionX:100*n/(i-f)+"%",backgroundPositionY:100*o/(s-h)+"%",backgroundSize:"cover"}}}return s.on("load",function(){void 0!==a&&a.destroy&&a.destroy();var e=$(this);e.css("height","auto"),l=f/h,u=e.width(),m=e.height(),p=u/m,s.Jcrop({setSelect:function(){if(d=u,c=Math.round(u/l),"none"==r.css("backgroundImage"))return[0,0,d,c];var e=Math.round(parseFloat(r.css("backgroundSize"))),a=Math.round(parseFloat(r.css("backgroundPositionX"))),t=Math.round(parseFloat(r.css("backgroundPositionY")));Math.round(f*e/100),Math.round(h*e/100);var n=Math.round(100*u/e),o=Math.round(n/l),i=Math.round((u-n)*a/100),s=Math.round((m-o)*t/100);return[i,s,Math.round(i+n),Math.round(s+o)]}(),aspectRatio:l,onChange:b,onSelect:b},function(){a=this})}),t.click(function(){o(g),s.attr("src",""),a.destroy()}),v.click(function(){s.attr("src",""),a.destroy(),n.close()}),n.reg(i,e),function(e,a,t){o="function"==typeof t?t:function(){},f=(r=e).width(),h=r.height(),s.attr("src",a),n.show(i)}},app.popup.getExpOption=function(s,e,r){var l,d=$("#tmp-exp-option"),a=d.find(".ok"),c=d.find(".scale"),u=d.find(".page-margin"),m=d.find(".sec-margin"),p=d.find(".mod-margin"),f=d.find(".msg");return a.on("click",function(){var e,a,t,n,o=0,i=l.expOpt;if(e=c.val(),a=u.val(),t=m.val(),n=p.val(),d.find(".error").removeClass("error"),validator.isInt(a)||(u.addClass("error"),o=1),validator.isInt(t)||(m.addClass("error"),o=1),validator.isInt(n)||(p.addClass("error"),o=1),f.toggleClass("error",0<o),o)return!1;i.Scale=e,i.Margin=a,i.SecMargin=t,i.ModMargin=n,r.set("exp-opt-"+l.Token,JSON.stringify(i)),s.close()}),s.reg(d,d.find(".icon-Close, .no")),function(e){l=e;var a={Scale:1,Margin:15,SecMargin:12,ModMargin:12},t=r.get("exp-opt-"+l.Token);if(t)try{a=JSON.parse(t)}catch(e){}l.expOpt=a,c.val(a.Scale),u.val(a.Margin),m.val(a.SecMargin),p.val(a.ModMargin),s.show(d)}},app.popup.getExport=function(u,m,e,p,n,a){var f,h,g,v,i,b,T,y,C,w,k=$("#tmp-export"),t=k.find(".popup-header"),o=t.find("h1"),s=t.find(".tabs").find("span"),r=s.filter(".pdf"),l=s.filter(".png"),d=k.find(".js-pdf"),x=k.find(".x-select"),c=k.find(".no, .icon-Close"),P=k.find(".yes"),S=k.find(".cta-btns"),D=k.find(".loading-animation").html(m.spinner),F=k.find(".exp-option"),I=k.find(".png-msg"),M=k.find(".pdf-msg"),E=k.find(".gen-msg"),U=$("#pdf-col"),N=$("#thumb-col"),A=k.find(".popup-header-note"),L=k.find(".popup-header-free"),O=$(".thumbnail-controls"),R=$(".thumbnail-container"),B=k.find(".spinner-cont"),Y=k.find(".png-spinner"),_=k.find(".break .sec"),G=k.find(".break .cimg"),H=k.find(".break .rb"),z=k.find(".break .autofill"),q=0,K=0,j=!0,V=!1,J=!0;function W(){P.find(".fa, i").remove(),P.append('<i class="fa fa-lock"></i>')}function X(){j=!(V=!(i=!0)),u.Team&&0<u.Team.Id?0!==u.Team.ST&&34!==u.Team.ST||(V=!0):a.getData(1,function(e,a,t,n){0!==e.ST&&34!==e.ST||(V=!0)}),V&&u.exportLimits&&(w=u.exportLimits.LimitsImposed),console.log("isUserFree",V),console.log("allowed",j),V&&ie()}function Q(){m.payment(),$("#tmp-payment").css("opacity",0),setTimeout(function(){$("#tmp-payment .btn-credits, .btn-creds").trigger("click"),setTimeout(function(){$("#tmp-payment").css("opacity",1)},200)},1e3)}n.addListener("plusUnlocked",function(){X()}),n.addListener("plusCancelled",function(){X()}),s.click(function(){i||(h.format=$(this).hasClass("png")?"PNG":"PDF",ee())}),F.click(function(){m.push(k),m.expOption(f)});O.find(".arr-left").on("click",function(e){e.preventDefault(),$(".carousel").carousel("prev"),Z()}),O.find(".arr-right").on("click",function(e){e.preventDefault(),$(".carousel").carousel("next"),Z()});var Z=function(){q=R.find(".active").index()+1,O.find("#thumb-counter").text(q+" / "+K)},ee=function(){if(console.log("ExportPreviewEnabled",u.ExportPreviewEnabled),console.log("ExportPreviewInitialLoadEnabled",u.ExportPreviewInitialLoadEnabled),console.log(_typeof(u.ExportPreviewInitialLoadEnabled)),console.log("ExportPreviewSaveToBlobEnabled",u.ExportPreviewSaveToBlobEnabled),J&&u.ExportPreviewEnabled&&(h.format="PDF",h.mode="screen",h.orient="landscape",i=!0,u.ExportPreviewInitialLoadEnabled&&setTimeout(function(){P.click()},500),J=!1),h.format=h.format||"PDF",h.paper=h.paper||"612x792",P.removeAttr("target"),s.removeClass("selected"),R.removeClass("cont-landscape"),O.hide(),M.hide(),I.hide(),E.hide(),oe(),k.find(".paper").hasClass("hide-cancel")||(u.ExportPreviewEnabled?P.attr("href","#").removeClass("download").find("span").html("Preview and Export "+h.format):P.attr("href","#").removeClass("download").find("span").html("Export "+h.format)),o.text("Export "+h.format),g.target?k.find(".break").hide():k.find(".break").show(),"PNG"==h.format){R.hide(),l.addClass("selected"),d.hide();var e="<div class='thumbnail-container'><div class='img'><img src='/img/thumb-placeholder.jpg' class='placeholder' /> </div></div>";e+="Export your "+(g.target||"folio")+" as a single PNG",I.html(e).show()}else h.orient=h.orient||"landscape",d.show(),r.addClass("selected"),k.find(".selection, .select, .radio").removeClass("selected"),k.find(".for-"+(h.mode||"screen")).addClass("selected").find(".change-mode").addClass("selected"),_.addClass(h.sec?"selected":""),H.addClass(h.rb?"selected":""),G.addClass(h.cimg?"selected":""),z.addClass(h.autofill?"selected":""),k.find('.radio[data-val="'+(h.orient||"landscape")+'"]').addClass("selected"),console.log("settings data",h),setTimeout(function(){h.autofill?(H.removeClass("disable-op"),G.addClass("disable-op")):h.sec&&(H.addClass("disable-op"),G.removeClass("disable-op"))},10),function(e){k.find(".x-select span"),k.find(".x-select .item").removeClass("active");var a=k.find('.x-select .item[data-value="'+e+'"]').addClass("active").text();k.find(".x-select .text").text(a)}(h.paper||"612x792"),u.ExportPreviewEnabled?(R.show(),N.show(),U.removeClass("do-full"),M.html("Click the Preview and Export button to generate preview").show(),h.mode&&"screen"!==h.mode?(x.removeClass("disable-select"),"landscape"===h.orient?(R.html('<div class="img"><img src="/img/thumb-placeholder_landscape.jpg" class="placeholder" /></div>'),R.addClass("cont-landscape"),B.find(".loader").addClass("landscape")):(R.html('<div class="img"><img src="/img/thumb-placeholder.jpg" class="placeholder" /></div>'),R.removeClass("cont-landscape"),B.find(".loader").removeClass("landscape"))):(R.html('<div class="img"><img src="/img/thumb-placeholder.jpg" class="placeholder" /></div>'),R.removeClass("cont-landscape"),B.find(".loader").removeClass("landscape"),x.addClass("disable-select"))):(N.hide(),U.addClass("do-full"));return!1},ae=function(e,a){$(e).hover(function(e){$(this).stop().animate({scrollTop:$(this).find(a).height()},5e3)},function(e){$(this).stop().animate({scrollTop:0},2e3)})};k.find(".change-mode").on("click",function(){if(!i)return h.mode=$(this).data("mode"),ee()}),k.find(".orientation .radio").on("click",function(){if(!i&&"print"===h.mode)return h.orient=$(this).data("val"),h.mode="print",ee()}),k.find(".break .select").on("click",function(){if(!i&&"print"===h.mode){var e=$(this).data("val");return h[e]=!h[e],h.mode="print",$(this).hasClass("sec")?h.autofill=!h[e]:$(this).hasClass("autofill")&&(h.sec=!h[e]),ee()}}),k.find(".dropdown").on("change",function(){if(!i&&"print"===h.mode)return h.paper=this.value,h.mode="print",ee()}),k.find(".x-select .item").on("click",function(){var e=$(this);if(!i&&"print"===h.mode)return h.paper=e.attr("data-value"),h.mode="print",k.find(".x-select .text").text(e.text()),ee(),!0});var te=function(e){i=!0,S.addClass("disable-btns"),n.raiseEvent("saveBeforeExport",function(){return console.log("save folio on export")}),void 0!==u.teamDefaultColorStyles&&""!==u.teamDefaultColorStyles&&(console.log("implementing team default color"),e=u.teamDefaultColorStyles.toString()+e);if(" opacity: 0 !important; display: none;"," }",e="<style id='watermark' type='text/css'> .watermark-on-free, .watermark-on-free-shared { opacity: 0 !important; display: none; } </style>".toString()+e,console.log("data",h),console.log("settings before processing",v),h&&v&&!v.OnePage&&h.sec&&h.cimg){var a;switch(h.paper){case"612x792":a=v.Landscape?986:1651;break;case"612x1008":a=v.Landscape?849:2101,v.Landscape&&(v.BrowserWidth=1400);break;case"792x1224":a=v.Landscape?1035:2163,v.BrowserWidth=v.Landscape?1600:1400;break;case"842x1190":a=v.Landscape?1132:1979,v.BrowserWidth=v.Landscape?1600:1401;break;case"595x842":a=v.Landscape?884:1805,v.Landscape&&(v.BrowserWidth=1251);break;case"421x595":a=v.Landscape?902:1766;break;default:a=986,console.log("NO PAPER MATCH FOUND!!")}var t=".preview-div { min-height: "+a+"px !important; page-break-after: always !important; } ";e=("<style id='preview-div-h' type='text/css'> "+(t+=".preview-div .section-content { page-break-after: auto !important; }")+" </style>").toString()+e,console.log("applying full image/color page"),console.log("page height: ",a),console.log("settings.BrowserWidth: ",v.BrowserWidth)}console.log("str",e),p.exportFolio({format:h.format,html:e,settings:v,success:function(f){console.log("exportFolio response",f),T=f.Message.replace("/get-export/","");var e=u.ExportPreviewSaveToBlobEnabled?f.Data.exportPreviewThumbPath:"/get-preview-thumbnail/"+T,a=u.ExportPreviewSaveToBlobEnabled?f.Data.exportPreviewPath:"/get-preview/"+T;if(clearTimeout(y),"PDF"===h.format)if(u.ExportPreviewEnabled)if("print"===h.mode){var t=new XMLHttpRequest;t.open("GET",a),t.responseType="arraybuffer",t.onload=function(e){var a=e.target.response,t=UTIF.decode(a);R.html('<div id="carousel-" class="carousel slide" data-ride="carousel"><div class="carousel-inner" role="listbox"></div></div>'),console.log("page count: "+t.length);for(var n=0;n<t.length;n++){UTIF.decodeImage(a,t[n]);var o=UTIF.toRGBA8(t[n]),i=document.createElement("canvas");i.width=t[n].width,i.height=t[n].height;for(var s=i.getContext("2d"),r=s.createImageData(i.width,i.height),l=0;l<o.length;l++)r.data[l]=o[l];s.putImageData(r,0,0);var d=0===n?"item active":"item",c=$("<div />",{class:"img"}).append(i),u=$("<div />",{class:d}).append(c),m=c.find("canvas").width(),p=c.find("canvas").height()*(250/m);u.find("canvas").css({width:"250px",height:p+"px"}),R.find(".carousel-inner").append(u)}$(".carousel").carousel({interval:!1}),1<n&&(O.show(),K=n,q=1,O.find("#thumb-counter").text(q+" / "+K)),M.html("Your "+h.format+" is ready to download."),"landscape"===h.orient&&R.addClass("cont-landscape"),ae(".img","canvas"),ne(f,"",!1)},t.send()}else R.html("<div class='img'><img id='pdfImg' src='"+e+"' /></div>"),M.html("Your "+h.format+" is ready to download."),ae(".img","img"),ne(f,"pdfImg");else{var n="Your "+h.format+" is ready to download.";E.html(n).show(),ne(f),d.hide(),R.hide()}else{n="Preview<br><div class='thumbnail-container'><div class='img'><img id='pngImg' src='"+e+"' /> </div></div>";n+="Your "+h.format+" is ready to download.",I.html(n),ae(".img","img"),ne(f,"pngImg")}},error:function(e){M.text(e.Message),I.text(e.Message),oe(),clearTimeout(y),S.removeClass("disable-btns"),x.removeClass("disable-select")},complete:function(){$("#tmp-power-by-footer").show()}})},ne=function(e,a,t){var n=u.ExportPreviewSaveToBlobEnabled?e.Data.exportPath:e.Message;if(t=void 0===t||t,i=!1,clearTimeout(y),t){var o=$("#"+a);o.prop("complete")?oe():o.on("load",function(){oe()})}else setTimeout(function(){oe()},1e3);S.removeClass("disable-btns"),x.removeClass("disable-select"),P.attr("href",n).addClass("download").find("span").html('<i class="fi-download"></i> Download')},oe=function(){D.hide(),B.hide(),Y.hide()};P.on("click",function(e){if($("#tmp-power-by-footer").hide(),P.hasClass("download")||e.preventDefault(),!j||w&&0===C){var a=" are not allowed to purchase credits. Please contact your team admins for more credits.",t="Exporting as PDF/PNG is a paid feature. Please add credits or upgrade to a subscription plan for unlimited exports.",n="Purchase Export Credits",o="Upgrade",i=!1;u.Team&&0<u.Team.Id&&(2===u.Team.Role?(n=!(i=!0),o="Purchase Export Credits"):3===u.Team.Role?(n=!1,o="Ok",t="Team members"+a):4===u.Team.Role&&(n=!1,o="Ok",t="Premium guests"+a));var s={heading:"Upgrade or add credits",message:t,btnText:o,bodyCentered:!0,notMini:!0};n&&(s.cancelText=n,s.handleNo=function(){Q()}),"Ok"!==o&&(s.handleOK=function(){m.payment("showPlans")}),i&&(s.handleOK=function(){Q()}),m.push(k),m.message(s)}else{if(!P.hasClass("download")){var r=$.extend({paper:"612x792"},h);v=f.expOpt||{},b=v.Scale||1,v.Margin||0;1367<$(window).width()&&$(window).width();if(null==r.paper&&(r.paper="612x792"),"print"==r.mode&&"PDF"==r.format){var l=r.paper.split("x");v.Landscape="landscape"==r.orient,v.Width=l[0],v.Height=l[1],v.Breaks=r.sec?1:0,v.Breaks|=r.pers?2:0,v.Breaks|=r.rb?4:0,v.BrowserWidth=1276*b,v.Landscape||"421x595"!=r.paper||(v.BrowserWidth=1250*b)}else v.OnePage=!0,v.Fit=!0,v.BrowserWidth=1370,v.Width=1367,v.Height=0<g.$el.height()?g.$el.height():0;return v.ExportPreviewEnabled=null!=u.ExportPreviewEnabled&&"not-set"!=u.ExportPreviewEnabled,v.IsFreeUser=V&&!(w&&0<C),console.log(v.IsFreeUser),console.log("settings",v),"PDF"===r.format?u.ExportPreviewEnabled?(M.html("Generating preview. <br>This may take up to a minute...").show(),v.OnePage?B.find(".loader").removeClass("landscape"):"landscape"===r.orient?B.find(".loader").addClass("landscape"):B.find(".loader").removeClass("landscape"),B.show()):D.show():"PNG"===r.format&&Y.show(),u.isTeam&&u.Team.Id?p.getStyleGuides({data:{team_Id:u.Team.Id},success:function(e){v.styleGuide=JSON.parse(e.Data),g.cb(v.BrowserWidth,function(e){v.Height=Math.min(14400,v.Height||Math.round(.75*g.$el.height())),te(e)})}}):g.cb(v.BrowserWidth,function(e){v.Height=Math.min(14400,v.Height||Math.round(.75*g.$el.height())),te(e)}),console.log("export settings",v),d=r.format,c="Still working on it...","PNG"===d&&(c="<div class='thumbnail-container'><div class='img'><img src='/img/thumb-placeholder.jpg' class='placeholder' /> </div></div>",c+="Still working on it..."),y=setTimeout(function(){"PNG"===d?I.html(c):M.html(c)},1e4),x.addClass("disable-select"),!1}setTimeout(function(){T&&u.ExportPreviewSaveToBlobEnabled&&$.post("/ReportExportSuccess/"+T),m.close(k)},300)}var d,c});var ie=function(){i=!0,L.hide(),u.Team&&0<u.Team.Id&&1<u.Team.Role&&u.isTeamOwnerTrailing?(A.show(),A.html("<h3>Exports are not available during trials. <br><br>\t\t\tPlease ask your team admin to start your subscription.</h3>"),W(),P.addClass("disable-btns")):p.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var a=JSON.parse(e.Data),t=f&&f.Role||2;C=a.CreditsLeft,w=a.LimitsImposed,console.log("userFolioRole",t),C<=0&&(j=!1),1<t&&!0===w?(A.show(),se(),0===C&&W()):(k.find(".popup-content").removeClass("remove-top-border"),A.hide(),P.hasClass("download")||P.find("span").html("Preview and Export"))},error:function(e){console.log("error: ",e)},complete:function(){i=!1}})},se=function(){var e=0===C?"PURCHASE EXPORT CREDITS":"PURCHASE MORE EXPORT CREDITS",a=0===C?" to download.":".",t=1===C?"credit":"credits";A.find(".cred-count").text(C+" "+t),u.Team&&0<u.Team.Id?1===u.Team.Role?(A.find("a.purchase-btn").text(e),A.find(".supplement").text(a)):2===u.Team.Role?(A.find("span.txt-or").text(""),A.find(".supplement").text(""),A.find("a.upgrade-btn").remove()):A.find("h3").html("Please contact your team admins for more credits. <p>Each PDF or PNG download requires 1 export credit.</p>"):(A.find("a.purchase-btn").text(e),A.find(".supplement").text(a))};return A.find(".upgrade-btn").click(function(e){e.preventDefault(),m.payment("showPlans")}),A.find(".purchase-btn").click(function(e){e.preventDefault(),Q()}),m.reg(k,c),function(e,a,t){f=e,g=t,(h=a).cimg=!0,h.sec=!0,h.autofill=!1,h.rb=!1,h.orient="landscape","string"==typeof u.ExportPreviewInitialLoadEnabled&&(u.ExportPreviewInitialLoadEnabled="not-set"!==u.ExportPreviewInitialLoadEnabled&&JSON.parse(u.ExportPreviewInitialLoadEnabled.toLowerCase())),"string"==typeof u.ExportPreviewEnabled&&(u.ExportPreviewEnabled="not-set"!==u.ExportPreviewEnabled&&JSON.parse(u.ExportPreviewEnabled.toLowerCase())),"string"==typeof u.ExportPreviewSaveToBlobEnabled&&(u.ExportPreviewSaveToBlobEnabled="not-set"!==u.ExportPreviewSaveToBlobEnabled&&JSON.parse(u.ExportPreviewSaveToBlobEnabled.toLowerCase())),J=!0,ee(),1===f.Role?(k.find(".readonly").removeClass("hidden"),k.find(".edit").addClass("hidden")):(k.find(".readonly").addClass("hidden"),k.find(".edit").removeClass("hidden")),X(),D.hide(),i=!1,m.show(k)}};